# æ•°æ®åº“æŒä¹…åŒ–é—®é¢˜ - æœ€ç»ˆè¯Šæ–­æŠ¥å‘Š

## é—®é¢˜ç°çŠ¶

æ ¹æ®æœ€æ–°æ—¥å¿—ï¼ˆ2025-11-17 04:59ï¼‰ï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

### 1. `SQLiteException: not an error`
```
2025-11-17 04:00:52.205 é”™è¯¯ AutoBet   å¼‚å¸¸æ¶ˆæ¯: not an error
```

### 2. å¤šä¸ªæµè§ˆå™¨å¯åŠ¨
```
2025-11-17 04:59:40.537 ä¿¡æ¯ AutoBet é…ç½®è¿æ¥çŠ¶æ€: å·²è¿æ¥
2025-11-17 04:59:42.281 ä¿¡æ¯ AutoBet è¯´æ˜ï¼šæ¢å¤ç”±ç›‘æ§ä»»åŠ¡ç»Ÿä¸€å¤„ç†...
```
ç”¨æˆ·åé¦ˆï¼š"åˆå¯åŠ¨ä¸¤ä¸ªæµè§ˆå™¨äº†"

### 3. æ•°æ®åº“è¡¨ç¼ºå¤±è­¦å‘Š
```
è­¦å‘Š BinggoLotteryService ä¿å­˜æœŸå· XXX æ•°æ®å¤±è´¥: no such table: BinggoLotteryData
```

## æ ¹æœ¬åŸå› åˆ†æ

### åŸå› 1ï¼š`BetConfig` å±æ€§æœªæ­£ç¡®è§¦å‘ `PropertyChanged`

ç»è¿‡æ·±å…¥åˆ†æï¼Œå‘ç°è™½ç„¶æˆ‘ä»¬å·²ç»ä¸º `Username` å’Œ `Password` æ·»åŠ äº† `PropertyChanged` é€šçŸ¥ï¼Œä½†**è¿˜æœ‰å¾ˆå¤šå…¶ä»–å±æ€§æ²¡æœ‰å®ç°**ï¼š

- `ConfigName` âŒ
- `Platform` âŒ
- `PlatformUrl` âŒ
- `IsEnabled` âŒ **ï¼ˆè¿™ä¸ªå¾ˆå…³é”®ï¼ï¼‰**
- `ShowBrowserWindow` âŒ
- `MinBetAmount` âŒ
- `MaxBetAmount` âŒ
- `AutoLogin` âŒ
- `Notes` âŒ
- `IsDefault` âŒ
- `Cookies` âŒ
- `CookieUpdateTime` âŒ

**å½“è¿™äº›å±æ€§è¢«ä¿®æ”¹æ—¶ï¼Œ`BetConfigBindingList` æ— æ³•æ„ŸçŸ¥å˜åŒ–ï¼Œå› æ­¤æ— æ³•è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“ï¼**

### åŸå› 2ï¼š`EnsureDefaultConfig` ä¸­çš„é€»è¾‘é—®é¢˜

`EnsureDefaultConfig` æ–¹æ³•åœ¨ä¿®æ”¹ `defaultConfig.IsEnabled`ã€`defaultConfig.PlatformUrl` ç­‰å±æ€§æ—¶ï¼Œç”±äºè¿™äº›å±æ€§æ²¡æœ‰å®ç° `PropertyChanged`ï¼Œæ‰€ä»¥ä¿®æ”¹**ä¸ä¼šè¢«ä¿å­˜åˆ°æ•°æ®åº“**ã€‚

### åŸå› 3ï¼šå¤šæµè§ˆå™¨å¯åŠ¨çš„åŸå› 

1. `SetDatabase` ä¸­æœ‰ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ£€æŸ¥æµè§ˆå™¨è¿›ç¨‹
2. `MonitorBrowsers` å®šæ—¶å™¨æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
3. å¦‚æœé…ç½®çš„ `IsEnabled` çŠ¶æ€åœ¨æ•°æ®åº“ä¸­ä¸ä¸€è‡´ï¼ˆå› ä¸ºæ²¡æœ‰æ­£ç¡®ä¿å­˜ï¼‰ï¼Œå¯èƒ½å¯¼è‡´é‡å¤å¯åŠ¨

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šä¸ºæ‰€æœ‰æŒä¹…åŒ–å±æ€§å®ç° `PropertyChanged`

#### ç¬¬1æ­¥ï¼šä¿®æ”¹ `BetConfig.cs`

å°†æ‰€æœ‰éœ€è¦æŒä¹…åŒ–çš„å±æ€§æ”¹ä¸ºå¸¦ `PropertyChanged` é€šçŸ¥çš„å®Œæ•´å±æ€§ï¼š

```csharp
// æŒä¹…åŒ–å±æ€§ï¼ˆéœ€è¦ PropertyChanged é€šçŸ¥ï¼‰
private string _configName = "é»˜è®¤é…ç½®";
public string ConfigName
{
    get => _configName;
    set => SetField(ref _configName, value);
}

private string _platform = "é€šå®";
public string Platform
{
    get => _platform;
    set => SetField(ref _platform, value);
}

private string _platformUrl = "";
public string PlatformUrl
{
    get => _platformUrl;
    set => SetField(ref _platformUrl, value);
}

private bool _isEnabled = false;
public bool IsEnabled  // ğŸ”¥ éå¸¸å…³é”®ï¼
{
    get => _isEnabled;
    set => SetField(ref _isEnabled, value);
}

// ... å…¶ä»–å±æ€§ç±»ä¼¼å¤„ç†
```

#### ç¬¬2æ­¥ï¼šåŒºåˆ†è¿è¡Œæ—¶å±æ€§

å¯¹äº**ä¸éœ€è¦æŒä¹…åŒ–**çš„å±æ€§ï¼Œä¿æŒä¸ºè‡ªåŠ¨å±æ€§å³å¯ï¼š

```csharp
// è¿è¡Œæ—¶æ•°æ®ï¼ˆä¸éœ€è¦ PropertyChangedï¼Œä¸éœ€è¦æŒä¹…åŒ–ï¼‰
[Ignore] public string Status { get; set; } = "æœªè¿æ¥";
[Ignore] public int ProcessId { get; set; }
[Ignore] public BrowserClient? Browser { get; set; }
```

### å…³é”®æ”¹è¿›ç‚¹

1. **`IsEnabled` å±æ€§å¿…é¡»æœ‰ PropertyChanged é€šçŸ¥** - è¿™æ˜¯æœ€å…³é”®çš„ï¼Œå¦åˆ™ç”¨æˆ·åœ¨UIä¸Šå¼€å¯/å…³é—­é£å•å¼€å…³åï¼ŒçŠ¶æ€ä¸ä¼šä¿å­˜åˆ°æ•°æ®åº“ï¼Œå¯¼è‡´ä¸‹æ¬¡å¯åŠ¨æ—¶çŠ¶æ€é”™è¯¯

2. **æ‰€æœ‰é…ç½®é¡¹éƒ½åº”è¯¥æœ‰ PropertyChanged é€šçŸ¥** - åŒ…æ‹¬è´¦å·ã€å¯†ç ã€å¹³å°URLã€é™é¢ç­‰

3. **è¿è¡Œæ—¶å±æ€§æ˜ç¡®æ ‡è®° `[Ignore]`** - é¿å…è¯¯ä¿å­˜åˆ°æ•°æ®åº“

## éªŒè¯æ–¹æ³•

### 1. æ·»åŠ è¯¦ç»†æ—¥å¿—

åœ¨ `BetConfigBindingList.cs` çš„ `PropertyChanged` å¤„ç†ä¸­æ·»åŠ æ—¥å¿—ï¼š

```csharp
item.PropertyChanged += (s, e) =>
{
    if (item.Id > 0)
    {
        try
        {
            _log.Info("BetConfig", $"ğŸ”” å±æ€§å˜æ›´: [{item.ConfigName}] {e.PropertyName} = {item.GetType().GetProperty(e.PropertyName)?.GetValue(item)}");
            
            lock (_dbLock)
            {
                int affectedRows = _db.Update(item);
                _log.Info("BetConfig", $"âœ… æ•°æ®åº“å·²æ›´æ–°: å½±å“è¡Œæ•°={affectedRows}");
            }
        }
        catch (Exception ex)
        {
            _log.Error("BetConfig", $"âŒ ä¿å­˜é…ç½®å¤±è´¥: {ex.Message}", ex);
        }
    }
};
```

### 2. æ•°æ®åº“éªŒè¯

ä¿®æ”¹åï¼Œæ‰“å¼€ `business.db`ï¼Œæ£€æŸ¥ï¼š
```sql
SELECT Id, ConfigName, Username, Password, IsEnabled, Platform 
FROM AutoBetConfigs;
```

åº”è¯¥èƒ½çœ‹åˆ°æ‰€æœ‰ä¿®æ”¹éƒ½è¢«æ­£ç¡®ä¿å­˜ã€‚

## é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼š

âœ… è´¦å·/å¯†ç ä¿®æ”¹å**ç«‹å³ä¿å­˜**  
âœ… é£å•å¼€å…³çŠ¶æ€**ç«‹å³ä¿å­˜**  
âœ… å¹³å°ã€é™é¢ç­‰é…ç½®**ç«‹å³ä¿å­˜**  
âœ… ç¨‹åºé‡å¯å**é…ç½®å®Œæ•´æ¢å¤**  
âœ… ä¸ä¼šå‡ºç°å¤šä¸ªæµè§ˆå™¨å¯åŠ¨  
âœ… æ—¥å¿—ä¸­ä¸å†å‡ºç° `SQLiteException: not an error`

## ä¸‹ä¸€æ­¥

ç«‹å³ä¿®æ”¹ `BetConfig.cs`ï¼Œä¸ºæ‰€æœ‰æŒä¹…åŒ–å±æ€§å®ç° `INotifyPropertyChanged`ã€‚

