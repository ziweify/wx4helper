# 测试平台说明文档

> **创建日期**: 2026-01-18  
> **平台名称**: 测试平台  
> **用途**: 开发测试，模拟投注操作

---

## 📋 概述

测试平台是一个专门用于开发和测试的虚拟投注平台，**不会发送任何真实的投注请求**。所有操作都是模拟的，包括登录、投注、查询余额等。

---

## ✅ 功能特性

### 1. 自动登录成功
- **操作**: 输入任意用户名和密码
- **结果**: 0.5秒后自动返回登录成功
- **初始余额**: 10,000元（模拟）

### 2. 模拟投注成功
- **操作**: 发送投注命令
- **验证**: 
  - 检查是否登录
  - 检查余额是否足够
  - 打印投注内容到日志
- **结果**: 
  - 返回模拟订单号（格式：`TEST{时间戳}_{计数器}`）
  - 扣除模拟余额
  - 返回与通宝平台相同格式的响应
- **延迟**: 300毫秒（模拟网络延迟）

### 3. 查询余额
- **操作**: 查询账户余额
- **结果**: 返回当前模拟余额（初始10,000元，随投注扣除）
- **延迟**: 200毫秒

### 4. 赔率列表
- **支持玩法**: 与真实平台完全相同
  - 平码：平一~平五（大小单双尾大尾小合单合双）
  - 和值：大小单双尾大尾小
  - 龙虎
- **赔率**: 统一为 1.97

### 5. 订单查询
- **操作**: 查询未结算/已结算订单
- **结果**: 返回空列表（测试平台不保存订单）
- **延迟**: 200毫秒

---

## 🔧 使用方法

### 1. 在配置管理中选择平台

1. 打开 BaiShengVx3Plus 主程序
2. 进入"配置管理"
3. 在"投注平台"下拉框中选择 **"测试平台"**
4. 设置盘口地址为 `https://www.baidu.com/` （或任意网址）
5. 保存配置

### 2. 登录

1. 输入任意用户名和密码（例如：`test` / `123456`）
2. 点击"登录"按钮
3. 等待0.5秒后，系统显示"✅ 登录成功！"

### 3. 投注测试

1. 在主程序中正常下单（例如：在微信群发送 `1大100`）
2. 系统会自动合并订单并发送到浏览器客户端
3. 浏览器客户端收到投注命令后：
   - 打印投注内容到日志
   - 检查余额
   - 模拟投注延迟（300毫秒）
   - 返回成功响应
4. 主程序收到响应后，更新订单状态为"已投注"

### 4. 查看日志

所有操作都会在浏览器客户端的日志中显示，前缀为 `[测试平台]`，方便识别：

```
🔐 [测试平台] 开始登录: test
✅ [测试平台] 登录成功！用户: test
💰 [测试平台] 模拟余额: 10000.00 元
🎲 [测试平台] 开始投注: 期号115002200 共3项 300元
   - P1 大: 100元
   - P2 小: 100元
   - P3 单: 100元
✅ [测试平台] 投注成功: TEST1737187200_1
💰 [测试平台] 剩余余额: 9700.00 元
```

---

## 📁 文件清单

### 新增文件

| 文件路径 | 说明 |
|---------|------|
| `BsBrowserClient/PlatformScripts/TestPlatformScript.cs` | 测试平台脚本实现 |
| `BsBrowserClient/PlatformScripts/测试平台说明文档.md` | 本文档 |

### 修改文件

| 文件路径 | 修改内容 |
|---------|---------|
| `Unit.Shared/Platform/BetPlatform.cs` | 添加枚举值 `测试平台 = 99` |
| `Unit.Shared/Platform/BetPlatform.cs` | 添加平台配置（DefaultUrl, LegacyNames） |
| `BsBrowserClient/Form1.cs` | 注册 `TestPlatformScript` 到平台脚本 switch 中 |

---

## 🎯 使用场景

### 1. 功能开发
- 无需真实平台账号
- 快速验证订单流程
- 测试UI交互逻辑

### 2. BUG调试
- 隔离平台问题（排除网络、认证等干扰）
- 快速复现问题场景
- 观察日志输出

### 3. 演示培训
- 安全的演示环境（不会误操作真实账号）
- 清晰的日志输出（便于教学）

### 4. 压力测试
- 模拟高频投注（无网络延迟限制）
- 验证订单队列机制
- 测试并发处理能力

---

## ⚙️ 技术细节

### 实现类

```csharp
namespace BsBrowserClient.PlatformScripts
{
    public class TestPlatformScript : IPlatformScript
    {
        // 实现 IPlatformScript 接口的所有方法
    }
}
```

### 关键特性

1. **无网络请求**: 所有操作都在本地完成，不发送HTTP请求
2. **完整接口**: 实现了 `IPlatformScript` 的所有方法
3. **日志前缀**: 所有日志都带 `[测试平台]` 前缀，便于识别
4. **兼容格式**: 返回的响应格式与真实平台（如通宝）完全一致

### 返回格式示例

**登录成功**:
```json
{
  "success": true,
  "username": "test",
  "balance": 10000.00
}
```

**投注成功**:
```json
{
  "status": true,
  "BettingNumber": "TEST1737187200_1",
  "msg": "投注成功",
  "balance": 9700.00
}
```

**投注失败**（余额不足）:
```json
{
  "status": false,
  "msg": "余额不足"
}
```

---

## 🔒 安全说明

1. **不会发送真实请求**: 所有操作都是模拟的
2. **不会修改真实数据**: 余额、订单等都是内存中的模拟数据
3. **不会访问真实平台**: 即使设置了盘口地址，也不会真正访问

**⚠️ 注意**: 虽然测试平台是安全的，但请确保在正式环境中切换回真实平台！

---

## 🐛 已知限制

1. **订单查询返回空**: 测试平台不保存订单，`GetLotMainOrderInfosAsync` 始终返回空列表
2. **余额不会恢复**: 重启程序后余额会重置为10,000元
3. **没有真实开奖**: 订单状态需要手动管理

---

## 📞 支持

如有问题或建议，请联系开发团队。

---

## 📝 更新记录

### 2026-01-18
- ✅ 创建测试平台脚本
- ✅ 添加到平台枚举和配置
- ✅ 注册到浏览器客户端
- ✅ 编译测试通过
- ✅ 编写说明文档
