# BsBrowserClient 版本号功能说明

## ✅ 已实现功能

### 1. 版本号配置

在 `BsBrowserClient.csproj` 中配置版本号：

```xml
<PropertyGroup>
  <Version>1.0.0.118</Version>
  <AssemblyVersion>1.0.0.118</AssemblyVersion>
  <FileVersion>1.0.0.118</FileVersion>
  <InformationalVersion>1.0.0.118-测试平台支持</InformationalVersion>
</PropertyGroup>
```

**版本号说明**：
- `1.0.0.118`：当前版本
- `118`：构建号（2026年1月18日）
- `-测试平台支持`：版本描述

### 2. 窗口标题显示版本号

**格式**：`配置名称 [平台] - v版本号`

**示例**：
```
默认配置 [测试平台] - v1.0.0.118-测试平台支持
```

**特点**：
- 配置名称在前
- 平台显示在方括号中
- 版本号在最后，以 `- v` 分隔
- 这样即使其他代码修改了标题前面部分，版本号也会保留在末尾

### 3. 日志中输出版本信息

启动时输出详细的版本和配置信息：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 BsBrowserClient 启动
📌 版本号: 1.0.0.118-测试平台支持
📌 启动时间: 2026-01-18 17:45:30
📌 进程ID: 12345
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 配置参数:
   配置ID: 1
   配置名称: 默认配置
   Socket端口: 9527
   投注平台: 测试平台
   平台URL: https://www.baidu.com/
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ WebView2 初始化完成
✅ 平台脚本初始化完成: 测试平台
   脚本类型: TestPlatformScript
✅ Socket服务器启动: 端口9527
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎉 BrowserClient 初始化成功
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 4. 状态栏显示版本号

底部状态栏格式：

```
v1.0.0.118-测试平台支持 | 配置: 默认配置 (ID:1) | 平台: 测试平台
```

---

## 🎯 如何验证浏览器是否重启

### 方法1：查看窗口标题

1. 打开浏览器窗口
2. 查看标题栏最右侧
3. 应该显示：`- v1.0.0.118-测试平台支持`

**如果版本号不同**：
- 旧版本（如 `v1.0.0.0`）→ 浏览器未重启
- 新版本（如 `v1.0.0.118`）→ 浏览器已重启 ✅

### 方法2：查看日志输出

1. 打开浏览器窗口
2. 查看日志面板（或日志文件）
3. 找到启动时的版本信息行：
   ```
   📌 版本号: 1.0.0.118-测试平台支持
   ```

### 方法3：查看平台脚本类型

在日志中找到：
```
✅ 平台脚本初始化完成: 测试平台
   脚本类型: TestPlatformScript
```

**如果显示其他脚本**：
- `YunDing28Script` → 浏览器未重启，仍使用旧配置
- `TestPlatformScript` → 浏览器已重启，使用新配置 ✅

### 方法4：查看进程ID

每次启动浏览器，进程ID都会改变：

```
📌 进程ID: 12345
```

对比两次启动的进程ID：
- 相同 → 浏览器未重启
- 不同 → 浏览器已重启 ✅

---

## 🔄 版本号更新流程

### 1. 修改版本号

编辑 `BsBrowserClient/BsBrowserClient.csproj`：

```xml
<Version>1.0.0.119</Version>
<AssemblyVersion>1.0.0.119</AssemblyVersion>
<FileVersion>1.0.0.119</FileVersion>
<InformationalVersion>1.0.0.119-修复XXX问题</InformationalVersion>
```

### 2. 重新编译

```bash
cd BsBrowserClient
dotnet build
```

### 3. 复制到运行目录

```bash
copy bin\Debug\net8.0-windows\BsBrowserClient.exe ..\BaiShengVx3Plus\bin\Debug\net8.0-windows\
```

或者编译整个解决方案，会自动复制。

### 4. 验证

1. 关闭旧的浏览器进程
2. 启动新的浏览器
3. 查看标题栏或日志，确认版本号已更新

---

## 📋 版本号命名规范

**格式**：`主版本.次版本.修订版.构建号-描述`

**示例**：
- `1.0.0.118-测试平台支持`
- `1.0.1.119-修复投注BUG`
- `1.1.0.120-新增云顶平台`

**字段说明**：
- **主版本**（Major）：重大功能变更或架构重构
- **次版本**（Minor）：新增功能
- **修订版**（Patch）：BUG修复
- **构建号**（Build）：每次编译递增（建议使用日期，如 `118` = 1月18日）
- **描述**（Tag）：简要说明本次更新内容

---

## 🛠️ 实现细节

### 代码位置

**Form1.cs**：

```csharp
// 🔥 版本号（从程序集读取）
private static readonly string VERSION = Assembly.GetExecutingAssembly()
    .GetCustomAttribute<AssemblyInformationalVersionAttribute>()?.InformationalVersion 
    ?? Assembly.GetExecutingAssembly().GetName().Version?.ToString() 
    ?? "1.0.0.0";
```

**为什么使用 InformationalVersion**：
1. 可以包含版本描述（如 `-测试平台支持`）
2. 不受 AssemblyVersion 的限制（AssemblyVersion 只能是数字）
3. 如果未设置，自动回退到 Version

### 标题格式

```csharp
// 🔥 设置窗口标题：标题内容 - 版本号
this.Text = $"{configName} [{platform}] - v{VERSION}";
```

**格式说明**：
- `{configName}`：配置名称（如"默认配置"）
- `[{platform}]`：平台名称（如"测试平台"）
- `- v{VERSION}`：版本号（始终在最后）

### 日志输出

```csharp
OnLogMessage("━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━");
OnLogMessage($"🚀 BsBrowserClient 启动");
OnLogMessage($"📌 版本号: {VERSION}");
OnLogMessage($"📌 启动时间: {DateTime.Now:yyyy-MM-dd HH:mm:ss}");
OnLogMessage($"📌 进程ID: {System.Diagnostics.Process.GetCurrentProcess().Id}");
OnLogMessage("━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━");
// ... 更多配置信息 ...
```

---

## ✅ 验证清单

每次修改配置或更新版本后，请确认：

- [ ] 窗口标题显示新版本号（格式：`配置 [平台] - v版本号`）
- [ ] 状态栏显示新版本号（格式：`v版本号 | ...`）
- [ ] 日志输出新版本号（`📌 版本号: ...`）
- [ ] 日志显示正确的平台（`投注平台: 测试平台`）
- [ ] 日志显示正确的脚本类型（`脚本类型: TestPlatformScript`）
- [ ] 进程ID与上次不同（说明是新进程）
- [ ] 投注测试返回正确的结果

---

## 📝 更新记录

### v1.0.0.118 (2026-01-18)
- ✅ 添加版本号支持
- ✅ 窗口标题显示版本号
- ✅ 日志输出版本信息、启动时间、进程ID
- ✅ 日志输出详细的配置参数
- ✅ 日志输出平台脚本类型
- ✅ 状态栏显示版本号
- ✅ 支持测试平台（TestPlatformScript）

---

**总结**：
- 版本号显示在窗口标题最右侧（`- v版本号`）
- 无论标题内容如何变化，版本号始终保留
- 日志中详细记录版本、时间、进程ID、平台信息
- 方便验证浏览器是否真的重启了
