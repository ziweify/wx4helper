# 测试平台配置不生效问题诊断

## ❌ 问题现象

虽然在配置中选择了"测试平台"，但投注时返回：
```
#云顶28平台投注功能待实现
```

这说明浏览器客户端实际使用的是**云顶平台**，而不是测试平台。

---

## 🔍 诊断步骤

### 步骤1：检查浏览器客户端日志

请查看浏览器客户端窗口的日志，找到**启动时的日志**（前20行左右）。

#### ❌ 如果看到这样的日志（错误）

```
初始化平台脚本: 云顶
创建平台脚本: YunDing28Script
```

说明浏览器客户端仍在使用云顶平台。

#### ✅ 应该看到这样的日志（正确）

```
初始化平台脚本: 测试平台
创建平台脚本: TestPlatformScript
🔐 [测试平台] 开始登录: ...
```

---

### 步骤2：确认是否重启了浏览器客户端

**关键**：修改配置后，**必须关闭并重新启动浏览器客户端**！

#### 正确的操作流程

1. **关闭旧的浏览器客户端窗口**
   - 找到浏览器客户端窗口
   - 点击窗口右上角的 ❌ 关闭按钮
   - **确保窗口完全关闭**

2. **在 BaiShengVx3Plus 中启动新的浏览器**
   - 找到"启动浏览器"按钮
   - 点击启动
   - 等待新窗口打开

3. **查看新窗口的日志**
   - 应该显示 `[测试平台]` 前缀

#### ⚠️ 常见错误

❌ **只是最小化窗口** - 浏览器客户端仍在运行，配置不会更新  
❌ **没有重启** - 旧的浏览器客户端还在使用旧配置  
❌ **修改配置时浏览器已启动** - 需要重启才能生效

---

### 步骤3：检查配置是否保存

#### 方法1：在BaiShengVx3Plus中检查

1. 打开 BaiShengVx3Plus
2. 查看主界面右侧的**投注平台下拉框**
3. 确认当前显示的是什么

**期望**：应该显示 **"测试平台"**

#### 方法2：查看配置文件（高级）

配置文件可能在：
- `BaiShengVx3Plus/bin/Debug/config.db`（SQLite数据库）

查询命令（如果您熟悉SQLite）：
```sql
SELECT * FROM BetConfig WHERE IsDefault = 1;
```

查看 `Platform` 字段应该是 **"测试平台"**

---

## 🛠️ 解决方案

### 方案1：标准流程（推荐）

1. **确认配置**
   - 打开 BaiShengVx3Plus
   - 在主界面找到"投注平台"下拉框
   - 选择 **"测试平台"**
   - 点击"保存配置"按钮（如果有）

2. **完全关闭浏览器**
   - 找到浏览器客户端窗口
   - 点击 ❌ 关闭
   - 确保窗口消失

3. **重新启动浏览器**
   - 在 BaiShengVx3Plus 中点击"启动浏览器"
   - 等待新窗口打开

4. **验证日志**
   - 查看新窗口的日志
   - 应该看到：`🔐 [测试平台] 开始登录: ...`

5. **测试投注**
   - 投注 `1234大10`
   - 应该返回：`Success=true, OrderId="TEST..."`

---

### 方案2：强制重启（如果方案1不起作用）

1. **完全关闭所有程序**
   - 关闭 BaiShengVx3Plus
   - 关闭所有浏览器客户端窗口
   - 等待5秒

2. **重新启动 BaiShengVx3Plus**
   - 启动 BaiShengVx3Plus.exe
   - 等待程序完全加载

3. **检查并修改配置**
   - 在主界面找到"投注平台"
   - 选择"测试平台"
   - 保存

4. **启动浏览器**
   - 点击"启动浏览器"
   - 查看日志

---

### 方案3：手动编辑配置（高级用户）

如果配置界面不工作，可以手动编辑数据库：

1. **关闭 BaiShengVx3Plus 和浏览器**

2. **打开数据库文件**
   - 使用 SQLite 工具（如 DB Browser for SQLite）
   - 打开 `BaiShengVx3Plus/bin/Debug/config.db`

3. **修改配置**
   ```sql
   UPDATE BetConfig 
   SET Platform = '测试平台'
   WHERE IsDefault = 1;
   ```

4. **保存并关闭数据库**

5. **重新启动程序**

---

## 🔍 验证方法

### 验证1：浏览器客户端日志

**查找这些关键行**：

❌ **错误**（仍在使用云顶）：
```
初始化平台脚本: 云顶
创建平台脚本: YunDing28Script
```

✅ **正确**（使用测试平台）：
```
初始化平台脚本: 测试平台
创建平台脚本: TestPlatformScript
🔐 [测试平台] 开始登录: test
✅ [测试平台] 登录成功！用户: test
💰 [测试平台] 模拟余额: 10000.00 元
```

### 验证2：投注返回

❌ **错误**：
```json
{
  "Success": false,
  "ErrorMessage": "#云顶28平台投注功能待实现"
}
```

✅ **正确**：
```json
{
  "Success": true,
  "OrderId": "TEST1737187455_1",
  "Result": "{\"status\":true,\"BettingNumber\":\"TEST1737187455_1\",\"msg\":\"投注成功\",\"balance\":9960.00}"
}
```

---

## 📋 检查清单

请按顺序检查：

- [ ] 在 BaiShengVx3Plus 主界面，投注平台下拉框显示"测试平台"
- [ ] 点击了"保存配置"按钮
- [ ] **完全关闭了**旧的浏览器客户端窗口（不是最小化）
- [ ] 重新启动了浏览器客户端
- [ ] 浏览器客户端日志中显示 `[测试平台]` 前缀
- [ ] 投注返回包含 `TEST` 前缀的订单号

**如果以上全部勾选，测试平台应该工作正常！**

---

## 🐛 调试信息

如果按照以上步骤仍然不工作，请提供：

### 1. BaiShengVx3Plus 主界面截图
- 显示"投注平台"下拉框的选择

### 2. 浏览器客户端日志（前50行）
- 从程序启动开始
- 包含"初始化平台脚本"的行

### 3. 投注命令的完整返回
- 您已提供，显示使用的是云顶平台

### 4. 配置文件内容
```sql
-- 执行这个查询
SELECT ConfigName, Platform, PlatformUrl, IsDefault 
FROM BetConfig;
```

---

## ⚠️ 重要提示

**关键点**：配置修改后，**必须重启浏览器客户端**才能生效！

1. ❌ 最小化窗口 → 不起作用
2. ❌ 刷新页面 → 不起作用
3. ✅ **完全关闭并重新启动** → 这才是正确的

---

## 💡 快速验证

**最快的验证方法**：

1. 关闭浏览器客户端窗口
2. 在 BaiShengVx3Plus 中重新启动浏览器
3. 查看浏览器日志的前5行
4. 如果看到 `[测试平台]`，说明成功；如果看到其他平台名，说明配置没生效

---

**请按照上述步骤操作，然后告诉我结果！** 🔍
