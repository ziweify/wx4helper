# 日志文件命名更新说明

> **更新**: 日志文件名改为"日期+时间"格式  
> **优势**: 可以区分每次启动，知道启动了几次  
> **日期**: 2025-12-16

---

## 📝 **命名变化**

### **之前的命名（按日期）**

```
BsBrowserClient_20251216.log  (当天所有启动共用一个文件)
```

**问题**:
- ❌ 多次启动会追加到同一个文件
- ❌ 无法区分是哪次启动的日志
- ❌ 文件会越来越大

### **现在的命名（日期+时间）**

```
BsBrowserClient_20251216_153025.log  (15:30:25 启动)
BsBrowserClient_20251216_160145.log  (16:01:45 启动)
BsBrowserClient_20251216_183520.log  (18:35:20 启动)
```

**优势**:
- ✅ 每次启动创建新文件
- ✅ 可以看到启动了几次
- ✅ 可以快速找到某次启动的日志
- ✅ 文件大小可控

---

## 🕐 **文件名格式**

### **完整格式**

```
BsBrowserClient_yyyyMMdd_HHmmss.log
```

### **格式说明**

| 部分 | 格式 | 示例 | 说明 |
|------|------|------|------|
| 前缀 | `BsBrowserClient_` | 固定 | 程序标识 |
| 日期 | `yyyyMMdd` | `20251216` | 年月日 |
| 分隔符 | `_` | `_` | 下划线 |
| 时间 | `HHmmss` | `153025` | 时分秒（24小时制） |
| 后缀 | `.log` | `.log` | 日志文件 |

### **实际示例**

```
文件名: BsBrowserClient_20251216_153025.log

解析:
- 日期: 2025年12月16日
- 时间: 15:30:25 (下午 3:30:25)
- 含义: 该日志记录了 2025年12月16日下午3点30分25秒启动的程序日志
```

---

## 📂 **文件夹结构示例**

### **单天多次启动**

```
%LocalAppData%\BaiShengVx3Plus\log\
├── BsBrowserClient_20251216_090512.log  (上午 9:05:12 启动)
├── BsBrowserClient_20251216_143028.log  (下午 2:30:28 启动)
├── BsBrowserClient_20251216_183645.log  (下午 6:36:45 启动)
└── BsBrowserClient_20251216_220105.log  (晚上 10:01:05 启动)
```

**说明**: 2025年12月16日启动了 **4 次**

### **多天启动**

```
%LocalAppData%\BaiShengVx3Plus\log\
├── BsBrowserClient_20251210_091530.log  (7 天前)
├── BsBrowserClient_20251210_150245.log
├── BsBrowserClient_20251211_084512.log
├── BsBrowserClient_20251212_093028.log
├── BsBrowserClient_20251213_101645.log
├── BsBrowserClient_20251214_085105.log
├── BsBrowserClient_20251215_092330.log
├── BsBrowserClient_20251215_164520.log
├── BsBrowserClient_20251216_090512.log  (今天)
├── BsBrowserClient_20251216_143028.log  (当前运行)
└── ...
```

---

## 🔍 **如何快速找到日志**

### **方法 1: 按时间排序**

1. 打开日志文件夹：
   ```
   %LocalAppData%\BaiShengVx3Plus\log
   ```

2. 在文件管理器中按"修改时间"排序
3. 最新的文件在最上面（或最下面）

### **方法 2: 按名称排序**

1. 在文件管理器中按"名称"排序
2. 文件会自动按时间顺序排列（因为文件名包含时间戳）

### **方法 3: 搜索**

1. 在文件管理器的搜索框中输入日期：
   ```
   BsBrowserClient_20251216
   ```

2. 会显示该日期的所有启动日志

### **方法 4: 查看当前日志**

程序启动时会显示：
```
💾 日志持久化已启动: BsBrowserClient_20251216_153025.log
```

**直接打开该文件即可查看当前运行的日志**

---

## 🗑️ **自动清理**

### **清理策略**

- **保留时间**: 7 天
- **清理依据**: 文件的最后修改时间
- **清理时机**: 程序启动时

### **清理示例**

```
今天: 2025-12-16
保留: 2025-12-09 及之后的日志
删除: 2025-12-08 及之前的日志
```

### **清理日志输出**

```
已删除旧日志: BsBrowserClient_20251208_091530.log (2.34 MB)
已删除旧日志: BsBrowserClient_20251208_143520.log (3.12 MB)
已删除旧日志: BsBrowserClient_20251207_153025.log (1.89 MB)
✅ 已清理 3 个旧日志文件，释放 7.35 MB 空间
```

---

## 📊 **文件大小估算**

### **单次启动日志大小**

| 运行时长 | 正常使用 | 调试模式 |
|---------|---------|---------|
| 1 小时 | 5.4 MB | 72 MB |
| 4 小时 | 21.6 MB | 288 MB |
| 8 小时 | 43.2 MB | 576 MB |
| 24 小时 | 129.6 MB | 1.7 GB |

### **多次启动总大小（7 天）**

**场景 1: 每天启动 1 次，每次运行 8 小时**

```
正常使用: 43.2 MB/天 × 7 天 = 302 MB
调试模式: 576 MB/天 × 7 天 = 4 GB
```

**场景 2: 每天启动 3 次，每次运行 3 小时**

```
正常使用: 16.2 MB/次 × 3 次/天 × 7 天 = 340 MB
调试模式: 216 MB/次 × 3 次/天 × 7 天 = 4.5 GB
```

---

## 💡 **使用建议**

### **日常使用**

1. **关闭 HTTP 日志**
   - 减少日志量
   - 每次启动只有几十 MB

2. **让自动清理工作**
   - 保留最近 7 天
   - 自动释放空间

3. **定期查看日志文件夹**
   - 查看启动次数
   - 发现异常启动

### **调试模式**

1. **临时开启 HTTP 日志**
   - 只在需要调试时开启
   - 调试完立即关闭

2. **手动清理调试日志**
   - 调试完删除大日志文件
   - 节省磁盘空间

### **问题排查**

1. **确定问题发生时间**
   - 例如：下午 3 点左右出现问题

2. **找到对应的日志文件**
   ```
   BsBrowserClient_20251216_143028.log  (2:30 启动)
   BsBrowserClient_20251216_152015.log  (3:20 启动) ← 找这个
   ```

3. **搜索关键字**
   - 错误、异常、失败等

---

## 🔧 **技术实现**

### **文件名生成**

```csharp
// 在程序启动时生成文件名（构造函数中）
var now = DateTime.Now;
_currentLogFile = Path.Combine(
    _logFolder,
    $"BsBrowserClient_{now:yyyyMMdd_HHmmss}.log"
);
```

### **整个运行期间使用同一个文件**

```csharp
// 获取日志文件路径（不变）
private string GetLogFilePath()
{
    return _currentLogFile;  // 始终返回启动时确定的文件名
}
```

### **清理时跳过当前文件**

```csharp
foreach (var file in logFiles)
{
    // 跳过当前正在使用的日志文件
    if (file == _currentLogFile)
        continue;
    
    // 清理旧文件
    if (fileInfo.LastWriteTime < cutoffDate)
    {
        File.Delete(file);
    }
}
```

---

## 📋 **对比总结**

| 特性 | 按日期命名 | 按日期+时间命名 |
|------|-----------|----------------|
| **文件名** | `_20251216.log` | `_20251216_153025.log` |
| **启动区分** | ❌ 无法区分 | ✅ 清晰区分 |
| **启动次数** | ❌ 不知道 | ✅ 一目了然 |
| **文件大小** | ❌ 越来越大 | ✅ 单个文件可控 |
| **查找日志** | ⚠️ 需要看内容 | ✅ 看文件名即可 |
| **空间占用** | ⚠️ 单文件大 | ✅ 多文件分散 |
| **清理策略** | ✅ 按日期清理 | ✅ 按修改时间清理 |

---

## 🎉 **总结**

### **优势**

- ✅ **清晰**: 文件名即知启动时间
- ✅ **可控**: 单个文件大小可控
- ✅ **方便**: 快速找到某次启动的日志
- ✅ **统计**: 一眼看出启动次数

### **示例**

```
看到文件夹中有 5 个文件：
BsBrowserClient_20251216_090512.log
BsBrowserClient_20251216_120330.log
BsBrowserClient_20251216_143028.log
BsBrowserClient_20251216_162015.log
BsBrowserClient_20251216_183645.log

立即知道：今天启动了 5 次！
```

### **实用场景**

1. **排查问题**: "下午3点左右出问题了" → 找 `_143028.log` 或 `_150000.log`
2. **统计启动**: 看文件数量即知启动次数
3. **分析异常**: 为什么今天启动了10次？是有问题吗？
4. **性能监控**: 每次启动的日志大小，判断是否正常

**新的文件命名方式更加清晰、实用、易管理！** 🚀

