# å°ç›˜æŠ•æ³¨å®Œæ•´æµç¨‹è¯¦è§£

## ğŸ“Š æµç¨‹æ€»è§ˆ

```
å°ç›˜è§¦å‘ â†’ AutoBetCoordinatorè®¢é˜…äº‹ä»¶ â†’ æŸ¥è¯¢å¾…æŠ•æ³¨è®¢å• â†’ åˆå¹¶è®¢å• â†’ éªŒè¯é‡‘é¢ 
â†’ åˆ›å»ºæŠ•æ³¨è®°å½• â†’ å‘é€åˆ°æµè§ˆå™¨ â†’ æµè§ˆå™¨æ‰§è¡ŒæŠ•æ³¨ â†’ è¿”å›ç»“æœ â†’ æ›´æ–°è®¢å•çŠ¶æ€
```

---

## ğŸ”¥ è¯¦ç»†æµç¨‹æ­¥éª¤

### æ­¥éª¤0ï¼šå‰ç½®æ¡ä»¶ï¼ˆç”¨æˆ·å¯ç”¨é£å•å¼€å…³ï¼‰

**è§¦å‘ä½ç½®**ï¼š`VxMain.cs` â†’ `swiAutoOrdersBet_ValueChanged` (ç¬¬3568-3617è¡Œ)

```csharp
if (value) // å¼€å¯é£å•å¼€å…³
{
    // 1. ä¿å­˜è´¦å·å¯†ç è®¾ç½®
    SaveAutoBetSettings();
    
    // 2. è®¾ç½® BetConfig.IsEnabled = true
    defaultConfig.IsEnabled = true;
    
    // 3. ğŸ”¥ å…³é”®ï¼šå¯åŠ¨ AutoBetCoordinatorï¼ˆè®¢é˜…å°ç›˜äº‹ä»¶ï¼‰
    _ = Task.Run(async () =>
    {
        var success = await _autoBetCoordinator.StartAsync(defaultConfig.Id);
    });
}
```

**å…³é”®ä½œç”¨**ï¼š
- âœ… `_autoBetCoordinator.StartAsync()` è®¢é˜… `BinggoLotteryService.StatusChanged` äº‹ä»¶
- âœ… ç›‘æ§çº¿ç¨‹è‡ªåŠ¨å¯åŠ¨æµè§ˆå™¨ï¼ˆå¦‚æœæœªè¿æ¥ï¼‰
- âœ… ç³»ç»Ÿè¿›å…¥"å‡†å¤‡æ¥å•"çŠ¶æ€

---

### æ­¥éª¤1ï¼šå°ç›˜è§¦å‘ï¼ˆBinggoLotteryServiceï¼‰

**è§¦å‘ä½ç½®**ï¼š`BinggoLotteryService.cs` â†’ `UpdateStatus` æ–¹æ³•

```csharp
// å½“å‰©ä½™æ—¶é—´ <= 0 æ—¶ï¼Œåˆ‡æ¢åˆ°"å°ç›˜ä¸­"
if (secondsToSeal <= 0)
{
    newStatus = BinggoLotteryStatus.å°ç›˜ä¸­;
    
    // ğŸ”¥ è§¦å‘çŠ¶æ€å˜æ›´äº‹ä»¶
    StatusChanged?.Invoke(this, new BinggoStatusChangedEventArgs
    {
        OldStatus = _currentStatus,
        NewStatus = newStatus,
        IssueId = _currentIssueId
    });
}
```

**å…³é”®æ•°æ®**ï¼š
- `IssueId`: å½“å‰æœŸå·
- `OldStatus`: ä¸Šä¸€ä¸ªçŠ¶æ€ï¼ˆå¦‚ `å¼€ç›˜ä¸­`ï¼‰
- `NewStatus`: `å°ç›˜ä¸­`

---

### æ­¥éª¤2ï¼šAutoBetCoordinatoræ¥æ”¶å°ç›˜äº‹ä»¶

**å¤„ç†ä½ç½®**ï¼š`AutoBetCoordinator.cs` â†’ `LotteryService_StatusChanged` (ç¬¬161-200è¡Œ)

```csharp
private async void LotteryService_StatusChanged(object? sender, BinggoStatusChangedEventArgs e)
{
    if (e.NewStatus == BinggoLotteryStatus.å°ç›˜ä¸­)
    {
        // ğŸ”¥ é˜²æ­¢é‡å¤æŠ•æ³¨ï¼šåŒé‡æ£€æŸ¥
        if (_hasProcessedCurrentIssue) return;  // å·²å¤„ç†è¿‡å½“å‰æœŸå·
        if (_lastStatus == BinggoLotteryStatus.å°ç›˜ä¸­) return;  // å·²ç»åœ¨å°ç›˜ä¸­
        
        _lastStatus = e.NewStatus;
        _hasProcessedCurrentIssue = true;  // æ ‡è®°å·²å¤„ç†
        
        // ç»§ç»­å¤„ç†...
    }
}
```

**æ—¥å¿—è¾“å‡º**ï¼š
```
ğŸ“¢ çŠ¶æ€å˜æ›´äº‹ä»¶è§¦å‘: å¼€ç›˜ä¸­ â†’ å°ç›˜ä¸­, æœŸå·:20231118001
   ä¸Šæ¬¡çŠ¶æ€: å¼€ç›˜ä¸­
   å½“å‰çŠ¶æ€: å°ç›˜ä¸­
   é…ç½®ID: 1
ğŸ¯ è§¦å‘å°ç›˜æŠ•æ³¨: æœŸå·=20231118001
```

---

### æ­¥éª¤3ï¼šæŸ¥è¯¢å¾…æŠ•æ³¨è®¢å•

**ä»£ç ä½ç½®**ï¼š`AutoBetCoordinator.cs` (ç¬¬202-212è¡Œ)

```csharp
// 1. æŸ¥è¯¢å¾…å¤„ç†è®¢å•
var pendingOrders = _orderService.GetPendingOrdersForIssue(e.IssueId);

if (!pendingOrders.Any())
{
    _log.Warning("AutoBet", $"âš ï¸ æœŸå·{e.IssueId}æ²¡æœ‰å¾…æŠ•æ³¨è®¢å•");
    return;
}
```

**æŸ¥è¯¢æ¡ä»¶**ï¼š
- è®¢å•çŠ¶æ€ = `å¾…å¤„ç†`
- è®¢å•æœŸå· = å½“å‰æœŸå·
- è®¢å•ç±»å‹ â‰  `æ‰˜å•`ï¼ˆæ‰˜å•ä¸æŠ•æ³¨ï¼‰

**æ—¥å¿—è¾“å‡º**ï¼š
```
ğŸ“‹ å¼€å§‹æŸ¥è¯¢å¾…æŠ•æ³¨è®¢å•...
âœ… æŸ¥è¯¢åˆ°5ä¸ªå¾…æŠ•æ³¨è®¢å•
```

---

### æ­¥éª¤4ï¼šåˆå¹¶è®¢å•ï¼ˆOrderMergerï¼‰

**ä»£ç ä½ç½®**ï¼š`AutoBetCoordinator.cs` (ç¬¬229-242è¡Œ)

```csharp
// 3. åˆå¹¶è®¢å•
var mergeResult = _orderMerger.Merge(pendingOrders);
```

**åˆå¹¶é€»è¾‘**ï¼š`OrderMerger.cs` â†’ `Merge` æ–¹æ³• (ç¬¬55-119è¡Œ)

```csharp
public MergeResult Merge(IEnumerable<V2MemberOrder> orders)
{
    // 1. è§£ææ¯ä¸ªè®¢å•çš„æŠ•æ³¨å†…å®¹ï¼ˆBetContentStandarï¼‰
    foreach (var order in orderList)
    {
        // ä½¿ç”¨ F5BotV2 çš„è§£æé€»è¾‘
        var items = BetContentParser.ParseBetContentToOrderList(
            order.BetContentStandar, 
            order.IssueId
        );
        allItems.AddRange(items);
    }
    
    // 2. åˆå¹¶ç›¸åŒå·ç å’Œç©æ³•çš„æŠ•æ³¨é¡¹
    var mergedItems = MergeBetItems(allItems);  // æŒ‰ (Car, Play) åˆ†ç»„ï¼Œç´¯åŠ é‡‘é¢
    
    // 3. ç”Ÿæˆæ ‡å‡†æŠ•æ³¨å†…å®¹ï¼š"1å¤§50,2å°30,3å¤§10"
    var betContentStandard = string.Join(",", mergedItems.Select(item => 
        $"{carNumber}{GetPlayName(item.Play)}{item.MoneySum}"
    ));
    
    return new MergeResult
    {
        BetContentStandard = betContentStandard,  // "1å¤§50,2å°30"
        TotalAmount = totalAmount,                 // 80
        OrderIds = orderIds,                       // [101, 102, 103]
        BetItems = mergedItems                     // [BetStandardOrder, ...]
    };
}
```

**ç¤ºä¾‹**ï¼š
```
è¾“å…¥è®¢å•ï¼š
  è®¢å•101: 1å¤§20,2å°10
  è®¢å•102: 1å¤§30,3å¤§10
  è®¢å•103: 2å°20

åˆå¹¶ç»“æœï¼š
  æŠ•æ³¨å†…å®¹: "1å¤§50,2å°30,3å¤§10"
  æ€»é‡‘é¢: 90å…ƒ
  è®¢å•ID: [101, 102, 103]
```

**æ—¥å¿—è¾“å‡º**ï¼š
```
âœ… è®¢å•åˆå¹¶å®Œæˆ:
   è®¢å•æ•°é‡: 3ä¸ª
   åˆå¹¶å†…å®¹: 1å¤§50,2å°30,3å¤§10
   æ€»é‡‘é¢: 90.00å…ƒ
```

---

### æ­¥éª¤5ï¼šéªŒè¯æŠ•æ³¨é‡‘é¢é™åˆ¶

**ä»£ç ä½ç½®**ï¼š`AutoBetCoordinator.cs` (ç¬¬244-299è¡Œ)

```csharp
// 3.5 éªŒè¯æ¯ä¸€é¡¹æŠ•æ³¨é‡‘é¢æ˜¯å¦ç¬¦åˆé…ç½®é™åˆ¶ï¼ˆå‚è€ƒ F5BotV2ï¼‰
float minBet = _configService.GetMinBet();  // ä»å…¨å±€é…ç½®è·å–
float maxBet = _configService.GetMaxBet();

foreach (var item in mergeResult.BetItems)
{
    if (item.MoneySum < (decimal)minBet)
    {
        firstInvalidItem = $"{itemKey}ä¸èƒ½å°äº{minBet}";
        break;
    }
    
    if (item.MoneySum > (decimal)maxBet)
    {
        firstInvalidItem = $"{itemKey}è¶…é™,å½“å‰{item.MoneySum},æœ€å¤§{maxBet}";
        break;
    }
}

// ğŸ”¥ å¦‚æœæœ‰ä¸ç¬¦åˆé™åˆ¶çš„é¡¹ï¼Œæ‹’ç»æ•´ä¸ªæŠ•æ³¨
if (firstInvalidItem != null)
{
    _log.Error("AutoBet", $"âŒ è¿›ä»“å¤±è´¥! {firstInvalidItem}");
    return;  // è®¢å•ä¿æŒ"å¾…å¤„ç†"çŠ¶æ€ï¼Œä¸è¿›è¡ŒæŠ•æ³¨
}
```

**éªŒè¯è§„åˆ™**ï¼š
- æ¯ä¸€é¡¹æŠ•æ³¨é‡‘é¢å¿…é¡» >= æœ€å°æŠ•æ³¨ï¼ˆå¦‚10å…ƒï¼‰
- æ¯ä¸€é¡¹æŠ•æ³¨é‡‘é¢å¿…é¡» <= æœ€å¤§æŠ•æ³¨ï¼ˆå¦‚10000å…ƒï¼‰
- **åªè¦æœ‰ä¸€é¡¹ä¸ç¬¦åˆï¼Œæ•´æ¡æ‹’ç»**ï¼ˆå‚è€ƒ F5BotV2ï¼‰

**æ—¥å¿—è¾“å‡º**ï¼ˆæˆåŠŸï¼‰ï¼š
```
ğŸ” å¼€å§‹éªŒè¯æŠ•æ³¨é‡‘é¢é™åˆ¶...
âœ… æŠ•æ³¨é‡‘é¢éªŒè¯é€šè¿‡ï¼ˆé™åˆ¶: 10-10000å…ƒï¼‰
```

**æ—¥å¿—è¾“å‡º**ï¼ˆå¤±è´¥ï¼‰ï¼š
```
âŒ è¿›ä»“å¤±è´¥! 1å¤§5ä¸èƒ½å°äº10å…ƒ
   è®¢å•æ•°é‡: 3ä¸ª
   åˆå¹¶å†…å®¹: 1å¤§5,2å°30
ğŸ’¡ è¯·åœ¨ã€å¿«é€Ÿè®¾ç½®ã€‘ä¸­è°ƒæ•´ã€æœ€å°æŠ•æ³¨ã€‘å’Œã€æœ€å¤§æŠ•æ³¨ã€‘
```

---

### æ­¥éª¤6ï¼šåˆ›å»ºæŠ•æ³¨è®°å½•ï¼ˆBetRecordï¼‰

**ä»£ç ä½ç½®**ï¼š`AutoBetCoordinator.cs` (ç¬¬301-322è¡Œ)

```csharp
// 4. åˆ›å»ºæŠ•æ³¨è®°å½•
var betRecord = new BetRecord
{
    ConfigId = _currentConfigId,           // é…ç½®ID: 1
    IssueId = e.IssueId,                   // æœŸå·: 20231118001
    Source = BetRecordSource.è®¢å•,          // æ¥æº: è®¢å•
    OrderIds = "101,102,103",              // å…³è”è®¢å•
    BetContentStandard = "1å¤§50,2å°30",    // æŠ•æ³¨å†…å®¹
    TotalAmount = 80,                       // æ€»é‡‘é¢
    SendTime = DateTime.Now                 // å‘é€æ—¶é—´
};

betRecord = _betRecordService.Create(betRecord);
```

**ä½œç”¨**ï¼š
- âœ… è®°å½•æŠ•æ³¨å†å²ï¼ˆå¯åœ¨é…ç½®ç®¡ç†å™¨ä¸­æŸ¥çœ‹ï¼‰
- âœ… å…³è”è®¢å•IDï¼ˆè¿½æº¯æ¥æºï¼‰
- âœ… è®°å½•æŠ•æ³¨æ—¶é—´å’Œå†…å®¹

**æ—¥å¿—è¾“å‡º**ï¼š
```
ğŸ“‹ åˆ›å»ºæŠ•æ³¨è®°å½•...
âœ… æŠ•æ³¨è®°å½•å·²åˆ›å»º: ID=45
```

---

### æ­¥éª¤7ï¼šå‘é€æŠ•æ³¨å‘½ä»¤åˆ°æµè§ˆå™¨ï¼ˆSocketé€šä¿¡ï¼‰

**ä»£ç ä½ç½®**ï¼š`AutoBetCoordinator.cs` (ç¬¬324-339è¡Œ)

```csharp
// 5. é€šè¿‡ Socket å‘é€æŠ•æ³¨å‘½ä»¤åˆ°æµè§ˆå™¨
_betQueueManager.EnqueueBet(betRecord.Id, async () =>
{
    var result = await _autoBetService.SendBetCommandAsync(
        _currentConfigId,           // é…ç½®ID: 1
        e.IssueId.ToString(),       // æœŸå·: "20231118001"
        mergeResult.BetContentStandard  // æŠ•æ³¨å†…å®¹: "1å¤§50,2å°30"
    );
});
```

#### 7.1 æŸ¥æ‰¾æµè§ˆå™¨å®¢æˆ·ç«¯

**ä»£ç ä½ç½®**ï¼š`AutoBetService.cs` â†’ `SendBetCommandAsync` (ç¬¬792-854è¡Œ)

```csharp
public async Task<BetResult> SendBetCommandAsync(int configId, string issueId, string betContentStandard)
{
    // 1. æŸ¥æ‰¾é…ç½®
    var config = GetConfig(configId);
    if (config == null)
    {
        return new BetResult { Success = false, ErrorMessage = "é…ç½®ä¸å­˜åœ¨" };
    }
    
    // 2. è·å–æµè§ˆå™¨å®¢æˆ·ç«¯
    var browserClient = config.Browser;
    if (browserClient == null)
    {
        return new BetResult { Success = false, ErrorMessage = "æµè§ˆå™¨æœªè¿æ¥" };
    }
    
    // 3. æ£€æŸ¥è¿æ¥çŠ¶æ€
    if (!browserClient.IsConnected)
    {
        return new BetResult { Success = false, ErrorMessage = "è¿æ¥çŠ¶æ€å¼‚å¸¸" };
    }
    
    // ç»§ç»­...
}
```

#### 7.2 è§£ææŠ•æ³¨å†…å®¹å¹¶å‘é€

**ä»£ç ä½ç½®**ï¼š`AutoBetService.cs` (ç¬¬856-900è¡Œ)

```csharp
try
{
    // ğŸ”¥ å°†å­—ç¬¦ä¸²æ ¼å¼è§£æä¸º BetStandardOrderList å¯¹è±¡
    // "1å¤§50,2å°30" â†’ [BetStandardOrder{Car=P1, Play=å¤§, MoneySum=50}, ...]
    var betOrders = BetContentParser.ParseBetContentToOrderList(
        betContentStandard, 
        int.Parse(issueId)
    );
    
    // ğŸ”¥ å‘é€åˆ°æµè§ˆå™¨ï¼ˆSocketé€šä¿¡ï¼‰
    var result = await browserClient.SendCommandAsync("æŠ•æ³¨", betOrders);
    
    // è§£æè¿”å›ç»“æœ
    var betResult = new BetResult
    {
        Success = result.Success,
        ErrorMessage = result.ErrorMessage,
        Result = platformResponse  // å¹³å°å®Œæ•´å“åº”
    };
    
    return betResult;
}
```

**Socketæ¶ˆæ¯æ ¼å¼**ï¼š
```json
{
    "Command": "æŠ•æ³¨",
    "Data": [
        {
            "IssueId": 20231118001,
            "Car": "P1",
            "Play": "å¤§",
            "MoneySum": 50
        },
        {
            "IssueId": 20231118001,
            "Car": "P2",
            "Play": "å°",
            "MoneySum": 30
        }
    ]
}
```

**æ—¥å¿—è¾“å‡º**ï¼š
```
ğŸ“¤ å‘é€æŠ•æ³¨å‘½ä»¤åˆ°æµè§ˆå™¨å®¢æˆ·ç«¯:
   é…ç½®ID: 1
   æœŸå·: 20231118001
   å†…å®¹: 1å¤§50,2å°30
ğŸš€ å¼€å§‹æ‰§è¡ŒæŠ•æ³¨...
```

---

### æ­¥éª¤8ï¼šæµè§ˆå™¨æ¥æ”¶å¹¶æ‰§è¡ŒæŠ•æ³¨ï¼ˆBsBrowserClientï¼‰

**å¤„ç†ä½ç½®**ï¼š`BsBrowserClient/Form1.cs` â†’ Socketæ¶ˆæ¯å¤„ç†

```csharp
case "æŠ•æ³¨":
    // 1. è§£ææŠ•æ³¨å‘½ä»¤æ•°æ®ï¼ˆBetStandardOrderListï¼‰
    var betOrders = commandRequest.Data.ToObject<BetStandardOrderList>();
    
    // 2. è°ƒç”¨å¹³å°è„šæœ¬æ‰§è¡ŒæŠ•æ³¨
    var (success, message, platformResponse) = await _platformScript!.PlaceBetAsync(betOrders);
    
    // 3. è¿”å›ç»“æœ
    response.Success = success;
    response.ErrorMessage = message;
    response.Data = new 
    {
        platformResponse = platformResponse,  // å¹³å°å®Œæ•´å“åº”
        timestamp = DateTime.Now,
        duration = stopwatch.ElapsedMilliseconds
    };
```

#### 8.1 å¹³å°è„šæœ¬æ‰§è¡ŒæŠ•æ³¨

**ä»£ç ä½ç½®**ï¼š`TongBaoScript.cs` â†’ `PlaceBetAsync` (é€šè¿‡WebView2æ‰§è¡ŒJavaScript)

```javascript
// æµè§ˆå™¨ç«¯JavaScriptæ‰§è¡Œï¼ˆé€šè¿‡WebView2.ExecuteScriptAsyncæ³¨å…¥ï¼‰
async function placeBet(betOrders) {
    let results = [];
    
    for (let order of betOrders) {
        // 1. æŸ¥æ‰¾å¯¹åº”çš„æŠ•æ³¨é¡¹IDï¼ˆå¦‚ "å¹³ä¸€å¤§" â†’ å¹³å°ID "101"ï¼‰
        let platformId = getPlatformId(order.Car, order.Play);
        
        // 2. è°ƒç”¨å¹³å°APIæŠ•æ³¨
        let response = await fetch('/api/bet', {
            method: 'POST',
            body: JSON.stringify({
                issue: order.IssueId,
                betId: platformId,
                amount: order.MoneySum
            })
        });
        
        results.push(await response.json());
    }
    
    return results;
}
```

**æ—¥å¿—è¾“å‡º**ï¼ˆæµè§ˆå™¨ç«¯ï¼‰ï¼š
```
âš™ï¸ ğŸ² æ‰§è¡ŒæŠ•æ³¨: 2é¡¹
   - P1å¤§ 50å…ƒ â†’ å¹³å°ID: 101
   - P2å° 30å…ƒ â†’ å¹³å°ID: 202
âš™ï¸ âœ… æŠ•æ³¨å®Œæˆ: è€—æ—¶ 234ms
```

---

### æ­¥éª¤9ï¼šæµè§ˆå™¨è¿”å›æŠ•æ³¨ç»“æœ

**è¿”å›æ•°æ®æ ¼å¼**ï¼š
```json
{
    "Success": true,
    "ErrorMessage": "",
    "Data": {
        "platformResponse": "{\"code\":0,\"msg\":\"æŠ•æ³¨æˆåŠŸ\",\"data\":{\"orderId\":\"ORD123456\"}}",
        "timestamp": "2023-11-18 15:30:45",
        "duration": 234
    }
}
```

**æ—¥å¿—è¾“å‡º**ï¼ˆä¸»ç¨‹åºï¼‰ï¼š
```
ğŸ“¥ æŠ•æ³¨ç»“æœ:é…ç½®1 æˆåŠŸ=True
   å¹³å°å“åº”: {"code":0,"msg":"æŠ•æ³¨æˆåŠŸ","data":{"orderId":"ORD123456"}}
   è€—æ—¶: 234ms
```

---

### æ­¥éª¤10ï¼šæ›´æ–°è®¢å•çŠ¶æ€

**ä»£ç ä½ç½®**ï¼š`AutoBetCoordinator.cs` (ç¬¬347-391è¡Œ)

```csharp
// ğŸ”¥ æ ¹æ®POSTç»“æœæ›´æ–°è®¢å•çŠ¶æ€
if (result.Success)
{
    // æŠ•æ³¨æˆåŠŸ â†’ æ›´æ–°æ‰€æœ‰å…³è”è®¢å•ä¸º"å·²å‘é€"
    foreach (var orderId in mergeResult.OrderIds)
    {
        var order = _orderService.GetOrderById(orderId);
        if (order != null)
        {
            order.OrderStatus = OrderStatus.å·²å‘é€;
            order.BetTime = DateTime.Now;
            _orderService.UpdateOrder(order);
        }
    }
    
    // æ›´æ–°æŠ•æ³¨è®°å½•
    betRecord.Status = BetRecordStatus.æˆåŠŸ;
    betRecord.PlatformResponse = result.Result;
    _betRecordService.Update(betRecord);
    
    _log.Info("AutoBet", $"âœ… æŠ•æ³¨æˆåŠŸï¼Œå·²æ›´æ–°{mergeResult.OrderIds.Count}ä¸ªè®¢å•çŠ¶æ€");
}
else
{
    // æŠ•æ³¨å¤±è´¥ â†’ ä¿æŒè®¢å•ä¸º"å¾…å¤„ç†"ï¼Œä¸‹æ¬¡å°ç›˜ç»§ç»­å°è¯•
    betRecord.Status = BetRecordStatus.å¤±è´¥;
    betRecord.ErrorMessage = result.ErrorMessage;
    _betRecordService.Update(betRecord);
    
    _log.Error("AutoBet", $"âŒ æŠ•æ³¨å¤±è´¥: {result.ErrorMessage}");
}
```

**çŠ¶æ€è½¬æ¢**ï¼š
- âœ… æˆåŠŸï¼š`å¾…å¤„ç†` â†’ `å·²å‘é€`
- âŒ å¤±è´¥ï¼šä¿æŒ `å¾…å¤„ç†`ï¼ˆä¸‹æ¬¡å°ç›˜ç»§ç»­å°è¯•ï¼‰

**æ—¥å¿—è¾“å‡º**ï¼ˆæˆåŠŸï¼‰ï¼š
```
âœ… æŠ•æ³¨æˆåŠŸï¼Œå·²æ›´æ–°3ä¸ªè®¢å•çŠ¶æ€
   è®¢å•101: å¾…å¤„ç† â†’ å·²å‘é€
   è®¢å•102: å¾…å¤„ç† â†’ å·²å‘é€
   è®¢å•103: å¾…å¤„ç† â†’ å·²å‘é€
```

---

## ğŸ“‹ å…³é”®ç»„ä»¶è¯´æ˜

### 1. AutoBetCoordinatorï¼ˆåè°ƒå™¨ï¼‰
- **ä½œç”¨**ï¼šè¿æ¥å¼€å¥–æœåŠ¡å’ŒæŠ•æ³¨æœåŠ¡
- **èŒè´£**ï¼š
  - è®¢é˜…å°ç›˜äº‹ä»¶
  - æŸ¥è¯¢å¾…æŠ•æ³¨è®¢å•
  - åˆå¹¶è®¢å•
  - éªŒè¯é‡‘é¢
  - åˆ›å»ºæŠ•æ³¨è®°å½•
  - å‘é€åˆ°æµè§ˆå™¨
  - æ›´æ–°è®¢å•çŠ¶æ€

### 2. OrderMergerï¼ˆè®¢å•åˆå¹¶å™¨ï¼‰
- **ä½œç”¨**ï¼šå°†å¤šä¸ªè®¢å•åˆå¹¶ä¸ºå•ä¸ªæŠ•æ³¨å‘½ä»¤
- **é€»è¾‘**ï¼š
  - è§£ææ¯ä¸ªè®¢å•çš„æŠ•æ³¨å†…å®¹
  - æŒ‰ `(Car, Play)` åˆ†ç»„
  - ç´¯åŠ ç›¸åŒé¡¹çš„é‡‘é¢
  - ç”Ÿæˆæ ‡å‡†æŠ•æ³¨å­—ç¬¦ä¸²

### 3. BrowserClientï¼ˆæµè§ˆå™¨å®¢æˆ·ç«¯ï¼‰
- **ä½œç”¨**ï¼šSocketé€šä¿¡ä»£ç†
- **èŒè´£**ï¼š
  - ç»´æŠ¤ä¸ `BsBrowserClient` çš„TCPè¿æ¥
  - å‘é€å‘½ä»¤ï¼ˆæŠ•æ³¨ã€ç™»å½•ã€æŸ¥ä½™é¢ç­‰ï¼‰
  - æ¥æ”¶å“åº”
  - è¶…æ—¶é‡è¯•

### 4. TongBaoScriptï¼ˆå¹³å°è„šæœ¬ï¼‰
- **ä½œç”¨**ï¼šå¹³å°ç‰¹å®šæŠ•æ³¨é€»è¾‘
- **èŒè´£**ï¼š
  - æ˜ å°„æ ‡å‡†æŠ•æ³¨é¡¹åˆ°å¹³å°ID
  - æ‰§è¡ŒWebView2 JavaScriptæ³¨å…¥
  - è°ƒç”¨å¹³å°API
  - è§£æå¹³å°å“åº”

---

## ğŸ”§ å…³é”®æ•°æ®ç»“æ„

### BetStandardOrderï¼ˆæ ‡å‡†æŠ•æ³¨é¡¹ï¼‰
```csharp
public class BetStandardOrder
{
    public int IssueId { get; set; }        // æœŸå·: 20231118001
    public CarNumEnum Car { get; set; }     // å·ç : P1 (ç¬¬ä¸€çƒ)
    public BetPlayEnum Play { get; set; }   // ç©æ³•: å¤§
    public decimal MoneySum { get; set; }   // é‡‘é¢: 50
}
```

### MergeResultï¼ˆåˆå¹¶ç»“æœï¼‰
```csharp
public class MergeResult
{
    public string BetContentStandard { get; set; }  // "1å¤§50,2å°30"
    public decimal TotalAmount { get; set; }         // 80
    public List<long> OrderIds { get; set; }        // [101, 102, 103]
    public BetStandardOrderList BetItems { get; set; }
}
```

### BetRecordï¼ˆæŠ•æ³¨è®°å½•ï¼‰
```csharp
public class BetRecord
{
    public int Id { get; set; }                     // è®°å½•ID
    public int ConfigId { get; set; }               // é…ç½®ID
    public int IssueId { get; set; }                // æœŸå·
    public BetRecordSource Source { get; set; }     // æ¥æº: è®¢å•/å‘½ä»¤/è¡¥å•
    public string OrderIds { get; set; }            // å…³è”è®¢å•: "101,102"
    public string BetContentStandard { get; set; }  // æŠ•æ³¨å†…å®¹: "1å¤§50"
    public decimal TotalAmount { get; set; }        // æ€»é‡‘é¢: 80
    public BetRecordStatus Status { get; set; }     // çŠ¶æ€: æˆåŠŸ/å¤±è´¥
    public string? PlatformResponse { get; set; }   // å¹³å°å“åº”
    public DateTime SendTime { get; set; }          // å‘é€æ—¶é—´
}
```

---

## ğŸš¨ å¼‚å¸¸å¤„ç†

### 1. æµè§ˆå™¨æœªè¿æ¥
```
âŒ æµè§ˆå™¨æœªè¿æ¥ï¼Œæ— æ³•æ¨é€æŠ•æ³¨å‘½ä»¤: é»˜è®¤é…ç½®
   ç›‘æ§ä»»åŠ¡ä¼šåœ¨3ç§’å†…è‡ªåŠ¨æ£€æŸ¥å¹¶é‡å¯æµè§ˆå™¨
```
**å¤„ç†**ï¼šè®¢å•ä¿æŒ `å¾…å¤„ç†`ï¼Œç›‘æ§çº¿ç¨‹è‡ªåŠ¨é‡å¯æµè§ˆå™¨ï¼Œä¸‹æ¬¡å°ç›˜ç»§ç»­å°è¯•

### 2. æŠ•æ³¨é‡‘é¢ä¸ç¬¦åˆé™åˆ¶
```
âŒ è¿›ä»“å¤±è´¥! 1å¤§5ä¸èƒ½å°äº10å…ƒ
ğŸ’¡ è¯·åœ¨ã€å¿«é€Ÿè®¾ç½®ã€‘ä¸­è°ƒæ•´ã€æœ€å°æŠ•æ³¨ã€‘å’Œã€æœ€å¤§æŠ•æ³¨ã€‘
```
**å¤„ç†**ï¼šè®¢å•ä¿æŒ `å¾…å¤„ç†`ï¼Œä¸è¿›è¡ŒæŠ•æ³¨ï¼Œç®¡ç†å‘˜è°ƒæ•´è®¾ç½®åä¸‹æ¬¡å°ç›˜é‡è¯•

### 3. å¹³å°è¿”å›å¤±è´¥
```
âŒ æŠ•æ³¨å¤±è´¥: ä½™é¢ä¸è¶³
   å¹³å°å“åº”: {"code":1001,"msg":"ä½™é¢ä¸è¶³"}
```
**å¤„ç†**ï¼šè®¢å•ä¿æŒ `å¾…å¤„ç†`ï¼Œè®°å½•åˆ° `BetRecord` çš„ `ErrorMessage`

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### å…³é”®æ—¶é—´èŠ‚ç‚¹
1. **å°ç›˜è§¦å‘** â†’ **è®¢å•æŸ¥è¯¢**ï¼š< 50ms
2. **è®¢å•æŸ¥è¯¢** â†’ **è®¢å•åˆå¹¶**ï¼š< 100ms
3. **è®¢å•åˆå¹¶** â†’ **é‡‘é¢éªŒè¯**ï¼š< 10ms
4. **é‡‘é¢éªŒè¯** â†’ **å‘é€æµè§ˆå™¨**ï¼š< 50ms
5. **å‘é€æµè§ˆå™¨** â†’ **æµè§ˆå™¨æ‰§è¡Œ**ï¼š200-500msï¼ˆç½‘ç»œå»¶è¿Ÿï¼‰
6. **æµè§ˆå™¨æ‰§è¡Œ** â†’ **å¹³å°å“åº”**ï¼š300-1000msï¼ˆå¹³å°APIå»¶è¿Ÿï¼‰
7. **æ€»è€—æ—¶**ï¼š< 2ç§’

### æ—¥å¿—ç¤ºä¾‹ï¼ˆå®Œæ•´æµç¨‹ï¼‰
```
[15:30:00.000] ğŸ“¢ çŠ¶æ€å˜æ›´äº‹ä»¶è§¦å‘: å¼€ç›˜ä¸­ â†’ å°ç›˜ä¸­, æœŸå·:20231118001
[15:30:00.050] âœ… æŸ¥è¯¢åˆ°3ä¸ªå¾…æŠ•æ³¨è®¢å•
[15:30:00.150] âœ… è®¢å•åˆå¹¶å®Œæˆ: 1å¤§50,2å°30
[15:30:00.160] âœ… æŠ•æ³¨é‡‘é¢éªŒè¯é€šè¿‡
[15:30:00.210] âœ… æŠ•æ³¨è®°å½•å·²åˆ›å»º: ID=45
[15:30:00.260] ğŸ“¤ å‘é€æŠ•æ³¨å‘½ä»¤åˆ°æµè§ˆå™¨å®¢æˆ·ç«¯
[15:30:00.560] ğŸ“¥ æŠ•æ³¨ç»“æœ:é…ç½®1 æˆåŠŸ=True
[15:30:00.610] âœ… æŠ•æ³¨æˆåŠŸï¼Œå·²æ›´æ–°3ä¸ªè®¢å•çŠ¶æ€
[15:30:00.620] âœ… å°ç›˜æŠ•æ³¨æµç¨‹å®Œæˆ (æ€»è€—æ—¶: 620ms)
```

---

## âœ… éªŒè¯æ¸…å•

### ç”¨æˆ·å¦‚ä½•éªŒè¯æµç¨‹æ­£å¸¸
1. âœ… å¯ç”¨é£å•å¼€å…³ï¼Œæ—¥å¿—æ˜¾ç¤º `AutoBetCoordinator å·²å¯åŠ¨`
2. âœ… ä¼šå‘˜ä¸‹å•åï¼Œè®¢å•è¡¨æ˜¾ç¤º `å¾…å¤„ç†` çŠ¶æ€
3. âœ… å°ç›˜æ—¶ï¼Œæ—¥å¿—æ˜¾ç¤º `è§¦å‘å°ç›˜æŠ•æ³¨`
4. âœ… æ—¥å¿—æ˜¾ç¤º `è®¢å•åˆå¹¶å®Œæˆ`
5. âœ… æ—¥å¿—æ˜¾ç¤º `æŠ•æ³¨é‡‘é¢éªŒè¯é€šè¿‡`
6. âœ… æ—¥å¿—æ˜¾ç¤º `å‘é€æŠ•æ³¨å‘½ä»¤åˆ°æµè§ˆå™¨å®¢æˆ·ç«¯`
7. âœ… æµè§ˆå™¨æ—¥å¿—æ˜¾ç¤º `æ‰§è¡ŒæŠ•æ³¨`
8. âœ… æ—¥å¿—æ˜¾ç¤º `æŠ•æ³¨æˆåŠŸï¼Œå·²æ›´æ–°Nä¸ªè®¢å•çŠ¶æ€`
9. âœ… è®¢å•è¡¨çŠ¶æ€å˜ä¸º `å·²å‘é€`
10. âœ… é…ç½®ç®¡ç†ä¸­å¯æŸ¥çœ‹ `æŠ•æ³¨è®°å½•` è¯¦æƒ…

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

### ä¸»è¦ä»£ç æ–‡ä»¶
1. `BaiShengVx3Plus/Views/VxMain.cs` - UIæ§åˆ¶ï¼ˆé£å•å¼€å…³ï¼‰
2. `BaiShengVx3Plus/Services/AutoBet/AutoBetCoordinator.cs` - åè°ƒå™¨ï¼ˆæ ¸å¿ƒæµç¨‹ï¼‰
3. `BaiShengVx3Plus/Services/AutoBet/OrderMerger.cs` - è®¢å•åˆå¹¶
4. `BaiShengVx3Plus/Services/AutoBet/AutoBetService.cs` - Socketé€šä¿¡
5. `BaiShengVx3Plus/Services/AutoBet/BrowserClient.cs` - æµè§ˆå™¨å®¢æˆ·ç«¯ä»£ç†
6. `BsBrowserClient/Form1.cs` - æµè§ˆå™¨ç«¯æ¶ˆæ¯å¤„ç†
7. `BsBrowserClient/PlatformScripts/TongBaoScript.cs` - å¹³å°æŠ•æ³¨é€»è¾‘

### æ•°æ®æ¨¡å‹
1. `BaiShengVx3Plus.Shared/Models/BetStandardOrder.cs` - æ ‡å‡†æŠ•æ³¨é¡¹
2. `BaiShengVx3Plus/Models/AutoBet/BetRecord.cs` - æŠ•æ³¨è®°å½•
3. `BaiShengVx3Plus/Models/V2MemberOrder.cs` - ä¼šå‘˜è®¢å•

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2024-11-18  
**é€‚ç”¨ç‰ˆæœ¬**: BaiShengVx3Plus (Release)

