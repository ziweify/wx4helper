# 永利系统 - 项目结构说明

**最后更新**: 2025-12-23  
**维护规则**: 任何文件创建、修改、删除都需要更新此文档

---

## 📁 项目目录结构

```
永利系统/
│
├── Contracts/                          # 接口定义层
│   ├── Games/
│   │   └── Bingo/
│   │       ├── ILotteryService.cs              # 开奖数据服务接口
│   │       └── IBingoGameService.cs            # 游戏服务接口（可选）
│   └── Wechat/
│       ├── IWechatService.cs                   # 微信服务接口
│       └── IOrderService.cs                    # 订单服务接口
│
├── Services/                            # 业务服务层（有状态、有生命周期）
│   ├── LoggingService.cs                      # 日志服务
│   ├── Games/
│   │   └── Bingo/
│   │       ├── LotteryService.cs              # 开奖数据服务实现
│   │       └── BingoGameServiceBase.cs        # 游戏服务基类（混合模式）
│   └── Wechat/
│       ├── WechatService.cs                   # 微信服务实现
│       ├── OrderService.cs                    # 订单服务实现
│       └── WechatBingoGameService.cs          # 微信模块的Bingo游戏服务（派生类）
│
├── Helpers/                             # 工具类（无状态、可复用）
│   ├── HttpHelper.cs                         # 通用HTTP工具
│   ├── TimeHelper.cs                         # 时间工具
│   └── StringHelper.cs                       # 字符串工具
│
├── Infrastructure/                      # 基础设施（第三方封装、跨模块）
│   ├── Http/
│   │   ├── WechatHttpHelper.cs               # 微信HTTP封装
│   │   └── ApiHttpHelper.cs                  # API HTTP封装
│   └── Database/
│       └── DatabaseHelper.cs                 # 数据库封装
│
├── Models/                              # 数据模型层
│   ├── LogEntry.cs                           # 日志条目模型
│   ├── LogLevel.cs                           # 日志级别枚举
│   ├── DataItem.cs                           # 数据项模型
│   ├── Games/
│   │   └── Bingo/
│   │       ├── LotteryStatus.cs              # 开奖状态枚举
│   │       ├── LotteryData.cs                 # 开奖数据模型
│   │       ├── Events/                        # 事件参数类
│   │       │   ├── BingoLotteryIssueChangedEventArgs.cs
│   │       │   ├── BingoLotteryStatusChangedEventArgs.cs
│   │       │   ├── BingoLotteryCountdownEventArgs.cs
│   │       │   ├── BingoLotteryOpenedEventArgs.cs
│   │       │   └── BingoGameWarningEventArgs.cs
│   │       └── Exceptions/                   # 异常类
│   │           └── BingoGameException.cs
│   └── Wechat/
│       ├── Contact.cs                        # 联系人模型
│       ├── Member.cs                         # 会员模型
│       ├── Order.cs                          # 订单模型
│       ├── WechatConnectionState.cs          # 微信连接状态枚举
│       └── Events/
│           └── WechatConnectionStateChangedEventArgs.cs
│
├── ViewModels/                          # 视图模型层
│   ├── MainViewModel.cs                      # 主窗口 ViewModel
│   ├── DashboardViewModel.cs                 # 首页 ViewModel
│   └── DataManagementViewModel.cs            # 数据管理 ViewModel
│
├── Views/                               # 视图层
│   ├── Main.cs                               # 主窗口
│   ├── MainTabs.cs                           # 主窗口（TabControl版本）
│   ├── LogWindow.cs                          # 日志窗口
│   ├── Pages/                                # 页面控件
│   │   ├── DashboardPage.cs
│   │   ├── DataManagementPage.cs
│   │   ├── ReportsPage.cs
│   │   └── SettingsPage.cs
│   └── Wechat/
│       └── WechatPage.cs                     # 微信助手页面
│
├── Core/                                # 核心框架层（MVVM基础设施）
│   └── (MVVM相关基类，如需要)
│
└── 项目说明/                            # 项目文档
    ├── 项目结构.md                            # 本文档
    └── ...
```

---

## 📋 分类说明

### 1. Contracts（接口定义层）
**职责**: 定义服务接口，实现依赖倒置原则

**特征**:
- 只包含接口定义
- 不包含实现代码
- 按模块分类（Games/Bingo, Wechat等）

**命名规范**: `I[功能]Service.cs`

---

### 2. Services（业务服务层）
**职责**: 实现业务逻辑，管理状态和资源

**特征**:
- ✅ 有状态（维护内部状态）
- ✅ 管理资源（线程、连接、缓存）
- ✅ 业务逻辑（复杂的业务流程）
- ✅ 生命周期管理（Start/Stop/Dispose）

**命名规范**: `[功能]Service.cs` 或 `[功能]ServiceBase.cs`（基类）

**示例**:
- `LotteryService` - 管理开奖数据，有缓存、有状态
- `WechatService` - 管理微信连接，有状态、有生命周期
- `BingoGameServiceBase` - 管理游戏状态，有线程、有状态（基类）

---

### 3. Helpers（工具类）
**职责**: 提供无状态的工具方法

**特征**:
- ❌ 无状态（静态方法或纯函数）
- ✅ 可复用（多个地方使用）
- ✅ 单一职责（只做一件事）
- ❌ 无副作用（不改变外部状态）

**命名规范**: `[功能]Helper.cs`

**示例**:
- `HttpHelper` - HTTP请求工具，无状态
- `TimeHelper` - 时间计算工具，纯函数
- `StringHelper` - 字符串处理工具，无状态

---

### 4. Infrastructure（基础设施）
**职责**: 封装第三方库，提供跨模块使用的技术实现

**特征**:
- ⚠️ 可能有状态（连接池、缓存等）
- ✅ 第三方封装（包装第三方库）
- ✅ 跨模块使用（多个模块都需要）
- ✅ 技术实现（不是业务逻辑）

**命名规范**: `[功能][类型]Helper.cs` 或按子模块分类

**示例**:
- `WechatHttpHelper` - 微信API封装，跨模块使用
- `DatabaseHelper` - 数据库操作封装
- `ApiHttpHelper` - 通用API封装

**子目录结构**:
- `Infrastructure/Http/` - HTTP相关封装
- `Infrastructure/Database/` - 数据库相关封装
- `Infrastructure/Adapters/` - 适配器模式实现（如需要）
- `Infrastructure/Wrappers/` - 包装器模式实现（如需要）

---

### 5. Models（数据模型层）
**职责**: 定义数据结构、枚举、事件参数、异常类

**特征**:
- 纯数据容器
- 不包含业务逻辑
- 按模块分类

**子目录**:
- `Models/Games/Bingo/Events/` - Bingo游戏事件参数
- `Models/Games/Bingo/Exceptions/` - Bingo游戏异常类
- `Models/Wechat/Events/` - 微信事件参数

---

### 6. ViewModels（视图模型层）
**职责**: 视图和模型之间的桥梁，处理UI逻辑

**特征**:
- 实现 `INotifyPropertyChanged`
- 包含命令（ICommand）
- 不直接操作UI

---

### 7. Views（视图层）
**职责**: UI界面定义

**特征**:
- WinForms 控件
- 只负责显示和用户交互
- 通过 ViewModel 绑定数据

---

## 🔄 文件操作规则

**重要**: 任何文件创建、修改、删除都需要更新此文档！

### 创建文件时
1. 确定文件应该放在哪个分类下
2. 在本文档的对应位置添加文件路径
3. 如果是新分类，添加分类说明

### 修改文件时
1. 如果文件移动了位置，更新本文档中的路径
2. 如果文件重命名，更新本文档中的文件名

### 删除文件时
1. 从本文档中删除对应的文件路径
2. 如果目录为空，可以删除目录说明（但保留分类说明）

---

## 📝 更新日志

### 2025-12-23
- ✅ 创建项目结构文档
- ✅ 创建 `Infrastructure/` 目录结构
- ✅ 创建 `Infrastructure/Http/` 目录
- ✅ 创建 `Helpers/` 目录
- ✅ 创建 `Models/Games/Bingo/Exceptions/` 目录
- ✅ 创建 `Models/Games/Bingo/Events/BingoGameWarningEventArgs.cs`
- ✅ 创建 `Models/Games/Bingo/Exceptions/BingoGameException.cs`
- ✅ 创建 `Services/Games/Bingo/BingoGameServiceBase.cs`（混合模式：虚方法 + 事件）
- ✅ 创建 `Services/Wechat/WechatBingoGameService.cs`（派生类示例）
- ✅ 创建 `项目说明/项目结构维护规则.md`
- ✅ 修复 `LoggingService.Warning` → `LoggingService.Warn` 方法调用

---

## 🎯 设计原则

1. **单一职责**: 每个类只负责一个功能
2. **依赖倒置**: 依赖接口而不是具体实现
3. **开闭原则**: 对扩展开放，对修改关闭（基类设计）
4. **模块化**: 按功能模块组织代码（Games/Bingo, Wechat等）
5. **可测试性**: 接口和实现分离，便于单元测试

---

## 📌 注意事项

1. **Services vs Helpers**: 
   - Services 有状态、有生命周期
   - Helpers 无状态、纯函数

2. **Infrastructure vs Helpers**:
   - Infrastructure 封装第三方、跨模块使用
   - Helpers 通用工具、无状态

3. **基类命名**:
   - 基类使用 `Base` 后缀：`BingoGameServiceBase`
   - 接口使用 `I` 前缀：`IBingoGameService`

4. **模块化组织**:
   - 按业务模块分类（Games/Bingo, Wechat等）
   - 每个模块有自己的 Models、Services、Contracts

---

**维护者**: 开发团队  
**优先级**: 高（项目结构文档）

