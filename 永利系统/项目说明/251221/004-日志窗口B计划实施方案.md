# æ—¥å¿—çª—å£ B è®¡åˆ’ - å®æ–½æ–¹æ¡ˆ

**ğŸ“… æ—¥æœŸ**: 2025-12-21  
**ğŸ“Œ ä¸»é¢˜**: ä½¿ç”¨ SplitContainerControl é‡æ–°è®¾è®¡æ—¥å¿—çª—å£  
**ğŸ“„ æ–‡ä»¶ç¼–å·**: 251221-004

---

## ğŸ¯ ç›®æ ‡

1. æ—¥å¿—çª—å£åœ¨è®¾è®¡å™¨ä¸­å¯è§å’Œå¯ç¼–è¾‘
2. ä½¿ç”¨ä¸Šä¸‹åˆ†å‰²å¸ƒå±€ï¼ˆSplitContainerï¼‰
3. é»˜è®¤éšè—æ—¥å¿—é¢æ¿ï¼Œç‚¹å‡»åæ˜¾ç¤º
4. æ”¯æŒæ‹–å‡ºä¸ºç‹¬ç«‹æµ®åŠ¨çª—å£
5. å…³é—­åè‡ªåŠ¨æ¢å¤åŸä½

---

## ğŸ’¡ æ–¹æ¡ˆè®¾è®¡

### æ¶æ„

```
Main.cs (RibbonForm)
â”œâ”€â”€ RibbonControl (é¡¶éƒ¨)
â”œâ”€â”€ SplitContainerControl1 (ä¸­é—´, Dock=Fill, Horizontal=False)
â”‚   â”œâ”€â”€ Panel1 (ä¸Šæ–¹ - ä¸»å†…å®¹åŒºåŸŸ)
â”‚   â”‚   â””â”€â”€ contentPanel (Panel)
â”‚   â”‚       â””â”€â”€ å½“å‰é¡µé¢å†…å®¹
â”‚   â””â”€â”€ Panel2 (ä¸‹æ–¹ - æ—¥å¿—åŒºåŸŸ, åˆå§‹é«˜åº¦=0, Collapsed=True)
â”‚       â””â”€â”€ logWindow1 (LogWindow UserControl)
â”‚           â”œâ”€â”€ å·¥å…·æ ï¼ˆæ¨¡å—è¿‡æ»¤ã€çº§åˆ«è¿‡æ»¤ã€æœç´¢ã€æ¸…ç©ºã€æš‚åœã€å¯¼å‡ºã€å¼¹å‡ºï¼‰
â”‚           â””â”€â”€ GridControl (æ—¥å¿—åˆ—è¡¨)
â””â”€â”€ RibbonStatusBar (åº•éƒ¨)
```

### å…³é”®ç‰¹æ€§

1. **SplitContainerControl**:
   - `Horizontal = false` (ä¸Šä¸‹åˆ†å‰²)
   - `Panel2.Collapsed = true` (é»˜è®¤éšè—)
   - `SplitterPosition` æ§åˆ¶åˆ†å‰²ä½ç½®

2. **LogWindow (UserControl)**:
   - å®Œå…¨åœ¨è®¾è®¡å™¨ä¸­è®¾è®¡
   - åŒ…å«å·¥å…·æ å’ŒGridControl
   - æ·»åŠ "å¼¹å‡º"æŒ‰é’®ç”¨äºåˆ›å»ºæµ®åŠ¨çª—å£

3. **æµ®åŠ¨çª—å£ (LogFloatForm)**:
   - ç‹¬ç«‹çš„ Form
   - åŒ…å« LogWindow çš„å…‹éš†æˆ–å¼•ç”¨
   - å…³é—­æ—¶æ¢å¤åˆ° SplitContainer.Panel2

---

## ğŸ“ å®æ–½æ­¥éª¤

### ç¬¬1æ­¥ï¼šä¿®æ”¹ Main.Designer.cs

æ‰‹åŠ¨ç¼–è¾‘`Main.Designer.cs`ï¼Œå°†ç°æœ‰çš„ `contentPanel` æ›¿æ¢ä¸º `SplitContainerControl`:

```csharp
// åœ¨ InitializeComponent ä¸­æ·»åŠ 
splitContainerControl1 = new DevExpress.XtraEditors.SplitContainerControl();
logWindow1 = new LogWindow();

// é…ç½® SplitContainer
splitContainerControl1.Horizontal = false; // ä¸Šä¸‹åˆ†å‰²
splitContainerControl1.Panel1.Controls.Add(contentPanel);
splitContainerControl1.Panel2.Controls.Add(logWindow1);
splitContainerControl1.Panel2.Collapsed = true; // é»˜è®¤éšè—
splitContainerControl1.Dock = DockStyle.Fill;

// æ·»åŠ åˆ° Form
Controls.Add(splitContainerControl1);
```

### ç¬¬2æ­¥ï¼šæ¸…ç† LogWindow.cs

ç§»é™¤æ‰€æœ‰ä»£ç åˆ›å»ºçš„UIï¼Œæ”¹ä¸ºä½¿ç”¨Designerï¼š

1. æ‰“å¼€ `LogWindow.cs` è®¾è®¡å™¨
2. ä»å·¥å…·ç®±æ‹–å…¥æ§ä»¶ï¼š
   - PanelControl (å·¥å…·æ )
   - ComboBoxEdit (æ¨¡å—è¿‡æ»¤)
   - ComboBoxEdit (çº§åˆ«è¿‡æ»¤)
   - TextEdit (æœç´¢)
   - SimpleButton (æ¸…ç©ºã€æš‚åœã€å¯¼å‡ºã€å¼¹å‡º)
   - GridControl + GridView (æ—¥å¿—åˆ—è¡¨)

### ç¬¬3æ­¥ï¼šå®ç°æ˜¾ç¤º/éšè—åŠŸèƒ½

```csharp
// Main.cs
private void ToggleLogWindow()
{
    if (splitContainerControl1.Panel2.Collapsed)
    {
        // æ˜¾ç¤ºæ—¥å¿—é¢æ¿
        splitContainerControl1.Panel2.Collapsed = false;
        splitContainerControl1.SplitterPosition = splitContainerControl1.Height - 250;
    }
    else
    {
        // éšè—æ—¥å¿—é¢æ¿
        splitContainerControl1.Panel2.Collapsed = true;
    }
}
```

### ç¬¬4æ­¥ï¼šå®ç°æµ®åŠ¨çª—å£

åˆ›å»º `LogFloatForm.cs`:

```csharp
public partial class LogFloatForm : DevExpress.XtraEditors.XtraForm
{
    private LogWindow _logWindow;
    
    public LogFloatForm(LogWindow logWindow)
    {
        InitializeComponent();
        _logWindow = logWindow;
        
        // å°† logWindow ä»åŸçˆ¶å®¹å™¨ç§»é™¤å¹¶æ·»åŠ åˆ°æ­¤Form
        logWindow.Parent?.Controls.Remove(logWindow);
        logWindow.Dock = DockStyle.Fill;
        Controls.Add(logWindow);
        
        FormClosed += LogFloatForm_FormClosed;
    }
    
    private void LogFloatForm_FormClosed(object sender, FormClosedEventArgs e)
    {
        // æ¢å¤ logWindow åˆ°åŸä½
        Controls.Remove(_logWindow);
        // é€šè¿‡äº‹ä»¶é€šçŸ¥ Main çª—å£æ¢å¤
        OnRestoreRequested?.Invoke(_logWindow);
    }
    
    public event Action<LogWindow>? OnRestoreRequested;
}
```

åœ¨ `Main.cs` ä¸­ï¼š

```csharp
private void PopOutLogWindow()
{
    if (_logFloatForm == null || _logFloatForm.IsDisposed)
    {
        // éšè— Panel2
        splitContainerControl1.Panel2.Collapsed = true;
        
        // åˆ›å»ºæµ®åŠ¨çª—å£
        _logFloatForm = new LogFloatForm(logWindow1);
        _logFloatForm.OnRestoreRequested += RestoreLogWindow;
        _logFloatForm.Show(this);
    }
}

private void RestoreLogWindow(LogWindow logWindow)
{
    // æ¢å¤åˆ° Panel2
    splitContainerControl1.Panel2.Controls.Add(logWindow);
    logWindow.Dock = DockStyle.Fill;
    
    _logFloatForm = null;
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Designer æ–‡ä»¶**ï¼š`Main.Designer.cs` éœ€è¦æ‰‹åŠ¨ç¼–è¾‘ï¼Œå› ä¸ºè®¾è®¡å™¨å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç†æ§ä»¶åµŒå¥—
2. **æ§ä»¶å¼•ç”¨**ï¼šç¡®ä¿ `logWindow1` åœ¨ `Main.Designer.cs` ä¸­æ­£ç¡®å£°æ˜
3. **äº‹ä»¶è®¢é˜…**ï¼šåœ¨ `Main_Load` ä¸­åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿå’Œäº‹ä»¶è®¢é˜…
4. **æµ®åŠ¨çª—å£**ï¼šéœ€è¦å¤„ç†æ§ä»¶æ‰€æœ‰æƒè½¬ç§»ï¼ˆParent.Controls.Remove/Addï¼‰

---

## âœ… éªŒæ”¶æ ‡å‡†

1. [ ] æ—¥å¿—çª—å£åœ¨è®¾è®¡å™¨ä¸­å¯è§
2. [ ] é»˜è®¤éšè—ï¼Œç‚¹å‡»å·¥å…·æ æŒ‰é’®åæ˜¾ç¤º
3. [ ] å¯ä»¥æ‹–åŠ¨åˆ†éš”æ¡è°ƒæ•´å¤§å°
4. [ ] å¯ä»¥å¼¹å‡ºä¸ºç‹¬ç«‹çª—å£
5. [ ] å…³é—­æµ®åŠ¨çª—å£åè‡ªåŠ¨æ¢å¤åˆ°åŸä½
6. [ ] æ‰€æœ‰æ—¥å¿—åŠŸèƒ½æ­£å¸¸ï¼ˆè¿‡æ»¤ã€æœç´¢ã€å¯¼å‡ºç­‰ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥

å½“å‰æš‚åœåœ¨æ­¤æ–¹æ¡ˆæ–‡æ¡£ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤æ˜¯å¦ç»§ç»­å®æ–½ã€‚


