# ç•™~åå•å’Œä¸­~åå•ä½¿ç”¨çš„åå­—å­—æ®µåˆ†æ

## ğŸ“‹ ç»“è®ºæ€»ç»“

### ä¸­~åå•ï¼ˆæœ‰è®¢å•çš„ä¼šå‘˜ï¼‰
- **ä½¿ç”¨å­—æ®µä¼˜å…ˆçº§**ï¼š
  1. `order.Nickname`ï¼ˆè®¢å•ä¸­çš„æ˜µç§°ï¼‰
  2. `member.Nickname`ï¼ˆä¼šå‘˜è¡¨çš„æ˜µç§°ï¼‰
  3. `member.DisplayName`ï¼ˆä¼šå‘˜è¡¨çš„ç¾¤æ˜µç§°ï¼‰
  4. "æœªçŸ¥"ï¼ˆå…œåº•ï¼‰

### ç•™~åå•ï¼ˆæ‰€æœ‰ä¼šå‘˜ï¼‰
- **ä½¿ç”¨å­—æ®µ**ï¼š`member.Nickname`ï¼ˆä¼šå‘˜è¡¨çš„æ˜µç§°ï¼‰

## ğŸ“Š è¯¦ç»†åˆ†æ

### 1. ä¸­~åå•ä½¿ç”¨çš„åå­—

**ä½ç½®ï¼š** `BaiShengVx3Plus/Services/Games/Binggo/BinggoLotteryService.cs` (ç¬¬1144-1145è¡Œ)

```csharp
// ğŸ”¥ ä½¿ç”¨è®¢å•ä¸­çš„æ˜µç§°ï¼ˆå‚è€ƒ F5BotV2: order.nicknameï¼‰
string nickname = order.Nickname.UnEscape() 
    ?? member.Nickname.UnEscape() 
    ?? member.DisplayName.UnEscape() 
    ?? "æœªçŸ¥";
```

**ä¼˜å…ˆçº§è¯´æ˜ï¼š**
1. **order.Nickname** - è®¢å•åˆ›å»ºæ—¶è®°å½•çš„æ˜µç§°ï¼ˆæœ€ä¼˜å…ˆï¼‰
2. **member.Nickname** - ä¼šå‘˜è¡¨çš„æ˜µç§°
3. **member.DisplayName** - ä¼šå‘˜è¡¨çš„ç¾¤æ˜µç§°/å¤‡æ³¨
4. **"æœªçŸ¥"** - å…œåº•å€¼

**æ¶ˆæ¯æ ¼å¼ï¼š**
```
ç¬¬{æœŸå·}é˜Ÿ
{å¼€å¥–å·ç }
----ä¸­~åå•----
{nickname}[{ä½™é¢}] {çº¯åˆ©}
```

**ç¤ºä¾‹ï¼š**
```
ç¬¬033é˜Ÿ
01 02 03 04 05 æ€»å’Œ15
----ä¸­~åå•----
å¼ ä¸‰[1000] -50
æå››[2000] +100
```

### 2. ç•™~åå•ä½¿ç”¨çš„åå­—

**ä½ç½®ï¼š** `BaiShengVx3Plus/Services/Games/Binggo/BinggoLotteryService.cs` (ç¬¬1442-1445è¡Œ)

```csharp
string name = "";
if (member.Nickname == null)
    name = "";
else
    name = member.Nickname.UnEscape();
```

**ä½¿ç”¨å­—æ®µï¼š** åªä½¿ç”¨ `member.Nickname`

**æ¶ˆæ¯æ ¼å¼ï¼š**
```
ç¬¬{æœŸå·}é˜Ÿ
{å¼€å¥–å·ç }
----ç•™~åå•----
{nickname} {ä½™é¢}
```

**ç¤ºä¾‹ï¼š**
```
ç¬¬033é˜Ÿ
01 02 03 04 05 æ€»å’Œ15
----ç•™~åå•----
å¼ ä¸‰ 1000
æå›› 2000
ç‹äº” 500
```

## ğŸ”„ åå­—å­—æ®µçš„æ¥æºå’Œæ›´æ–°

### å­—æ®µå®šä¹‰

**ä½ç½®ï¼š** `BaiShengVx3Plus/Models/V2Member.cs` (ç¬¬93-105è¡Œ)

```csharp
[DataGridColumn(HeaderText = "æ˜µç§°", Width = 120, Order = 3)]
public string? Nickname
{
    get => _nickname;
    set => SetField(ref _nickname, value);
}

[DataGridColumn(HeaderText = "ç¾¤æ˜µç§°", Width = 120, Order = 4)]
public string? DisplayName
{
    get => _displayName;
    set => SetField(ref _displayName, value);
}
```

**è¯´æ˜ï¼š**
- **Nickname** = å¾®ä¿¡æ˜µç§°ï¼ˆç”¨æˆ·è‡ªå·±è®¾ç½®çš„æ˜µç§°ï¼‰
- **DisplayName** = ç¾¤æ˜µç§°/å¤‡æ³¨ï¼ˆç¾¤ä¸»æˆ–ç®¡ç†å‘˜è®¾ç½®çš„å¤‡æ³¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç­‰äºæ˜µç§°ï¼‰

### åˆå§‹åŒ–æ¥æº

**ä½ç½®ï¼š** `BaiShengVx3Plus/Services/GroupBinding/GroupBindingService.cs` (ç¬¬707-733è¡Œ)

#### ä»æœåŠ¡å™¨è·å–ç¾¤æˆå‘˜æ—¶ï¼š

```csharp
// ğŸ”¥ è§£ææ˜µç§°
if (item.TryGetProperty("member_nickname", out var memberNickname))
{
    member.Nickname = memberNickname.GetString() ?? string.Empty;
}
else if (item.TryGetProperty("nickname", out var nickname))
{
    member.Nickname = nickname.GetString() ?? string.Empty;
}

// ğŸ”¥ è§£æå¤‡æ³¨åï¼ˆä½œä¸ºç¾¤æ˜µç§°ï¼‰
if (item.TryGetProperty("member_remark", out var memberRemark))
{
    string remark = memberRemark.GetString() ?? string.Empty;
    if (!string.IsNullOrEmpty(remark))
    {
        member.DisplayName = remark;  // ä½¿ç”¨å¤‡æ³¨
    }
    else
    {
        member.DisplayName = member.Nickname; // å¤‡æ³¨ä¸ºç©ºæ—¶ä½¿ç”¨æ˜µç§°
    }
}
else if (item.TryGetProperty("display_name", out var displayName))
{
    member.DisplayName = displayName.GetString() ?? string.Empty;
}
else
{
    member.DisplayName = member.Nickname; // é»˜è®¤ä½¿ç”¨æ˜µç§°
}
```

**æ•°æ®æ¥æºï¼š**
- ä»å¾®ä¿¡æœåŠ¡å™¨APIè·å–ç¾¤æˆå‘˜åˆ—è¡¨
- **Nickname** æ¥è‡ª API è¿”å›çš„ `member_nickname` æˆ– `nickname` å­—æ®µ
- **DisplayName** æ¥è‡ª API è¿”å›çš„ `member_remark` æˆ– `display_name` å­—æ®µ

### åˆ·æ–°å‘½ä»¤çš„å½±å“

**ä½ç½®ï¼š** `BaiShengVx3Plus/Services/GroupBinding/GroupBindingService.cs` (ç¬¬165-186è¡Œ)

#### æ™ºèƒ½åˆå¹¶é€»è¾‘ï¼š

```csharp
// ğŸ”¥ æ£€æŸ¥æ˜µç§°æ˜¯å¦å˜åŒ–
if (!string.IsNullOrEmpty(serverMember.Nickname) && 
    serverMember.Nickname != dbMember.Nickname)
{
    dbMember.Nickname = serverMember.Nickname;
    nicknameChanged = true;
}

// ğŸ”¥ æ£€æŸ¥DisplayNameï¼ˆç¾¤æ˜µç§°/å¤‡æ³¨ï¼‰æ˜¯å¦å˜åŒ–
if (!string.IsNullOrEmpty(serverMember.DisplayName) && 
    serverMember.DisplayName != dbMember.DisplayName)
{
    dbMember.DisplayName = serverMember.DisplayName;
    displayNameChanged = true;
}

// ğŸ”¥ è®°å½•å˜åŒ–æ—¥å¿—
if (nicknameChanged || displayNameChanged)
{
    _logService.Info("GroupBindingService", 
        $"ğŸ“ ä¼šå‘˜ä¿¡æ¯å˜åŒ–: {dbMember.Wxid}");
    if (nicknameChanged)
        _logService.Info("GroupBindingService", 
            $"   æ˜µç§°: {oldNickname} â†’ {dbMember.Nickname}");
    if (displayNameChanged)
        _logService.Info("GroupBindingService", 
            $"   ç¾¤æ˜µç§°: {oldDisplayName} â†’ {dbMember.DisplayName}");
}
```

**åˆ·æ–°æ—¶æ›´æ–°é€»è¾‘ï¼š**

**ä½ç½®ï¼š** `BaiShengVx3Plus/Services/GroupBinding/GroupBindingService.cs` (ç¬¬442-444è¡Œ)

```csharp
// æ›´æ–°ç°æœ‰ä¼šå‘˜çš„æ•°æ®ï¼ˆä¿æŒå¼•ç”¨ä¸å˜ï¼‰
existingMember.Nickname = newMember.Nickname;
existingMember.DisplayName = newMember.DisplayName;
existingMember.State = newMember.State;
```

### åˆ·æ–°åçš„å˜æ›´æƒ…å†µ

| æ“ä½œ | Nickname | DisplayName |
|------|----------|-------------|
| **é¦–æ¬¡ç»‘å®šç¾¤** | âœ… ä»æœåŠ¡å™¨è·å– | âœ… ä»æœåŠ¡å™¨è·å– |
| **åˆ·æ–°ä¼šå‘˜ï¼ˆåŒä¸€ä¸ªç¾¤ï¼‰** | âœ… æ›´æ–°ä¸ºæœåŠ¡å™¨æœ€æ–°å€¼ | âœ… æ›´æ–°ä¸ºæœåŠ¡å™¨æœ€æ–°å€¼ |
| **åˆ‡æ¢ç¾¤** | âœ… æ¸…ç©ºåé‡æ–°åŠ è½½ | âœ… æ¸…ç©ºåé‡æ–°åŠ è½½ |

**ç»“è®ºï¼šåˆ·æ–°å‘½ä»¤ä¼šåŒæ—¶æ›´æ–°ä¸¤ä¸ªå­—æ®µã€‚**

## ğŸ“ å®Œæ•´æµç¨‹å›¾

### ä¸­~åå•ç”Ÿæˆæµç¨‹

```
å¼€å¥–è§¦å‘
  â””â”€> ç»“ç®—è®¢å•
      â””â”€> éå†è®¢å•
          â””â”€> è·å–æ˜µç§°ï¼š
              â”œâ”€ order.Nicknameï¼ˆè®¢å•è®°å½•çš„æ˜µç§°ï¼‰âœ… ä¼˜å…ˆ
              â”œâ”€ member.Nicknameï¼ˆä¼šå‘˜è¡¨æ˜µç§°ï¼‰
              â”œâ”€ member.DisplayNameï¼ˆä¼šå‘˜è¡¨ç¾¤æ˜µç§°ï¼‰
              â””â”€ "æœªçŸ¥"ï¼ˆå…œåº•ï¼‰
          â””â”€> æ‹¼æ¥æ¶ˆæ¯ï¼š
              "{nickname}[{ä½™é¢}] {çº¯åˆ©}"
```

### ç•™~åå•ç”Ÿæˆæµç¨‹

```
å¼€å¥–è§¦å‘
  â””â”€> éå†ä¼šå‘˜è¡¨
      â””â”€> ç­›é€‰æ¡ä»¶ï¼šä½™é¢ >= 1
          â””â”€> è·å–æ˜µç§°ï¼š
              â””â”€ member.Nicknameï¼ˆä¼šå‘˜è¡¨æ˜µç§°ï¼‰âœ… å”¯ä¸€
          â””â”€> æ‹¼æ¥æ¶ˆæ¯ï¼š
              "{nickname} {ä½™é¢}"
```

## ğŸ” å…³é”®ä»£ç ä½ç½®

### ä¸¤ä¸ªé¡¹ç›®ä¸€è‡´

#### BaiShengVx3Plus

| åŠŸèƒ½ | æ–‡ä»¶ | è¡Œå· |
|------|------|------|
| ä¸­~åå•ä½¿ç”¨åå­— | `Services/Games/Binggo/BinggoLotteryService.cs` | 1144-1145 |
| ç•™~åå•ä½¿ç”¨åå­— | `Services/Games/Binggo/BinggoLotteryService.cs` | 1442-1445 |
| åå­—å­—æ®µå®šä¹‰ | `Models/V2Member.cs` | 93-105 |
| åˆå§‹åŒ–æ¥æº | `Services/GroupBinding/GroupBindingService.cs` | 707-733 |
| åˆ·æ–°æ›´æ–°é€»è¾‘ | `Services/GroupBinding/GroupBindingService.cs` | 165-186, 442-444 |

#### zhaocaimao

åŒæ ·çš„ä½ç½®ï¼Œé€»è¾‘å®Œå…¨ä¸€è‡´ã€‚

## âœ… æ€»ç»“

### ä½¿ç”¨çš„åå­—

| åå• | ä½¿ç”¨å­—æ®µ | å¤‡æ³¨ |
|------|---------|------|
| **ä¸­~åå•** | `order.Nickname` â†’ `member.Nickname` â†’ `member.DisplayName` | ä¼˜å…ˆä½¿ç”¨è®¢å•æ˜µç§° |
| **ç•™~åå•** | `member.Nickname` | åªä½¿ç”¨ä¼šå‘˜æ˜µç§° |

### å­—æ®µæ¥æº

| å­—æ®µ | åˆå§‹æ¥æº | æ•°æ®æº |
|------|---------|--------|
| **Nickname** | API: `member_nickname` æˆ– `nickname` | å¾®ä¿¡ç”¨æˆ·æ˜µç§° |
| **DisplayName** | API: `member_remark` æˆ– `display_name` | ç¾¤å¤‡æ³¨æˆ–æ˜µç§° |

### åˆ·æ–°å½±å“

âœ… **åˆ·æ–°ä¼šå‘˜å‘½ä»¤ä¼šåŒæ—¶æ›´æ–°ä¸¤ä¸ªå­—æ®µ**ï¼š
- `member.Nickname` - æ›´æ–°ä¸ºæœåŠ¡å™¨æœ€æ–°å€¼
- `member.DisplayName` - æ›´æ–°ä¸ºæœåŠ¡å™¨æœ€æ–°å€¼

å¦‚æœä¼šå‘˜ä¿®æ”¹äº†å¾®ä¿¡æ˜µç§°æˆ–ç¾¤ä¸»ä¿®æ”¹äº†å¤‡æ³¨ï¼Œåˆ·æ–°åè¿™ä¸¤ä¸ªå­—æ®µéƒ½ä¼šåŒæ­¥æ›´æ–°ã€‚

---

**å»ºè®®ï¼š** å¦‚æœéœ€è¦åœ¨ç•™~åå•ä¸­ä½¿ç”¨ç¾¤å¤‡æ³¨ï¼ˆDisplayNameï¼‰ï¼Œå¯ä»¥ä¿®æ”¹ç¬¬1442-1445è¡Œçš„ä»£ç ï¼Œæ”¹ä¸ºä½¿ç”¨ `member.DisplayName`ã€‚

