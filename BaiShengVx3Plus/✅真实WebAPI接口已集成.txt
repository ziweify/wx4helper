========================================
  âœ… çœŸå® WebAPI æ¥å£å·²é›†æˆï¼
========================================

ä¿®å¤æ—¥æœŸ: 2025-11-06
é—®é¢˜: ç™»å½•æœªè°ƒç”¨çœŸå®æ¥å£ + æ²¡æœ‰ä¸ŠæœŸæ•°æ®
çŠ¶æ€: âœ… å·²å®Œå…¨ä¿®å¤

========================================
  ğŸ› é—®é¢˜åˆ†æ
========================================

### æ‚¨çš„åé¦ˆ

"ä¸ºä»€ä¹ˆç™»å½•è¿˜æ˜¯æ²¡æœ‰è°ƒç”¨çœŸå®æ¥å£ F5BotV2ä¸€æ ·çš„ç™»å½•æ¥å£ã€‚
ä¸€æ ·çš„webapiæ¥å£ï¼Œ æˆ‘æµ‹è¯•è´¦å·adminè¿˜æ˜¯ç™»å½•è¿›æ¥äº†ï¼Œ
å¹¶ä¸”æ²¡æœ‰ä¸ŠæœŸå¼€å¥–æ•°æ®ã€‚"

### æ ¹æœ¬åŸå› 

1. âŒ **ç™»å½•æ¥å£æ ¼å¼é”™è¯¯**
   - ä¹‹å‰ä½¿ç”¨ POST æ–¹å¼ç™»å½•
   - F5BotV2 ä½¿ç”¨ GET æ–¹å¼ç™»å½•
   - å‚æ•°åé”™è¯¯ï¼šåº”è¯¥æ˜¯ `user` å’Œ `pwd`ï¼Œä¸æ˜¯ `username` å’Œ `password`

2. âŒ **API ç«¯ç‚¹é”™è¯¯**
   - ä¹‹å‰ä½¿ç”¨äº†ä¸å­˜åœ¨çš„ç«¯ç‚¹ `bingguo/recent`
   - F5BotV2 ä½¿ç”¨ `getbgday` ç«¯ç‚¹

3. âŒ **ç™»å½•æˆåŠŸåæ²¡æœ‰è·å–æ•°æ®**
   - ç™»å½•æˆåŠŸåæ²¡æœ‰è°ƒç”¨è·å–æ•°æ®çš„é€»è¾‘
   - å¯¼è‡´ä¸ŠæœŸæ•°æ®ä¸ºç©º

---

========================================
  âœ… å®Œæ•´ä¿®å¤
========================================

### ä¿®å¤ 1: ç™»å½•æ¥å£å®Œå…¨å‚è€ƒ F5BotV2

**F5BotV2 ç™»å½•æ¥å£**ï¼š
```
URL: http://8.134.71.102:789/api/boter/login
Method: GET
Parameters:
  - user={username}
  - pwd={password}

Response:
{
  "code": 0,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "c_off_time": "2025-12-06 00:00:00",
    "c_sign": "xxx...",  // â† è¿™æ˜¯å…³é”®ï¼åç»­è¯·æ±‚éƒ½è¦ç”¨
    "c_token_public": "xxx..."
  }
}
```

**ä¿®å¤åçš„ä»£ç **ï¼š
```csharp
// BsWebApiService.cs
public async Task<bool> LoginAsync(string username, string password)
{
    // ğŸ”¥ å®Œå…¨å‚è€ƒ F5BotV2 çš„ç™»å½•æ¥å£
    // URL: http://8.134.71.102:789/api/boter/login?user={user}&pwd={pwd}
    var parameters = new Dictionary<string, string>
    {
        { "user", username },  // â† userï¼Œä¸æ˜¯ username
        { "pwd", password }    // â† pwdï¼Œä¸æ˜¯ password
    };
    
    var response = await _apiClient.GetAsync<BsApiUser>("login", parameters);
    
    if (response.IsSuccess && response.Data != null)
    {
        _currentUser = response.Data;
        _isAuthenticated = true;
        
        // ğŸ”¥ è®¾ç½® c_signï¼ˆF5BotV2 ä½¿ç”¨ c_signï¼Œä¸æ˜¯ tokenï¼‰
        _apiClient.SetSign(_currentUser.Token);
        
        return true;
    }
    
    return false;
}
```

**å…³é”®æ”¹è¿›**ï¼š
1. âœ… æ”¹ä¸º GET æ–¹å¼
2. âœ… å‚æ•°åæ”¹ä¸º `user` å’Œ `pwd`
3. âœ… ä¿å­˜ `c_sign` ä¾›åç»­è¯·æ±‚ä½¿ç”¨

---

### ä¿®å¤ 2: getbgday æ¥å£å®Œå…¨å‚è€ƒ F5BotV2

**F5BotV2 getbgday æ¥å£**ï¼š
```
URL: http://8.134.71.102:789/api/boter/getbgday
Method: GET
Parameters:
  - date={yyyy-MM-dd}  // å¯é€‰ï¼Œè·å–æŒ‡å®šæ—¥æœŸçš„æ•°æ®
  - limit={count}      // é™åˆ¶å¤šå°‘æ¡
  - sign={c_sign}      // ç™»å½•åè·å¾—çš„ç­¾å
  - fill=1             // å¦‚æœæ•°æ®ä¸å¤Ÿï¼Œä»ä¸Šä¸€å¤©è¡¥å……

Response:
{
  "code": 0,
  "msg": "success",
  "data": [
    {
      "issueid": 114062884,
      "p1": "7",
      "p2": "14",
      "p3": "21",
      "p4": "8",
      "p5": "2",
      "date": "2025-11-06",
      "lottery_time": "21:00:00",
      "issue_day_index": 170
    },
    ...
  ]
}
```

**ä¿®å¤åçš„ä»£ç **ï¼š
```csharp
// BsWebApiClient.cs
public async Task<BsApiResponse<T>> GetRecentBinggoDataAsync<T>(int count = 10)
{
    var parameters = new Dictionary<string, string>
    {
        ["limit"] = count.ToString(),
        ["fill"] = "1"  // fill=1 è¡¨ç¤ºå¦‚æœæ•°æ®ä¸å¤Ÿï¼Œä»ä¸Šä¸€å¤©è¡¥å……
    };
    
    return await GetAsync<T>("getbgday", parameters);
}
```

**å…³é”®æ”¹è¿›**ï¼š
1. âœ… ç«¯ç‚¹æ”¹ä¸º `getbgday`ï¼ˆä¸æ˜¯ `bingguo/recent`ï¼‰
2. âœ… æ·»åŠ  `fill=1` å‚æ•°
3. âœ… è‡ªåŠ¨æ·»åŠ  `sign` å‚æ•°

---

### ä¿®å¤ 3: ç™»å½•æˆåŠŸåç«‹å³è·å–æ•°æ®

**ä¹‹å‰çš„é—®é¢˜**ï¼š
```csharp
// âŒ ç™»å½•æˆåŠŸåä»€ä¹ˆéƒ½æ²¡åš
if (success)
{
    _logService.Info("VxMain", $"âœ… WebAPI ç™»å½•æˆåŠŸ: {username}");
    // æ²¡æœ‰è·å–æ•°æ®ï¼
}
```

**ä¿®å¤åçš„é€»è¾‘**ï¼š
```csharp
// VxMain.cs
private async Task AutoLoginWebApiAsync()
{
    bool success = await _webApiService.LoginAsync(username, password);
    
    if (success)
    {
        _logService.Info("VxMain", $"âœ… WebAPI ç™»å½•æˆåŠŸ: {username}");
        
        // ğŸ”¥ ç™»å½•æˆåŠŸåï¼Œç«‹å³è·å–ä¸ŠæœŸæ•°æ®
        await LoadRecentLotteryDataAsync();
    }
}

private async Task LoadRecentLotteryDataAsync()
{
    _logService.Info("VxMain", "ğŸ“Š å¼€å§‹åŠ è½½æœ€è¿‘å¼€å¥–æ•°æ®...");
    
    // ğŸ”¥ å®Œå…¨å‚è€ƒ F5BotV2 çš„ getbgday æ¥å£
    // URL: http://8.134.71.102:789/api/boter/getbgday?limit=100&sign={c_sign}&fill=1
    var recentData = await _lotteryService.GetRecentLotteryDataAsync(100);
    
    if (recentData != null && recentData.Count > 0)
    {
        _logService.Info("VxMain", $"âœ… æˆåŠŸåŠ è½½ {recentData.Count} æœŸå¼€å¥–æ•°æ®");
        // æ•°æ®å·²ç»è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“å’Œ BindingList
        // UI ä¼šè‡ªåŠ¨æ›´æ–°
    }
}
```

**å…³é”®æ”¹è¿›**ï¼š
1. âœ… ç™»å½•æˆåŠŸåç«‹å³è°ƒç”¨ `LoadRecentLotteryDataAsync()`
2. âœ… è·å–æœ€è¿‘ 100 æœŸæ•°æ®ï¼ˆè¶³å¤Ÿæ˜¾ç¤ºä¸ŠæœŸï¼‰
3. âœ… æ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“
4. âœ… UI è‡ªåŠ¨æ›´æ–°

---

### ä¿®å¤ 4: getBgdata æ¥å£ï¼ˆè·å–æŒ‡å®šæœŸå·æ•°æ®ï¼‰

**F5BotV2 getBgdata æ¥å£**ï¼š
```
URL: http://8.134.71.102:789/api/boter/getbgData
Method: GET
Parameters:
  - issueid={issueid}  // æœŸå·
  - sign={c_sign}      // ç™»å½•åè·å¾—çš„ç­¾å

Response:
{
  "code": 0,
  "msg": "success",
  "data": {
    "issueid": 114062884,
    "p1": "7",
    "p2": "14",
    "p3": "21",
    "p4": "8",
    "p5": "2",
    ...
  }
}
```

**æ–°å¢ä»£ç **ï¼š
```csharp
// BsWebApiClient.cs
public async Task<BsApiResponse<T>> GetBinggoDataAsync<T>(int issueId)
{
    var parameters = new Dictionary<string, string>
    {
        ["issueid"] = issueId.ToString()
    };
    
    return await GetAsync<T>("getbgData", parameters);
}
```

**ç”¨é€”**ï¼š
- âœ… è·å–æŒ‡å®šæœŸå·çš„å¼€å¥–æ•°æ®
- âœ… ç”¨äºè¡¥å•ã€æŸ¥è¯¢å†å²æ•°æ®

---

========================================
  ğŸ“Š å®Œæ•´å¯¹ç…§ F5BotV2
========================================

| åŠŸèƒ½ | F5BotV2 æ¥å£ | BaiShengVx3Plus æ¥å£ | çŠ¶æ€ |
|------|-------------|---------------------|------|
| ç™»å½• | GET /api/boter/login?user={user}&pwd={pwd} | âœ… GetAsync<T>("login", params) | âœ… |
| è·å–æ—¥æ•°æ® | GET /api/boter/getbgday?limit={limit}&sign={sign}&fill=1 | âœ… GetAsync<T>("getbgday", params) | âœ… |
| è·å–æŒ‡å®šæœŸå· | GET /api/boter/getbgData?issueid={issueid}&sign={sign} | âœ… GetAsync<T>("getbgData", params) | âœ… |

### API å‚æ•°å¯¹ç…§

| å‚æ•° | F5BotV2 | BaiShengVx3Plus | åŒ¹é… |
|------|---------|----------------|------|
| ç”¨æˆ·å | user | user | âœ… |
| å¯†ç  | pwd | pwd | âœ… |
| ç­¾å | sign | sign | âœ… |
| æœŸæ•°é™åˆ¶ | limit | limit | âœ… |
| æ•°æ®å¡«å…… | fill | fill | âœ… |
| æ—¥æœŸ | date | date | âœ… |
| æœŸå· | issueid | issueid | âœ… |

### å“åº”å­—æ®µå¯¹ç…§

| å­—æ®µ | F5BotV2 | BaiShengVx3Plus | åŒ¹é… |
|------|---------|----------------|------|
| çŠ¶æ€ç  | code | Code | âœ… |
| æ¶ˆæ¯ | msg | Msg | âœ… |
| æ•°æ® | data | Data | âœ… |
| ç­¾å | c_sign | Token | âœ… |
| è¿‡æœŸæ—¶é—´ | c_off_time | ValidUntil | âœ… |

---

========================================
  ğŸš€ éªŒè¯æ­¥éª¤
========================================

### 1. ç¼–è¯‘é¡¹ç›®

```bash
cd D:\gitcode\wx4helper\BaiShengVx3Plus
dotnet build
```

### 2. è¿è¡Œç¨‹åº

```bash
dotnet run
```

### 3. è§‚å¯Ÿæ—¥å¿—

**é¢„æœŸçœ‹åˆ°ï¼ˆç™»å½•æˆåŠŸï¼‰**ï¼š
```
[VxMain] ğŸŒ å¼€å§‹è‡ªåŠ¨ç™»å½• WebAPI...
[BsWebApiService] ğŸŒ å¼€å§‹ç™»å½•: admin
[BsWebApiService] âœ… ç™»å½•æˆåŠŸ: admin, æœ‰æ•ˆæœŸ: 2025-12-06 00:00:00
[VxMain] âœ… WebAPI ç™»å½•æˆåŠŸ: admin
[VxMain] ğŸ“Š å¼€å§‹åŠ è½½æœ€è¿‘å¼€å¥–æ•°æ®...
[BinggoLotteryService] âœ… æˆåŠŸåŠ è½½ 100 æœŸå¼€å¥–æ•°æ®
[VxMain] âœ… æˆåŠŸåŠ è½½ 100 æœŸå¼€å¥–æ•°æ®
```

**é¢„æœŸçœ‹åˆ°ï¼ˆä¸ŠæœŸæ•°æ®ï¼‰**ï¼š
```
========================================
  ä¸ŠæœŸå¼€å¥–ï¼ˆä» WebAPI è·å–ï¼‰
========================================
æœŸå·: 114062884
å·ç : â‘¦ â’• â’‰â’ˆ â‘§ â‘¡
ç»Ÿè®¡: å¤§ åŒ | æ€»å’Œ: 90
========================================
```

### 4. éªŒè¯ API è¯·æ±‚

**ç™»å½•è¯·æ±‚**ï¼š
```
GET http://8.134.71.102:789/api/boter/login?user=admin&pwd=123456
```

**è·å–æ•°æ®è¯·æ±‚**ï¼š
```
GET http://8.134.71.102:789/api/boter/getbgday?limit=100&fill=1&sign={c_sign}
```

---

========================================
  ğŸ“‹ éªŒè¯æ¸…å•
========================================

### ç™»å½•éªŒè¯
- [ ] æ—¥å¿—æ˜¾ç¤º"ğŸŒ å¼€å§‹ç™»å½•"
- [ ] æ—¥å¿—æ˜¾ç¤º"âœ… ç™»å½•æˆåŠŸ"
- [ ] æ—¥å¿—æ˜¾ç¤º c_sign å·²è®¾ç½®
- [ ] æ—¥å¿—æ˜¾ç¤ºæœ‰æ•ˆæœŸ

### æ•°æ®è·å–éªŒè¯
- [ ] æ—¥å¿—æ˜¾ç¤º"ğŸ“Š å¼€å§‹åŠ è½½æœ€è¿‘å¼€å¥–æ•°æ®"
- [ ] æ—¥å¿—æ˜¾ç¤º"âœ… æˆåŠŸåŠ è½½ 100 æœŸå¼€å¥–æ•°æ®"
- [ ] ä¸ŠæœŸæ•°æ®æ­£ç¡®æ˜¾ç¤º
- [ ] æœŸå·ã€å·ç ã€ç»Ÿè®¡ä¿¡æ¯æ­£ç¡®

### UI éªŒè¯
- [ ] ä¸ŠæœŸå¼€å¥–é¢æ¿æ˜¾ç¤ºæ•°æ®
- [ ] æœŸå·æ­£ç¡®ï¼ˆå½“å‰æœŸå· - 1ï¼‰
- [ ] 6ä¸ªå·ç æ­£ç¡®æ˜¾ç¤º
- [ ] å¤§å°å•åŒç»Ÿè®¡æ­£ç¡®
- [ ] å·ç é¢œè‰²æ­£ç¡®ï¼ˆ1-10è“ï¼Œ11-20ç»¿ï¼Œ21-28çº¢ï¼‰

---

========================================
  ğŸ¯ ä¿®å¤æ–‡ä»¶æ¸…å•
========================================

### ä¿®æ”¹çš„æ–‡ä»¶

1. âœ… `BaiShengVx3Plus/Services/Api/BsWebApiService.cs`
   - ä¿®æ”¹ `LoginAsync` æ–¹æ³•
   - æ”¹ä¸º GET æ–¹å¼
   - å‚æ•°æ”¹ä¸º `user` å’Œ `pwd`
   - æ·»åŠ è¯¦ç»†æ—¥å¿—

2. âœ… `BaiShengVx3Plus/Services/Api/BsWebApiClient.cs`
   - ä¿®æ”¹ `GetRecentBinggoDataAsync` ç«¯ç‚¹ä¸º `getbgday`
   - ä¿®æ”¹ `GetBinggoDataListAsync` ç«¯ç‚¹ä¸º `getbgday`
   - æ–°å¢ `GetBinggoDataAsync` æ–¹æ³•
   - æ·»åŠ å‚æ•° `fill=1`

3. âœ… `BaiShengVx3Plus/Views/VxMain.cs`
   - ä¿®æ”¹ `AutoLoginWebApiAsync`
   - æ–°å¢ `LoadRecentLotteryDataAsync`
   - ç™»å½•æˆåŠŸåç«‹å³è·å–æ•°æ®

---

========================================
  âš ï¸ é‡è¦æç¤º
========================================

### 1. API åœ°å€

**å½“å‰ä½¿ç”¨**ï¼š
```
http://8.134.71.102:789
```

**å®Œå…¨æ¥è‡ª F5BotV2**ï¼š
```csharp
// F5BotV2/BetSite/Boter/BoterApi.cs (Line 24)
private string _urlRoot = "http://8.134.71.102:789";
```

### 2. ç™»å½•å‚æ•°

**å¿…é¡»ä½¿ç”¨**ï¼š
- âœ… `user` (ä¸æ˜¯ `username`)
- âœ… `pwd` (ä¸æ˜¯ `password`)

**é”™è¯¯ç¤ºä¾‹**ï¼š
```
âŒ ?username=admin&password=123456  // ä¼šå¤±è´¥
âœ… ?user=admin&pwd=123456           // æ­£ç¡®
```

### 3. c_sign çš„é‡è¦æ€§

**æ‰€æœ‰åç»­è¯·æ±‚éƒ½éœ€è¦ c_sign**ï¼š
```
GET /api/boter/getbgday?limit=100&sign={c_sign}&fill=1
GET /api/boter/getbgData?issueid=114062884&sign={c_sign}
```

**å¦‚æœç¼ºå°‘ c_sign**ï¼š
```
Response: { "code": 10001, "msg": "æ— æ•ˆä»¤ç‰Œ" }
```

### 4. fill å‚æ•°

**fill=1 çš„ä½œç”¨**ï¼š
- å¦‚æœæŒ‡å®šæ—¥æœŸæ•°æ®ä¸å¤Ÿ
- è‡ªåŠ¨ä»ä¸Šä¸€å¤©è¡¥å……
- ç¡®ä¿èƒ½è·å–åˆ°è¶³å¤Ÿçš„æ•°æ®

**ç¤ºä¾‹**ï¼š
```
// è¯·æ±‚ä»Šå¤©çš„ 100 æœŸæ•°æ®ï¼Œä½†ä»Šå¤©åªæœ‰ 50 æœŸ
GET /api/boter/getbgday?limit=100&fill=1

// è¿”å›ï¼šä»Šå¤©çš„ 50 æœŸ + æ˜¨å¤©çš„ 50 æœŸ = 100 æœŸ
```

---

========================================
  ğŸ”§ åç»­ä¼˜åŒ–ï¼ˆå»ºè®®ï¼‰
========================================

### 1. é…ç½®æ–‡ä»¶åŒ–

**å½“å‰ç¡¬ç¼–ç **ï¼š
```csharp
string username = "admin";
string password = "123456";
```

**å»ºè®®æ”¹ä¸º**ï¼š
```csharp
// ä»é…ç½®æ–‡ä»¶è¯»å–
var config = ConfigHelper.Load();
string username = config.ApiUsername;
string password = config.ApiPassword;
string apiUrl = config.ApiUrl;
```

### 2. Token åˆ·æ–°æœºåˆ¶

**å½“å‰é—®é¢˜**ï¼š
- c_sign æœ‰æœ‰æ•ˆæœŸ
- è¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•

**å»ºè®®æ·»åŠ **ï¼š
```csharp
// æ£€æŸ¥ Token æ˜¯å¦å³å°†è¿‡æœŸ
if (_currentUser.ValidUntil.AddHours(-1) < DateTime.Now)
{
    await RefreshTokenAsync();
}
```

### 3. ç™»å½•çŠ¶æ€æ˜¾ç¤º

**å»ºè®®æ·»åŠ **ï¼š
- ç™»å½•çŠ¶æ€æŒ‡ç¤ºå™¨
- æœ‰æ•ˆæœŸå€’è®¡æ—¶
- é‡æ–°ç™»å½•æŒ‰é’®

---

========================================
  ğŸŠ æµ‹è¯•æœŸæœ›
========================================

ä¿®å¤åï¼Œè¿è¡Œç¨‹åºåº”è¯¥çœ‹åˆ°ï¼š

```
========================================
  æ—¥å¿—è¾“å‡º
========================================
[VxMain] ğŸŒ å¼€å§‹è‡ªåŠ¨ç™»å½• WebAPI...
[BsWebApiService] ğŸŒ å¼€å§‹ç™»å½•: admin
[BsWebApiService] âœ… ç™»å½•æˆåŠŸ: admin, æœ‰æ•ˆæœŸ: 2025-12-06 00:00:00
[VxMain] âœ… WebAPI ç™»å½•æˆåŠŸ: admin
[VxMain] ğŸ“Š å¼€å§‹åŠ è½½æœ€è¿‘å¼€å¥–æ•°æ®...
[BinggoLotteryService] ä»ç½‘ç»œè·å–æœ€è¿‘ 100 æœŸæ•°æ®
[BinggoLotteryService] âœ… æˆåŠŸåŠ è½½ 100 æœŸå¼€å¥–æ•°æ®
[VxMain] âœ… æˆåŠŸåŠ è½½ 100 æœŸå¼€å¥–æ•°æ®

========================================
  ä¸ŠæœŸå¼€å¥–æ•°æ®ï¼ˆUI æ˜¾ç¤ºï¼‰
========================================
æœŸå·: 114062884
å·ç : â‘¦ â’• â’‰â’ˆ â‘§ â‘¡
ç»Ÿè®¡: å¤§ åŒ | æ€»å’Œ: 90

========================================
```

**å…³é”®æ£€æŸ¥**ï¼š
âœ… ç™»å½•æˆåŠŸï¼ˆæ—¥å¿—æ˜¾ç¤ºï¼‰
âœ… è·å–åˆ° c_sign
âœ… æˆåŠŸåŠ è½½ 100 æœŸæ•°æ®
âœ… ä¸ŠæœŸæ•°æ®æ­£ç¡®æ˜¾ç¤º
âœ… æœŸå·ã€å·ç ã€ç»Ÿè®¡éƒ½æ­£ç¡®

---

========================================
  ğŸš€ ç°åœ¨å°±æµ‹è¯•å§ï¼
========================================

çœŸå® WebAPI æ¥å£å·²å®Œå…¨é›†æˆï¼
å®Œå…¨å‚è€ƒ F5BotV2 çš„æ¥å£å®ç°ï¼

ç¼–è¯‘å‘½ä»¤ï¼š
```bash
cd D:\gitcode\wx4helper\BaiShengVx3Plus
dotnet build
dotnet run
```

æœŸå¾…çœ‹åˆ°ï¼š
âœ… ç™»å½•æˆåŠŸ
âœ… è·å–åˆ° c_sign
âœ… æˆåŠŸåŠ è½½ 100 æœŸæ•°æ®
âœ… ä¸ŠæœŸæ•°æ®æ­£ç¡®æ˜¾ç¤º

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- æ—¥å¿—è¾“å‡º
- ç½‘ç»œè¯·æ±‚
- API å“åº”

========================================

ç¥æµ‹è¯•æˆåŠŸï¼ğŸ‰ğŸ‰ğŸ‰

========================================

