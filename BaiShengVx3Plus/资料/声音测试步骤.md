# ğŸ”Š å£°éŸ³æµ‹è¯•æ­¥éª¤

## é—®é¢˜ç°çŠ¶

- âœ… ä»£ç å·²ä¿®æ”¹ï¼ˆæ·»åŠ äº† `SetVolume`ï¼‰
- âœ… ç¼–è¯‘æˆåŠŸ
- âŒ æµ‹è¯• `ä¸Š100` å‘½ä»¤ï¼Œ**è¿˜æ˜¯æ²¡æœ‰å£°éŸ³**

---

## ğŸ” å¯èƒ½çš„åŸå› 

### 1. **ç³»ç»ŸéŸ³é‡é™éŸ³**
- Windows ç³»ç»ŸéŸ³é‡è¢«é™éŸ³
- æˆ–è€…éŸ³é‡è®¾ç½®ä¸º 0

### 2. **MP3 æ–‡ä»¶æŸå**
- `sound/mp3_shang.mp3` æ–‡ä»¶å¯èƒ½æŸå
- æˆ–è€…æ ¼å¼ä¸æ­£ç¡®

### 3. **MCI å‘½ä»¤å¤±è´¥**
- `setaudio` å‘½ä»¤å¯èƒ½ä¸æ”¯æŒ
- æˆ–è€…éœ€è¦ä¸åŒçš„è¯­æ³•

### 4. **éŸ³é¢‘è®¾å¤‡é—®é¢˜**
- æ²¡æœ‰éŸ³é¢‘è¾“å‡ºè®¾å¤‡
- æˆ–è€…è®¾å¤‡è¢«å…¶ä»–ç¨‹åºå ç”¨

---

## ğŸ§ª è¯Šæ–­æ­¥éª¤

### æ­¥éª¤1ï¼šæ£€æŸ¥ç³»ç»ŸéŸ³é‡

1. å³é”®ç‚¹å‡»ä»»åŠ¡æ éŸ³é‡å›¾æ ‡
2. ç¡®è®¤éŸ³é‡ä¸æ˜¯ 0ï¼Œæ²¡æœ‰é™éŸ³
3. å°è¯•æ’­æ”¾å…¶ä»–å£°éŸ³ï¼ˆå¦‚ YouTube è§†é¢‘ï¼‰ï¼Œç¡®è®¤æ‰¬å£°å™¨æ­£å¸¸

---

### æ­¥éª¤2ï¼šæ£€æŸ¥ MP3 æ–‡ä»¶

1. æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨
2. å¯¼èˆªåˆ°ï¼š`D:\gitcode\wx4helper\BaiShengVx3Plus\bin\Debug\net8.0-windows\sound\`
3. åŒå‡» `mp3_shang.mp3`
4. ç¡®è®¤èƒ½åœ¨ Windows Media Player æˆ–å…¶ä»–æ’­æ”¾å™¨ä¸­æ’­æ”¾

**å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æˆ–æŸå**ï¼š
- ä» F5BotV2 å¤åˆ¶å£°éŸ³æ–‡ä»¶ï¼š
  ```powershell
  Copy-Item "D:\gitcode\wx4helper\F5BotV2\sound\*.mp3" -Destination "D:\gitcode\wx4helper\BaiShengVx3Plus\bin\Debug\net8.0-windows\sound\" -Force
  ```

---

### æ­¥éª¤3ï¼šæŸ¥çœ‹ Debug è¾“å‡º

**åœ¨ Visual Studio ä¸­**ï¼š

1. **View â†’ Output** (æˆ– `Ctrl+Alt+O`)
2. é€‰æ‹© **"Debug"**
3. è¿è¡Œç¨‹åº
4. æ‰§è¡Œ `ä¸Š100` å‘½ä»¤
5. æŸ¥æ‰¾ä»¥ä¸‹æ—¥å¿—ï¼š

```
[SoundService] ğŸ”Š å‡†å¤‡æ’­æ”¾å£°éŸ³: mp3_shang.mp3
[SoundService]    1. MP3Play å¯¹è±¡å·²åˆ›å»º
[SoundService]    2. FileName å·²è®¾ç½®
[MP3Play] 1. Close all: 0
[MP3Play] 2. Open command: open "D:\...\mp3_shang.mp3" alias media
[MP3Play] 3. Open result: 0
[MP3Play] 4. Set time format result: 0
[MP3Play] Set volume to 100% (MCI: 1000), result: 0
[MP3Play] Play command result: 0
[SoundService]    4. SetVolume(100) å·²è°ƒç”¨
[SoundService]    5. play() å·²è°ƒç”¨
[SoundService] âœ… æ’­æ”¾å£°éŸ³å®Œæˆ: mp3_shang.mp3, éŸ³é‡: 100%
```

**å…³é”®æ£€æŸ¥ç‚¹**ï¼š
- âœ… æ‰€æœ‰è¿”å›å€¼åº”è¯¥æ˜¯ `0`ï¼ˆæˆåŠŸï¼‰
- âœ… æ–‡ä»¶è·¯å¾„åº”è¯¥æ­£ç¡®
- âœ… `SetVolume` åº”è¯¥è¢«è°ƒç”¨

**å¦‚æœè¿”å›å€¼ä¸æ˜¯ 0**ï¼š
- `272` = MCI é©±åŠ¨å†…éƒ¨é”™è¯¯ï¼ˆå¯èƒ½æ˜¯ç¼–è§£ç å™¨é—®é¢˜ï¼‰
- `276` = æ— æ•ˆæ–‡ä»¶
- `286` = æ–‡ä»¶æœªæ‰¾åˆ°

---

### æ­¥éª¤4ï¼šæ‰‹åŠ¨æµ‹è¯• MCI æ’­æ”¾

**ä½¿ç”¨ PowerShell æµ‹è¯•**ï¼š

```powershell
# å¯¼èˆªåˆ° sound æ–‡ä»¶å¤¹
cd "D:\gitcode\wx4helper\BaiShengVx3Plus\bin\Debug\net8.0-windows\sound"

# ä½¿ç”¨ PowerShell è°ƒç”¨ MCI
Add-Type -TypeDefinition @"
using System;
using System.Runtime.InteropServices;
using System.Text;
public class MCI {
    [DllImport("winmm.dll")]
    public static extern int mciSendString(string command, StringBuilder returnValue, int returnLength, IntPtr hwndCallback);
}
"@

$sb = New-Object System.Text.StringBuilder(128)
$file = (Get-Location).Path + "\mp3_shang.mp3"

# å…³é—­æ‰€æœ‰
[MCI]::mciSendString("close all", $sb, $sb.Capacity, [IntPtr]::Zero)
Write-Host "Close all: $($sb.ToString())"

# æ‰“å¼€æ–‡ä»¶
$openCmd = "open `"$file`" alias test"
$result = [MCI]::mciSendString($openCmd, $sb, $sb.Capacity, [IntPtr]::Zero)
Write-Host "Open result: $result"

# è®¾ç½®éŸ³é‡
$result = [MCI]::mciSendString("setaudio test volume to 1000", $sb, $sb.Capacity, [IntPtr]::Zero)
Write-Host "Set volume result: $result"

# æ’­æ”¾
$result = [MCI]::mciSendString("play test", $sb, $sb.Capacity, [IntPtr]::Zero)
Write-Host "Play result: $result"

# ç­‰å¾… 5 ç§’
Start-Sleep -Seconds 5

# å…³é—­
[MCI]::mciSendString("close test", $sb, $sb.Capacity, [IntPtr]::Zero)
```

**æœŸæœ›ç»“æœ**ï¼š
- âœ… æ‰€æœ‰è¿”å›å€¼åº”è¯¥æ˜¯ `0`
- âœ… åº”è¯¥å¬åˆ°å£°éŸ³

**å¦‚æœè¿˜æ˜¯æ²¡æœ‰å£°éŸ³**ï¼š
- é—®é¢˜å¯èƒ½åœ¨äº MCI ä¸æ”¯æŒè¯¥ MP3 æ–‡ä»¶æ ¼å¼
- æˆ–è€…ç³»ç»Ÿç¼ºå°‘ MP3 ç¼–è§£ç å™¨

---

### æ­¥éª¤5ï¼šå°è¯•ä½¿ç”¨ WAV æ–‡ä»¶

å¦‚æœ MCI ä¸æ”¯æŒ MP3ï¼Œå¯ä»¥è½¬æ¢ä¸º WAVï¼š

```powershell
# ä½¿ç”¨ ffmpeg è½¬æ¢ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰
ffmpeg -i mp3_shang.mp3 mp3_shang.wav

# æˆ–è€…ä½¿ç”¨åœ¨çº¿è½¬æ¢å·¥å…·
# https://cloudconvert.com/mp3-to-wav
```

ç„¶åä¿®æ”¹ `SoundSettings`ï¼š
```csharp
_creditUpSound = "mp3_shang.wav";
```

---

## ğŸ”§ å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ MediaPlayer

å¦‚æœ MCI ç¡®å®æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ‡æ¢åˆ° `System.Windows.Media.MediaPlayer`ï¼š

### ä¿®æ”¹ `SoundService.cs`ï¼š

```csharp
using System.Windows.Media;

public class SoundService
{
    private MediaPlayer? _currentPlayer;
    
    public void PlayMp3(string fileName, int volume = 100)
    {
        try
        {
            string filePath = Path.Combine(_soundDirectory, fileName);
            
            if (!File.Exists(filePath))
            {
                _logService.Warning("SoundService", $"âš ï¸ å£°éŸ³æ–‡ä»¶ä¸å­˜åœ¨: {filePath}");
                return;
            }
            
            // åœæ­¢å½“å‰æ’­æ”¾
            if (_currentPlayer != null)
            {
                try
                {
                    _currentPlayer.Stop();
                    _currentPlayer.Close();
                }
                catch { }
            }
            
            // åˆ›å»ºæ–°çš„ MediaPlayer
            _currentPlayer = new MediaPlayer();
            _currentPlayer.Volume = volume / 100.0;  // MediaPlayer éŸ³é‡æ˜¯ 0.0-1.0
            _currentPlayer.Open(new Uri(filePath, UriKind.Absolute));
            _currentPlayer.Play();
            
            _logService.Info("SoundService", $"âœ… æ’­æ”¾å£°éŸ³: {fileName}, éŸ³é‡: {volume}%");
        }
        catch (Exception ex)
        {
            _logService.Error("SoundService", $"æ’­æ”¾å£°éŸ³å¤±è´¥: {fileName}", ex);
        }
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç¨³å®šï¼Œå®˜æ–¹æ”¯æŒ
- âœ… æ”¯æŒå¤šç§æ ¼å¼ï¼ˆMP3ã€WAVã€WMAï¼‰
- âœ… éŸ³é‡æ§åˆ¶æ›´ç²¾ç¡®

**ç¼ºç‚¹**ï¼š
- âŒ éœ€è¦å¼•ç”¨ `PresentationCore.dll`ï¼ˆWPF åº“ï¼‰

---

## ğŸ“‹ å¾…åé¦ˆä¿¡æ¯

**è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯**ï¼š

1. âœ… **ç³»ç»ŸéŸ³é‡æ˜¯å¦æ­£å¸¸ï¼Ÿ**
   - èƒ½å¦æ’­æ”¾å…¶ä»–å£°éŸ³ï¼ˆå¦‚ YouTubeï¼‰ï¼Ÿ

2. âœ… **MP3 æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”èƒ½æ’­æ”¾ï¼Ÿ**
   - åŒå‡» `mp3_shang.mp3` æ˜¯å¦èƒ½åœ¨æ’­æ”¾å™¨ä¸­æ’­æ”¾ï¼Ÿ

3. âœ… **Debug è¾“å‡ºæ—¥å¿—**
   - å¤åˆ¶æ‰€æœ‰ `[SoundService]` å’Œ `[MP3Play]` å¼€å¤´çš„æ—¥å¿—

4. âœ… **MCI å‘½ä»¤è¿”å›å€¼**
   - ç‰¹åˆ«æ˜¯ `Open result`ã€`Set volume result`ã€`Play result`

5. âœ… **PowerShell æ‰‹åŠ¨æµ‹è¯•ç»“æœ**
   - è¿è¡Œæ­¥éª¤4ä¸­çš„ PowerShell è„šæœ¬ï¼Œæ˜¯å¦æœ‰å£°éŸ³ï¼Ÿ

---

**æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘å°±èƒ½ç¡®å®šé—®é¢˜æ‰€åœ¨å¹¶æä¾›ç²¾ç¡®çš„è§£å†³æ–¹æ¡ˆï¼** ğŸ¯

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-11-18 16:15

