# ğŸ“± å¼€å‘å·¥å…·ï¼šæ¶ˆæ¯æ¨¡æ‹Ÿçª—å£è®¾è®¡æ–¹æ¡ˆ

> **ç›®æ ‡**: åˆ›å»ºä¸€ä¸ªå¾®ä¿¡é£æ ¼çš„æ¶ˆæ¯æ¨¡æ‹Ÿçª—å£ï¼Œç”¨äºç¦»çº¿å¼€å‘å’Œæµ‹è¯•  
> **åŸåˆ™**: æœ€å°åŒ–ä¿®æ”¹ï¼Œä¸å½±å“ç°æœ‰æµç¨‹ï¼Œå¤ç”¨å·²æœ‰çš„ `SimulateMemberMessageAsync` æ–¹æ³•  
> **æ—¥æœŸ**: 2025-11-18

---

## ğŸ¯ éœ€æ±‚åˆ†æ

### **æ ¸å¿ƒéœ€æ±‚**

1. âœ… **éæ¨¡æ€çª—å£**: åŒä¸€ä¼šå‘˜åªèƒ½å¼€ä¸€ä¸ªçª—å£ï¼Œæ”¯æŒå¤šä¸ªä¼šå‘˜åŒæ—¶æ‰“å¼€å¤šä¸ªçª—å£
2. âœ… **å¾®ä¿¡é£æ ¼**: æ¨¡æ‹Ÿå¾®ä¿¡èŠå¤©ç•Œé¢ï¼ˆæ°”æ³¡ã€å¤´åƒã€æ—¶é—´æˆ³ï¼‰
3. âœ… **è§’è‰²æ¨¡æ‹Ÿ**: ä»¥å½“å‰ä¼šå‘˜èº«ä»½å‘é€æ¶ˆæ¯ï¼ˆä¼šå‘˜/ç®¡ç†å‘˜ï¼‰
4. âœ… **å®Œæ•´æµç¨‹**: æ¶ˆæ¯è¿›å…¥çœŸå®ä¸šåŠ¡æµç¨‹ï¼ˆè®¢å•ã€ä¸Šä¸‹åˆ†ç­‰ï¼‰
5. âœ… **æœ€å°åŒ–ä¿®æ”¹**: å¤ç”¨ `VxMain.SimulateMemberMessageAsync`ï¼Œä¸ç ´åç°æœ‰é€»è¾‘

### **åŠŸèƒ½æ¸…å•**

| åŠŸèƒ½ | æè¿° | å®ç°æ–¹å¼ |
|------|------|---------|
| å‘é€æ¶ˆæ¯ | æ¨¡æ‹Ÿä¼šå‘˜/ç®¡ç†å‘˜å‘é€æ¶ˆæ¯ | è°ƒç”¨ `SimulateMemberMessageAsync` |
| æ¥æ”¶å›å¤ | æ˜¾ç¤ºç³»ç»Ÿå›å¤æ¶ˆæ¯ | è§£æè¿”å›çš„ `replyMessage` |
| æ¶ˆæ¯å†å² | æ˜¾ç¤ºå¯¹è¯å†å² | ä½¿ç”¨ `RichTextBox` æˆ– `ListView` |
| è§’è‰²è¯†åˆ« | è‡ªåŠ¨è¯†åˆ«ä¼šå‘˜/ç®¡ç†å‘˜ | æ ¹æ® `MemberState` åˆ¤æ–­ |
| çª—å£ç®¡ç† | åŒä¸€ä¼šå‘˜åªå¼€ä¸€ä¸ªçª—å£ | é™æ€ `Dictionary<string, Form>` ç®¡ç† |

---

## ğŸ“Š ç°æœ‰æµç¨‹åˆ†æ

### **æ¶ˆæ¯å¤„ç†æµç¨‹å›¾**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ”§ å¼€å‘æ¨¡å¼ (ç¦»çº¿æµ‹è¯•)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘   å¼€å‘èœå•: å³é”® â†’ å‘é€æ¶ˆæ¯ (æ–°å¢)                          â”‚
â”‚      â†’ æ‰“å¼€ MessageSimulatorForm (éæ¨¡æ€)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¡  ç”¨æˆ·åœ¨çª—å£è¾“å…¥æ¶ˆæ¯ (ä¾‹å¦‚: "123å¤§10", "ä¸Š100")             â”‚
â”‚      â†’ ç‚¹å‡»å‘é€æŒ‰é’®                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¢  è°ƒç”¨ VxMain.SimulateMemberMessageAsync(wxid, message)   â”‚
â”‚      âœ… å¤ç”¨å·²æœ‰æ–¹æ³•ï¼Œä¸éœ€è¦ä¿®æ”¹æµç¨‹ï¼                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘£  SimulateMemberMessageAsync å†…éƒ¨æµç¨‹:                     â”‚
â”‚      1. æ£€æŸ¥å¼€å‘æ¨¡å¼                                          â”‚
â”‚      2. æ£€æŸ¥ç¾¤ç»‘å®š                                            â”‚
â”‚      3. æ£€æŸ¥æ”¶å•å¼€å…³                                          â”‚
â”‚      4. æŸ¥æ‰¾ä¼šå‘˜ä¿¡æ¯                                          â”‚
â”‚      5. è°ƒç”¨ BinggoMessageHandler.HandleMessageAsync         â”‚
â”‚      6. è¿”å› (success, replyMessage, errorMessage)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¤  MessageSimulatorForm æ¥æ”¶è¿”å›ç»“æœ:                       â”‚
â”‚      - success=true  â†’ æ˜¾ç¤ºå›å¤æ¶ˆæ¯ï¼ˆç»¿è‰²æ°”æ³¡ï¼‰               â”‚
â”‚      - success=false â†’ æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼ˆçº¢è‰²æ°”æ³¡ï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¥  ä¸šåŠ¡æµç¨‹ (å®Œå…¨å¤ç”¨ç°æœ‰é€»è¾‘):                              â”‚
â”‚      - è®¢å•åˆ›å»º â†’ V2MemberOrder è¡¨                           â”‚
â”‚      - ä¸Šä¸‹åˆ†   â†’ V2CreditWithdraw è¡¨                        â”‚
â”‚      - ç®¡ç†å‘½ä»¤ â†’ AdminCommandHandler                        â”‚
â”‚      - ç»Ÿè®¡æ›´æ–° â†’ BinggoStatisticsService                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **å…³é”®ç‚¹**

1. âœ… **ä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä¸šåŠ¡é€»è¾‘**: ç›´æ¥å¤ç”¨ `SimulateMemberMessageAsync`
2. âœ… **æ¶ˆæ¯è¿›å…¥çœŸå®æµç¨‹**: `BinggoMessageHandler` â†’ `BinggoOrderService` â†’ æ•°æ®åº“
3. âœ… **æ”¯æŒæ‰€æœ‰æ¶ˆæ¯ç±»å‹**: æŠ•æ³¨ã€ä¸Šä¸‹åˆ†ã€ç®¡ç†å‘½ä»¤ç­‰
4. âœ… **æœ€å°åŒ–åŸåˆ™**: åªéœ€æ–°å¢çª—å£ + å³é”®èœå•é¡¹

---

## ğŸ¨ UI è®¾è®¡æ–¹æ¡ˆ

### **æ–¹æ¡ˆé€‰æ‹©: RichTextBox (æ¨è)**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| RichTextBox | âœ… ç®€å•æ˜“ç”¨<br>âœ… æ”¯æŒå¯Œæ–‡æœ¬<br>âœ… æ”¯æŒé¢œè‰²ã€å­—ä½“<br>âœ… WinForms åŸç”Ÿ | âŒ ä¸æ”¯æŒå¤æ‚å¸ƒå±€<br>âŒ æ°”æ³¡æ•ˆæœéœ€è¦æ‰‹åŠ¨ç»˜åˆ¶ | â­â­â­â­â­ |
| ListView (OwnerDraw) | âœ… æ”¯æŒè‡ªå®šä¹‰ç»˜åˆ¶<br>âœ… å¯ä»¥ç»˜åˆ¶æ°”æ³¡ | âŒ å¤æ‚åº¦é«˜<br>âŒ éœ€è¦å¤§é‡ç»˜åˆ¶ä»£ç  | â­â­â­ |
| FlowLayoutPanel | âœ… æ”¯æŒå¤æ‚å¸ƒå±€<br>âœ… å¯ä»¥æ·»åŠ è‡ªå®šä¹‰æ§ä»¶ | âŒ æ€§èƒ½é—®é¢˜<br>âŒ æ¶ˆæ¯å¤šæ—¶å¡é¡¿ | â­â­ |

**æœ€ç»ˆé€‰æ‹©**: **RichTextBox** (ç®€å•ã€é«˜æ•ˆã€ç¬¦åˆéœ€æ±‚)

### **çª—å£å¸ƒå±€**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ æ¶ˆæ¯æ¨¡æ‹Ÿå™¨ - [ä¼šå‘˜æ˜µç§°] (Wxid)                    [Ã—]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [2025-11-18 15:30:20] å¼ ä¸‰                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚ â”‚
â”‚  â”‚  â”‚ 123å¤§10          â”‚  â† ä¼šå‘˜æ¶ˆæ¯ï¼ˆå³å¯¹é½ï¼Œç»¿è‰²æ°”æ³¡ï¼‰   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  [2025-11-18 15:30:21] ç³»ç»Ÿå›å¤                        â”‚ â”‚
â”‚  â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚  â”‚  ï¼ˆå·¦å¯¹é½ï¼Œç°è‰²ï¼‰ â”‚ å·²è¿›ä»“1                     â”‚        â”‚ â”‚
â”‚  â”‚                  â”‚ 1å¤§10|æ‰£:10|ç•™:990          â”‚        â”‚ â”‚
â”‚  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  [2025-11-18 15:30:25] å¼ ä¸‰                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚ â”‚
â”‚  â”‚  â”‚ æŸ¥                â”‚                                  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  [2025-11-18 15:30:26] ç³»ç»Ÿå›å¤                        â”‚ â”‚
â”‚  â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚  â”‚                  â”‚ æµ~~è®°å½•                    â”‚        â”‚ â”‚
â”‚  â”‚                  â”‚ ä»Šæ—¥/æœ¬è½®è¿›è´§:10/0          â”‚        â”‚ â”‚
â”‚  â”‚                  â”‚ ä»Šæ—¥ä¸Š/ä¸‹:0/0               â”‚        â”‚ â”‚
â”‚  â”‚                  â”‚ ä»Šæ—¥ç›ˆäº:0                  â”‚        â”‚ â”‚
â”‚  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è¯·è¾“å…¥æ¶ˆæ¯...                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  [å‘é€(S)]  [æ¸…ç©ºå†å²]  [å¿«æ·å‘½ä»¤ â–¼]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **æ¶ˆæ¯æ ·å¼**

```csharp
// ä¼šå‘˜å‘é€çš„æ¶ˆæ¯ï¼ˆå³å¯¹é½ï¼Œç»¿è‰²ï¼‰
[æ—¶é—´] æ˜µç§°
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ æ¶ˆæ¯å†…å®¹      â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// ç³»ç»Ÿå›å¤çš„æ¶ˆæ¯ï¼ˆå·¦å¯¹é½ï¼Œç°è‰²ï¼‰
[æ—¶é—´] ç³»ç»Ÿå›å¤
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ å›å¤å†…å®¹      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// é”™è¯¯æ¶ˆæ¯ï¼ˆå·¦å¯¹é½ï¼Œçº¢è‰²ï¼‰
[æ—¶é—´] âš ï¸ é”™è¯¯
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ é”™è¯¯ä¿¡æ¯      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ å®ç°æ–¹æ¡ˆ

### **æ–‡ä»¶ç»“æ„**

```
BaiShengVx3Plus/
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ Dev/
â”‚   â”‚   â”œâ”€â”€ MessageSimulatorForm.cs           â† æ–°å¢ï¼šæ¶ˆæ¯æ¨¡æ‹Ÿçª—å£
â”‚   â”‚   â”œâ”€â”€ MessageSimulatorForm.Designer.cs  â† æ–°å¢ï¼šçª—å£è®¾è®¡å™¨
â”‚   â”‚   â””â”€â”€ MessageSimulatorForm.resx         â† æ–°å¢ï¼šèµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ VxMain.cs                              â† ä¿®æ”¹ï¼šæ·»åŠ å³é”®èœå•é¡¹
â”‚   â””â”€â”€ VxMain_DevMenu.cs                      â† å·²æœ‰ï¼šSimulateMemberMessageAsync
```

### **æ ¸å¿ƒä»£ç ç»“æ„**

#### **1. MessageSimulatorForm.cs**

```csharp
public partial class MessageSimulatorForm : Form
{
    // ğŸ”¥ é™æ€å­—å…¸ï¼šç®¡ç†æ‰€æœ‰æ‰“å¼€çš„çª—å£ï¼ˆåŒä¸€ä¼šå‘˜åªèƒ½å¼€ä¸€ä¸ªï¼‰
    private static Dictionary<string, MessageSimulatorForm> _openWindows = new();
    
    // ğŸ”¥ æ ¸å¿ƒä¾èµ–
    private readonly V2Member _member;
    private readonly Func<string, string, Task<(bool, string?, string?)>> _simulateMessageFunc;
    private readonly ILogService _logService;
    
    // ğŸ”¥ UI æ§ä»¶
    private RichTextBox rtbMessages;
    private TextBox txtInput;
    private Button btnSend;
    private Button btnClear;
    private ComboBox cbxQuickCommands;
    
    // ğŸ”¥ é™æ€å·¥å‚æ–¹æ³•ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰
    public static MessageSimulatorForm GetOrCreate(
        V2Member member,
        Func<string, string, Task<(bool, string?, string?)>> simulateMessageFunc,
        ILogService logService)
    {
        if (_openWindows.TryGetValue(member.Wxid, out var existingForm))
        {
            // å·²æœ‰çª—å£ï¼Œæ¿€æ´»å¹¶è¿”å›
            existingForm.Activate();
            return existingForm;
        }
        
        // åˆ›å»ºæ–°çª—å£
        var newForm = new MessageSimulatorForm(member, simulateMessageFunc, logService);
        _openWindows[member.Wxid] = newForm;
        
        // çª—å£å…³é—­æ—¶ç§»é™¤
        newForm.FormClosed += (s, e) => _openWindows.Remove(member.Wxid);
        
        return newForm;
    }
    
    // ğŸ”¥ ç§æœ‰æ„é€ å‡½æ•°
    private MessageSimulatorForm(
        V2Member member,
        Func<string, string, Task<(bool, string?, string?)>> simulateMessageFunc,
        ILogService logService)
    {
        InitializeComponent();
        _member = member;
        _simulateMessageFunc = simulateMessageFunc;
        _logService = logService;
        
        InitializeUI();
    }
    
    // ğŸ”¥ å‘é€æ¶ˆæ¯
    private async void btnSend_Click(object sender, EventArgs e)
    {
        string message = txtInput.Text.Trim();
        if (string.IsNullOrEmpty(message)) return;
        
        // 1. æ˜¾ç¤ºå‘é€çš„æ¶ˆæ¯ï¼ˆå³å¯¹é½ï¼Œç»¿è‰²ï¼‰
        AppendMemberMessage(_member.Nickname, message);
        
        // 2. æ¸…ç©ºè¾“å…¥æ¡†
        txtInput.Clear();
        
        // 3. è°ƒç”¨æ¨¡æ‹Ÿæ–¹æ³•ï¼ˆå¤ç”¨ç°æœ‰æµç¨‹ï¼‰
        var (success, replyMessage, errorMessage) = await _simulateMessageFunc(_member.Wxid, message);
        
        // 4. æ˜¾ç¤ºå›å¤æ¶ˆæ¯
        if (success)
        {
            AppendSystemMessage(replyMessage ?? "âœ… æ¶ˆæ¯å·²å¤„ç†ï¼ˆæ— å›å¤ï¼‰");
        }
        else
        {
            AppendErrorMessage(errorMessage ?? "æœªçŸ¥é”™è¯¯");
        }
    }
    
    // ğŸ”¥ è¿½åŠ ä¼šå‘˜æ¶ˆæ¯ï¼ˆå³å¯¹é½ï¼Œç»¿è‰²ï¼‰
    private void AppendMemberMessage(string nickname, string message)
    {
        rtbMessages.SelectionAlignment = HorizontalAlignment.Right;
        rtbMessages.SelectionColor = Color.Green;
        rtbMessages.SelectionFont = new Font(rtbMessages.Font.FontFamily, 9, FontStyle.Bold);
        rtbMessages.AppendText($"[{DateTime.Now:HH:mm:ss}] {nickname}\n");
        
        rtbMessages.SelectionColor = Color.DarkGreen;
        rtbMessages.SelectionFont = new Font(rtbMessages.Font.FontFamily, 10);
        rtbMessages.AppendText($"  {message}\n\n");
        
        rtbMessages.ScrollToCaret();
    }
    
    // ğŸ”¥ è¿½åŠ ç³»ç»Ÿå›å¤ï¼ˆå·¦å¯¹é½ï¼Œç°è‰²ï¼‰
    private void AppendSystemMessage(string message)
    {
        rtbMessages.SelectionAlignment = HorizontalAlignment.Left;
        rtbMessages.SelectionColor = Color.Gray;
        rtbMessages.SelectionFont = new Font(rtbMessages.Font.FontFamily, 9);
        rtbMessages.AppendText($"[{DateTime.Now:HH:mm:ss}] ç³»ç»Ÿå›å¤\n");
        
        rtbMessages.SelectionColor = Color.Black;
        rtbMessages.SelectionFont = new Font(rtbMessages.Font.FontFamily, 10);
        rtbMessages.AppendText($"  {message}\n\n");
        
        rtbMessages.ScrollToCaret();
    }
    
    // ğŸ”¥ è¿½åŠ é”™è¯¯æ¶ˆæ¯ï¼ˆå·¦å¯¹é½ï¼Œçº¢è‰²ï¼‰
    private void AppendErrorMessage(string message)
    {
        rtbMessages.SelectionAlignment = HorizontalAlignment.Left;
        rtbMessages.SelectionColor = Color.Red;
        rtbMessages.SelectionFont = new Font(rtbMessages.Font.FontFamily, 9, FontStyle.Bold);
        rtbMessages.AppendText($"[{DateTime.Now:HH:mm:ss}] âš ï¸ é”™è¯¯\n");
        
        rtbMessages.SelectionColor = Color.DarkRed;
        rtbMessages.SelectionFont = new Font(rtbMessages.Font.FontFamily, 10);
        rtbMessages.AppendText($"  {message}\n\n");
        
        rtbMessages.ScrollToCaret();
    }
}
```

#### **2. VxMain.cs - æ·»åŠ å³é”®èœå•é¡¹**

```csharp
// åœ¨ VxMain.cs çš„ InitializeComponent æˆ– Load äº‹ä»¶ä¸­æ·»åŠ 
private void InitializeMemberContextMenu()
{
    // æŸ¥æ‰¾ç°æœ‰çš„"å¼€å‘é€‰é¡¹"èœå•é¡¹
    var devMenuItem = dgvMembers.ContextMenuStrip?.Items
        .OfType<ToolStripMenuItem>()
        .FirstOrDefault(item => item.Text == "ğŸ”§ å¼€å‘é€‰é¡¹");
    
    if (devMenuItem != null)
    {
        // æ·»åŠ "å‘é€æ¶ˆæ¯"å­èœå•
        var sendMessageMenuItem = new ToolStripMenuItem("ğŸ“± å‘é€æ¶ˆæ¯ (æ¨¡æ‹Ÿ)")
        {
            ShortcutKeys = Keys.Control | Keys.M
        };
        sendMessageMenuItem.Click += MenuItemSendMessage_Click;
        
        devMenuItem.DropDownItems.Add(sendMessageMenuItem);
    }
}

// ç‚¹å‡»"å‘é€æ¶ˆæ¯"èœå•é¡¹
private void MenuItemSendMessage_Click(object sender, EventArgs e)
{
    // ğŸ”¥ æ£€æŸ¥å¼€å‘æ¨¡å¼
    if (!_configService.GetIsRunModeDev())
    {
        UIMessageBox.ShowWarning("ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹å¯ç”¨ï¼");
        return;
    }
    
    // ğŸ”¥ è·å–é€‰ä¸­çš„ä¼šå‘˜
    if (dgvMembers.CurrentRow?.DataBoundItem is not V2Member member)
    {
        UIMessageBox.ShowWarning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä¼šå‘˜ï¼");
        return;
    }
    
    // ğŸ”¥ æ‰“å¼€æˆ–æ¿€æ´»æ¶ˆæ¯æ¨¡æ‹Ÿçª—å£
    var form = MessageSimulatorForm.GetOrCreate(
        member,
        SimulateMemberMessageAsync,  // â† å¤ç”¨å·²æœ‰æ–¹æ³•ï¼
        _logService);
    
    form.Show(this);
    
    _logService.Info("VxMain", $"ğŸ“± æ‰“å¼€æ¶ˆæ¯æ¨¡æ‹Ÿçª—å£: {member.Nickname} ({member.Wxid})");
}
```

---

## ğŸ¯ å¿«æ·å‘½ä»¤è®¾è®¡

ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæ·»åŠ å¿«æ·å‘½ä»¤ä¸‹æ‹‰æ¡†ï¼š

```csharp
private void InitializeQuickCommands()
{
    var commands = new[]
    {
        "-- ä¼šå‘˜å‘½ä»¤ --",
        "123å¤§10",
        "123å°10",
        "ä¸Š100",
        "ä¸‹100",
        "æŸ¥",
        "å–æ¶ˆ",
        "-- ç®¡ç†å‘˜å‘½ä»¤ --",
        "7ä¸Š100",
        "7ä¸‹100",
        "åˆ·æ–°",
        "æ¸…é›¶",
        "å°ç›˜",
        "å¼€ç›˜"
    };
    
    cbxQuickCommands.Items.AddRange(commands);
    cbxQuickCommands.SelectedIndexChanged += (s, e) =>
    {
        if (cbxQuickCommands.SelectedIndex > 0 && 
            !cbxQuickCommands.SelectedItem.ToString().StartsWith("--"))
        {
            txtInput.Text = cbxQuickCommands.SelectedItem.ToString();
            txtInput.Focus();
            txtInput.SelectAll();
        }
    };
}
```

---

## ğŸ“‹ å®ç°æ­¥éª¤

### **ç¬¬ä¸€é˜¶æ®µï¼šåˆ›å»ºçª—å£ï¼ˆ30åˆ†é’Ÿï¼‰**

1. âœ… åˆ›å»º `MessageSimulatorForm.cs` å’Œ `Designer.cs`
2. âœ… è®¾è®¡ UI å¸ƒå±€ï¼ˆRichTextBox + TextBox + Buttonsï¼‰
3. âœ… å®ç°é™æ€çª—å£ç®¡ç†ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰

### **ç¬¬äºŒé˜¶æ®µï¼šæ¶ˆæ¯å‘é€ï¼ˆ20åˆ†é’Ÿï¼‰**

1. âœ… å®ç° `btnSend_Click`
2. âœ… è°ƒç”¨ `SimulateMemberMessageAsync`
3. âœ… æ˜¾ç¤ºå‘é€å’Œå›å¤æ¶ˆæ¯

### **ç¬¬ä¸‰é˜¶æ®µï¼šUI ç¾åŒ–ï¼ˆ15åˆ†é’Ÿï¼‰**

1. âœ… å®ç°æ¶ˆæ¯æ ·å¼ï¼ˆé¢œè‰²ã€å¯¹é½ï¼‰
2. âœ… æ·»åŠ æ—¶é—´æˆ³
3. âœ… å®ç°æ»šåŠ¨åˆ°åº•éƒ¨

### **ç¬¬å››é˜¶æ®µï¼šå³é”®èœå•é›†æˆï¼ˆ10åˆ†é’Ÿï¼‰**

1. âœ… åœ¨ `VxMain.cs` æ·»åŠ å³é”®èœå•é¡¹
2. âœ… ç»‘å®šç‚¹å‡»äº‹ä»¶
3. âœ… æµ‹è¯•æ‰“å¼€çª—å£

### **ç¬¬äº”é˜¶æ®µï¼šå¿«æ·å‘½ä»¤ï¼ˆ10åˆ†é’Ÿï¼‰**

1. âœ… æ·»åŠ ä¸‹æ‹‰æ¡†
2. âœ… å¡«å……å¸¸ç”¨å‘½ä»¤
3. âœ… å®ç°é€‰æ‹©äº‹ä»¶

---

## âœ… ä¼˜åŠ¿æ€»ç»“

| è®¾è®¡åŸåˆ™ | å®ç°æ–¹å¼ |
|---------|---------|
| âœ… æœ€å°åŒ–ä¿®æ”¹ | åªæ–°å¢çª—å£ + 1ä¸ªå³é”®èœå•é¡¹ï¼Œä¸ä¿®æ”¹ä»»ä½•ä¸šåŠ¡é€»è¾‘ |
| âœ… å¤ç”¨ç°æœ‰æµç¨‹ | ç›´æ¥è°ƒç”¨ `SimulateMemberMessageAsync`ï¼Œ100%å¤ç”¨ |
| âœ… ä¸å½±å“åŸæœ‰åŠŸèƒ½ | æ‰€æœ‰ä¿®æ”¹éƒ½åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸å—å½±å“ |
| âœ… å•ä¾‹çª—å£ç®¡ç† | é™æ€å­—å…¸ç®¡ç†ï¼ŒåŒä¸€ä¼šå‘˜åªèƒ½å¼€ä¸€ä¸ªçª—å£ |
| âœ… å®Œæ•´æµ‹è¯•èƒ½åŠ› | æ”¯æŒæ‰€æœ‰æ¶ˆæ¯ç±»å‹ï¼ˆæŠ•æ³¨ã€ä¸Šä¸‹åˆ†ã€ç®¡ç†å‘½ä»¤ï¼‰ |
| âœ… æ˜“äºç»´æŠ¤ | ä»£ç ç®€æ´ï¼Œé€»è¾‘æ¸…æ™°ï¼Œæ˜“äºæ‰©å±• |

---

## ğŸ” ä»£ç è´¨é‡ä¿è¯

1. âœ… **å¼‚å¸¸å¤„ç†**: æ‰€æœ‰ `async` æ–¹æ³•éƒ½æœ‰ `try-catch`
2. âœ… **æ—¥å¿—è®°å½•**: å…³é”®æ“ä½œéƒ½è®°å½•æ—¥å¿—
3. âœ… **èµ„æºé‡Šæ”¾**: çª—å£å…³é—­æ—¶æ­£ç¡®é‡Šæ”¾èµ„æº
4. âœ… **çº¿ç¨‹å®‰å…¨**: UI æ“ä½œéƒ½åœ¨ UI çº¿ç¨‹æ‰§è¡Œ
5. âœ… **å¼€å‘æ¨¡å¼æ£€æŸ¥**: æ‰€æœ‰æ¨¡æ‹ŸåŠŸèƒ½éƒ½æ£€æŸ¥ `IsRunModeDev`

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿæˆ‘ä»¬ç°åœ¨å¼€å§‹å®ç°ï¼** ğŸš€

