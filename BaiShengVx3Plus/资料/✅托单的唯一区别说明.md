# âœ… æ‰˜å•çš„å”¯ä¸€åŒºåˆ«è¯´æ˜

## ğŸ“‹ æ ¸å¿ƒåŸåˆ™

> **æ‰˜ç»™å¤–äººå’Œæ‰€æœ‰äººçœ‹æ¥éƒ½æ˜¯æ­£å¸¸çš„ç©å®¶ï¼Œèµ°æ­£å¸¸æµç¨‹ï¼Œæ­£å¸¸çš„ç»“ç®—ä½“ç³»ã€‚ä»…ä»…æ˜¯åˆå¹¶è®¢å•æŠ•æ³¨æ—¶å€™ï¼Œè¿‡æ»¤æ‰æ‰˜çš„è€Œå·²ã€‚**

---

## ğŸ¯ æ‰˜å•ä¸æ™®é€šä¼šå‘˜çš„å¯¹æ¯”

| åŠŸèƒ½ | æ‰˜å• | æ™®é€šä¼šå‘˜ | è¯´æ˜ |
|------|------|---------|------|
| **ä¸‹å•éªŒè¯** |  |  |  |
| ä½™é¢éªŒè¯ | âœ… éªŒè¯ | âœ… éªŒè¯ | ä½™é¢ä¸è¶³ä¸èƒ½ä¸‹å• |
| é‡‘é¢é™åˆ¶éªŒè¯ | âœ… éªŒè¯ | âœ… éªŒè¯ | å•æ³¨ã€å•æœŸé‡‘é¢é™åˆ¶ |
| **ä¸‹å•æ‰£æ¬¾** |  |  |  |
| æ‰£é™¤ä½™é¢ | âœ… æ‰£é™¤ | âœ… æ‰£é™¤ | `member.Balance -= amount` |
| å¢åŠ ä¸ªäººç»Ÿè®¡ | âœ… å¢åŠ  | âœ… å¢åŠ  | `BetWait`, `BetToday`, `BetTotal`, `BetCur` |
| è®¡å…¥å…¨å±€ç»Ÿè®¡ | âŒ ä¸è®¡å…¥ | âœ… è®¡å…¥ | `_statisticsService.OnOrderCreated()` |
| **å°ç›˜æŠ•æ³¨** |  |  |  |
| æŠ•æ³¨åˆ°å¹³å° | âŒ ä¸æŠ•æ³¨ | âœ… æŠ•æ³¨ | **å”¯ä¸€åŒºåˆ«ï¼šæ‰˜å•è¢«è¿‡æ»¤** |
| **å¼€å¥–ç»“ç®—** |  |  |  |
| å‘é€åˆ°å¾®ä¿¡ | âœ… å‘é€ | âœ… å‘é€ | æ˜¾ç¤ºåœ¨ä¸­~åå•å’Œç•™~åå•ä¸­ |
| ç»“ç®—ä½™é¢ | âœ… ç»“ç®— | âœ… ç»“ç®— | `member.Balance += Profit` |
| æ›´æ–°ç›ˆäº | âœ… æ›´æ–° | âœ… æ›´æ–° | `IncomeToday`, `IncomeTotal` |
| å‡å°‘å¾…ç»“ç®— | âœ… å‡å°‘ | âœ… å‡å°‘ | `BetWait -= AmountTotal` |
| è®¡å…¥å…¨å±€ç»Ÿè®¡ | âŒ ä¸è®¡å…¥ | âœ… è®¡å…¥ | `_statisticsService.OnOrderSettled()` |
| **å–æ¶ˆè®¢å•** |  |  |  |
| é€€æ¬¾ | âœ… é€€æ¬¾ | âœ… é€€æ¬¾ | `member.Balance += AmountTotal` |
| å‡å°‘ä¸ªäººç»Ÿè®¡ | âœ… å‡å°‘ | âœ… å‡å°‘ | `BetWait`, `BetToday`, `BetTotal`, `BetCur` |
| å‡å°‘å…¨å±€ç»Ÿè®¡ | âŒ ä¸å‡å°‘ | âœ… å‡å°‘ | `_statisticsService.OnOrderCanceled()` |

---

## ğŸ”‘ æ‰˜å•çš„ç‰¹æ®Šå¤„ç†æ±‡æ€»

### 1ï¸âƒ£ è®¢å•ç±»å‹åˆå§‹åŒ–

**ä½ç½®**: `BinggoOrderService.cs:159`

```csharp
// ğŸ”¥ è®¢å•ç±»å‹æ ¹æ®ä¼šå‘˜ç­‰çº§åˆå§‹åŒ–
OrderType = member.State == MemberState.æ‰˜ ? OrderType.æ‰˜ : OrderType.å¾…å®š,
```

**è¯´æ˜**: æ ¹æ®ä¼šå‘˜ç­‰çº§è‡ªåŠ¨è®¾ç½®è®¢å•ç±»å‹

---

### 2ï¸âƒ£ å°ç›˜æŠ•æ³¨è¿‡æ»¤ï¼ˆå”¯ä¸€è¿‡æ»¤ç‚¹ï¼‰

**ä½ç½®**: `BinggoOrderService.cs:564`

```csharp
// ğŸ”¥ æ’é™¤æ‰˜å•ï¼ˆå‚è€ƒ F5BotV2ï¼‰
var validOrders = allOrders
    .Where(o => o.OrderType != OrderType.æ‰˜)
    .ToList();
```

**è¯´æ˜**: **è¿™æ˜¯æ‰˜å•ä¸æ™®é€šè®¢å•çš„å”¯ä¸€åŒºåˆ«**ï¼Œæ‰˜å•ä¸å‘é€åˆ°åšå½©å¹³å°

---

### 3ï¸âƒ£ å…¨å±€ç»Ÿè®¡è¿‡æ»¤

#### ä½ç½®1ï¼šåˆ›å»ºè®¢å•æ—¶

**ä½ç½®**: `BinggoOrderService.cs:217`

```csharp
// æ³¨æ„ï¼šæ‰˜å•ä¸è®¡å…¥ç»Ÿè®¡ï¼ˆå‚è€ƒ F5BotV2 Line 548ï¼‰
if (_statisticsService != null && order.OrderType != OrderType.æ‰˜ && order.OrderStatus != OrderStatus.å·²å–æ¶ˆ)
{
    _statisticsService.OnOrderCreated(order);
}
```

#### ä½ç½®2ï¼šç»“ç®—è®¢å•æ—¶

**ä½ç½®**: `BinggoOrderService.cs:525`

```csharp
// æ³¨æ„ï¼šæ‰˜å•ä¸è®¡å…¥ç»Ÿè®¡ï¼ˆå‚è€ƒ F5BotV2 Line 626ï¼‰
if (_statisticsService != null && order.OrderType != OrderType.æ‰˜)
{
    _statisticsService.OnOrderSettled(order);
}
```

#### ä½ç½®3ï¼šå–æ¶ˆè®¢å•æ—¶

**ä½ç½®**: `BinggoLotteryService.cs:1304`

```csharp
// ğŸ”¥ æ›´æ–°å…¨å±€ç»Ÿè®¡ï¼ˆå‚è€ƒ F5BotV2 ç¬¬680-709è¡Œï¼šOnMemberOrderCancelï¼‰
if (_statisticsService != null && ods.OrderType != OrderType.æ‰˜)
{
    _statisticsService.OnOrderCanceled(ods);
}
```

#### ä½ç½®4ï¼šç»Ÿè®¡æœåŠ¡å†…éƒ¨

**ä½ç½®**: `BinggoStatisticsService.cs:174,267,324,407`

```csharp
// ğŸ”¥ è·³è¿‡æ‰˜å•å’Œå·²å–æ¶ˆè®¢å•ï¼ˆå‚è€ƒ F5BotV2 ç¬¬ 548 è¡Œï¼‰
if (order.OrderType == OrderType.æ‰˜ || order.OrderStatus == OrderStatus.å·²å–æ¶ˆ)
    return;
```

**è¯´æ˜**: æ‰˜å•ä¸å½±å“å…¨å±€ç»Ÿè®¡æ•°æ®ï¼ˆ`BetMoneyTotal`, `BetMoneyToday`, `IncomeTotal` ç­‰ï¼‰

---

## âŒ æ‰˜å•ä¸åº”è¯¥æœ‰çš„ç‰¹æ®Šå¤„ç†

### âŒ é”™è¯¯1ï¼šä½™é¢éªŒè¯ç‰¹æ®ŠåŒ–ï¼ˆå·²ä¿®å¤ï¼‰

**ä¿®å¤å‰**ï¼ˆé”™è¯¯ï¼‰:
```csharp
// âŒ é”™è¯¯ï¼šæ‰˜å•ä¸éªŒè¯ä½™é¢
if (member.State != MemberState.æ‰˜ && member.State != MemberState.ç®¡ç†)
{
    if ((decimal)member.Balance < totalAmount)
    {
        errorMessage = "ä½™é¢ä¸è¶³";
        return false;
    }
}
```

**ä¿®å¤å**ï¼ˆæ­£ç¡®ï¼‰:
```csharp
// âœ… æ­£ç¡®ï¼šæ‰˜å•ä¹Ÿè¦éªŒè¯ä½™é¢ï¼ï¼ˆæ‰˜å•æ˜¯æ­£å¸¸ç©å®¶ï¼Œèµ°æ­£å¸¸æµç¨‹ï¼‰
// åªæœ‰ç®¡ç†å‘˜ä¸éªŒè¯ä½™é¢ï¼ˆç®¡ç†å‘˜ä¸æ‰£é’±ï¼‰
if (member.State != MemberState.ç®¡ç†)
{
    if ((decimal)member.Balance < totalAmount)
    {
        errorMessage = "ä½™é¢ä¸è¶³";
        return false;
    }
}
```

**ä¿®å¤æ–‡ä»¶**: `BinggoOrderValidator.cs:99-110`

---

## âœ… æ­£ç¡®çš„æ‰˜å•å¤„ç†æµç¨‹

### æµç¨‹1ï¼šæ‰˜å•ä¸‹å•

1. âœ… ä¼šå‘˜å‘é€æŠ•æ³¨æ¶ˆæ¯ï¼ˆå¦‚ï¼š"1å¤§10"ï¼‰
2. âœ… è§£ææŠ•æ³¨å†…å®¹
3. âœ… **éªŒè¯ä½™é¢**ï¼ˆæ‰˜å•ä¹Ÿè¦éªŒè¯ï¼‰
4. âœ… **éªŒè¯é‡‘é¢é™åˆ¶**ï¼ˆæ‰˜å•ä¹Ÿè¦éªŒè¯ï¼‰
5. âœ… **æ‰£é™¤ä½™é¢**ï¼ˆæ‰˜å•ä¹Ÿè¦æ‰£é’±ï¼‰
6. âœ… **å¢åŠ ä¼šå‘˜ä¸ªäººç»Ÿè®¡**
7. âŒ **ä¸è®¡å…¥å…¨å±€ç»Ÿè®¡**
8. âœ… è®¢å•ä¿å­˜åˆ°è®¢å•è¡¨
9. âœ… è¿”å›æˆåŠŸæ¶ˆæ¯ç»™ä¼šå‘˜

---

### æµç¨‹2ï¼šå°ç›˜æŠ•æ³¨

1. âœ… æŸ¥è¯¢å¾…æŠ•æ³¨è®¢å•
2. âŒ **è¿‡æ»¤æ‰˜å•**ï¼ˆå”¯ä¸€åŒºåˆ«ï¼‰
3. âœ… åˆå¹¶å…¶ä»–è®¢å•
4. âœ… æŠ•æ³¨åˆ°å¹³å°

---

### æµç¨‹3ï¼šå¼€å¥–ç»“ç®—

1. âœ… æŸ¥è¯¢æ‰€æœ‰è®¢å•ï¼ˆ**åŒ…æ‹¬æ‰˜å•**ï¼‰
2. âœ… ç»“ç®—æ¯ä¸ªè®¢å•ï¼ˆ**åŒ…æ‹¬æ‰˜å•**ï¼‰
3. âœ… **æ‰˜å•ä¹Ÿæ›´æ–°ä½™é¢**
4. âœ… **æ‰˜å•ä¹Ÿæ›´æ–°ç›ˆäº**
5. âŒ **æ‰˜å•ä¸è®¡å…¥å…¨å±€ç»Ÿè®¡**
6. âœ… **æ‰˜å•å‘é€åˆ°å¾®ä¿¡**ï¼ˆæ˜¾ç¤ºåœ¨ä¸­~åå•å’Œç•™~åå•ä¸­ï¼‰

---

### æµç¨‹4ï¼šå–æ¶ˆè®¢å•

1. âœ… ä¼šå‘˜å‘é€"å–æ¶ˆ"
2. âœ… æŸ¥æ‰¾æœ€æ–°è®¢å•ï¼ˆ**åŒ…æ‹¬æ‰˜å•**ï¼‰
3. âœ… **æ‰˜å•ä¹Ÿé€€æ¬¾**
4. âœ… **æ‰˜å•ä¹Ÿå‡å°‘ä¸ªäººç»Ÿè®¡**
5. âŒ **æ‰˜å•ä¸å‡å°‘å…¨å±€ç»Ÿè®¡**
6. âœ… è¿”å›å–æ¶ˆæˆåŠŸæ¶ˆæ¯

---

## ğŸ“Š ä»£ç å®¡è®¡ç»“æœ

### âœ… å·²ç¡®è®¤æ­£ç¡®çš„å¤„ç†ï¼ˆ3å¤„ï¼‰

1. âœ… `BinggoOrderService.cs:159` - è®¢å•ç±»å‹åˆå§‹åŒ–
2. âœ… `BinggoOrderService.cs:564` - å°ç›˜æŠ•æ³¨è¿‡æ»¤ï¼ˆå”¯ä¸€åŒºåˆ«ï¼‰
3. âœ… å¤šä¸ªä½ç½® - å…¨å±€ç»Ÿè®¡è¿‡æ»¤

### âŒ å·²ä¿®å¤çš„é”™è¯¯ï¼ˆ1å¤„ï¼‰

1. âœ… `BinggoOrderValidator.cs:99` - ä½™é¢éªŒè¯ï¼ˆå·²ä¿®å¤ï¼‰

### âœ… ç¡®è®¤æ— éœ€ç‰¹æ®Šå¤„ç†ï¼ˆå¤šå¤„ï¼‰

1. âœ… `BinggoOrderService.cs:176` - æ‰˜å•æ­£å¸¸æ‰£é’±ï¼ˆç®¡ç†å‘˜ä¸æ‰£ï¼‰
2. âœ… `BinggoOrderService.cs:513` - æ‰˜å•æ­£å¸¸ç»“ç®—
3. âœ… `BinggoLotteryService.cs:897` - æ‰˜å•æ­£å¸¸å‘é€åˆ°å¾®ä¿¡
4. âœ… `BinggoLotteryService.cs:1283` - æ‰˜å•æ­£å¸¸é€€æ¬¾ï¼ˆç®¡ç†å‘˜ä¸é€€ï¼‰

---

## ğŸ¯ æ€»ç»“

### æ‰˜å•çš„æœ¬è´¨

**æ‰˜å• = æ™®é€šä¼šå‘˜ - æŠ•æ³¨åˆ°å¹³å° - å…¨å±€ç»Ÿè®¡**

### æ‰˜å•çš„å”¯ä¸€åŒºåˆ«

âŒ **å°ç›˜æ—¶ä¸æŠ•æ³¨åˆ°å¹³å°**ï¼ˆ`Where(o => o.OrderType != OrderType.æ‰˜)`ï¼‰

### æ‰˜å•çš„å…¶ä»–è¡Œä¸º

âœ… **å…¶ä»–æ‰€æœ‰è¡Œä¸ºéƒ½å’Œæ™®é€šä¼šå‘˜å®Œå…¨ä¸€æ ·**ï¼š
- ä¸‹å•éªŒè¯ï¼ˆä½™é¢ã€é‡‘é¢ï¼‰
- æ‰£æ¬¾
- ç»“ç®—
- é€€æ¬¾
- å¾®ä¿¡æ¶ˆæ¯
- ä¼šå‘˜ä¸ªäººç»Ÿè®¡

### ç®¡ç†å‘˜çš„ç‰¹æ®Šæ€§

ç®¡ç†å‘˜æ‰æ˜¯çœŸæ­£ç‰¹æ®Šçš„ï¼š
- âŒ ä¸éªŒè¯ä½™é¢
- âŒ ä¸æ‰£é’±
- âŒ ä¸é€€é’±ï¼ˆå› ä¸ºæ²¡æ‰£é’±ï¼‰
- âœ… å…¶ä»–æµç¨‹æ­£å¸¸

---

## âœ… ä»£ç å·²å®Œå…¨ç¬¦åˆè¦æ±‚

**æ‰€æœ‰ä»£ç å·²ç»è¿‡å®¡è®¡å’Œä¿®å¤ï¼Œæ‰˜å•ç°åœ¨å®Œå…¨æŒ‰ç…§"æ­£å¸¸ç©å®¶"çš„æ–¹å¼å¤„ç†ï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯å°ç›˜æ—¶ä¸æŠ•æ³¨åˆ°å¹³å°ï¼** ğŸ‰

