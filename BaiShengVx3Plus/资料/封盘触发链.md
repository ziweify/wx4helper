# ğŸ“Š å°ç›˜è§¦å‘é“¾ - AutoBetCoordinator vs BetQueueManager

> **åˆ›å»ºæ—¶é—´**: 2025-11-18  
> **ä½œè€…**: ç³»ç»Ÿæ¶æ„åˆ†æ  
> **ç‰ˆæœ¬**: v1.0

---

## ğŸ¯ æ ¸å¿ƒåŒºåˆ«

| ç»´åº¦ | **AutoBetCoordinator** | **BetQueueManager** |
|------|----------------------|-------------------|
| **å±‚çº§** | **ä¸šåŠ¡åè°ƒå±‚**ï¼ˆé«˜å±‚ï¼‰ | **ä»»åŠ¡æ‰§è¡Œå±‚**ï¼ˆåº•å±‚ï¼‰ |
| **è§¦å‘æ—¶æœº** | **äº‹ä»¶é©±åŠ¨**ï¼ˆå°ç›˜äº‹ä»¶ï¼‰ | **è¢«åŠ¨è°ƒç”¨**ï¼ˆåè°ƒå™¨è°ƒç”¨ï¼‰ |
| **èŒè´£èŒƒå›´** | **å®Œæ•´ä¸šåŠ¡æµç¨‹** | **å•ä¸€ä»»åŠ¡æ‰§è¡Œ** |
| **æ˜¯å¦æ„ŸçŸ¥ä¸šåŠ¡** | âœ… **æ˜¯**ï¼ˆçŸ¥é“æ¸¸æˆè§„åˆ™ï¼‰ | âŒ **å¦**ï¼ˆåªç®¡æŠ•æ³¨ï¼‰ |
| **ä»£ç ä½ç½®** | `Services/AutoBet/AutoBetCoordinator.cs` | `Services/AutoBet/BetQueueManager.cs` |

---

## ğŸ”„ å®Œæ•´å°ç›˜è§¦å‘é“¾

### **ä»å°ç›˜åˆ°æŠ•æ³¨çš„å®Œæ•´æµç¨‹**

```
1ï¸âƒ£ å¼€å¥–æœåŠ¡ (BinggoLotteryService)
   â”œâ”€ ç›‘å¬å¼€å¥–ç³»ç»ŸçŠ¶æ€å˜åŒ–
   â”œâ”€ æ£€æµ‹åˆ°çŠ¶æ€ä» "æ”¶å•ä¸­" â†’ "å°ç›˜ä¸­"
   â””â”€ è§¦å‘äº‹ä»¶: StatusChanged
   
   â†“ äº‹ä»¶è®¢é˜…
   
2ï¸âƒ£ è‡ªåŠ¨æŠ•æ³¨åè°ƒå™¨ (AutoBetCoordinator) â† ğŸ¯ ä¸šåŠ¡åè°ƒå±‚
   â”‚
   â”œâ”€ LotteryService_StatusChanged() è¢«è§¦å‘
   â”‚
   â”œâ”€ [æ­¥éª¤1] é˜²é‡å¤æ£€æŸ¥
   â”‚   â”œâ”€ æ£€æŸ¥å½“å‰æœŸå·æ˜¯å¦å·²å¤„ç† (_hasProcessedCurrentIssue)
   â”‚   â””â”€ æ£€æŸ¥çŠ¶æ€æ˜¯å¦çœŸæ­£å˜åŒ– (_lastStatus)
   â”‚
   â”œâ”€ [æ­¥éª¤2] ğŸ“‹ æŸ¥è¯¢å¾…æŠ•æ³¨è®¢å•
   â”‚   â””â”€ _orderService.GetPendingOrdersForIssue(issueId)
   â”‚       â””â”€ ä» _ordersBindingListï¼ˆå†…å­˜è¡¨ï¼‰æŸ¥è¯¢
   â”‚       â””â”€ æ’é™¤ï¼šæ‰˜å•ï¼ˆOrderType.æ‰˜ï¼‰
   â”‚       â””â”€ æ’é™¤ï¼šå·²å–æ¶ˆã€å·²å®Œæˆçš„è®¢å•
   â”‚
   â”œâ”€ [æ­¥éª¤3] ğŸ” éªŒè¯ä¸šåŠ¡è§„åˆ™
   â”‚   â”œâ”€ æ£€æŸ¥ä¼šå‘˜ç­‰çº§
   â”‚   â”œâ”€ æ£€æŸ¥è®¢å•é‡‘é¢
   â”‚   â””â”€ ï¼ˆå¯æ‰©å±•ï¼‰è“ä¼šä¼šå‘˜>500å…ƒï¼Œå¤šæ‰“åˆ°é…ç½®B
   â”‚
   â”œâ”€ [æ­¥éª¤4] ğŸ“¦ åˆå¹¶è®¢å•
   â”‚   â””â”€ _orderMerger.Merge(pendingOrders)
   â”‚       â”œâ”€ è¾“å…¥: [è®¢å•1: 1å¤§10, è®¢å•2: 1å¤§20, è®¢å•3: 2å°30]
   â”‚       â””â”€ è¾“å‡º: BetContentStandard = "1å¤§30,2å°30"
   â”‚
   â”œâ”€ [æ­¥éª¤5] âœ… éªŒè¯é‡‘é¢é™åˆ¶
   â”‚   â””â”€ æ£€æŸ¥æ¯ä¸€é¡¹æŠ•æ³¨æ˜¯å¦åœ¨ MinBet ~ MaxBet èŒƒå›´å†…
   â”‚       â””â”€ ä» ConfigService è¯»å–å…¨å±€é…ç½®
   â”‚       â””â”€ å¦‚æœä¸ç¬¦åˆï¼šæ‹’ç»æŠ•æ³¨ï¼Œè®°å½•æ—¥å¿—
   â”‚
   â”œâ”€ [æ­¥éª¤6] ğŸ“ åˆ›å»ºæŠ•æ³¨è®°å½•
   â”‚   â””â”€ _betRecordService.Add(betRecord)
   â”‚       â”œâ”€ ä¿å­˜åˆ° BetRecord è¡¨
   â”‚       â”œâ”€ è®°å½•æœŸå·ã€è®¢å•IDã€æŠ•æ³¨å†…å®¹ã€æ€»é‡‘é¢
   â”‚       â””â”€ è¿”å› recordId
   â”‚
   â””â”€ [æ­¥éª¤7] ğŸš€ æäº¤åˆ°é˜Ÿåˆ—ç®¡ç†å™¨
       â””â”€ _betQueueManager.EnqueueBet(recordId, async () => {
               return await _autoBetService.PushBetCommand(...);
           });
       
   â†“ è°ƒç”¨
   
3ï¸âƒ£ æŠ•æ³¨é˜Ÿåˆ—ç®¡ç†å™¨ (BetQueueManager) â† ğŸ¯ ä»»åŠ¡æ‰§è¡Œå±‚
   â”‚
   â”œâ”€ EnqueueBet(recordId, betAction) è¢«è°ƒç”¨
   â”‚
   â”œâ”€ [æ­¥éª¤1] åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
   â”‚   â””â”€ Task.Run(async () => { ... })
   â”‚
   â”œâ”€ [æ­¥éª¤2] åŠ å…¥ä»»åŠ¡å­—å…¸
   â”‚   â””â”€ _pendingBets.TryAdd(recordId, task)
   â”‚       â””â”€ è·Ÿè¸ªæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼ˆå¯å¹¶å‘ï¼‰
   â”‚
   â”œâ”€ [æ­¥éª¤3] æ‰§è¡ŒæŠ•æ³¨åŠ¨ä½œ
   â”‚   â”œâ”€ â±ï¸ è®°å½•å¼€å§‹æ—¶é—´
   â”‚   â”œâ”€ æ‰§è¡Œ betAction() â† Lambda è¡¨è¾¾å¼
   â”‚   â”‚   â””â”€ è°ƒç”¨ _autoBetService.PushBetCommand()
   â”‚   â””â”€ â±ï¸ è®°å½•ç»“æŸæ—¶é—´
   â”‚
   â”œâ”€ [æ­¥éª¤4] ğŸ“Š æ›´æ–°æŠ•æ³¨è®°å½•
   â”‚   â””â”€ _betRecordService.UpdateResult(
   â”‚           recordId,
   â”‚           result.Success,      // æˆåŠŸ/å¤±è´¥
   â”‚           result.Result,       // å¹³å°è¿”å›å†…å®¹
   â”‚           result.ErrorMessage, // é”™è¯¯ä¿¡æ¯
   â”‚           result.PostStartTime,// æŠ•æ³¨å¼€å§‹æ—¶é—´
   â”‚           result.PostEndTime,  // æŠ•æ³¨ç»“æŸæ—¶é—´
   â”‚           result.OrderNo       // è®¢å•å·
   â”‚       )
   â”‚
   â””â”€ [æ­¥éª¤5] ğŸ—‘ï¸ æ¸…ç†å®Œæˆä»»åŠ¡
       â””â”€ _pendingBets.TryRemove(recordId, out _)
   
   â†“ è°ƒç”¨
   
4ï¸âƒ£ è‡ªåŠ¨æŠ•æ³¨æœåŠ¡ (AutoBetService)
   â”‚
   â”œâ”€ PushBetCommand(configId, issueId, betContent, totalAmount)
   â”‚
   â”œâ”€ [BaiShengVx3Plus] Socket æ¨é€åˆ°å¤–éƒ¨æµè§ˆå™¨è¿›ç¨‹
   â”‚   â””â”€ _socketServer â†’ BrowserClient â†’ å¤–éƒ¨æµè§ˆå™¨
   â”‚
   â””â”€ [zhaocaimao] ç›´æ¥è°ƒç”¨å†…éƒ¨ WebView2 æ§ä»¶
       â””â”€ BetBrowserControl.ExecuteCommandAsync("æŠ•æ³¨", orders)
   
   â†“ è¿”å›ç»“æœ
   
5ï¸âƒ£ æŠ•æ³¨ç»“æœè¿”å›
   â”‚
   â””â”€ BetResult
       â”œâ”€ Success: true/false
       â”œâ”€ Result: "æŠ•æ³¨æˆåŠŸï¼šè®¢å•å·123456"
       â”œâ”€ PostStartTime: å¼€å§‹æ—¶é—´
       â”œâ”€ PostEndTime: ç»“æŸæ—¶é—´
       â””â”€ DurationMs: è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰
```

---

## ğŸ“ AutoBetCoordinator è¯¦ç»†èŒè´£

### **ä»£ç ä½ç½®**
```
BaiShengVx3Plus/Services/AutoBet/AutoBetCoordinator.cs
```

### **1. äº‹ä»¶è®¢é˜…å’Œç®¡ç†**

```csharp
/// <summary>
/// å¯åŠ¨è‡ªåŠ¨æŠ•æ³¨
/// </summary>
public async Task<bool> StartAsync(int configId)
{
    // â‘  å¯åŠ¨æµè§ˆå™¨
    var success = await _autoBetService.StartBrowser(configId);
    
    // â‘¡ è®¢é˜…å¼€å¥–æœåŠ¡çš„äº‹ä»¶
    _lotteryService.IssueChanged += LotteryService_IssueChanged;
    _lotteryService.StatusChanged += LotteryService_StatusChanged;  // â† å°ç›˜äº‹ä»¶
    
    _currentConfigId = configId;
    _isAutoBetEnabled = true;
    
    return true;
}
```

### **2. å°ç›˜äº‹ä»¶å¤„ç†**ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰

```csharp
/// <summary>
/// çŠ¶æ€å˜æ›´äº‹ä»¶ - å°ç›˜æ—¶å¤„ç†è®¢å•å’Œæ¨é€æŠ•æ³¨å‘½ä»¤
/// ğŸ”¥ æŠ•æ³¨æ—¶æœºï¼šåœ¨"å°ç›˜ä¸­"çŠ¶æ€æ—¶æŠ•æ³¨
/// </summary>
private async void LotteryService_StatusChanged(object? sender, BinggoStatusChangedEventArgs e)
{
    // â‘  æ£€æŸ¥çŠ¶æ€ï¼šæ˜¯å¦æ˜¯ "å°ç›˜ä¸­"
    if (e.NewStatus == BinggoLotteryStatus.å°ç›˜ä¸­)
    {
        // â‘¡ é˜²é‡å¤ï¼šæ£€æŸ¥å½“å‰æœŸå·æ˜¯å¦å·²å¤„ç†
        if (_hasProcessedCurrentIssue) return;
        if (_lastStatus == BinggoLotteryStatus.å°ç›˜ä¸­) return;
        
        // æ ‡è®°å·²å¤„ç†
        _hasProcessedCurrentIssue = true;
        _lastStatus = e.NewStatus;
        
        // â‘¢ æŸ¥è¯¢è®¢å•ï¼šä» OrderService è·å–å¾…æŠ•æ³¨è®¢å•
        var pendingOrders = _orderService.GetPendingOrdersForIssue(e.IssueId);
        
        // â‘£ ä¸šåŠ¡è§„åˆ™ï¼šéªŒè¯ä¼šå‘˜ç­‰çº§ã€é‡‘é¢é™åˆ¶ï¼ˆå¯æ‰©å±•ï¼‰
        // ä¾‹å¦‚ï¼šè“ä¼šä¼šå‘˜>500å…ƒï¼Œå¯ä»¥å¤šæ‰“åˆ°é…ç½®B
        // var blueMemberLargeOrders = pendingOrders.Where(o =>
        //     o.MemberState == MemberState.è“ä¼š &&
        //     o.AmountTotal > 500 &&
        //     o.OrderType != OrderType.æ‰˜
        // ).ToList();
        
        // â‘¤ åˆå¹¶è®¢å•ï¼šæŠŠå¤šä¸ªè®¢å•åˆå¹¶æˆæŠ•æ³¨å†…å®¹
        var mergeResult = _orderMerger.Merge(pendingOrders);
        // è¾“å‡ºï¼šBetContentStandard = "1å¤§10,2å°20,3å¤§30"
        
        // â‘¥ éªŒè¯é‡‘é¢ï¼šæ£€æŸ¥æ˜¯å¦åœ¨é…ç½®çš„ MinBet ~ MaxBet èŒƒå›´å†…
        var config = _autoBetService.GetConfig(_currentConfigId);
        var minBet = _configService.GetValue<int>("MinBet");
        var maxBet = _configService.GetValue<int>("MaxBet");
        
        var parsedOrders = BetContentParser.ParseBetContentToOrderList(
            mergeResult.BetContentStandard, 
            e.IssueId
        );
        
        foreach (var order in parsedOrders)
        {
            if (order.Amount < minBet || order.Amount > maxBet)
            {
                _log.Error("AutoBet", $"âŒ æŠ•æ³¨é‡‘é¢ä¸ç¬¦åˆé™åˆ¶: {order.Amount}å…ƒ");
                _log.Error("AutoBet", $"ğŸ’¡ é…ç½®é™åˆ¶: {minBet}-{maxBet}å…ƒ");
                return; // æ‹’ç»æŠ•æ³¨
            }
        }
        
        // â‘¦ åˆ›å»ºæŠ•æ³¨è®°å½•ï¼šä¿å­˜åˆ° BetRecord è¡¨
        var betRecord = new BetRecord
        {
            ConfigId = _currentConfigId,
            IssueId = e.IssueId,
            OrderIds = string.Join(",", mergeResult.OrderIds),
            Source = "è‡ªåŠ¨",
            BetContentStandard = mergeResult.BetContentStandard,
            TotalAmount = mergeResult.TotalAmount,
            SendTime = DateTime.Now
        };
        var recordId = _betRecordService.Add(betRecord);
        
        // â‘§ æäº¤åˆ°é˜Ÿåˆ—ç®¡ç†å™¨ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼‰â† è°ƒç”¨ BetQueueManager
        _betQueueManager.EnqueueBet(recordId, async () => {
            return await _autoBetService.PushBetCommand(
                _currentConfigId,
                e.IssueId.ToString(),
                mergeResult.BetContentStandard,
                mergeResult.TotalAmount
            );
        });
    }
}
```

### **3. æœŸå·å˜æ›´äº‹ä»¶**

```csharp
/// <summary>
/// æœŸå·å˜æ›´äº‹ä»¶ - é‡ç½®æŠ•æ³¨æ ‡è®°
/// </summary>
private void LotteryService_IssueChanged(object? sender, BinggoIssueChangedEventArgs e)
{
    _hasProcessedCurrentIssue = false;  // é‡ç½®æ ‡è®°ï¼Œå…è®¸æ–°æœŸå·æŠ•æ³¨
    _log.Info("AutoBet", $"ğŸ”“ æ–°æœŸå·{e.NewIssueId}ï¼Œå·²é‡ç½®æŠ•æ³¨æ ‡è®°");
}
```

### **å…³é”®ç‰¹ç‚¹**

- âœ… **çŸ¥é“æ¸¸æˆè§„åˆ™**ï¼ˆå°ç›˜ã€æœŸå·ã€ä¼šå‘˜ç­‰çº§ï¼‰
- âœ… **åè°ƒå¤šä¸ªæœåŠ¡**
  - `IBinggoOrderService`ï¼šæŸ¥è¯¢è®¢å•
  - `OrderMerger`ï¼šåˆå¹¶è®¢å•
  - `IConfigurationService`ï¼šè¯»å–é…ç½®
  - `BetRecordService`ï¼šè®°å½•æŠ•æ³¨
  - `BetQueueManager`ï¼šæ‰§è¡ŒæŠ•æ³¨
- âœ… **å¤„ç†å®Œæ•´ä¸šåŠ¡æµç¨‹**ï¼ˆä»è®¢å•æŸ¥è¯¢åˆ°æŠ•æ³¨æäº¤ï¼‰
- âœ… **å¯æ‰©å±•ä¸šåŠ¡è§„åˆ™**ï¼ˆä¼šå‘˜ç­‰çº§ã€é‡‘é¢é™åˆ¶ã€å¤šé…ç½®æŠ•æ³¨ï¼‰

---

## ğŸ“ BetQueueManager è¯¦ç»†èŒè´£

### **ä»£ç ä½ç½®**
```
BaiShengVx3Plus/Services/AutoBet/BetQueueManager.cs
```

### **1. æ¥æ”¶æŠ•æ³¨ä»»åŠ¡**

```csharp
/// <summary>
/// æ·»åŠ æŠ•æ³¨ä»»åŠ¡åˆ°é˜Ÿåˆ—ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼‰
/// </summary>
public void EnqueueBet(int recordId, Func<Task<BetResult>> betAction)
{
    // â‘  åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
    var task = Task.Run(async () =>
    {
        try
        {
            _log.Info("BetQueueManager", $"å¼€å§‹æ‰§è¡ŒæŠ•æ³¨:RecordId={recordId}");
            
            // â‘¡ æ‰§è¡ŒæŠ•æ³¨åŠ¨ä½œï¼ˆLambdaè¡¨è¾¾å¼ï¼‰
            var result = await betAction();  // â† è¿™é‡Œæ‰çœŸæ­£è°ƒç”¨ AutoBetService
            
            // â‘¢ æ›´æ–°æŠ•æ³¨è®°å½•
            _betRecordService.UpdateResult(
                recordId,
                result.Success,
                result.Result,
                result.ErrorMessage,
                result.PostStartTime,
                result.PostEndTime,
                result.OrderNo
            );
            
            _log.Info("BetQueueManager", 
                $"æŠ•æ³¨å®Œæˆ:RecordId={recordId} æˆåŠŸ={result.Success} è€—æ—¶={result.DurationMs}ms");
        }
        catch (Exception ex)
        {
            _log.Error("BetQueueManager", $"æŠ•æ³¨æ‰§è¡Œå¼‚å¸¸:RecordId={recordId}", ex);
            
            // â‘£ è®°å½•å¼‚å¸¸
            _betRecordService.UpdateResult(
                recordId,
                false,
                null,
                ex.Message,
                null,
                null,
                null
            );
        }
        finally
        {
            // â‘¤ ç§»é™¤å®Œæˆçš„ä»»åŠ¡
            _pendingBets.TryRemove(recordId, out _);
        }
    });
    
    // â‘¥ åŠ å…¥ä»»åŠ¡å­—å…¸ï¼ˆè·Ÿè¸ªæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼‰
    _pendingBets.TryAdd(recordId, task);
    
    _log.Info("BetQueueManager", $"âœ… æŠ•æ³¨ä»»åŠ¡å·²åŠ å…¥é˜Ÿåˆ—:RecordId={recordId} å½“å‰é˜Ÿåˆ—æ•°:{_pendingBets.Count}");
}
```

### **2. ä»»åŠ¡ç®¡ç†**

```csharp
/// <summary>
/// ä»»åŠ¡å­—å…¸ï¼šè·Ÿè¸ªæ­£åœ¨æ‰§è¡Œçš„æŠ•æ³¨ä»»åŠ¡
/// </summary>
private readonly ConcurrentDictionary<int, Task> _pendingBets = new();

/// <summary>
/// ç­‰å¾…æ‰€æœ‰æŠ•æ³¨å®Œæˆ
/// </summary>
public async Task WaitForAllBets(int timeoutMs = 30000)
{
    if (_pendingBets.IsEmpty) return;
    
    try
    {
        _log.Info("BetQueueManager", $"ç­‰å¾…{_pendingBets.Count}ä¸ªæŠ•æ³¨ä»»åŠ¡å®Œæˆ...");
        
        var allTasks = _pendingBets.Values.ToArray();
        await Task.WhenAll(allTasks).WaitAsync(TimeSpan.FromMilliseconds(timeoutMs));
        
        _log.Info("BetQueueManager", "âœ… æ‰€æœ‰æŠ•æ³¨ä»»åŠ¡å·²å®Œæˆ");
    }
    catch (TimeoutException)
    {
        _log.Warning("BetQueueManager", $"ç­‰å¾…æŠ•æ³¨è¶…æ—¶:{timeoutMs}ms è¿˜æœ‰{_pendingBets.Count}ä¸ªæœªå®Œæˆ");
    }
}
```

### **å…³é”®ç‰¹ç‚¹**

- âŒ **ä¸çŸ¥é“æ¸¸æˆè§„åˆ™**ï¼ˆåªçŸ¥é“æŠ•æ³¨ï¼‰
- âŒ **ä¸æŸ¥è¯¢è®¢å•**ï¼ˆç”±åè°ƒå™¨ä¼ å…¥ï¼‰
- âŒ **ä¸éªŒè¯ä¸šåŠ¡è§„åˆ™**ï¼ˆç”±åè°ƒå™¨éªŒè¯ï¼‰
- âœ… **åªç®¡ä»»åŠ¡æ‰§è¡Œ**ï¼ˆå¼‚æ­¥ã€å¹¶å‘ã€è¶…æ—¶æ§åˆ¶ï¼‰
- âœ… **åªç®¡è®°å½•æ›´æ–°**ï¼ˆæˆåŠŸ/å¤±è´¥ã€è€—æ—¶ï¼‰
- âœ… **æ”¯æŒå¹¶å‘**ï¼ˆå¤šä¸ªæŠ•æ³¨å¯ä»¥åŒæ—¶æ‰§è¡Œï¼‰

---

## ğŸ”¥ ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªç»„ä»¶ï¼Ÿ

### **âŒ å¦‚æœåªæœ‰ AutoBetCoordinatorï¼ˆæ··åœ¨ä¸€èµ·ï¼‰**

```csharp
// âŒ é—®é¢˜ï¼šä¸šåŠ¡é€»è¾‘å’Œä»»åŠ¡æ‰§è¡Œæ··åœ¨ä¸€èµ·
private async void LotteryService_StatusChanged(...)
{
    // æŸ¥è¯¢è®¢å•
    var orders = _orderService.GetPendingOrdersForIssue(issueId);
    
    // åˆå¹¶è®¢å•
    var mergeResult = _orderMerger.Merge(orders);
    
    // âŒ ç›´æ¥æ‰§è¡ŒæŠ•æ³¨ï¼ˆé˜»å¡åç»­å¤„ç†ï¼‰
    var result = await _autoBetService.PushBetCommand(...);
    
    // æ›´æ–°è®°å½•
    _betRecordService.UpdateResult(...);
}

// âŒ ç¼ºç‚¹ï¼š
// 1. å¦‚æœæŠ•æ³¨å¾ˆæ…¢ï¼ˆ3ç§’ï¼‰ï¼Œä¸‹ä¸€ä¸ªå°ç›˜äº‹ä»¶ä¼šè¢«é˜»å¡
// 2. æ— æ³•å¹¶å‘å¤„ç†å¤šä¸ªé…ç½®çš„æŠ•æ³¨
// 3. æ— æ³•ç»Ÿä¸€ç®¡ç†ä»»åŠ¡çŠ¶æ€ï¼ˆå“ªäº›åœ¨æ‰§è¡Œã€å“ªäº›å·²å®Œæˆï¼‰
// 4. æ— æ³•å®ç°è¶…æ—¶æ§åˆ¶ï¼ˆç­‰å¾…æ‰€æœ‰æŠ•æ³¨å®Œæˆï¼‰
```

### **âœ… åˆ†ç¦»åçš„ä¼˜åŠ¿**

```csharp
// âœ… åè°ƒå™¨ï¼šå¿«é€Ÿå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ˆä¸é˜»å¡ï¼‰
private async void LotteryService_StatusChanged(...)
{
    var orders = _orderService.GetPendingOrdersForIssue(issueId);
    var mergeResult = _orderMerger.Merge(orders);
    var recordId = _betRecordService.Add(betRecord);
    
    // âœ… æäº¤åˆ°é˜Ÿåˆ—åç«‹å³è¿”å›ï¼ˆä¸é˜»å¡ï¼‰
    _betQueueManager.EnqueueBet(recordId, async () => {
        return await _autoBetService.PushBetCommand(...);
    });
    
    // â† ç«‹å³è¿”å›ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªäº‹ä»¶
}

// âœ… é˜Ÿåˆ—ç®¡ç†å™¨ï¼šåå°å¼‚æ­¥æ‰§è¡ŒæŠ•æ³¨ï¼ˆå¯å¹¶å‘ï¼‰
// - æŠ•æ³¨1ï¼šæ­£åœ¨æ‰§è¡Œï¼ˆè€—æ—¶3ç§’ï¼‰
// - æŠ•æ³¨2ï¼šæ­£åœ¨æ‰§è¡Œï¼ˆè€—æ—¶2ç§’ï¼‰â† åŒæ—¶è¿›è¡Œ
// - æŠ•æ³¨3ï¼šæ­£åœ¨æ‰§è¡Œï¼ˆè€—æ—¶4ç§’ï¼‰â† åŒæ—¶è¿›è¡Œ
```

**ä¼˜åŠ¿æ€»ç»“**ï¼š
1. âœ… **è§£è€¦**ï¼šä¸šåŠ¡é€»è¾‘å’Œä»»åŠ¡æ‰§è¡Œåˆ†ç¦»
2. âœ… **ä¸é˜»å¡**ï¼šåè°ƒå™¨å¿«é€Ÿè¿”å›ï¼Œä¸å½±å“ä¸‹ä¸€ä¸ªäº‹ä»¶
3. âœ… **å¹¶å‘**ï¼šå¤šä¸ªæŠ•æ³¨å¯ä»¥åŒæ—¶æ‰§è¡Œ
4. âœ… **å¯ç®¡ç†**ï¼šç»Ÿä¸€è·Ÿè¸ªä»»åŠ¡çŠ¶æ€
5. âœ… **å¯æ‰©å±•**ï¼šå¯ä»¥æ·»åŠ è¶…æ—¶æ§åˆ¶ã€é‡è¯•æœºåˆ¶

---

## ğŸ“‹ ç±»æ¯”ç†è§£ï¼šé¤å…ç‚¹é¤ç³»ç»Ÿ

| è§’è‰² | å¯¹åº”ç»„ä»¶ | èŒè´£ | è¯´æ˜ |
|------|---------|------|------|
| **é¡¾å®¢** | `BinggoLotteryService` | è§¦å‘éœ€æ±‚ | å°ç›˜ = é¡¾å®¢ç‚¹é¤ |
| **æœåŠ¡å‘˜**ï¼ˆåè°ƒè€…ï¼‰ | `AutoBetCoordinator` | æ¥å•ã€æ ¸å¯¹èœå•ã€éªŒè¯è§„åˆ™ã€ä¸‹å•åˆ°å¨æˆ¿ | å¿«é€Ÿå¤„ç†ï¼Œä¸é˜»å¡ |
| **å¨æˆ¿è°ƒåº¦**ï¼ˆé˜Ÿåˆ—ç®¡ç†å™¨ï¼‰ | `BetQueueManager` | å®‰æ’å¨å¸ˆã€å¹¶å‘åšèœã€è®°å½•å®Œæˆæ—¶é—´ | ç»Ÿä¸€ç®¡ç†ä»»åŠ¡ |
| **å¨å¸ˆ** | `AutoBetService` | å®é™…åšèœ | æŠ•æ³¨åˆ°å¹³å° |

### **å¦‚æœæ²¡æœ‰å¨æˆ¿è°ƒåº¦ï¼ˆBetQueueManagerï¼‰**

```
é¡¾å®¢ç‚¹é¤ â†’ æœåŠ¡å‘˜æ¥å• â†’ æœåŠ¡å‘˜ç›¯ç€å¨å¸ˆåšèœï¼ˆé˜»å¡ï¼‰
                          â†‘
                    ä¸€é“èœæ²¡åšå®Œï¼Œä¸èƒ½æ¥ä¸‹ä¸€æ¡Œçš„å• âŒ
                    æ— æ³•å¹¶å‘å¤„ç†å¤šæ¡Œè®¢å• âŒ
```

### **æœ‰å¨æˆ¿è°ƒåº¦å**

```
é¡¾å®¢ç‚¹é¤ â†’ æœåŠ¡å‘˜æ¥å• â†’ å¿«é€Ÿä¸‹å•åˆ°å¨æˆ¿ â†’ ç»§ç»­æ¥å…¶ä»–æ¡Œçš„å• âœ…
                          â†“
                    å¨æˆ¿è°ƒåº¦å®‰æ’ï¼š
                    - å¨å¸ˆ1ï¼šåšèœAï¼ˆ3åˆ†é’Ÿï¼‰
                    - å¨å¸ˆ2ï¼šåšèœBï¼ˆ2åˆ†é’Ÿï¼‰â† åŒæ—¶è¿›è¡Œ âœ…
                    - å¨å¸ˆ3ï¼šåšèœCï¼ˆ4åˆ†é’Ÿï¼‰â† åŒæ—¶è¿›è¡Œ âœ…
```

---

## ğŸ¯ æ•°æ®æµè½¬ç¤ºæ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¼€å¥–æœåŠ¡                                  â”‚
â”‚               BinggoLotteryService                           â”‚
â”‚                                                              â”‚
â”‚   æœŸå·: 114063155                                            â”‚
â”‚   çŠ¶æ€: æ”¶å•ä¸­ â†’ å°ç›˜ä¸­  â† è§¦å‘äº‹ä»¶                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ StatusChanged Event
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  è‡ªåŠ¨æŠ•æ³¨åè°ƒå™¨                               â”‚
â”‚               AutoBetCoordinator                             â”‚
â”‚                                                              â”‚
â”‚  [ä¸šåŠ¡åè°ƒå±‚]                                                â”‚
â”‚   â”œâ”€ æŸ¥è¯¢è®¢å•: 10ä¸ªå¾…æŠ•æ³¨è®¢å•                                 â”‚
â”‚   â”œâ”€ éªŒè¯è§„åˆ™: ä¼šå‘˜ç­‰çº§ã€é‡‘é¢é™åˆ¶                             â”‚
â”‚   â”œâ”€ åˆå¹¶è®¢å•: "1å¤§30,2å°20,3å¤§10"                           â”‚
â”‚   â”œâ”€ éªŒè¯é‡‘é¢: 30å…ƒåœ¨[30-5000]èŒƒå›´å†… âœ…                       â”‚
â”‚   â”œâ”€ åˆ›å»ºè®°å½•: RecordId=12345                                â”‚
â”‚   â””â”€ æäº¤ä»»åŠ¡: EnqueueBet(12345, Lambda)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Lambda Expression
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æŠ•æ³¨é˜Ÿåˆ—ç®¡ç†å™¨                               â”‚
â”‚                BetQueueManager                               â”‚
â”‚                                                              â”‚
â”‚  [ä»»åŠ¡æ‰§è¡Œå±‚]                                                â”‚
â”‚   â”œâ”€ æ¥æ”¶ä»»åŠ¡: RecordId=12345                                â”‚
â”‚   â”œâ”€ åˆ›å»ºå¼‚æ­¥: Task.Run(async () => ...)                     â”‚
â”‚   â”œâ”€ åŠ å…¥é˜Ÿåˆ—: _pendingBets[12345] = task                    â”‚
â”‚   â”œâ”€ æ‰§è¡ŒæŠ•æ³¨: await betAction()  â† è°ƒç”¨ä¸‹å±‚                 â”‚
â”‚   â”œâ”€ æ›´æ–°è®°å½•: Success=true, è€—æ—¶=1234ms                     â”‚
â”‚   â””â”€ æ¸…ç†ä»»åŠ¡: _pendingBets.Remove(12345)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ PushBetCommand
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  è‡ªåŠ¨æŠ•æ³¨æœåŠ¡                                 â”‚
â”‚                AutoBetService                                â”‚
â”‚                                                              â”‚
â”‚  [é€šä¿¡å±‚]                                                    â”‚
â”‚   â”œâ”€ BaiShengVx3Plus: Socket â†’ å¤–éƒ¨æµè§ˆå™¨è¿›ç¨‹                â”‚
â”‚   â””â”€ zhaocaimao: ç›´æ¥è°ƒç”¨ WebView2 æ§ä»¶                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ æŠ•æ³¨å‘½ä»¤
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æµè§ˆå™¨                                    â”‚
â”‚              BrowserClient / WebView2                        â”‚
â”‚                                                              â”‚
â”‚   HTTP POST â†’ æŠ•æ³¨å¹³å°                                        â”‚
â”‚   è¿”å›: { success: true, orderId: "P123456" }                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š å¹¶å‘æ‰§è¡Œç¤ºä¾‹

### **æ—¶é—´çº¿ï¼ˆç§’ï¼‰**

```
æ—¶åˆ» | åè°ƒå™¨                    | é˜Ÿåˆ—ç®¡ç†å™¨                  | æµè§ˆå™¨
-----|--------------------------|----------------------------|--------
0.0  | æ”¶åˆ°å°ç›˜äº‹ä»¶              |                            |
0.1  | æŸ¥è¯¢è®¢å•(10ä¸ª)            |                            |
0.2  | åˆå¹¶è®¢å•                 |                            |
0.3  | åˆ›å»ºè®°å½•(ID=100)         |                            |
0.4  | EnqueueBet(100) â†’ è¿”å›   | æ¥æ”¶ä»»åŠ¡100                 |
0.5  | âœ… ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªäº‹ä»¶      | Task.Runå¯åŠ¨               | 
0.6  |                          | å¼€å§‹æ‰§è¡ŒæŠ•æ³¨100             | POSTè¯·æ±‚
1.0  | æ”¶åˆ°ä¸‹ä¸€ä¸ªå°ç›˜äº‹ä»¶        | æŠ•æ³¨100è¿›è¡Œä¸­...            | ç­‰å¾…å“åº”
1.1  | æŸ¥è¯¢è®¢å•(8ä¸ª)            | æŠ•æ³¨100è¿›è¡Œä¸­...            | ç­‰å¾…å“åº”
1.2  | åˆå¹¶è®¢å•                 | æŠ•æ³¨100è¿›è¡Œä¸­...            | ç­‰å¾…å“åº”
1.3  | åˆ›å»ºè®°å½•(ID=101)         | æŠ•æ³¨100è¿›è¡Œä¸­...            | ç­‰å¾…å“åº”
1.4  | EnqueueBet(101) â†’ è¿”å›   | æ¥æ”¶ä»»åŠ¡101                 | ç­‰å¾…å“åº”
1.5  | âœ… ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªäº‹ä»¶      | Task.Runå¯åŠ¨ â† å¹¶å‘ï¼       | 
1.6  |                          | æŠ•æ³¨100è¿›è¡Œä¸­...            | å“åº”è¿”å›
     |                          | æŠ•æ³¨101å¼€å§‹æ‰§è¡Œ â† å¹¶å‘ï¼     | POSTè¯·æ±‚
2.0  |                          | æŠ•æ³¨100å®Œæˆ âœ…               |
     |                          | æ›´æ–°è®°å½•100                 |
     |                          | ç§»é™¤ä»»åŠ¡100                 |
2.5  |                          | æŠ•æ³¨101è¿›è¡Œä¸­...            | å“åº”è¿”å›
     |                          | æŠ•æ³¨101å®Œæˆ âœ…               |
     |                          | æ›´æ–°è®°å½•101                 |
     |                          | ç§»é™¤ä»»åŠ¡101                 |
```

**å…³é”®ç‚¹**ï¼š
- âœ… åè°ƒå™¨åœ¨ 0.4 ç§’æäº¤ä»»åŠ¡åç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…æŠ•æ³¨å®Œæˆ
- âœ… 1.0 ç§’æ—¶å¯ä»¥å¤„ç†ä¸‹ä¸€ä¸ªå°ç›˜äº‹ä»¶ï¼ˆä¸é˜»å¡ï¼‰
- âœ… æŠ•æ³¨100å’ŒæŠ•æ³¨101å¯ä»¥å¹¶å‘æ‰§è¡Œï¼ˆ1.6ç§’åŒæ—¶è¿›è¡Œï¼‰

---

## âœ… æ¶æ„ä¼˜åŠ¿æ€»ç»“

### **å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰**

| ç»„ä»¶ | å•ä¸€èŒè´£ |
|------|---------|
| `AutoBetCoordinator` | åªè´Ÿè´£**ä¸šåŠ¡åè°ƒ**ï¼ˆæŸ¥è¯¢ã€éªŒè¯ã€åˆå¹¶ï¼‰ |
| `BetQueueManager` | åªè´Ÿè´£**ä»»åŠ¡æ‰§è¡Œ**ï¼ˆå¼‚æ­¥ã€å¹¶å‘ã€è®°å½•ï¼‰ |
| `AutoBetService` | åªè´Ÿè´£**é€šä¿¡**ï¼ˆSocket/WebView2ï¼‰ |

### **å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰**

- âœ… **æ‰©å±•å¼€æ”¾**ï¼šå¯ä»¥æ·»åŠ æ–°çš„ä¸šåŠ¡è§„åˆ™ï¼ˆä¼šå‘˜ç­‰çº§ã€å¤šé…ç½®æŠ•æ³¨ï¼‰
  - åªéœ€ä¿®æ”¹ `AutoBetCoordinator`
  - ä¸å½±å“ `BetQueueManager` å’Œ `AutoBetService`
  
- âœ… **ä¿®æ”¹å°é—­**ï¼šåº•å±‚ä»»åŠ¡æ‰§è¡Œé€»è¾‘ç¨³å®š
  - `BetQueueManager` ä¸éœ€è¦çŸ¥é“ä¸šåŠ¡è§„åˆ™
  - ä¸šåŠ¡è§„åˆ™å˜åŒ–ä¸å½±å“ä»»åŠ¡æ‰§è¡Œ

### **ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰**

```
é«˜å±‚ï¼ˆåè°ƒå™¨ï¼‰
    â†“ ä¾èµ–æŠ½è±¡
ä¸­å±‚ï¼ˆé˜Ÿåˆ—ç®¡ç†å™¨ï¼‰
    â†“ ä¾èµ–æŠ½è±¡
ä½å±‚ï¼ˆæŠ•æ³¨æœåŠ¡ï¼‰
```

### **æ€§èƒ½ä¼˜åŠ¿**

- âš¡ **ä¸é˜»å¡**ï¼šåè°ƒå™¨å¿«é€Ÿè¿”å›ï¼ˆ< 500msï¼‰
- âš¡ **å¹¶å‘**ï¼šå¤šä¸ªæŠ•æ³¨åŒæ—¶æ‰§è¡Œï¼ˆ3-5ç§’å˜æˆ1-2ç§’ï¼‰
- âš¡ **å¯æ‰©å±•**ï¼šå¯ä»¥æ·»åŠ æ›´å¤šæµè§ˆå™¨/é…ç½®ï¼ˆæ¨ªå‘æ‰©å±•ï¼‰

---

## ğŸ” å¸¸è§é—®é¢˜ FAQ

### **Q1: ä¸ºä»€ä¹ˆä¸èƒ½åœ¨åè°ƒå™¨ä¸­ç›´æ¥ await æŠ•æ³¨ï¼Ÿ**

**A**: ä¼šé˜»å¡å°ç›˜äº‹ä»¶å¤„ç†ã€‚

```csharp
// âŒ é”™è¯¯åšæ³•
private async void LotteryService_StatusChanged(...)
{
    var result = await _autoBetService.PushBetCommand(...);  // é˜»å¡3ç§’
    // å¦‚æœä¸‹ä¸€ä¸ªå°ç›˜äº‹ä»¶åœ¨3ç§’å†…åˆ°è¾¾ï¼Œä¼šè¢«é˜»å¡ï¼
}

// âœ… æ­£ç¡®åšæ³•
private async void LotteryService_StatusChanged(...)
{
    _betQueueManager.EnqueueBet(recordId, async () => {
        return await _autoBetService.PushBetCommand(...);
    });
    // ç«‹å³è¿”å›ï¼Œä¸é˜»å¡ï¼
}
```

### **Q2: å¦‚æœæŠ•æ³¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿ**

**A**: `BetQueueManager` ä¼šè‡ªåŠ¨è®°å½•å¤±è´¥ä¿¡æ¯ã€‚

```csharp
catch (Exception ex)
{
    // è®°å½•å¼‚å¸¸åˆ° BetRecord è¡¨
    _betRecordService.UpdateResult(
        recordId,
        false,          // Success = false
        null,
        ex.Message,     // ErrorMessage
        null,
        null,
        null
    );
}
```

### **Q3: å¦‚ä½•æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„æŠ•æ³¨ä»»åŠ¡ï¼Ÿ**

**A**: é€šè¿‡ `BetQueueManager._pendingBets` å­—å…¸ã€‚

```csharp
_log.Info("BetQueueManager", $"å½“å‰é˜Ÿåˆ—æ•°:{_pendingBets.Count}");
```

### **Q4: åè°ƒå™¨å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªé…ç½®å—ï¼Ÿ**

**A**: ç›®å‰è®¾è®¡æ˜¯å•é…ç½®ï¼ˆ`_currentConfigId`ï¼‰ã€‚

**æ‰©å±•æ–¹æ¡ˆ**ï¼š
```csharp
// å¯ä»¥æ”¹ä¸ºå­—å…¸ï¼šconfigId â†’ Coordinator
private readonly Dictionary<int, AutoBetCoordinator> _coordinators = new();

// æˆ–è€…æ”¹ä¸ºæ”¯æŒå¤šé…ç½®
private readonly List<int> _enabledConfigIds = new();
```

### **Q5: å°ç›˜äº‹ä»¶ä¼šé‡å¤è§¦å‘å—ï¼Ÿ**

**A**: æœ‰é˜²é‡å¤æœºåˆ¶ã€‚

```csharp
// é˜²é‡å¤æ£€æŸ¥1ï¼šæœŸå·çº§åˆ«
if (_hasProcessedCurrentIssue) return;

// é˜²é‡å¤æ£€æŸ¥2ï¼šçŠ¶æ€çº§åˆ«
if (_lastStatus == BinggoLotteryStatus.å°ç›˜ä¸­) return;
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è®¢å•åˆå¹¶é€»è¾‘**: `BaiShengVx3Plus/Services/AutoBet/OrderMerger.cs`
- **æŠ•æ³¨è®°å½•æœåŠ¡**: `BaiShengVx3Plus/Services/AutoBet/BetRecordService.cs`
- **æµè§ˆå™¨é€šä¿¡**: 
  - BaiShengVx3Plus: `AutoBetSocketServer.cs` (Socket)
  - zhaocaimao: `BetBrowserControl.cs` (WebView2)
- **æ•°æ®æ¨¡å‹**: 
  - `Models/AutoBet/BetRecord.cs` (æŠ•æ³¨è®°å½•)
  - `Models/V2MemberOrder.cs` (ä¼šå‘˜è®¢å•)

---

## ğŸ”„ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è¯´æ˜ |
|------|------|------|
| v1.0 | 2025-11-18 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´è®°å½•å°ç›˜è§¦å‘é“¾å’Œç»„ä»¶èŒè´£ |

---

**ğŸ“ æ–‡æ¡£ç»“æŸ**

