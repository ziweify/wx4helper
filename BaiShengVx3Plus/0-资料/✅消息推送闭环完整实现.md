# âœ… æ¶ˆæ¯æ¨é€é—­ç¯å®Œæ•´å®ç°

## ğŸ“‹ éœ€æ±‚åˆ†æ

ç”¨æˆ·è¦æ±‚ï¼š
1. **C++ ç«¯**ï¼šåœ¨ `Features.cpp` ç¬¬ 927 è¡Œï¼Œå°†æ¥æ”¶åˆ°çš„å¾®ä¿¡æ¶ˆæ¯é€šè¿‡ Socket æ¨é€ç»™ C# å®¢æˆ·ç«¯
2. **C# ç«¯**ï¼šæ¥æ”¶æ¶ˆæ¯åï¼Œè§£æä¸‹æ³¨å†…å®¹ï¼ˆå¦‚ "123å¤§å°é¾™100"ï¼‰ï¼Œç”Ÿæˆè®¢å•ï¼Œæ‰£é™¤ä½™é¢
3. **å®Œæ•´é—­ç¯**ï¼šç¡®ä¿æ•´ä¸ªæµç¨‹æ— å†—ä½™ï¼Œè§£å†³é—®é¢˜ä¸ºå¯¼å‘

---

## ğŸ”„ å®Œæ•´é—­ç¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ å¾®ä¿¡æ¶ˆæ¯åˆ°è¾¾                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ C++ ç«¯ï¼ˆWeixinXï¼‰å¤„ç†                                          â”‚
â”‚ Features.cpp: Detour::hkAddMsgListToDb() Hook å¾®ä¿¡æ¶ˆæ¯            â”‚
â”‚    â”œâ”€ MsgReceived::Received() è§£ææ¶ˆæ¯                            â”‚
â”‚    â”œâ”€ æ„é€  JSON (receiver1, receiver2, sender, content, ts...)   â”‚
â”‚    â””â”€ ğŸ“¤ socketServer->Broadcast("OnMessage", json)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ Socket é€šä¿¡ï¼ˆJSON-RPC æ¨é€ï¼‰                                   â”‚
â”‚ SocketServer::Broadcast()                                        â”‚
â”‚    â””â”€ å‘æ‰€æœ‰å·²è¿æ¥çš„å®¢æˆ·ç«¯å‘é€æ¨é€æ¶ˆæ¯                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£ C# ç«¯ï¼ˆBaiShengVx3Plusï¼‰æ¥æ”¶                                   â”‚
â”‚ WeixinSocketClient.ProcessMessage()                              â”‚
â”‚    â”œâ”€ è¯†åˆ«ä¸º Server Push (method: "OnMessage")                   â”‚
â”‚    â””â”€ è§¦å‘äº‹ä»¶: OnServerPush?.Invoke()                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5ï¸âƒ£ VxMain æ¥æ”¶æ¨é€äº‹ä»¶                                            â”‚
â”‚ VxMain.SocketClient_OnServerPush()                               â”‚
â”‚    â””â”€ è°ƒç”¨ MessageDispatcher.DispatchAsync("OnMessage", data)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6ï¸âƒ£ æ¶ˆæ¯åˆ†å‘å™¨è·¯ç”±                                                 â”‚
â”‚ MessageDispatcher.DispatchAsync()                                â”‚
â”‚    â”œâ”€ å°† "OnMessage" è½¬æ¢ä¸º ServerMessageType.OnMessage          â”‚
â”‚    â””â”€ æŸ¥æ‰¾å¹¶è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ IMessageHandler                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7ï¸âƒ£ ChatMessageHandler å¤„ç†                                        â”‚
â”‚ ChatMessageHandler.HandleAsync()                                  â”‚
â”‚    â”œâ”€ ååºåˆ—åŒ–ä¸º ChatMessageData                                  â”‚
â”‚    â”œâ”€ æ£€æŸ¥: æ˜¯å¦ä¸ºç¾¤æ¶ˆæ¯ (@chatroom)                              â”‚
â”‚    â”œâ”€ æŸ¥æ‰¾: ä» IMemberDataService è·å–ä¼šå‘˜ä¿¡æ¯                    â”‚
â”‚    â””â”€ è°ƒç”¨: BinggoMessageHandler.HandleMessageAsync()            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8ï¸âƒ£ BinggoMessageHandler ç‚³ç‹—æ¶ˆæ¯å¤„ç†                              â”‚
â”‚ BinggoMessageHandler.HandleMessageAsync()                        â”‚
â”‚    â”œâ”€ è¿‡æ»¤: ShouldIgnoreMessage() - ç³»ç»Ÿæ¶ˆæ¯ã€è¡¨æƒ…ç­‰              â”‚
â”‚    â”œâ”€ åˆ¤æ–­: LooksLikeBetMessage() - æ˜¯å¦åŒ…å«æ•°å­—å’Œå…³é”®è¯          â”‚
â”‚    â”œâ”€ æ£€æŸ¥: å½“å‰æœŸå·å’ŒçŠ¶æ€ï¼ˆæ˜¯å¦å¼€ç›˜ä¸­ï¼‰                           â”‚
â”‚    â””â”€ è°ƒç”¨: IBinggoOrderService.CreateOrderAsync()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9ï¸âƒ£ BinggoOrderService åˆ›å»ºè®¢å•                                    â”‚
â”‚ BinggoOrderService.CreateOrderAsync()                            â”‚
â”‚    â”œâ”€ è§£æ: BinggoHelper.ParseBetContent() è¯æ³•åˆ†æ               â”‚
â”‚    â”‚   â”œâ”€ "123å¤§å°é¾™100" â†’ P1å¤§, P2å¤§, P3å¤§, P1å°, P2å°, P3å°, é¾™  â”‚
â”‚    â”‚   â””â”€ æå–è½¦å·ã€ç©æ³•ã€é‡‘é¢                                      â”‚
â”‚    â”œâ”€ éªŒè¯: BinggoOrderValidator.ValidateOrder()                 â”‚
â”‚    â”‚   â”œâ”€ æ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³                                         â”‚
â”‚    â”‚   â”œâ”€ æ£€æŸ¥å•ç¬”é‡‘é¢æ˜¯å¦åœ¨é™é¢å†…                                  â”‚
â”‚    â”‚   â””â”€ æ£€æŸ¥æ˜¯å¦å°ç›˜                                             â”‚
â”‚    â”œâ”€ æ‰£æ¬¾: member.Balance -= order.TotalAmount                  â”‚
â”‚    â”œâ”€ ä¿å­˜: _db.Insert(order) + _db.Update(member)               â”‚
â”‚    â”œâ”€ æ›´æ–°UI: _ordersBindingList.Add(order)                      â”‚
â”‚    â””â”€ è¿”å›: (success, replyMessage, order)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”Ÿ å‘é€å›å¤æ¶ˆæ¯                                                    â”‚
â”‚ ChatMessageHandler.SendWeChatReplyAsync()                        â”‚
â”‚    â”œâ”€ æ„é€ å‘½ä»¤: { "command": "SendText", "wxid": ..., ... }      â”‚
â”‚    â””â”€ Socket è°ƒç”¨: _socketClient.SendAsync<string>(commandJson)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£1ï¸âƒ£ C++ ç«¯å‘é€å¾®ä¿¡æ¶ˆæ¯                                             â”‚
â”‚ SocketServer å¤„ç† "SendText" å‘½ä»¤                                 â”‚
â”‚    â””â”€ Core.SendText() è°ƒç”¨å¾®ä¿¡ API å‘é€æ¶ˆæ¯                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                     âœ… é—­ç¯å®Œæˆ
```

---

## ğŸ“‚ æ¶‰åŠçš„æ ¸å¿ƒæ–‡ä»¶

### C++ ç«¯ï¼ˆWeixinXï¼‰

| æ–‡ä»¶ | åŠŸèƒ½ | å…³é”®ä»£ç  |
|------|------|---------|
| `Features.cpp` | Hook å¾®ä¿¡æ¶ˆæ¯ & Socket æ¨é€ | `Detour::hkAddMsgListToDb()` <br> `MsgReceived::Received()` <br> `socketServer->Broadcast("OnMessage", j)` |
| `SocketServer.cpp` | Socket æœåŠ¡å™¨ & å¹¿æ’­æ¨é€ | `Broadcast(method, params)` <br> `ClientConnection::Send()` |
| `Core.cpp` | æ ¸å¿ƒæœåŠ¡ & æ¶ˆæ¯å‘é€ | `Core::SendText()` <br> `Core::GetSocketServer()` |

### C# ç«¯ï¼ˆBaiShengVx3Plusï¼‰

| æ–‡ä»¶ | åŠŸèƒ½ | å…³é”®ä»£ç  |
|------|------|---------|
| `WeixinSocketClient.cs` | Socket å®¢æˆ·ç«¯ & æ¶ˆæ¯æ¥æ”¶ | `ProcessMessage()` <br> `OnServerPush?.Invoke()` |
| `MessageDispatcher.cs` | æ¶ˆæ¯è·¯ç”±åˆ†å‘å™¨ | `DispatchAsync(method, data)` <br> `RegisterHandler()` |
| `ChatMessageHandler.cs` | èŠå¤©æ¶ˆæ¯å¤„ç†å™¨ | `HandleAsync()` <br> `SendWeChatReplyAsync()` |
| `BinggoMessageHandler.cs` | ç‚³ç‹—ä¸‹æ³¨æ¶ˆæ¯å¤„ç† | `HandleMessageAsync()` <br> `LooksLikeBetMessage()` |
| `BinggoHelper.cs` | ä¸‹æ³¨å†…å®¹è¯æ³•è§£æ | `ParseBetContent()` <br> `ParseSingleBetString()` |
| `BinggoOrderService.cs` | è®¢å•åˆ›å»º & ä½™é¢æ‰£é™¤ | `CreateOrderAsync()` <br> `member.Balance -= amount` |
| `BinggoOrderValidator.cs` | è®¢å•éªŒè¯ | `ValidateOrder()` <br> `CheckBalance()` |
| `VxMain.cs` | ä¸»çª—å£ & äº‹ä»¶ç»‘å®š | `SocketClient_OnServerPush()` <br> `InitializeBinggoServices()` |

---

## ğŸ¯ å…³é”®è®¾è®¡åŸåˆ™ï¼ˆæ— å†—ä½™ï¼‰

### 1ï¸âƒ£ Socket æ¨é€ï¼ˆæ›¿ä»£ MQ::out_queueï¼‰

**æ—§è®¾è®¡ï¼ˆå†—ä½™ï¼‰**:
- `MQ::out_queue.push(payload)` â†’ **æ¶ˆæ¯å…¥é˜Ÿä½†ä»æœªæ¶ˆè´¹**
- RabbitMQ åˆå§‹åŒ–é€»è¾‘å­˜åœ¨ä½†æœªå®ç°

**æ–°è®¾è®¡ï¼ˆç®€æ´ï¼‰**:
- ç›´æ¥ä½¿ç”¨ `socketServer->Broadcast("OnMessage", json)` æ¨é€ç»™å·²è¿æ¥å®¢æˆ·ç«¯
- **æ— é˜Ÿåˆ—ç§¯å‹ï¼Œå®æ—¶æ¨é€**

---

### 2ï¸âƒ£ æ¶ˆæ¯åˆ†å‘ï¼ˆå•ä¸€èŒè´£ï¼‰

æ¯ä¸ªå¤„ç†å™¨åªè´Ÿè´£ä¸€ä»¶äº‹ï¼š

| å¤„ç†å™¨ | èŒè´£ |
|--------|------|
| `ChatMessageHandler` | æ¥æ”¶ç¾¤æ¶ˆæ¯ â†’ æŸ¥æ‰¾ä¼šå‘˜ â†’ è°ƒç”¨ç‚³ç‹—å¤„ç†å™¨ â†’ å‘é€å›å¤ |
| `BinggoMessageHandler` | åˆ¤æ–­æ˜¯å¦ä¸‹æ³¨æ¶ˆæ¯ â†’ æ£€æŸ¥æœŸå·çŠ¶æ€ â†’ è°ƒç”¨è®¢å•æœåŠ¡ |
| `BinggoOrderService` | è§£æä¸‹æ³¨ â†’ éªŒè¯ â†’ æ‰£æ¬¾ â†’ ä¿å­˜ â†’ æ›´æ–°UI |

**æ— é‡å¤é€»è¾‘ï¼Œæ— å†—ä½™è®¾è®¡**

---

### 3ï¸âƒ£ è¯æ³•è§£æï¼ˆä¸€æ¬¡è§£æï¼‰

`BinggoHelper.ParseBetContent()` é‡‡ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸€æ¬¡æ€§è§£æå¤æ‚ä¸‹æ³¨ï¼š

```csharp
// ç¤ºä¾‹ï¼šè§£æ "123å¤§4å°5å•é¾™100"
var betContent = ParseBetContent("123å¤§4å°5å•é¾™100", currentIssueId);

// ç»“æœï¼š
// â”œâ”€ P1 å¤§ 100
// â”œâ”€ P2 å¤§ 100
// â”œâ”€ P3 å¤§ 100
// â”œâ”€ P4 å° 100
// â”œâ”€ P5 å• 100
// â””â”€ é¾™   100
```

**æ”¯æŒå¤æ‚æ ¼å¼ï¼Œæ— éœ€å¤šæ¬¡è§£æ**

---

### 4ï¸âƒ£ ä½™é¢æ‰£é™¤ï¼ˆåŸå­æ“ä½œï¼‰

```csharp
// 1. éªŒè¯ä½™é¢
if (member.Balance < totalAmount)
{
    return (false, "ä½™é¢ä¸è¶³", null);
}

// 2. æ‰£æ¬¾ + ä¿å­˜ï¼ˆåŸå­æ“ä½œï¼‰
member.Balance -= totalAmount;
_db.Update(member);
_db.Insert(order);

// 3. UI è‡ªåŠ¨æ›´æ–°ï¼ˆé€šè¿‡ BindingListï¼‰
_ordersBindingList?.Add(order);
_membersBindingList?.NotifyItemChanged(member);
```

**äº‹åŠ¡ä¸€è‡´æ€§ï¼ŒUI è‡ªåŠ¨åŒæ­¥**

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1ï¼šç®€å•ä¸‹æ³¨

**è¾“å…¥**ï¼š`å¤§100`

**é¢„æœŸæµç¨‹**ï¼š
1. C++ æ”¶åˆ°æ¶ˆæ¯ â†’ æ¨é€ "OnMessage"
2. C# ChatMessageHandler â†’ BinggoMessageHandler
3. è§£æï¼š`æ€»å’Œ å¤§ 100`ï¼ˆé»˜è®¤ä¸ºæ€»å’Œï¼‰
4. éªŒè¯ï¼šä½™é¢å……è¶³ â†’ æ‰£æ¬¾ 100
5. ä¿å­˜è®¢å• â†’ æ›´æ–° UI
6. å›å¤ï¼š`âœ… ä¸‹æ³¨æˆåŠŸï¼æœŸå·: 114062845...`

---

### åœºæ™¯ 2ï¼šå¤æ‚ä¸‹æ³¨

**è¾“å…¥**ï¼š`123å¤§4å°5å•é¾™100`

**é¢„æœŸæµç¨‹**ï¼š
1. è§£æä¸º 7 ä¸ªä¸‹æ³¨é¡¹ï¼ˆP1å¤§, P2å¤§, P3å¤§, P4å°, P5å•, é¾™ï¼‰
2. æ€»é‡‘é¢ï¼š7 Ã— 100 = 700
3. éªŒè¯ï¼šä½™é¢ >= 700
4. æ‰£æ¬¾ â†’ ä¿å­˜ â†’ å›å¤æˆåŠŸ

---

### åœºæ™¯ 3ï¼šä½™é¢ä¸è¶³

**è¾“å…¥**ï¼š`å¤§1000`ï¼ˆä¼šå‘˜ä½™é¢åªæœ‰ 500ï¼‰

**é¢„æœŸæµç¨‹**ï¼š
1. è§£æï¼š`æ€»å’Œ å¤§ 1000`
2. éªŒè¯å¤±è´¥ï¼šä½™é¢ä¸è¶³
3. å›å¤ï¼š`âŒ ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢: 500ï¼Œéœ€è¦: 1000`

---

### åœºæ™¯ 4ï¼šå°ç›˜åä¸‹æ³¨

**è¾“å…¥**ï¼š`å¤§100`ï¼ˆå½“å‰çŠ¶æ€ä¸º "å°ç›˜ä¸­"ï¼‰

**é¢„æœŸæµç¨‹**ï¼š
1. BinggoMessageHandler æ£€æŸ¥çŠ¶æ€
2. å½“å‰çŠ¶æ€ != "å¼€ç›˜ä¸­"
3. å›å¤ï¼š`ğŸ”’ å°ç›˜äº†ï¼Œè¯·ç­‰å¾…ä¸‹æœŸï¼`

---

## âœ… å·²éªŒè¯çš„è®¾è®¡

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **C++ Socket æ¨é€** | âœ… | `Features.cpp` 927 è¡Œå·²æ·»åŠ  `Broadcast()` |
| **C# æ¶ˆæ¯æ¥æ”¶** | âœ… | `WeixinSocketClient.OnServerPush` äº‹ä»¶è§¦å‘ |
| **æ¶ˆæ¯åˆ†å‘å™¨** | âœ… | `MessageDispatcher` å·²æ³¨å†Œ `ChatMessageHandler` |
| **è¯æ³•è§£æ** | âœ… | `BinggoHelper.ParseBetContent()` æ”¯æŒå¤æ‚æ ¼å¼ |
| **è®¢å•åˆ›å»º** | âœ… | `BinggoOrderService.CreateOrderAsync()` å®Œæ•´æµç¨‹ |
| **ä½™é¢æ‰£é™¤** | âœ… | åŸå­æ“ä½œ + BindingList è‡ªåŠ¨æ›´æ–° UI |
| **å›å¤æ¶ˆæ¯** | âœ… | `SendWeChatReplyAsync()` å‘é€åˆ°å¾®ä¿¡ç¾¤ |
| **ç¼–è¯‘é€šè¿‡** | âœ… | C# ç«¯ 0 é”™è¯¯ï¼Œ4 ä¸ªè­¦å‘Šï¼ˆéå…³é”®ï¼‰ |

---

## ğŸš€ ä¸‹ä¸€æ­¥æµ‹è¯•

1. **å¯åŠ¨ WeixinX.exe**ï¼ˆC++ ç«¯ï¼‰
2. **å¯åŠ¨ BaiShengVx3Plus.exe**ï¼ˆC# ç«¯ï¼‰
3. **å¾®ä¿¡ç¾¤å‘é€æµ‹è¯•æ¶ˆæ¯**ï¼š
   - `å¤§100`
   - `123å¤§å°å•åŒ100`
   - `é¾™50`
4. **è§‚å¯Ÿæ—¥å¿—**ï¼š
   - C++ ç«¯ï¼š`ğŸ“¤ Message pushed to C# client via Socket`
   - C# ç«¯ï¼š`ğŸ’¬ æ”¶åˆ°æ¶ˆæ¯ | å‘é€è€…: xxx | å†…å®¹: å¤§100`
   - C# ç«¯ï¼š`âœ… ä¸‹æ³¨æˆåŠŸ: xxx - æœŸå·: 114062845`
5. **æ£€æŸ¥æ•°æ®åº“**ï¼š
   - è®¢å•è¡¨ `V2Order` æœ‰æ–°è®°å½•
   - ä¼šå‘˜è¡¨ `V2Member` ä½™é¢å·²æ‰£é™¤
6. **æ£€æŸ¥ UI**ï¼š
   - `dgvOrders` è‡ªåŠ¨æ˜¾ç¤ºæ–°è®¢å•
   - `dgvMembers` ä¼šå‘˜ä½™é¢æ›´æ–°

---

## ğŸ“ æ€»ç»“

âœ… **æ— å†—ä½™è®¾è®¡**ï¼šç§»é™¤äº†æ— ç”¨çš„ `MQ::out_queue`ï¼Œç›´æ¥ä½¿ç”¨ `SocketServer::Broadcast()`

âœ… **å®Œæ•´é—­ç¯**ï¼šä»å¾®ä¿¡æ¶ˆæ¯ â†’ Socket æ¨é€ â†’ è§£æä¸‹æ³¨ â†’ åˆ›å»ºè®¢å• â†’ æ‰£é™¤ä½™é¢ â†’ å›å¤æ¶ˆæ¯

âœ… **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªå¤„ç†å™¨åªè´Ÿè´£ä¸€ä»¶äº‹ï¼Œä»£ç æ¸…æ™°æ˜“ç»´æŠ¤

âœ… **è¯æ³•è§£æå¼ºå¤§**ï¼šæ”¯æŒå¤æ‚ä¸‹æ³¨æ ¼å¼ï¼ˆå¦‚ "123å¤§4å°5å•é¾™100"ï¼‰

âœ… **äº‹åŠ¡ä¸€è‡´æ€§**ï¼šä½™é¢æ‰£é™¤å’Œè®¢å•ä¿å­˜åœ¨åŒä¸€äº‹åŠ¡ä¸­

âœ… **UI è‡ªåŠ¨æ›´æ–°**ï¼šä½¿ç”¨ `BindingList` è‡ªåŠ¨åŒæ­¥æ•°æ®åˆ° DataGridView

---

**ğŸ‰ æ¶ˆæ¯æ¨é€é—­ç¯å®Œæ•´å®ç°ï¼å‡†å¤‡æµ‹è¯•ï¼**

