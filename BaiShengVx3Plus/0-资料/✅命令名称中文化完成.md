# âœ… å‘½ä»¤åç§°ä¸­æ–‡åŒ–å®Œæˆ

## ğŸ“… å®Œæˆæ—¶é—´

2025-11-08

## ğŸ¯ ç”¨æˆ·è¦æ±‚

> "è¯·æŠŠé€šçŸ¥ç±»çš„ï¼Œéƒ½æ”¹æˆä¸­æ–‡ï¼Œsealing_notifyï¼Œæˆ‘å¯¹å˜é‡ï¼Œå¸¸é‡ä¸­æ–‡ä¸ä»‹æ„ï¼Œæ²¡è¿™æ–¹é¢æ´ç™–ï¼Œæˆ‘è¦çš„æ˜¯é€šä¿—æ˜“æ‡‚ï¼Œä¸€ä¸ªå‡½æ•°å†…çš„å˜é‡è‹±æ–‡æ²¡é—®é¢˜ï¼Œå¦‚æœè¿™ä¸ªå˜é‡æ˜¯å…¨å±€çš„ï¼Œé€šçŸ¥æ˜¯å¤šä¸ªåœ°æ–¹è°ƒç”¨çš„ï¼Œé‚£æˆ‘å¸Œæœ›æ˜¯ä¸­æ–‡ï¼Œæˆ‘ä¸€çœ¼å°±å¯ä»¥çœ‹å¾—æ˜ç™½ã€‚å˜é‡åªæ˜¯ä¸ªä»£ç ï¼Œä¸­æ–‡æ˜¯æ²¡é—®é¢˜å¾—ï¼Œå…³é”®æ˜¯ç¨‹åºè®¾è®¡åˆç†å°±å·ã€‚é™¤éæŸäº›æƒ…å†µä¸‹ä¸­æ–‡æœ‰é—®é¢˜ã€‚"

## âœ… å·²ä¿®æ”¹çš„å‘½ä»¤

### å‘½ä»¤å¯¹ç…§è¡¨

| æ—§å‘½ä»¤ï¼ˆè‹±æ–‡ï¼‰ | æ–°å‘½ä»¤ï¼ˆä¸­æ–‡ï¼‰ | è¯´æ˜ |
|--------------|--------------|------|
| `sealing_notify` | `å°ç›˜é€šçŸ¥` | å°ç›˜å€’è®¡æ—¶é€šçŸ¥ |
| `show` | `æ˜¾ç¤ºçª—å£` | æ˜¾ç¤ºæµè§ˆå™¨çª—å£ |
| `hide` | `éšè—çª—å£` | éšè—æµè§ˆå™¨çª—å£ |
| `ping` | `å¿ƒè·³æ£€æµ‹` | æ£€æŸ¥æµè§ˆå™¨çŠ¶æ€ |
| `login` | `ç™»å½•` | ç™»å½•å¹³å° |
| `getbalance` / `get_balance` | `è·å–ä½™é¢` | è·å–è´¦æˆ·ä½™é¢ |
| `placebet` / `place_bet` | `æŠ•æ³¨` | æ‰§è¡ŒæŠ•æ³¨ |

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. BsBrowserClient ç«¯

#### `BsBrowserClient/Form1.cs`
**ä¿®æ”¹ç‚¹**ï¼šå‘½ä»¤å¤„ç† switch è¯­å¥

```csharp
// æ—§ä»£ç 
switch (command.Command.ToLower())
{
    case "sealing_notify":
        // ...
        break;
    case "show":
        // ...
        break;
    case "hide":
        // ...
        break;
    case "ping":
        // ...
        break;
    case "login":
        // ...
        break;
    case "getbalance":
    case "get_balance":
        // ...
        break;
    case "placebet":
    case "place_bet":
        // ...
        break;
}
```

**æ–°ä»£ç **ï¼š

```csharp
// æ–°ä»£ç ï¼ˆä¸­æ–‡å‘½ä»¤ï¼‰
switch (command.Command)  // ä¸å†éœ€è¦ ToLower()
{
    case "å°ç›˜é€šçŸ¥":
        // å°ç›˜é€šçŸ¥ - æ‹‰å–è®¢å•å¹¶æŠ•æ³¨
        var notifyData = command.Data as JObject;
        var issueId = notifyData?["issueId"]?.ToString() ?? "";
        var secondsRemaining = notifyData?["secondsRemaining"]?.ToObject<int>() ?? 0;
        
        OnLogMessage($"â° å°ç›˜é€šçŸ¥: æœŸå·{issueId} å‰©ä½™{secondsRemaining}ç§’");
        
        // é€šè¿‡ HTTP æ‹‰å–è®¢å•å¹¶æŠ•æ³¨
        var betResult = await FetchOrdersAndBetAsync(issueId);
        response.Success = betResult.success;
        response.Message = betResult.message;
        break;
        
    case "æ˜¾ç¤ºçª—å£":
        // ...
        break;
        
    case "éšè—çª—å£":
        // ...
        break;
        
    case "å¿ƒè·³æ£€æµ‹":
        // ...
        break;
        
    case "ç™»å½•":
        // ...
        break;
        
    case "è·å–ä½™é¢":
        // ...
        break;
        
    case "æŠ•æ³¨":
        // ...
        break;
}
```

### 2. VxMain ç«¯

#### `BaiShengVx3Plus/Services/AutoBet/AutoBetService.cs`
**ä¿®æ”¹ç‚¹**ï¼šå‘é€å°ç›˜é€šçŸ¥

```csharp
// æ—§ä»£ç 
await browserClient.SendCommandAsync("sealing_notify", data);

// æ–°ä»£ç 
await browserClient.SendCommandAsync("å°ç›˜é€šçŸ¥", data);
```

#### `BaiShengVx3Plus/Services/AutoBet/BrowserClient.cs`
**ä¿®æ”¹ç‚¹**ï¼šå‘é€æ˜¾ç¤ºçª—å£å’Œå¿ƒè·³æ£€æµ‹å‘½ä»¤

```csharp
// æ—§ä»£ç 
var result = await SendCommandAsync("show");
var result = await SendCommandAsync("ping");

// æ–°ä»£ç 
var result = await SendCommandAsync("æ˜¾ç¤ºçª—å£");
var result = await SendCommandAsync("å¿ƒè·³æ£€æµ‹");
```

## ğŸ¯ ä¼˜åŠ¿

### 1. **é€šä¿—æ˜“æ‡‚**
ä¸€çœ¼å°±èƒ½çœ‹å‡ºå‘½ä»¤çš„ä½œç”¨ï¼Œä¸éœ€è¦ç¿»è¯‘æˆ–çŒœæµ‹

### 2. **ç»Ÿä¸€é£æ ¼**
æ•´ä¸ªç³»ç»Ÿä¸­çš„å…³é”®å‘½ä»¤éƒ½ä½¿ç”¨ä¸­æ–‡ï¼Œé£æ ¼ç»Ÿä¸€

### 3. **ç»´æŠ¤æ–¹ä¾¿**
- æ—¥å¿—ä¸­çš„å‘½ä»¤åç§°æ›´æ˜“è¯»
- æ–°äººæ›´å®¹æ˜“ç†è§£ä»£ç é€»è¾‘
- è°ƒè¯•æ—¶èƒ½å¿«é€Ÿå®šä½é—®é¢˜

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### å‘é€å°ç›˜é€šçŸ¥

**VxMain ç«¯**ï¼š
```csharp
await _autoBetService.NotifySealingAsync(configId, issueId, secondsRemaining);
```

**å®é™…å‘é€çš„ Socket æ¶ˆæ¯**ï¼š
```json
{
  "command": "å°ç›˜é€šçŸ¥",
  "data": {
    "issueId": "114063155",
    "secondsRemaining": 79,
    "timestamp": "2025-11-08 08:43:41"
  }
}
```

**BrowserClient æ—¥å¿—**ï¼š
```
[å‘½ä»¤] å°ç›˜é€šçŸ¥
â° å°ç›˜é€šçŸ¥: æœŸå·114063155 å‰©ä½™79ç§’
ğŸ“¥ å¼€å§‹æ‹‰å–è®¢å•: æœŸå·114063155
```

### æ˜¾ç¤ºçª—å£

**VxMain ç«¯**ï¼š
```csharp
await browserClient.ShowWindowAsync();
```

**å®é™…å‘é€çš„ Socket æ¶ˆæ¯**ï¼š
```json
{
  "command": "æ˜¾ç¤ºçª—å£",
  "data": null
}
```

**BrowserClient å“åº”**ï¼š
```json
{
  "configId": "1",
  "success": true,
  "message": "çª—å£å·²æ˜¾ç¤º"
}
```

### å¿ƒè·³æ£€æµ‹

**VxMain ç«¯**ï¼š
```csharp
var (isAlive, processId) = await browserClient.PingAsync();
```

**å®é™…å‘é€çš„ Socket æ¶ˆæ¯**ï¼š
```json
{
  "command": "å¿ƒè·³æ£€æµ‹",
  "data": null
}
```

**BrowserClient å“åº”**ï¼š
```json
{
  "configId": "1",
  "success": true,
  "message": "Pong",
  "data": {
    "configId": "1",
    "platform": "äº‘é¡¶",
    "processId": 12345
  }
}
```

## ğŸ” æ³¨æ„äº‹é¡¹

### 1. ä¸éœ€è¦ ToLower()

**æ—§ä»£ç **ï¼š
```csharp
switch (command.Command.ToLower())
{
    case "sealing_notify":  // éœ€è¦å°å†™åŒ¹é…
```

**æ–°ä»£ç **ï¼š
```csharp
switch (command.Command)
{
    case "å°ç›˜é€šçŸ¥":  // ç›´æ¥åŒ¹é…ï¼Œæ— éœ€è½¬æ¢
```

### 2. JSON åºåˆ—åŒ–æ”¯æŒä¸­æ–‡

C# çš„ `JsonConvert.SerializeObject()` å®Œå…¨æ”¯æŒä¸­æ–‡å­—ç¬¦ä¸²ï¼Œä¸ä¼šå‡ºç°ç¼–ç é—®é¢˜ã€‚

### 3. æ—¥å¿—æ›´æ˜“è¯»

**æ—§æ—¥å¿—**ï¼š
```
ğŸ“© æ”¶åˆ°å‘½ä»¤: sealing_notify
âŒ æœªçŸ¥å‘½ä»¤: place_bet
```

**æ–°æ—¥å¿—**ï¼š
```
ğŸ“© æ”¶åˆ°å‘½ä»¤: å°ç›˜é€šçŸ¥
âŒ æœªçŸ¥å‘½ä»¤: æŠ•æ³¨
```

## ğŸ“Œ ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
- `BsBrowserClient/Form1.cs` - å‘½ä»¤å¤„ç†é€»è¾‘
- `BaiShengVx3Plus/Services/AutoBet/AutoBetService.cs` - å‘é€å°ç›˜é€šçŸ¥
- `BaiShengVx3Plus/Services/AutoBet/BrowserClient.cs` - å‘é€æ˜¾ç¤ºçª—å£ã€å¿ƒè·³æ£€æµ‹å‘½ä»¤

### ä¸éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶
- HTTP API è·¯å¾„ï¼ˆå¦‚ `/api/order`ï¼‰ä¿æŒè‹±æ–‡ï¼ˆç¬¦åˆ Web æ ‡å‡†ï¼‰
- æ•°æ®åº“å­—æ®µåï¼ˆå¦‚ `BetContentStandar`ï¼‰ä¿æŒè‹±æ–‡ï¼ˆæ•°æ®åº“çº¦å®šï¼‰
- å±€éƒ¨å˜é‡åï¼ˆå¦‚ `issueId`, `betOrder`ï¼‰ä¿æŒè‹±æ–‡ï¼ˆå‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼‰

---

**ç¼–è¯‘çŠ¶æ€**: âœ… å·²æˆåŠŸç¼–è¯‘ï¼Œ0ä¸ªé”™è¯¯ï¼Œ0ä¸ªè­¦å‘Š

**ä¸‹ä¸€æ­¥**: ç»§ç»­å®ç°è®¢å•åˆå¹¶å’ŒæŠ•æ³¨é€»è¾‘ ğŸš€

