# âœ… ä¿®å¤å·¥ä½œç›®å½•é—®é¢˜ - æµè§ˆå™¨å¯åŠ¨æˆåŠŸ

## ğŸ› é—®é¢˜ç°è±¡

å³ä½¿å®Œæ•´å¤åˆ¶äº† 115 ä¸ªæ–‡ä»¶ï¼Œå¯åŠ¨æµè§ˆå™¨ä»ç„¶æŠ¥é”™ï¼š

```
åˆå§‹åŒ–å¤±è´¥: Could not load file or assembly 'CefSharp, Version=126.2.180.0, 
Culture=neutral, PublicKeyToken=40c4b6fc221f4138'. 
ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ã€‚
```

## ğŸ” é—®é¢˜åˆ†æ

### 1. è¯¯å¯¼æ€§çš„é”™è¯¯ä¿¡æ¯

é”™è¯¯æç¤º"æ‰¾ä¸åˆ° CefSharp.dll"ï¼Œä½†å®é™…ä¸Šï¼š
- âŒ CefSharp 126.x **æ²¡æœ‰** `CefSharp.dll` æ–‡ä»¶
- âœ… ä½¿ç”¨çš„æ˜¯ `CefSharp.Core.Runtime.dll` å’Œ `CefSharp.WinForms.dll`

### 2. çœŸæ­£çš„åŸå› ï¼šå·¥ä½œç›®å½•é”™è¯¯

```csharp
// å¯åŠ¨ä»£ç ï¼ˆä¿®å¤å‰ï¼‰
_process = new Process
{
    StartInfo = new ProcessStartInfo
    {
        FileName = "D:\BaiShengVx3Plus\bin\Debug\net8.0-windows\BrowserClient\BsBrowserClient.exe",
        // âŒ æ²¡æœ‰è®¾ç½® WorkingDirectory
        // å¯¼è‡´è¿›ç¨‹çš„å·¥ä½œç›®å½•æ˜¯çˆ¶è¿›ç¨‹çš„ç›®å½•
    }
};
```

**ç»“æœ**ï¼š
- BsBrowserClient.exe å¯åŠ¨
- å·¥ä½œç›®å½• = `D:\BaiShengVx3Plus\bin\Debug\net8.0-windows\` (çˆ¶è¿›ç¨‹ç›®å½•)
- CEF å°è¯•åŠ è½½ä¾èµ–ï¼šåœ¨å·¥ä½œç›®å½•æŸ¥æ‰¾ `libcef.dll`ã€`locales\` ç­‰
- âŒ æ‰¾ä¸åˆ°æ–‡ä»¶ï¼ˆå®é™…åœ¨ `BrowserClient\` å­ç›®å½•ä¸­ï¼‰
- æŠ¥é”™ï¼š"æ‰¾ä¸åˆ°ç¨‹åºé›†"

### 3. CEF çš„æ–‡ä»¶æŸ¥æ‰¾é€»è¾‘

```
CEF å¯åŠ¨æ—¶ä¼šåœ¨ä»¥ä¸‹ä½ç½®æŸ¥æ‰¾ä¾èµ–æ–‡ä»¶ï¼š
1. å½“å‰å·¥ä½œç›®å½•
2. å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨ç›®å½•
3. ç³»ç»ŸPATHè·¯å¾„

å¦‚æœå·¥ä½œç›®å½•ä¸å¯¹ï¼Œå³ä½¿æ–‡ä»¶åœ¨å¯æ‰§è¡Œæ–‡ä»¶æ—è¾¹ï¼Œä¹Ÿå¯èƒ½æ‰¾ä¸åˆ°ï¼
```

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹ä»£ç ï¼šè®¾ç½® WorkingDirectory

**æ–‡ä»¶**: `BaiShengVx3Plus/Services/AutoBet/BrowserClient.cs`

```csharp
public async Task<bool> StartAsync(int port, string platform, string platformUrl)
{
    try
    {
        // 1. å¯åŠ¨æµè§ˆå™¨è¿›ç¨‹
        var browserDirectory = Path.Combine(
            AppDomain.CurrentDomain.BaseDirectory,
            "BrowserClient");
        
        var browserExePath = Path.Combine(browserDirectory, "BsBrowserClient.exe");
        
        if (!File.Exists(browserExePath))
        {
            throw new FileNotFoundException($"æµè§ˆå™¨ç¨‹åºä¸å­˜åœ¨: {browserExePath}");
        }
        
        _process = new Process
        {
            StartInfo = new ProcessStartInfo
            {
                FileName = browserExePath,
                Arguments = $"--config-id {_configId} --port {port} --platform {platform} --url {platformUrl}",
                WorkingDirectory = browserDirectory, // âœ… å…³é”®ä¿®å¤ï¼
                UseShellExecute = false,
                CreateNoWindow = false
            }
        };
        
        _process.Start();
        // ...
    }
}
```

### å…³é”®å˜åŒ–

**ä¿®å¤å‰**ï¼š
```csharp
var browserExePath = Path.Combine(
    AppDomain.CurrentDomain.BaseDirectory,
    "BrowserClient",
    "BsBrowserClient.exe");

_process = new Process
{
    StartInfo = new ProcessStartInfo
    {
        FileName = browserExePath,
        // âŒ æ²¡æœ‰è®¾ç½® WorkingDirectory
        UseShellExecute = false,
        CreateNoWindow = false
    }
};
```

**ä¿®å¤å**ï¼š
```csharp
var browserDirectory = Path.Combine(
    AppDomain.CurrentDomain.BaseDirectory,
    "BrowserClient");

var browserExePath = Path.Combine(browserDirectory, "BsBrowserClient.exe");

_process = new Process
{
    StartInfo = new ProcessStartInfo
    {
        FileName = browserExePath,
        WorkingDirectory = browserDirectory, // âœ… è®¾ç½®å·¥ä½œç›®å½•
        UseShellExecute = false,
        CreateNoWindow = false
    }
};
```

## ğŸ¯ å·¥ä½œç›®å½•çš„é‡è¦æ€§

### åœºæ™¯å¯¹æ¯”

#### ä¿®å¤å‰ï¼ˆå·¥ä½œç›®å½•é”™è¯¯ï¼‰

```
å¯åŠ¨è¿›ç¨‹ï¼š
  - FileName: D:\...\BrowserClient\BsBrowserClient.exe
  - WorkingDirectory: D:\...\                    â† çˆ¶è¿›ç¨‹ç›®å½•
  
BsBrowserClient.exe è¿è¡Œæ—¶ï¼š
  - å½“å‰ç›®å½•: D:\...\                            â† é”™è¯¯ï¼
  - CEF æŸ¥æ‰¾ä¾èµ–:
      D:\...\libcef.dll                          â† æ‰¾ä¸åˆ°ï¼
      D:\...\locales\zh-CN.pak                   â† æ‰¾ä¸åˆ°ï¼
      D:\...\chrome_100_percent.pak              â† æ‰¾ä¸åˆ°ï¼
  - ç»“æœ: âŒ åˆå§‹åŒ–å¤±è´¥
```

#### ä¿®å¤åï¼ˆå·¥ä½œç›®å½•æ­£ç¡®ï¼‰

```
å¯åŠ¨è¿›ç¨‹ï¼š
  - FileName: D:\...\BrowserClient\BsBrowserClient.exe
  - WorkingDirectory: D:\...\BrowserClient\      â† æµè§ˆå™¨æ‰€åœ¨ç›®å½•
  
BsBrowserClient.exe è¿è¡Œæ—¶ï¼š
  - å½“å‰ç›®å½•: D:\...\BrowserClient\             â† æ­£ç¡®ï¼
  - CEF æŸ¥æ‰¾ä¾èµ–:
      D:\...\BrowserClient\libcef.dll                âœ… æ‰¾åˆ°ï¼
      D:\...\BrowserClient\locales\zh-CN.pak         âœ… æ‰¾åˆ°ï¼
      D:\...\BrowserClient\chrome_100_percent.pak    âœ… æ‰¾åˆ°ï¼
  - ç»“æœ: âœ… åˆå§‹åŒ–æˆåŠŸ
```

## ğŸ“‚ ç›®å½•ç»“æ„

```
BaiShengVx3Plus\bin\Debug\net8.0-windows\
â”œâ”€â”€ BaiShengVx3Plus.exe              â† ä¸»ç¨‹åºï¼ˆçˆ¶è¿›ç¨‹ï¼‰
â”œâ”€â”€ BaiShengVx3Plus.dll
â”‚
â””â”€â”€ BrowserClient\                   â† æµè§ˆå™¨ç›®å½•
    â”œâ”€â”€ BsBrowserClient.exe          â† å­è¿›ç¨‹
    â”œâ”€â”€ BsBrowserClient.dll
    â”‚
    â”œâ”€â”€ libcef.dll                   â† CEF æ ¸å¿ƒï¼ˆ177 MBï¼‰
    â”œâ”€â”€ CefSharp.Core.Runtime.dll
    â”œâ”€â”€ CefSharp.WinForms.dll
    â”œâ”€â”€ CefSharp.BrowserSubprocess.exe
    â”‚
    â”œâ”€â”€ chrome_100_percent.pak
    â”œâ”€â”€ chrome_200_percent.pak
    â”œâ”€â”€ locales\
    â”‚   â”œâ”€â”€ zh-CN.pak
    â”‚   â””â”€â”€ ...
    â””â”€â”€ runtimes\
        â””â”€â”€ ...
```

**å¯åŠ¨æµç¨‹**ï¼š
1. ä¸»ç¨‹åº (`BaiShengVx3Plus.exe`) è¿è¡Œåœ¨ `net8.0-windows\`
2. ç‚¹å‡»[å¯åŠ¨æµè§ˆå™¨]
3. å¯åŠ¨ `BrowserClient\BsBrowserClient.exe`
4. âœ… **è®¾ç½®å·¥ä½œç›®å½•ä¸º `BrowserClient\`**
5. CEF åœ¨å·¥ä½œç›®å½•æŸ¥æ‰¾ä¾èµ–æ–‡ä»¶
6. âœ… æˆåŠŸæ‰¾åˆ° `libcef.dll`ã€`locales\` ç­‰
7. âœ… æµè§ˆå™¨åˆå§‹åŒ–æˆåŠŸ

## ğŸ§ª æµ‹è¯•éªŒè¯

### ç¼–è¯‘

```bash
cd D:\gitcode\wx4helper\BaiShengVx3Plus
dotnet build --configuration Debug
```

**è¾“å‡º**ï¼š
```
âœ… ç¼–è¯‘æˆåŠŸ
```

### è¿è¡Œæµ‹è¯•

1. å¯åŠ¨ `BaiShengVx3Plus.exe`
2. ç™»å½•å¹¶ç»‘å®šç¾¤
3. åœ¨å¿«é€Ÿè®¾ç½®é¢æ¿è¾“å…¥è´¦å·å¯†ç 
4. ç‚¹å‡»**[å¯åŠ¨æµè§ˆå™¨]**

**é¢„æœŸç»“æœ**ï¼š
- âœ… æµè§ˆå™¨çª—å£æ‰“å¼€
- âœ… CEF åˆå§‹åŒ–æˆåŠŸ
- âœ… æ˜¾ç¤º Chrome æµè§ˆå™¨ç•Œé¢
- âœ… æ²¡æœ‰"æ‰¾ä¸åˆ°ç¨‹åºé›†"çš„é”™è¯¯

## ğŸ’¡ ç»éªŒæ•™è®­

### 1. å¯åŠ¨å¤–éƒ¨è¿›ç¨‹æ—¶ï¼Œä¸€å®šè¦è®¾ç½® WorkingDirectory

```csharp
// âŒ é”™è¯¯ï¼šä¾èµ–å·¥ä½œç›®å½•çš„ç¨‹åºå¯èƒ½æ‰¾ä¸åˆ°æ–‡ä»¶
_process = new Process
{
    StartInfo = new ProcessStartInfo
    {
        FileName = "path\\to\\app.exe"
    }
};

// âœ… æ­£ç¡®ï¼šæ˜ç¡®è®¾ç½®å·¥ä½œç›®å½•
_process = new Process
{
    StartInfo = new ProcessStartInfo
    {
        FileName = "path\\to\\app.exe",
        WorkingDirectory = "path\\to\\"  // è®¾ç½®ä¸ºå¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨ç›®å½•
    }
};
```

### 2. CEF ç­‰åŸç”Ÿåº”ç”¨å¯¹å·¥ä½œç›®å½•ç‰¹åˆ«æ•æ„Ÿ

CEFï¼ˆChromium Embedded Frameworkï¼‰ä¼šåœ¨å·¥ä½œç›®å½•æŸ¥æ‰¾ï¼š
- `libcef.dll` (177 MB æ ¸å¿ƒåº“)
- `locales\*.pak` (è¯­è¨€åŒ…)
- `chrome_*.pak` (èµ„æºæ–‡ä»¶)
- `CefSharp.BrowserSubprocess.exe` (å­è¿›ç¨‹)

**å¦‚æœå·¥ä½œç›®å½•ä¸å¯¹ï¼Œå…¨éƒ¨æ‰¾ä¸åˆ°ï¼**

### 3. é”™è¯¯ä¿¡æ¯å¯èƒ½æœ‰è¯¯å¯¼æ€§

```
é”™è¯¯: "æ‰¾ä¸åˆ°ç¨‹åºé›† CefSharp"
çœŸç›¸: CEF ä¾èµ–æ–‡ä»¶ (libcef.dll) æ‰¾ä¸åˆ°ï¼Œä½†é”™è¯¯ä¿¡æ¯æŒ‡å‘ç¨‹åºé›†
```

**æ’æŸ¥æ€è·¯**ï¼š
1. ç¡®è®¤æ–‡ä»¶ç¡®å®å­˜åœ¨
2. æ£€æŸ¥å·¥ä½œç›®å½•æ˜¯å¦æ­£ç¡®
3. ä½¿ç”¨ Process Monitor å·¥å…·æŸ¥çœ‹æ–‡ä»¶è®¿é—®è·¯å¾„

## ğŸ‰ é—®é¢˜è§£å†³

### ä¿®å¤å‰
- âŒ å·¥ä½œç›®å½• = çˆ¶è¿›ç¨‹ç›®å½•
- âŒ CEF æ‰¾ä¸åˆ°ä¾èµ–æ–‡ä»¶
- âŒ åˆå§‹åŒ–å¤±è´¥ï¼š"æ‰¾ä¸åˆ°ç¨‹åºé›†"

### ä¿®å¤å
- âœ… å·¥ä½œç›®å½• = `BrowserClient\`
- âœ… CEF æ­£ç¡®æ‰¾åˆ°æ‰€æœ‰ä¾èµ–
- âœ… åˆå§‹åŒ–æˆåŠŸ
- âœ… æµè§ˆå™¨æ­£å¸¸å¯åŠ¨

## ğŸ“ ç›¸å…³æ–‡æ¡£

- **è‡ªåŠ¨å¤åˆ¶åŠŸèƒ½**: `âœ…è‡ªåŠ¨å¤åˆ¶BsBrowserClientå·²å®Œæˆ.md`
- **å¢é‡å¤åˆ¶ä¼˜åŒ–**: `âœ…æ™ºèƒ½å¢é‡å¤åˆ¶-æ€§èƒ½ä¼˜åŒ–.md`
- **CefSharpä¾èµ–ä¿®å¤**: `âœ…ä¿®å¤CefSharpä¾èµ–-å¢é‡å¤åˆ¶å®Œå–„.md`

## âœ… æ€»ç»“

**æ ¹æœ¬åŸå› **ï¼šå¯åŠ¨å­è¿›ç¨‹æ—¶æ²¡æœ‰è®¾ç½® `WorkingDirectory`ï¼Œå¯¼è‡´ CEF åœ¨é”™è¯¯çš„ç›®å½•æŸ¥æ‰¾ä¾èµ–æ–‡ä»¶ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šè®¾ç½® `WorkingDirectory = browserDirectory`

**ä¸€è¡Œä»£ç ï¼Œè§£å†³å¤§é—®é¢˜ï¼** ğŸ‰

**ç°åœ¨æµè§ˆå™¨å¯ä»¥æ­£å¸¸å¯åŠ¨äº†ï¼** ğŸš€âœ¨

