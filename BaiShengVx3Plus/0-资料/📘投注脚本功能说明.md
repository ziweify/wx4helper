# ğŸ“˜ æŠ•æ³¨è„šæœ¬åŠŸèƒ½è¯´æ˜

## ğŸ“… æ›´æ–°æ—¶é—´

2025-11-08

## ğŸ¯ å½“å‰çŠ¶æ€

**æŠ•æ³¨è„šæœ¬ï¼ˆBetScriptï¼‰å­—æ®µç›®å‰æ˜¯é¢„ç•™åŠŸèƒ½ï¼Œå°šæœªå®é™…ä½¿ç”¨ã€‚**

### ğŸ“ å®šä¹‰ä½ç½®

#### 1. æ•°æ®æ¨¡å‹
**æ–‡ä»¶**: `BaiShengVx3Plus/Models/AutoBet/BetConfig.cs`

```csharp
/// <summary>
/// è‡ªå®šä¹‰æŠ•æ³¨è„šæœ¬ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰
/// </summary>
public string? BetScript { get; set; }
```

#### 2. UI ç•Œé¢
**æ–‡ä»¶**: `BaiShengVx3Plus/Views/AutoBet/BetConfigManagerForm.Designer.cs`

- ä½ç½®ï¼šé«˜çº§è®¾ç½®é¢æ¿
- æ§ä»¶ï¼š`txtBetScript` (å¤šè¡Œæ–‡æœ¬æ¡†)
- æ ‡ç­¾ï¼š`lblBetScript` ("æŠ•æ³¨è„šæœ¬:")
- æ°´å°æç¤ºï¼š"è‡ªå®šä¹‰æŠ•æ³¨è„šæœ¬ï¼ˆé«˜çº§ï¼‰"

**ç•Œé¢ä½ç½®**ï¼š
```
é…ç½®ç®¡ç† â†’ é€‰æ‹©é…ç½® â†’ é«˜çº§è®¾ç½®é¢æ¿ â†’ "æŠ•æ³¨è„šæœ¬" æ–‡æœ¬æ¡†
```

## ğŸ’¡ è®¾è®¡æ„å›¾

### åŸå§‹è®¾æƒ³

æŠ•æ³¨è„šæœ¬å­—æ®µå¯ä»¥ç”¨äºï¼š

1. **è‡ªå®šä¹‰æŠ•æ³¨é€»è¾‘**
   - ç”¨æˆ·å¯ä»¥è¾“å…¥ JavaScript æˆ–ç±»ä¼¼è„šæœ¬
   - è„šæœ¬åœ¨æµè§ˆå™¨ç«¯æ‰§è¡Œ
   - è¦†ç›–é»˜è®¤çš„æŠ•æ³¨è¡Œä¸º

2. **çµæ´»æ€§**
   - ä¸åŒå¹³å°å¯èƒ½æœ‰ä¸åŒçš„æŠ•æ³¨ç­–ç•¥
   - ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ç‰¹æ®Šçš„æŠ•æ³¨è§„åˆ™
   - é€‚åˆé«˜çº§ç”¨æˆ·

### å½“å‰å®ç°

- âœ… æ•°æ®åº“å­—æ®µå·²åˆ›å»º
- âœ… UI ç•Œé¢å·²å®ç°
- âœ… é…ç½®ä¿å­˜/åŠ è½½å·²å®ç°
- âŒ **è„šæœ¬è§£æå’Œæ‰§è¡Œå°šæœªå®ç°**

## ğŸ”§ å¦‚ä½•ä½¿ç”¨ï¼ˆå½“å‰æ–¹æ¡ˆï¼‰

### æ–¹æ¡ˆ 1ï¼šæš‚æ—¶ä¸ä½¿ç”¨ï¼ˆæ¨èï¼‰

**åŸå› **ï¼š
- å½“å‰çš„æŠ•æ³¨é€»è¾‘æ˜¯é€šè¿‡ C# ä»£ç å®ç°çš„
- å‚è€ƒ F5BotV2 çš„æŠ•æ³¨æ–¹æ³•æ›´å¯é 
- è„šæœ¬è§£æå¢åŠ å¤æ‚åº¦

**å»ºè®®**ï¼š
- ä¿ç•™è¿™ä¸ªå­—æ®µï¼Œä»¥å¤‡å°†æ¥æ‰©å±•
- ç›®å‰ä¸“æ³¨äºå®ç°åŸºæœ¬çš„æŠ•æ³¨åŠŸèƒ½
- é€šè¿‡ä¿®æ”¹å¹³å°è„šæœ¬ç±»ï¼ˆå¦‚ `YunDing28Script.cs`ï¼‰æ¥å®šåˆ¶æŠ•æ³¨é€»è¾‘

### æ–¹æ¡ˆ 2ï¼šå®ç°ç®€å•çš„è„šæœ¬åŠŸèƒ½

å¦‚æœæƒ³ä½¿ç”¨æŠ•æ³¨è„šæœ¬ï¼Œå¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

#### 2.1 å®šä¹‰è„šæœ¬æ ¼å¼

**JSON æ ¼å¼ç¤ºä¾‹**ï¼š
```json
{
  "æŠ•æ³¨å‰æ£€æŸ¥": {
    "æœ€å°ä½™é¢": 100,
    "æœ€å¤§å•æ³¨": 1000
  },
  "æŠ•æ³¨ç­–ç•¥": {
    "åˆå¹¶ç›¸åŒå·ç ": true,
    "åˆ†æ‰¹æŠ•æ³¨": false,
    "å»¶è¿ŸæŠ•æ³¨ç§’æ•°": 0
  },
  "è¿‡æ»¤è§„åˆ™": {
    "è·³è¿‡å°é¢è®¢å•": 5,
    "è·³è¿‡å¤§é¢è®¢å•": 5000
  }
}
```

**ç®€å•è„šæœ¬æ ¼å¼ç¤ºä¾‹**ï¼š
```javascript
// æŠ•æ³¨å‰æ£€æŸ¥
if (balance < 100) {
  return "ä½™é¢ä¸è¶³";
}

// è¿‡æ»¤è®¢å•
orders = orders.filter(o => o.Amount >= 5 && o.Amount <= 5000);

// åˆå¹¶è®¢å•
orders = mergeOrders(orders);

// è¿”å›å¤„ç†åçš„è®¢å•
return orders;
```

#### 2.2 å®ç°è„šæœ¬æ‰§è¡Œå™¨

**ä½ç½®**: `BsBrowserClient/Services/BetScriptExecutor.cs`

```csharp
public class BetScriptExecutor
{
    /// <summary>
    /// æ‰§è¡ŒæŠ•æ³¨è„šæœ¬
    /// </summary>
    public List<BetOrder> ExecuteScript(string script, List<BetOrder> orders, decimal balance)
    {
        try
        {
            // æ–¹å¼1: è§£æ JSON é…ç½®
            var config = JsonConvert.DeserializeObject<BetScriptConfig>(script);
            
            // åº”ç”¨è¿‡æ»¤è§„åˆ™
            if (config?.FilterRules?.SkipSmallOrders > 0)
            {
                orders = orders.Where(o => o.Amount >= config.FilterRules.SkipSmallOrders).ToList();
            }
            
            // åº”ç”¨æŠ•æ³¨ç­–ç•¥
            if (config?.BettingStrategy?.MergeSameNumbers == true)
            {
                orders = MergeOrders(orders);
            }
            
            return orders;
        }
        catch
        {
            // è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œè¿”å›åŸå§‹è®¢å•
            return orders;
        }
    }
    
    private List<BetOrder> MergeOrders(List<BetOrder> orders)
    {
        // åˆå¹¶ç›¸åŒå·ç çš„è®¢å•
        var merged = new List<BetOrder>();
        foreach (var order in orders)
        {
            var existing = merged.FirstOrDefault(o => 
                o.PlayType == order.PlayType && 
                o.BetContent == order.BetContent);
            
            if (existing != null)
            {
                existing.Amount += order.Amount;
            }
            else
            {
                merged.Add(order);
            }
        }
        return merged;
    }
}

public class BetScriptConfig
{
    public PreBetCheck? PreBetCheck { get; set; }
    public BettingStrategy? BettingStrategy { get; set; }
    public FilterRules? FilterRules { get; set; }
}

public class PreBetCheck
{
    public decimal MinBalance { get; set; }
    public decimal MaxSingleBet { get; set; }
}

public class BettingStrategy
{
    public bool MergeSameNumbers { get; set; }
    public bool BatchBetting { get; set; }
    public int DelaySeconds { get; set; }
}

public class FilterRules
{
    public decimal SkipSmallOrders { get; set; }
    public decimal SkipLargeOrders { get; set; }
}
```

#### 2.3 åœ¨æŠ•æ³¨å‰è°ƒç”¨è„šæœ¬

**ä½ç½®**: `BsBrowserClient/Form1.cs` - `FetchOrdersAndBetAsync` æ–¹æ³•

```csharp
private async Task<(bool success, string message)> FetchOrdersAndBetAsync(string issueId)
{
    try
    {
        // ... æ‹‰å–è®¢å• ...
        
        OnLogMessage($"âœ… è·å–åˆ° {orders.Count} ä¸ªå¾…æŠ•æ³¨è®¢å•");
        
        // ğŸ”¥ æ‰§è¡ŒæŠ•æ³¨è„šæœ¬ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
        if (!string.IsNullOrEmpty(_betScript))
        {
            OnLogMessage($"ğŸ¬ æ‰§è¡ŒæŠ•æ³¨è„šæœ¬...");
            var executor = new BetScriptExecutor();
            var processedOrders = executor.ExecuteScript(_betScript, orders, _currentBalance);
            
            OnLogMessage($"âœ… è„šæœ¬æ‰§è¡Œå®Œæˆï¼Œå¤„ç†åè®¢å•æ•°:{processedOrders.Count}");
            orders = processedOrders;
        }
        
        // ... ç»§ç»­æŠ•æ³¨ ...
    }
    catch (Exception ex)
    {
        // ...
    }
}
```

### æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ C# ä»£ç å®ç°ï¼ˆæœ€æ¨èï¼‰

**ä¸ä½¿ç”¨è„šæœ¬ï¼Œç›´æ¥åœ¨ä»£ç ä¸­å®ç°æŠ•æ³¨é€»è¾‘**

#### ä¼˜åŠ¿
- âœ… ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥
- âœ… è°ƒè¯•æ–¹ä¾¿
- âœ… æ€§èƒ½å¥½
- âœ… æ˜“äºç»´æŠ¤

#### å®ç°ä½ç½®
**æ–‡ä»¶**: `BsBrowserClient/PlatformScripts/YunDing28Script.cs`

```csharp
public class YunDing28Script : IPlatformScript
{
    public async Task<(bool success, string orderId)> PlaceBetAsync(BetOrder order)
    {
        // è¿™é‡Œå®ç°æŠ•æ³¨é€»è¾‘
        // å‚è€ƒ F5BotV2/BetSite/HongHai/TongBaoMember.cs çš„ Bet() æ–¹æ³•
        
        // 1. åˆå¹¶è®¢å•
        var mergedOrders = MergeOrders(orders);
        
        // 2. ç»„è£…POSTæ•°æ®
        var postData = BuildPostData(mergedOrders);
        
        // 3. å‘é€HTTPè¯·æ±‚
        var response = await httpClient.PostAsync(betUrl, postData);
        
        // 4. è§£æç»“æœ
        return ParseBetResult(response);
    }
    
    private List<BetOrder> MergeOrders(List<BetOrder> orders)
    {
        // å‚è€ƒ F5BotV2 çš„è®¢å•åˆå¹¶é€»è¾‘
        // BetStandardOrderList betitems = new BetStandardOrderList();
        // foreach (var bsOrder in items)
        // {
        //     var last = betitems.LastOrDefault();
        //     if (last != null && last.car == bsOrder.car && last.play == bsOrder.play)
        //     {
        //         last.moneySum += bsOrder.moneySum;
        //     }
        //     else
        //     {
        //         betitems.Add(bsOrder);
        //     }
        // }
        
        return mergedOrders;
    }
}
```

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### å½“å‰é˜¶æ®µï¼ˆç«‹å³å®æ–½ï¼‰

**æ–¹æ¡ˆ 3ï¼šç›´æ¥åœ¨å¹³å°è„šæœ¬ä¸­å®ç°æŠ•æ³¨é€»è¾‘**

1. **å‚è€ƒ F5BotV2**
   - æ–‡ä»¶ï¼š`F5BotV2/BetSite/HongHai/TongBaoMember.cs`
   - æ–¹æ³•ï¼š`Bet(BetStandardOrderList items)`

2. **å®ç°ä½ç½®**
   - `BsBrowserClient/PlatformScripts/YunDing28Script.cs`
   - `BsBrowserClient/PlatformScripts/TongBaoScript.cs`

3. **å®ç°å†…å®¹**
   - è®¢å•åˆå¹¶é€»è¾‘
   - POST æ•°æ®ç»„è£…
   - HTTP è¯·æ±‚å‘é€
   - ç»“æœè§£æ

### æœªæ¥æ‰©å±•ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æ›´çµæ´»çš„æŠ•æ³¨ç­–ç•¥ï¼Œå¯ä»¥ï¼š

1. **å®ç° JSON é…ç½®æ–¹å¼**
   - ç®€å•ã€æ˜“äºç†è§£
   - æ”¯æŒå¸¸è§çš„æŠ•æ³¨ç­–ç•¥
   - ä¸éœ€è¦è„šæœ¬å¼•æ“

2. **ä¿ç•™è„šæœ¬å­—æ®µ**
   - ä½œä¸ºå¤‡ç”¨æ‰©å±•ç‚¹
   - å¯ä»¥å­˜å‚¨æŠ•æ³¨å‚æ•°ï¼ˆJSON æ ¼å¼ï¼‰
   - ä¸æ‰§è¡Œè„šæœ¬ä»£ç ï¼Œåªä½œä¸ºé…ç½®

## ğŸ“Œ æ€»ç»“

### ç°çŠ¶
- âœ… UI å­—æ®µå·²å­˜åœ¨
- âœ… æ•°æ®åº“å­—æ®µå·²å­˜åœ¨
- âŒ åŠŸèƒ½å°šæœªå®ç°

### å»ºè®®
1. **å½“å‰**ï¼šå¿½ç•¥æŠ•æ³¨è„šæœ¬å­—æ®µï¼Œä¸“æ³¨äºå®ç°åŸºæœ¬æŠ•æ³¨åŠŸèƒ½
2. **çŸ­æœŸ**ï¼šå‚è€ƒ F5BotV2 åœ¨å¹³å°è„šæœ¬ç±»ä¸­å®ç°æŠ•æ³¨é€»è¾‘
3. **é•¿æœŸ**ï¼šå¦‚éœ€çµæ´»é…ç½®ï¼Œå¯ä½¿ç”¨ JSON æ ¼å¼å­˜å‚¨æŠ•æ³¨å‚æ•°

### ç¤ºä¾‹ï¼šä½¿ç”¨ BetScript å­˜å‚¨é…ç½®å‚æ•°

```json
{
  "åˆå¹¶è®¢å•": true,
  "æœ€å°æŠ•æ³¨é‡‘é¢": 5,
  "æœ€å¤§æŠ•æ³¨é‡‘é¢": 5000,
  "å»¶è¿ŸæŠ•æ³¨": 0,
  "å¤‡æ³¨": "äº‘é¡¶28é…ç½®"
}
```

åœ¨ä»£ç ä¸­è¯»å–ï¼š
```csharp
var config = JsonConvert.DeserializeObject<Dictionary<string, object>>(betConfig.BetScript);
bool mergeOrders = (bool)config["åˆå¹¶è®¢å•"];
decimal minAmount = (decimal)config["æœ€å°æŠ•æ³¨é‡‘é¢"];
```

---

**ç»“è®º**ï¼šæŠ•æ³¨è„šæœ¬å­—æ®µç›®å‰å¯ä»¥**ä½œä¸ºé…ç½®å‚æ•°å­˜å‚¨**ä½¿ç”¨ï¼Œä½†**ä¸å»ºè®®æ‰§è¡Œè„šæœ¬ä»£ç **ã€‚å»ºè®®åœ¨å¹³å°è„šæœ¬ç±»ä¸­ç”¨ C# ä»£ç å®ç°æŠ•æ³¨é€»è¾‘ï¼Œæ›´å®‰å…¨ã€æ›´æ˜“ç»´æŠ¤ã€‚ğŸ¯

