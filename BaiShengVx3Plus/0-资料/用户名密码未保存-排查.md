# ç”¨æˆ·åå¯†ç æœªä¿å­˜ - é—®é¢˜æ’æŸ¥

## ğŸ› é—®é¢˜ç°è±¡

ç”¨æˆ·åœ¨"å¿«é€Ÿè®¾ç½®"ä¸­è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå…³é—­ç¨‹åºåé‡æ–°æ‰“å¼€ï¼Œç”¨æˆ·åå’Œå¯†ç ä¸¢å¤±ã€‚

---

## ğŸ” ä»£ç æ£€æŸ¥

### âœ… äº‹ä»¶ç»‘å®šæ­£ç¡®

```csharp
// VxMain.cs
txtAutoBetUsername.TextChanged += (s, e) => DebounceSaveSettings();
txtAutoBetPassword.TextChanged += (s, e) => DebounceSaveSettings();
```

### âœ… é˜²æŠ–ä¿å­˜é€»è¾‘æ­£ç¡®

```csharp
private void DebounceSaveSettings()
{
    _saveTimer?.Dispose();
    
    _saveTimer = new System.Threading.Timer(_ =>
    {
        this.Invoke(() =>
        {
            SaveAutoBetSettings();  // 1ç§’åä¿å­˜
            _saveTimer?.Dispose();
            _saveTimer = null;
        });
    }, null, 1000, System.Threading.Timeout.Infinite);
}
```

### âœ… å…³é—­æ—¶å¼ºåˆ¶ä¿å­˜

```csharp
protected override void OnFormClosing(FormClosingEventArgs e)
{
    _saveTimer?.Dispose();
    _saveTimer = null;
    SaveAutoBetSettings();  // ğŸ”¥ å¼ºåˆ¶ä¿å­˜
    // ...
}
```

### âœ… SaveAutoBetSettings é€»è¾‘æ­£ç¡®

```csharp
private void SaveAutoBetSettings()
{
    var defaultConfig = _autoBetService.GetConfigs().FirstOrDefault(c => c.IsDefault);
    
    if (defaultConfig != null)
    {
        defaultConfig.Username = txtAutoBetUsername.Text;
        defaultConfig.Password = txtAutoBetPassword.Text;
        
        _autoBetService.SaveConfig(defaultConfig);  // ä¿å­˜åˆ°æ•°æ®åº“
    }
}
```

---

## ğŸ” å¯èƒ½çš„åŸå› 

### åŸå›  1ï¼šBetConfigBindingList æœªè§¦å‘ PropertyChanged

`BetConfig` ä½¿ç”¨ `BetConfigBindingList` ç®¡ç†ï¼Œä¾èµ– `INotifyPropertyChanged` è‡ªåŠ¨ä¿å­˜ã€‚

ä½†æ˜¯ï¼**ç›´æ¥èµ‹å€¼å­—æ®µä¸ä¼šè§¦å‘ `PropertyChanged`**ï¼š

```csharp
// âŒ è¿™æ ·ä¸ä¼šè§¦å‘ PropertyChanged
defaultConfig.Username = txtAutoBetUsername.Text;
defaultConfig.Password = txtAutoBetPassword.Text;

// éœ€è¦æ£€æŸ¥ BetConfig.Username å’Œ Password æ˜¯å¦å®ç°äº† PropertyChanged
```

è®©æˆ‘æ£€æŸ¥ `BetConfig.cs`ï¼š

```csharp
public class BetConfig : INotifyPropertyChanged
{
    public string Username { get; set; } = "";  // âŒ è‡ªåŠ¨å±æ€§ä¸ä¼šè§¦å‘äº‹ä»¶
    public string Password { get; set; } = "";  // âŒ è‡ªåŠ¨å±æ€§ä¸ä¼šè§¦å‘äº‹ä»¶
    
    public event PropertyChangedEventHandler? PropertyChanged;
}
```

**é—®é¢˜**ï¼š`Username` å’Œ `Password` æ˜¯**è‡ªåŠ¨å±æ€§**ï¼Œèµ‹å€¼æ—¶ä¸ä¼šè§¦å‘ `PropertyChanged` äº‹ä»¶ï¼

---

### åŸå›  2ï¼šSaveConfig è°ƒç”¨åæœªå®é™…å†™å…¥æ•°æ®åº“

`AutoBetService.SaveConfig()` å¯èƒ½æœ‰é—®é¢˜ã€‚

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šBetConfig çš„ Username å’Œ Password æ”¹ä¸ºå®Œæ•´å±æ€§

```csharp
// BaiShengVx3Plus/Models/AutoBet/BetConfig.cs
private string _username = "";
public string Username
{
    get => _username;
    set
    {
        if (_username != value)
        {
            _username = value;
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(Username)));
        }
    }
}

private string _password = "";
public string Password
{
    get => _password;
    set
    {
        if (_password != value)
        {
            _password = value;
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(Password)));
        }
    }
}
```

### æ–¹æ¡ˆ 2ï¼šSaveAutoBetSettings å¼ºåˆ¶æ›´æ–° LastUpdateTime

```csharp
private void SaveAutoBetSettings()
{
    var defaultConfig = _autoBetService.GetConfigs().FirstOrDefault(c => c.IsDefault);
    
    if (defaultConfig != null)
    {
        defaultConfig.Username = txtAutoBetUsername.Text;
        defaultConfig.Password = txtAutoBetPassword.Text;
        defaultConfig.LastUpdateTime = DateTime.Now;  // ğŸ”¥ å¼ºåˆ¶è§¦å‘æ›´æ–°
        
        _autoBetService.SaveConfig(defaultConfig);
        
        _logService.Info("VxMain", $"âœ… å·²ä¿å­˜ç”¨æˆ·å: {defaultConfig.Username}");
    }
}
```

### æ–¹æ¡ˆ 3ï¼šSaveConfig ä¸­å¼ºåˆ¶è°ƒç”¨æ•°æ®åº“ Update

```csharp
// AutoBetService.cs
public void SaveConfig(BetConfig config)
{
    if (_db != null)
    {
        config.LastUpdateTime = DateTime.Now;
        _db.Update(config);  // ğŸ”¥ å¼ºåˆ¶æ›´æ–°åˆ°æ•°æ®åº“
    }
}
```

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

**æ–¹æ¡ˆ 2 + æ–¹æ¡ˆ 3**ï¼š

1. `SaveAutoBetSettings()` ä¸­æ›´æ–° `LastUpdateTime`
2. `AutoBetService.SaveConfig()` ä¸­å¼ºåˆ¶è°ƒç”¨ `_db.Update()`

è¿™æ ·ç¡®ä¿ï¼š
- æ¯æ¬¡ä¿å­˜éƒ½ä¼šè§¦å‘æ•°æ®åº“æ›´æ–°
- ä¸ä¾èµ– `PropertyChanged` äº‹ä»¶
- ç®€å•å¯é 

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. æ£€æŸ¥ `BetConfig.Username` å’Œ `Password` æ˜¯å¦æ˜¯è‡ªåŠ¨å±æ€§
2. å¦‚æœæ˜¯ï¼Œå®æ–½ä¿®å¤æ–¹æ¡ˆ 2 + æ–¹æ¡ˆ 3
3. æµ‹è¯•ï¼šè¾“å…¥ç”¨æˆ·åå¯†ç  â†’ å…³é—­ç¨‹åº â†’ é‡æ–°æ‰“å¼€ â†’ ç¡®è®¤æ•°æ®ä¿å­˜

