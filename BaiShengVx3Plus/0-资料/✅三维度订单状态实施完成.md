# âœ… ä¸‰ç»´åº¦è®¢å•çŠ¶æ€è®¾è®¡å®æ–½å®Œæˆ

## ğŸ¯ å®æ–½ç›®æ ‡

ä¸ºäº†æ”¯æŒæœªæ¥çš„æ‰©å±•éœ€æ±‚ï¼ˆå¦‚ï¼šè“ä¼šä¼šå‘˜é‡‘é¢>500å¤šæ‰“åˆ°é…ç½®Bï¼‰ï¼Œåœ¨è®¢å•ä¸­æ·»åŠ ä¼šå‘˜ç­‰çº§å¿«ç…§ï¼Œå½¢æˆä¸‰ç»´åº¦çŠ¶æ€ç®¡ç†ã€‚

---

## ğŸ“Š æœ€ç»ˆè®¾è®¡

### ä¸‰ä¸ªç»´åº¦

```csharp
public class V2MemberOrder
{
    // ç»´åº¦1ï¼šè®¢å•å¤„ç†æµç¨‹
    public OrderStatus OrderStatus { get; set; }
    
    // ç»´åº¦2ï¼šæŠ•æ³¨å¤„ç†æ–¹å¼ï¼ˆæ‰˜/ç›˜å†…/ç›˜å¤–ï¼‰
    public OrderType OrderType { get; set; }
    
    // ç»´åº¦3ï¼šä¼šå‘˜ç­‰çº§å¿«ç…§ï¼ˆæ‰©å±•å…³é”®ï¼ï¼‰â­
    public MemberState MemberState { get; set; }
}
```

### æšä¸¾å®šä¹‰

```csharp
/// <summary>
/// è®¢å•çŠ¶æ€ï¼ˆå¤„ç†æµç¨‹ï¼‰
/// </summary>
public enum OrderStatus
{
    æœªçŸ¥ = -1,
    å¾…å¤„ç† = 0,     // è®¢å•è¿›æ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰æŠ•é€’è¿›ç½‘ç›˜
    å¾…ç»“ç®— = 1,     // å·²æŠ•æ³¨ï¼Œç­‰å¾…å¼€å¥–ç»“ç®—
    å·²å®Œæˆ = 2,     // ç»“ç®—å®Œæˆ
    å·²å–æ¶ˆ = 3      // å·²å–æ¶ˆ
}

/// <summary>
/// è®¢å•ç±»å‹ï¼ˆå†³å®šç»“ç®—æ–¹å¼å’Œæ˜¯å¦è¿›ç›˜ï¼‰
/// </summary>
public enum OrderType
{
    å¾…å®š = 0,
    ç›˜å†… = 1,       // è¿›ç›˜çš„ï¼Œå°±æ˜¯ç›˜å†…
    ç›˜å¤– = 2,       // æ²¡è¿›ç›˜çš„ï¼Œå°±æ˜¯ç›˜å¤–
    æ‰˜ = 3          // å°±æ˜¯ä¸æ‰“è¿›ç›˜çš„
}

/// <summary>
/// ä¼šå‘˜çŠ¶æ€ï¼ˆåœ¨ Enums.cs ä¸­å·²å­˜åœ¨ï¼‰
/// </summary>
public enum MemberState
{
    å·²åˆ é™¤ = -1,
    éä¼šå‘˜ = 0,
    ä¼šå‘˜ = 1,
    æ‰˜ = 2,
    ç®¡ç† = 3,
    å·²é€€ç¾¤ = 4,
    æ™®ä¼š = 5,
    è“ä¼š = 6,
    ç´«ä¼š = 7,
    é»„ä¼š = 8
}
```

---

## ğŸ’» å®æ–½å†…å®¹

### 1. V2MemberOrder æ¨¡å‹æ›´æ–°

**æ–‡ä»¶ï¼š** `BaiShengVx3Plus/Models/V2MemberOrder.cs`

**æ”¹åŠ¨ï¼š**
```csharp
// æ·»åŠ ç§æœ‰å­—æ®µ
private MemberState _memberState;  // ğŸ”¥ ä¼šå‘˜ç­‰çº§å¿«ç…§

// æ·»åŠ å…¬å…±å±æ€§
[DataGridColumn(HeaderText = "ä¼šå‘˜ç­‰çº§", Width = 70, Order = 14, 
                Alignment = DataGridViewContentAlignment.MiddleCenter)]
public MemberState MemberState
{
    get => _memberState;
    set => SetField(ref _memberState, value);
}
```

**æ•ˆæœï¼š**
- âœ… è®¢å•åˆ—è¡¨ä¼šæ˜¾ç¤º"ä¼šå‘˜ç­‰çº§"åˆ—
- âœ… æ•°æ®åº“ä¼šè‡ªåŠ¨æ·»åŠ  `MemberState` åˆ—ï¼ˆSQLite-netè‡ªåŠ¨å¤„ç†ï¼‰
- âœ… æ”¯æŒæŒ‰ä¼šå‘˜ç­‰çº§æŸ¥è¯¢å’Œç­›é€‰è®¢å•

---

### 2. è®¢å•åˆ›å»ºé€»è¾‘æ›´æ–°

**æ–‡ä»¶ï¼š** `BaiShengVx3Plus/Services/Games/Binggo/BinggoOrderService.cs`

**æ”¹åŠ¨ä½ç½®1ï¼šæ­£å¸¸ä¸‹æ³¨**
```csharp
var order = new V2MemberOrder
{
    // ... å…¶ä»–å­—æ®µ ...
    OrderStatus = OrderStatus.å¾…ç»“ç®—,
    OrderType = OrderType.ç›˜å†…,
    MemberState = member.State,  // ğŸ”¥ è®°å½•ä¼šå‘˜ç­‰çº§å¿«ç…§
    // ... å…¶ä»–å­—æ®µ ...
};
```

**æ”¹åŠ¨ä½ç½®2ï¼šè¡¥å•**
```csharp
var order = new V2MemberOrder
{
    // ... å…¶ä»–å­—æ®µ ...
    MemberState = member.State,  // ğŸ”¥ è®°å½•ä¼šå‘˜ç­‰çº§å¿«ç…§
    Profit = 0,
    IsSettled = false,
    CreatedAt = DateTime.Now
};
```

**æ•ˆæœï¼š**
- âœ… è®¢å•åˆ›å»ºæ—¶è‡ªåŠ¨è®°å½•ä¼šå‘˜å½“æ—¶çš„ç­‰çº§
- âœ… å³ä½¿ä¼šå‘˜åç»­ç­‰çº§å˜æ›´ï¼Œè®¢å•ä¸­ä¿ç•™çš„æ˜¯åˆ›å»ºæ—¶çš„å¿«ç…§

---

### 3. æŠ•æ³¨åè°ƒå™¨å¢å¼º

**æ–‡ä»¶ï¼š** `BaiShengVx3Plus/Services/AutoBet/AutoBetCoordinator.cs`

**æ”¹åŠ¨ï¼š** åœ¨å°ç›˜äº‹ä»¶å¤„ç†ä¸­æ·»åŠ æ‰©å±•ä¸šåŠ¡è§„åˆ™ç¤ºä¾‹

```csharp
// 2. æ‰©å±•ä¸šåŠ¡è§„åˆ™ï¼šæŒ‰ä¼šå‘˜ç­‰çº§å¤„ç†è®¢å•ï¼ˆç¤ºä¾‹ï¼‰
// ä¾‹å¦‚ï¼šè“ä¼šä¼šå‘˜é‡‘é¢>500ï¼Œå¤šæ‰“åˆ°é…ç½®B
var blueMemberLargeOrders = pendingOrders.Where(o =>
    o.MemberState == MemberState.è“ä¼š &&
    o.AmountTotal > 500 &&
    o.OrderType != OrderType.æ‰˜  // æ’é™¤æ‰˜å•
).ToList();

if (blueMemberLargeOrders.Any())
{
    _log.Info("AutoBet", $"ğŸ“¢ æ£€æµ‹åˆ°{blueMemberLargeOrders.Count}ä¸ªè“ä¼šå¤§é¢è®¢å•(>500å…ƒ)");
    // TODO: å¤šæ‰“åˆ°é…ç½®Bçš„é€»è¾‘
    // await DuplicateOrdersToConfigB(blueMemberLargeOrders);
}
```

**æ•ˆæœï¼š**
- âœ… æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `MemberState` å®ç°æ‰©å±•ä¸šåŠ¡è§„åˆ™
- âœ… å¯ä»¥æŒ‰ä¼šå‘˜ç­‰çº§ç­›é€‰è®¢å•
- âœ… å¯ä»¥æŒ‰é‡‘é¢æ¡ä»¶å¤„ç†
- âœ… å¯ä»¥æ’é™¤æ‰˜å•ç­‰ç‰¹æ®Šç±»å‹

---

## ğŸš€ æ‰©å±•åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šè“ä¼šå¤§é¢å¤šæ‰“

```csharp
// æŸ¥è¯¢éœ€è¦å¤šæ‰“çš„è®¢å•
var ordersForDuplication = orders.Where(o =>
    o.MemberState == MemberState.è“ä¼š &&    // è“ä¼š
    o.AmountTotal > 500 &&                   // å¤§é¢
    o.OrderType != OrderType.æ‰˜ &&          // éæ‰˜å•
    o.OrderStatus == OrderStatus.å¾…å¤„ç†      // å¾…å¤„ç†
).ToList();

foreach (var order in ordersForDuplication)
{
    await DuplicateOrderToConfigB(order);
}
```

### åœºæ™¯2ï¼šVIPä¼šå‘˜ç‰¹æ®Šèµ”ç‡

```csharp
// åˆ›å»ºè®¢å•æ—¶æ ¹æ®ä¼šå‘˜ç­‰çº§è®¾ç½®èµ”ç‡
var order = new V2MemberOrder
{
    // ... å…¶ä»–å­—æ®µ ...
    MemberState = member.State,
    Odds = member.State == MemberState.é»„ä¼š ? 2.00f : 1.97f  // VIPèµ”ç‡
};
```

### åœºæ™¯3ï¼šæŒ‰ç­‰çº§ç»Ÿè®¡

```csharp
// ç»Ÿè®¡å„ç­‰çº§ä¼šå‘˜çš„æŠ•æ³¨æƒ…å†µ
var stats = orders
    .Where(o => o.OrderType != OrderType.æ‰˜)  // æ’é™¤æ‰˜å•
    .GroupBy(o => o.MemberState)
    .Select(g => new
    {
        MemberLevel = g.Key,
        TotalOrders = g.Count(),
        TotalAmount = g.Sum(o => o.AmountTotal),
        TotalProfit = g.Sum(o => o.NetProfit)
    })
    .OrderByDescending(s => s.TotalAmount);
```

### åœºæ™¯4ï¼šå¤æ‚æ¡ä»¶æŸ¥è¯¢

```csharp
// æŸ¥è¯¢é»„ä¼šä¼šå‘˜çš„å¤§é¢è®¢å•ï¼Œä¸”æŠ•æ³¨æˆåŠŸçš„
var vipSuccessOrders = orders.Where(o =>
    o.MemberState == MemberState.é»„ä¼š &&
    o.AmountTotal > 1000 &&
    o.OrderType == OrderType.ç›˜å†… &&
    o.OrderStatus == OrderStatus.å·²å®Œæˆ
).ToList();
```

---

## ğŸ“‹ ä¸šåŠ¡è§„åˆ™çŸ©é˜µ

| MemberState | OrderType | æ˜¯å¦æŠ•æ³¨ | æ˜¯å¦ç»Ÿè®¡ | æ˜¯å¦æ‰£ä½™é¢ | ç‰¹æ®Šè§„åˆ™ |
|-------------|-----------|---------|---------|-----------|---------|
| æ™®ä¼š | ç›˜å†… | âœ… | âœ… | âœ… | - |
| æ™®ä¼š | æ‰˜ | âŒ | âŒ | âŒ | - |
| **è“ä¼š** | ç›˜å†… | âœ… | âœ… | âœ… | **é‡‘é¢>500å¤šæ‰“** |
| **è“ä¼š** | æ‰˜ | âŒ | âŒ | âŒ | ä¸å¤šæ‰“ |
| é»„ä¼š | ç›˜å†… | âœ… | âœ… | âœ… | VIPèµ”ç‡ |
| é»„ä¼š | æ‰˜ | âŒ | âŒ | âŒ | - |
| ç®¡ç† | ç›˜å†… | âœ… | âŒ | âŒ | ä¸æ‰£ä½™é¢ |
| ç®¡ç† | æ‰˜ | âŒ | âŒ | âŒ | - |

---

## ğŸ¯ ä¸‰ä¸ªç»´åº¦çš„èŒè´£

### OrderStatus - æµç¨‹çŠ¶æ€
**å›ç­”ï¼šè®¢å•å¤„ç†åˆ°å“ªä¸€æ­¥äº†ï¼Ÿ**
- `å¾…å¤„ç†` â†’ åˆšæ”¶åˆ°è®¢å•ï¼Œç­‰å¾…å°ç›˜æ—¶æŠ•æ³¨
- `å¾…ç»“ç®—` â†’ å·²æŠ•æ³¨æˆåŠŸï¼Œç­‰å¾…å¼€å¥–ç»“ç®—
- `å·²å®Œæˆ` â†’ å·²ç»“ç®—æˆ–å·²æ ‡è®°ä¸ºç›˜å¤–
- `å·²å–æ¶ˆ` â†’ æ‰‹åŠ¨å–æ¶ˆ

**ç”¨é€”ï¼š**
- æŸ¥è¯¢"å¾…å¤„ç†"è®¢å•è¿›è¡ŒæŠ•æ³¨
- æŸ¥è¯¢"å¾…ç»“ç®—"è®¢å•è¿›è¡Œå¼€å¥–ç»“ç®—
- æŸ¥è¯¢"å·²å®Œæˆ"è®¢å•ç”ŸæˆæŠ¥è¡¨

### OrderType - å¤„ç†æ–¹å¼
**å›ç­”ï¼šè¿™ä¸ªè®¢å•è¦æ€ä¹ˆå¤„ç†ï¼Ÿ**
- `ç›˜å†…` â†’ æŠ•æ³¨æˆåŠŸï¼ŒæŒ‰èµ”ç‡ç»“ç®—
- `ç›˜å¤–` â†’ æŠ•æ³¨å¤±è´¥ï¼Œé€€æ¬¾å¤„ç†
- `æ‰˜` â†’ ä¸æŠ•æ³¨ï¼Œæ¨¡æ‹Ÿç»“ç®—ï¼ˆæ‰˜å•ï¼‰

**ç”¨é€”ï¼š**
- åˆ¤æ–­æ˜¯å¦æŠ•æ³¨ï¼ˆæ‰˜å•ä¸æŠ•ï¼‰
- åˆ¤æ–­æ˜¯å¦æ‰£ä½™é¢ï¼ˆæ‰˜å•ä¸æ‰£ï¼‰
- åˆ¤æ–­æ˜¯å¦è®¡å…¥ç»Ÿè®¡ï¼ˆæ‰˜å•ä¸è®¡ï¼‰
- ç»“ç®—æ—¶åŒºåˆ†å¤„ç†æ–¹å¼

### MemberState - ä¼šå‘˜ç­‰çº§ï¼ˆâ­ æ‰©å±•å…³é”®ï¼‰
**å›ç­”ï¼šè¿™ä¸ªè®¢å•æ¥è‡ªä»€ä¹ˆç­‰çº§çš„ä¼šå‘˜ï¼Ÿ**
- `æ™®ä¼š`ã€`è“ä¼š`ã€`ç´«ä¼š`ã€`é»„ä¼š` â†’ ä¸åŒç­‰çº§
- `æ‰˜`ã€`ç®¡ç†` â†’ ç‰¹æ®Šèº«ä»½

**ç”¨é€”ï¼š**
- æŒ‰ç­‰çº§è®¾ç½®ä¸åŒèµ”ç‡
- æŒ‰ç­‰çº§åšå·®å¼‚åŒ–å¤„ç†ï¼ˆå¦‚å¤§é¢å¤šæ‰“ï¼‰
- ç»Ÿè®¡åˆ†æä¸åŒç­‰çº§çš„æŠ•æ³¨æƒ…å†µ
- å®ç°VIPç‰¹æƒåŠŸèƒ½

---

## âœ… æµ‹è¯•æ£€æŸ¥é¡¹

### æ•°æ®åº“æ£€æŸ¥
- [ ] å¯åŠ¨åº”ç”¨ï¼Œç¡®è®¤æ•°æ®åº“è‡ªåŠ¨æ·»åŠ  `MemberState` åˆ—
- [ ] æŸ¥çœ‹è®¢å•åˆ—è¡¨ï¼Œç¡®è®¤æ˜¾ç¤º"ä¼šå‘˜ç­‰çº§"åˆ—
- [ ] åˆ›å»ºæ–°è®¢å•ï¼Œç¡®è®¤ `MemberState` è¢«æ­£ç¡®è®°å½•

### åŠŸèƒ½æ£€æŸ¥
- [ ] åˆ›å»ºä¸åŒç­‰çº§ä¼šå‘˜çš„è®¢å•ï¼ˆæ™®ä¼šã€è“ä¼šã€é»„ä¼šï¼‰
- [ ] ç¡®è®¤è®¢å•åˆ—è¡¨æ­£ç¡®æ˜¾ç¤ºä¼šå‘˜ç­‰çº§
- [ ] æµ‹è¯•å°ç›˜æ—¶çš„è“ä¼šå¤§é¢æ£€æµ‹æ—¥å¿—
- [ ] ç¡®è®¤æŠ•æ³¨æµç¨‹ä¸å—å½±å“

### æ‰©å±•æ£€æŸ¥
- [ ] æŒ‰ä¼šå‘˜ç­‰çº§æŸ¥è¯¢è®¢å•
- [ ] æŒ‰ä¼šå‘˜ç­‰çº§ç»Ÿè®¡æ•°æ®
- [ ] éªŒè¯æ‰˜å•æ’é™¤é€»è¾‘
- [ ] éªŒè¯ä¼šå‘˜ç­‰çº§å˜æ›´åè®¢å•å¿«ç…§ä¸å˜

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. ä¼šå‘˜ç­‰çº§æ˜¯å¿«ç…§
- è®¢å•åˆ›å»ºæ—¶è®°å½•ä¼šå‘˜ç­‰çº§
- ä¼šå‘˜åç»­ç­‰çº§å˜æ›´ä¸å½±å“å·²åˆ›å»ºè®¢å•
- é€‚ç”¨äºå†å²æ•°æ®åˆ†æå’Œå·®å¼‚åŒ–å¤„ç†

### 2. ä¸‰ä¸ªç»´åº¦ç‹¬ç«‹ä½†å…³è”
- `OrderStatus` æ§åˆ¶æµç¨‹
- `OrderType` æ§åˆ¶å¤„ç†æ–¹å¼
- `MemberState` æä¾›æ‰©å±•èƒ½åŠ›
- ä¸‰è€…é…åˆå®ç°å¤æ‚ä¸šåŠ¡è§„åˆ™

### 3. æ‰˜å•çš„ä¸¤ä¸ªå«ä¹‰
- `OrderType.æ‰˜` â†’ è®¢å•ç±»å‹æ˜¯æ‰˜å•ï¼ˆä¸æŠ•æ³¨ï¼‰
- `MemberState.æ‰˜` â†’ ä¼šå‘˜èº«ä»½æ˜¯æ‰˜ï¼ˆä½†å¯èƒ½æœ‰ç›˜å†…/ç›˜å¤–è®¢å•ï¼‰

### 4. ç»Ÿè®¡è§„åˆ™
```csharp
// ç»Ÿè®¡æ—¶æ’é™¤æ‰˜å•å’Œç®¡ç†å‘˜è®¢å•
var validOrders = orders.Where(o =>
    o.OrderType != OrderType.æ‰˜ &&
    o.MemberState != MemberState.æ‰˜ &&
    o.MemberState != MemberState.ç®¡ç†
);
```

---

## ğŸ‰ å®æ–½å®Œæˆ

**å®æ–½æ—¶é—´ï¼š** 2025-11-08

**ç¼–è¯‘çŠ¶æ€ï¼š** âœ… ç¼–è¯‘æˆåŠŸï¼ˆ0ä¸ªé”™è¯¯ï¼Œ23ä¸ªè­¦å‘Šï¼‰

**æ”¹åŠ¨æ–‡ä»¶ï¼š**
1. `BaiShengVx3Plus/Models/V2MemberOrder.cs` - æ·»åŠ  MemberState å­—æ®µ
2. `BaiShengVx3Plus/Services/Games/Binggo/BinggoOrderService.cs` - æ›´æ–°è®¢å•åˆ›å»ºé€»è¾‘
3. `BaiShengVx3Plus/Services/AutoBet/AutoBetCoordinator.cs` - æ·»åŠ æ‰©å±•ä¸šåŠ¡è§„åˆ™ç¤ºä¾‹

**æ•°æ®åº“å˜æ›´ï¼š**
- `V2MemberOrder` è¡¨è‡ªåŠ¨æ·»åŠ  `MemberState` åˆ—ï¼ˆSQLite-netè‡ªåŠ¨å¤„ç†ï¼‰

**UIå˜æ›´ï¼š**
- è®¢å•åˆ—è¡¨å¢åŠ "ä¼šå‘˜ç­‰çº§"åˆ—

---

## ğŸš€ åç»­æ‰©å±•æ–¹å‘

### 1. å®ç°è“ä¼šå¤§é¢å¤šæ‰“
```csharp
private async Task DuplicateOrdersToConfigB(List<V2MemberOrder> orders)
{
    // å®ç°å¤šæ‰“é€»è¾‘
}
```

### 2. å®ç°VIPèµ”ç‡
```csharp
// åœ¨è®¢å•åˆ›å»ºæ—¶æ ¹æ®ä¼šå‘˜ç­‰çº§è®¾ç½®èµ”ç‡
var odds = member.State switch
{
    MemberState.é»„ä¼š => 2.00f,  // VIPèµ”ç‡
    MemberState.è“ä¼š => 1.98f,  // ä¼˜è´¨ä¼šå‘˜
    _ => 1.97f                   // æ™®é€šä¼šå‘˜
};
```

### 3. å®ç°ç­‰çº§æŠ¥è¡¨
```csharp
// ç”ŸæˆæŒ‰ä¼šå‘˜ç­‰çº§åˆ†ç±»çš„æŠ¥è¡¨
public class MemberLevelReport
{
    public MemberState Level { get; set; }
    public int OrderCount { get; set; }
    public decimal TotalBet { get; set; }
    public decimal TotalProfit { get; set; }
}
```

### 4. å®ç°åŠ¨æ€è§„åˆ™å¼•æ“
```csharp
// é…ç½®é©±åŠ¨çš„ä¸šåŠ¡è§„åˆ™
public class BetRule
{
    public MemberState MemberLevel { get; set; }
    public decimal MinAmount { get; set; }
    public string Action { get; set; }  // "å¤šæ‰“", "æå‡èµ”ç‡"ç­‰
}
```

---

**è®¾è®¡å®Œæˆï¼å¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚çµæ´»æ‰©å±•ï¼** ğŸ‰

