# 🧪 快速测试指南

**测试目标：** 验证Cookie回传和投注命令功能  
**预计耗时：** 5分钟

---

## 📝 测试准备

1. **编译项目**
   ```powershell
   dotnet build
   ```

2. **启动VxMain**
   - 等待界面加载完成
   - 确认微信已连接

3. **打开配置管理**
   - 点击顶部工具栏"⚙️ 配置管理"

---

## 🎯 测试步骤

### 测试1：Cookie自动回传 ✅

**步骤：**
1. 在配置管理界面，点击"启动浏览器"按钮
2. 等待浏览器窗口弹出
3. 等待页面加载完成（约3-5秒）
4. 观察日志窗口

**预期结果：**
```
[BrowserClient] 📤 Cookie已回传到VxMain:共X个Cookie
[AutoBetServer] 🍪 收到Cookie更新:配置1
[AutoBet] ✅ 配置1(默认配置) Cookie已更新:共X个
```

**验证方法：**
- 点击配置列表刷新按钮
- 查看Cookie列是否有内容（如：`PHPSESSID=abc...`）

---

### 测试2：Cookie手动获取 ✅

**步骤：**
1. 确保浏览器已启动并登录
2. 在命令面板，点击"获取Cookie"按钮
3. 点击"发送"按钮
4. 查看执行结果区域

**预期结果：**
```
📤 发送命令:获取Cookie
   时间:2025-11-08 13:30:00.000
✅ 返回:成功=True
   消息:获取成功,共X个Cookie
   数据:{
     "url": "https://...",
     "cookies": {
       "PHPSESSID": "abc123",
       "token": "xyz789",
       ...
     },
     "count": X
   }
```

---

### 测试3：投注命令（简单格式） ✅

**步骤：**
1. 确保浏览器已登录
2. 在命令输入框输入：`投注(1大10)`
3. 点击"发送"按钮
4. 查看执行结果

**预期结果：**
```
📤 发送命令:投注(1大10)
   时间:2025-11-08 13:30:00.000
📝 命令:投注
   参数:1大10
[日志] 投注解析:原始=1大10 标准=1大10 金额=10
[日志] BetRecord已创建:ID=1
✅ 返回:成功=True
   消息:投注成功
   数据:{
     "betRecordId": 1,
     "issueId": 114063156,
     "originalContent": "1大10",
     "standardContent": "1大10",
     "totalAmount": 10,
     "betResult": {
       "success": true,
       "postStartTime": "...",
       "postEndTime": "...",
       "durationMs": 125,
       "orderNo": "ORD123456"
     }
   }
```

---

### 测试4：投注命令（连续数字） ✅

**步骤：**
1. 在命令输入框输入：`投注(1234大10)`
2. 点击"发送"按钮
3. 查看执行结果

**预期结果：**
```
📤 发送命令:投注(1234大10)
📝 命令:投注
   参数:1234大10
[日志] 投注解析:原始=1234大10 标准=1大10,2大10,3大10,4大10 金额=40
[日志] BetRecord已创建:ID=2
✅ 返回:成功=True
   消息:投注成功
   数据:{
     "betRecordId": 2,
     "issueId": 114063156,
     "originalContent": "1234大10",
     "standardContent": "1大10,2大10,3大10,4大10",
     "totalAmount": 40,
     ...
   }
```

---

### 测试5：查看数据库记录 ✅

**步骤：**
1. 打开数据库文件：`Data/business_{wxid}.db`
2. 使用SQLite工具（如DB Browser for SQLite）
3. 执行查询：

```sql
-- 查看投注记录
SELECT * FROM BetRecords ORDER BY CreateTime DESC LIMIT 10;

-- 查看Cookie
SELECT Id, ConfigName, Cookies, CookieUpdateTime 
FROM AutoBetConfigs 
WHERE Cookies IS NOT NULL;
```

**预期结果：**
- `BetRecords`表中有投注记录
- `AutoBetConfigs`表中有Cookie数据

---

## ❌ 常见问题排查

### 问题1：Cookie未回传
**症状：** 日志没有"Cookie已回传"消息  
**排查：**
- 检查BrowserClient是否启动成功
- 检查Socket连接是否建立（日志："浏览器已连接"）
- 检查页面是否加载完成
- 查看BrowserClient日志窗口

### 问题2：投注命令失败
**症状：** 返回Success=False  
**排查：**
- 检查BrowserClient是否已登录
- 检查当前期号是否有效（日志："当前期号=X"）
- 检查投注格式是否正确
- 查看ErrorMessage字段

### 问题3：BetRecord未创建
**症状：** 数据库中没有记录  
**排查：**
- 检查BetRecordService是否初始化（日志："投注记录表已初始化"）
- 检查日志是否有"BetRecord已创建"消息
- 检查数据库文件路径是否正确

---

## ✅ 测试通过标准

1. ✅ Cookie自动回传成功（日志显示，数据库有记录）
2. ✅ 手动获取Cookie成功（返回Cookie数据）
3. ✅ 投注命令解析正确（"1234大10" → "1大10,2大10,3大10,4大10"）
4. ✅ BetRecord创建成功（数据库有记录）
5. ✅ 投注结果更新成功（Success、DurationMs、OrderNo等字段已填充）
6. ✅ 日志完整清晰（每个步骤都有对应日志）

---

## 📊 测试报告模板

**测试日期：** 2025-11-08  
**测试人员：** [您的名字]  
**测试环境：** Windows 10, .NET 8.0

| 测试项 | 状态 | 备注 |
|-------|------|------|
| Cookie自动回传 | ✅/❌ |  |
| Cookie手动获取 | ✅/❌ |  |
| 投注命令（简单） | ✅/❌ |  |
| 投注命令（复杂） | ✅/❌ |  |
| 数据库记录 | ✅/❌ |  |

**问题记录：**
- [如有问题，请在此记录]

**总体评价：**
- [通过/不通过]

---

**开始测试吧！🚀**

