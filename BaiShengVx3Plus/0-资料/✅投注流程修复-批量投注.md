# âœ… æŠ•æ³¨æµç¨‹ä¿®å¤ï¼šæ‰¹é‡æŠ•æ³¨ï¼ˆä¸€æ¬¡æ€§POSTï¼‰

**ä¿®å¤æ—¶é—´ï¼š** 2025-11-08 14:00  
**é—®é¢˜ï¼š** æŠ•æ³¨å‘½ä»¤å°†"1å¤§10,2å¤§10,3å¤§10,4å¤§10"æ‹†åˆ†ä¸º4ä¸ªæŠ•æ³¨é¡¹ï¼Œé€ä¸ªæ‰§è¡Œ  
**æ­£ç¡®åšæ³•ï¼š** å‚è€ƒF5BotV2ï¼Œå°†æ‰€æœ‰æŠ•æ³¨é¡¹ç»„è£…æˆä¸€ä¸ªåŒ…ï¼Œä¸€æ¬¡æ€§POST

---

## ğŸ” é—®é¢˜åˆ†æ

### ç”¨æˆ·åé¦ˆ

> ä½ ç†è§£é”™äº†ï¼Œä¸ºä»€ä¹ˆè¦åˆ†æˆ4ä¸ªæŠ•æ³¨é¡¹ç›®ã€‚å¦‚æœè¦åˆ†æˆ4ä¸ªæŠ•æ³¨é¡¹ç›®ï¼Œé‚£è®¢å•è¡¨ç›´æ¥æŠ•æ³¨ä¸å°±å¥½äº†ï¼Œæˆ‘è¿˜åšä¸ªæŠ•æ³¨è¡¨å¹²ä»€ä¹ˆï¼ŒæŠ•æ³¨è¡¨å°±æ˜¯æŠŠè®¢å•è¡¨åˆå¹¶ï¼Œç„¶ååœ¨BrowserClientä¸­ç»„åŒ…åˆæˆä¸€ä¸ªåŒ…ï¼Œå‘é€æ‰€æœ‰è®¢å•å‡ºå»ï¼Œè¯·ä½ ä»”ç»†å‚è€ƒF5BotV2æ˜¯æ€ä¹ˆåšçš„ã€‚

### é”™è¯¯çš„å®ç°ï¼ˆä¿®å¤å‰ï¼‰

```csharp
// âŒ é€ä¸ªæŠ•æ³¨
var items = betContent.Split(',');  // "1å¤§10,2å¤§10,3å¤§10,4å¤§10"
foreach (var item in items)
{
    var betOrder = new BetOrder { BetContent = item };  // "1å¤§10"
    await _platformScript.PlaceBetAsync(betOrder);      // è°ƒç”¨4æ¬¡
}
```

**é—®é¢˜ï¼š**
- å‘é€äº†4ä¸ªHTTPè¯·æ±‚
- è€—æ—¶é•¿ï¼ˆæ¯æ¬¡éƒ½è¦ç­‰å¾…å“åº”ï¼‰
- å¯èƒ½å¯¼è‡´éƒ¨åˆ†æŠ•æ³¨å¤±è´¥
- ä¸ç¬¦åˆF5BotV2çš„è®¾è®¡

---

## âœ… æ­£ç¡®çš„å®ç°ï¼ˆå‚è€ƒF5BotV2ï¼‰

### F5BotV2çš„æŠ•æ³¨æµç¨‹

**æ–‡ä»¶ï¼š** `F5BotV2/BetSite/HongHai/TongBaoMember.cs`

#### 1. åˆå¹¶è®¢å•ï¼ˆLine 333-353ï¼‰
```csharp
//åˆå¹¶è®¢å•
BetStandardOrderList betitems = new BetStandardOrderList();
foreach (var bsOrder in items)
{
    var last = betitems.LastOrDefault();
    if (last == null)
    {
        betitems.Add(bsOrder);
    }
    else
    {
        if (last.car == bsOrder.car && last.play == bsOrder.play)
        {
            last.moneySum += bsOrder.moneySum;  // åˆå¹¶é‡‘é¢
        }
        else
        {
            betitems.Add(bsOrder);
        }
    }
}
```

#### 2. ç»„è£…POSTæ•°æ®åŒ…ï¼ˆLine 359-392ï¼‰
```csharp
List<dynamic> bets = new List<dynamic>();
StringBuilder userdata_buf = new StringBuilder(128);

for (int i = 0; i < betitems.Count; i++)
{
    var ibettem = betitems[i];
    var ods = _Odds.GetOdds(ibettem.car, ibettem.play);
    
    dynamic betdata = new ExpandoObject();
    betdata.id = Conversion.ToInt32(ods.oddsName);
    betdata.money = ibettem.moneySum;
    bets.Add(betdata);  // æ·»åŠ åˆ°åˆ—è¡¨
    userdata_buf.Append($"{ods.carName}{ods.play} ");
}

string arrbet = JsonConvert.SerializeObject(bets);  // âœ… åºåˆ—åŒ–ä¸ºJSONæ•°ç»„
string arrbet_encode = WebUtility.UrlEncode(arrbet);
postPackect.Append($"&arrbet={arrbet_encode}");  // âœ… ä½œä¸ºä¸€ä¸ªå‚æ•°
```

#### 3. ä¸€æ¬¡æ€§POSTï¼ˆLine 408-429ï¼‰
```csharp
string url = $"{urlRoot}/frcomgame/createmainorder";
HttpItem item = new HttpItem()
{
    URL = url,
    Method = "POST",
    Postdata = postdata,  // åŒ…å«æ‰€æœ‰æŠ•æ³¨é¡¹çš„æ•°æ®åŒ…
    ContentType = "application/x-www-form-urlencoded;charset=UTF-8",
};

HttpResult hr = http.GetHtml(item);  // âœ… ä¸€æ¬¡æ€§POST
```

**POSTæ•°æ®æ ¼å¼ï¼š**
```
uuid=10014139&sid=xxx&roomeng=twbingo&pan=A&shuitype=0
&arrbet=[{"id":1,"money":10},{"id":2,"money":10},{"id":3,"money":10},{"id":4,"money":10}]
&grouplabel=&userdata=1å¤§ 2å¤§ 3å¤§ 4å¤§&token=xxx&timestamp=xxx
```

---

## ğŸ”§ æˆ‘ä»¬çš„ä¿®å¤

### ä¿®æ”¹æ–‡ä»¶

#### 1. `BsBrowserClient/Form1.cs` - ä¸æ‹†åˆ†æŠ•æ³¨å†…å®¹

**ä¿®æ”¹å‰ï¼š**
```csharp
var items = betContent.Split(',');  // âŒ æ‹†åˆ†
foreach (var item in items)
{
    var betOrder = new BetOrder { BetContent = item };
    await _platformScript.PlaceBetAsync(betOrder);  // âŒ é€ä¸ªè°ƒç”¨
}
```

**ä¿®æ”¹åï¼š**
```csharp
OnLogMessage($"ğŸ“¦ å‡†å¤‡æŠ•æ³¨:æœŸå·={betIssueId} å†…å®¹={betContent}");

// ğŸ”¥ å°†å®Œæ•´çš„betContentå‘é€ç»™å¹³å°è„šæœ¬
var betOrder = new BetOrder
{
    IssueId = betIssueId,
    BetContent = betContent,  // âœ… "1å¤§10,2å¤§10,3å¤§10,4å¤§10" å®Œæ•´å†…å®¹
    Amount = 0
};

// âœ… åªè°ƒç”¨ä¸€æ¬¡
var (success, orderId) = await _platformScript.PlaceBetAsync(betOrder);
```

#### 2. `BsBrowserClient/PlatformScripts/TongBaoScript.cs` - è§£æå¹¶ç»„åŒ…

**ä¿®æ”¹åï¼š**
```csharp
_logCallback($"ğŸ² å¼€å§‹æŠ•æ³¨: {order.BetContent}");

// ğŸ”¥ è§£ææŠ•æ³¨å†…å®¹ï¼š"1å¤§10,2å¤§10,3å¤§10,4å¤§10"
var items = order.BetContent.Split(',');
var betList = new List<object>();
var userdataList = new List<string>();

foreach (var item in items)
{
    var trimmed = item.Trim();
    // è§£æï¼š1å¤§10 â†’ å·ç =1, ç©æ³•=å¤§, é‡‘é¢=10
    var match = Regex.Match(trimmed, @"^(\d+)(å¤§|å°|å•|åŒ|å°¾å¤§|å°¾å°)(\d+)$");
    if (match.Success)
    {
        var number = match.Groups[1].Value;
        var playType = match.Groups[2].Value;
        var money = int.Parse(match.Groups[3].Value);
        
        var betId = GetBetId($"{number}{playType}");
        betList.Add(new { id = betId, money = money });  // âœ… æ·»åŠ åˆ°åˆ—è¡¨
        userdataList.Add($"{number}{playType}");
        
        _logCallback($"   è§£æ:{number}{playType} é‡‘é¢:{money} ID:{betId}");
    }
}

// ğŸ”¥ ç»„è£…POSTæ•°æ®
var arrbet = JsonConvert.SerializeObject(betList);  // âœ… JSONæ•°ç»„
var arrbet_encoded = System.Web.HttpUtility.UrlEncode(arrbet);
var userdata = string.Join(" ", userdataList);
var userdata_encoded = System.Web.HttpUtility.UrlEncode(userdata);

postData.Append($"&arrbet={arrbet_encoded}");
postData.Append($"&userdata={userdata_encoded}");

// ğŸ”¥ ä¸€æ¬¡æ€§POST
var response = await _httpClient.PostAsync(url, content);
```

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰

```
VxMain â†’ BrowserClient: "1å¤§10,2å¤§10,3å¤§10,4å¤§10"
  â†“
BrowserClientæ‹†åˆ†ä¸º4ä¸ªæŠ•æ³¨ï¼š
  POST 1: "1å¤§10"   â†’ å“åº”1
  POST 2: "2å¤§10"   â†’ å“åº”2
  POST 3: "3å¤§10"   â†’ å“åº”3
  POST 4: "4å¤§10"   â†’ å“åº”4
  â†“
è¿”å›ï¼š4ä¸ªè®¢å•å·
```

**é—®é¢˜ï¼š**
- å‘é€äº†4ä¸ªHTTPè¯·æ±‚
- æ€»è€—æ—¶ = å•æ¬¡è€—æ—¶ Ã— 4
- å¯èƒ½éƒ¨åˆ†å¤±è´¥

### ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰

```
VxMain â†’ BrowserClient: "1å¤§10,2å¤§10,3å¤§10,4å¤§10"
  â†“
BrowserClientè§£æå¹¶ç»„åŒ…ï¼š
  {
    arrbet: [
      {id:1, money:10},
      {id:2, money:10},
      {id:3, money:10},
      {id:4, money:10}
    ]
  }
  â†“
POST 1æ¬¡: åŒ…å«æ‰€æœ‰æŠ•æ³¨  â†’ å“åº”1
  â†“
è¿”å›ï¼š1ä¸ªè®¢å•å·
```

**ä¼˜åŠ¿ï¼š**
- âœ… åªå‘é€1ä¸ªHTTPè¯·æ±‚
- âœ… é€Ÿåº¦å¿«ï¼ˆ1æ¬¡å“åº”ï¼‰
- âœ… å…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å¤±è´¥
- âœ… ç¬¦åˆF5BotV2çš„è®¾è®¡

---

## ğŸ¯ æ•°æ®æµå›¾

### å®Œæ•´æµç¨‹

```
ã€è®¢å•è¡¨ V2MemberOrderã€‘
  å¯Œè´µ: 1å¤§10
  å¯Œè´µ: 2å¤§10
  å°æ˜: 3å¤§10
  å°æ˜: 4å¤§10
      â†“
ã€VxMain - è®¢å•åˆå¹¶ã€‘
  OrderMerger.Merge()
      â†“
ã€æŠ•æ³¨è¡¨ BetRecordã€‘
  IssueId: 114063214
  Source: è®¢å•
  BetContentStandard: "1å¤§10,2å¤§10,3å¤§10,4å¤§10"
  TotalAmount: 40
      â†“
ã€VxMain â†’ BrowserClientã€‘
  Socketå‘½ä»¤: "æŠ•æ³¨"
  Data: {
    issueId: "114063214",
    betContent: "1å¤§10,2å¤§10,3å¤§10,4å¤§10"
  }
      â†“
ã€BrowserClient - æ¥æ”¶ã€‘
  Form1.OnCommandReceived("æŠ•æ³¨")
  betContent = "1å¤§10,2å¤§10,3å¤§10,4å¤§10"
      â†“
ã€BrowserClient â†’ PlatformScriptã€‘
  _platformScript.PlaceBetAsync(betOrder)
  betOrder.BetContent = "1å¤§10,2å¤§10,3å¤§10,4å¤§10"
      â†“
ã€PlatformScript - è§£æç»„åŒ…ã€‘
  TongBaoScript.PlaceBetAsync()
  1. è§£æï¼š["1å¤§10", "2å¤§10", "3å¤§10", "4å¤§10"]
  2. ç»„è£…ï¼š[{id:1,money:10}, {id:2,money:10}, ...]
  3. åºåˆ—åŒ–ï¼šJSONæ•°ç»„
      â†“
ã€HTTP POST - ä¸€æ¬¡æ€§å‘é€ã€‘
  POST /frcomgame/createmainorder
  Body: uuid=xxx&sid=xxx&arrbet=[{...},{...},{...},{...}]&token=xxx
      â†“
ã€å¹³å°å“åº”ã€‘
  {
    "status": true,
    "msg": "ä¸‹æ³¨æˆåŠŸ!",
    "BettingNumber": 7692
  }
      â†“
ã€è¿”å› VxMainã€‘
  BetResult {
    Success: true,
    OrderNo: "7692",
    PostStartTime: xxx,
    PostEndTime: xxx,
    DurationMs: 125
  }
      â†“
ã€æ›´æ–° BetRecordã€‘
  Success = true
  OrderNo = "7692"
  DurationMs = 125
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. **å…³é—­æ‰€æœ‰è¿è¡Œçš„ç¨‹åº**
2. **é‡æ–°ç¼–è¯‘**
   ```bash
   cd D:\gitcode\wx4helper
   dotnet build
   ```
3. **å¯åŠ¨VxMain**
4. **é…ç½®ç®¡ç† â†’ å¯åŠ¨æµè§ˆå™¨ï¼ˆç¡®è®¤å·²ç™»å½•ï¼‰**
5. **å‘½ä»¤é¢æ¿ â†’ è¾“å…¥ï¼š`æŠ•æ³¨(1234å¤§10)`**
6. **è§‚å¯ŸBrowserClientæ—¥å¿—**

### é¢„æœŸæ—¥å¿—

**BrowserClientæ—¥å¿—ï¼š**
```
ğŸ“ æ”¶åˆ°æŠ•æ³¨å‘½ä»¤:æœŸå·114063214 å†…å®¹:1å¤§10,2å¤§10,3å¤§10,4å¤§10
ğŸ“¦ å‡†å¤‡æŠ•æ³¨:æœŸå·=114063214 å†…å®¹=1å¤§10,2å¤§10,3å¤§10,4å¤§10
ğŸ² å¼€å§‹æŠ•æ³¨: 1å¤§10,2å¤§10,3å¤§10,4å¤§10
   è§£æ:1å¤§ é‡‘é¢:10 ID:1
   è§£æ:2å¤§ é‡‘é¢:10 ID:2
   è§£æ:3å¤§ é‡‘é¢:10 ID:3
   è§£æ:4å¤§ é‡‘é¢:10 ID:4
ğŸ“¦ æŠ•æ³¨åŒ…:arrbet=[{"id":1,"money":10},{"id":2,"money":10},{"id":3,"money":10},{"id":4,"money":10}], userdata=1å¤§ 2å¤§ 3å¤§ 4å¤§
ğŸ“¤ å‘é€æŠ•æ³¨è¯·æ±‚: https://xxx/frcomgame/createmainorder
ğŸ“¥ æŠ•æ³¨å“åº”: {"status":true,"msg":"ä¸‹æ³¨æˆåŠŸ!","BettingNumber":7692}
âœ… æŠ•æ³¨æˆåŠŸ: 7692
âœ… æŠ•æ³¨å®Œæˆ:æˆåŠŸ=True è€—æ—¶=125ms è®¢å•å·=7692
ğŸ“Š è¿”å›æ•°æ®:postStartTime=2025-11-08 14:05:00.123, postEndTime=2025-11-08 14:05:00.248
```

**VxMainå‘½ä»¤ç»“æœï¼š**
```
==================================================
âœ… æ‰§è¡Œç»“æœ:æˆåŠŸ=True
   æ¶ˆæ¯:
   è¿”å›æ•°æ®:
{
  "betRecordId": 1,
  "issueId": 114063214,
  "originalContent": "1234å¤§10",
  "standardContent": "1å¤§10,2å¤§10,3å¤§10,4å¤§10",
  "totalAmount": 40.0,
  "betResult": {
    "Success": true,
    "PostStartTime": "2025-11-08 14:05:00.123",  âœ…
    "PostEndTime": "2025-11-08 14:05:00.248",    âœ…
    "DurationMs": 125,                            âœ…
    "OrderNo": "7692"                             âœ…
  }
}
==================================================
```

**å…³é”®æŒ‡æ ‡ï¼š**
- âœ… åªå‘é€1ä¸ªPOSTè¯·æ±‚
- âœ… è€—æ—¶çº¦100-300msï¼ˆå–å†³äºç½‘ç»œï¼‰
- âœ… æ‰€æœ‰æŠ•æ³¨é¡¹ä¸€æ¬¡æ€§æˆåŠŸ
- âœ… è¿”å›å¹³å°è®¢å•å·

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

1. âœ… `BsBrowserClient/Form1.cs` - ä¸æ‹†åˆ†æŠ•æ³¨å†…å®¹ï¼Œæ•´ä½“å‘é€
2. âœ… `BsBrowserClient/PlatformScripts/TongBaoScript.cs` - è§£æå¹¶ç»„åŒ…ï¼Œä¸€æ¬¡æ€§POST
3. âœ… `BaiShengVx3Plus/Services/AutoBet/BrowserClient.cs` - ä¿®å¤ç»“æœè§£æï¼ˆå·²å®Œæˆï¼‰

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### 1. ä¸ºä»€ä¹ˆè¦åœ¨BrowserClientä¸­ç»„åŒ…ï¼Ÿ

- **VxMainçš„èŒè´£ï¼š** è®¢å•åˆå¹¶ï¼Œç”Ÿæˆæ ‡å‡†æŠ•æ³¨å†…å®¹
- **BrowserClientçš„èŒè´£ï¼š** å¹³å°é€‚é…ï¼Œç»„è£…å¹³å°ä¸“ç”¨æ•°æ®åŒ…

### 2. ä¸ºä»€ä¹ˆä¸åœ¨VxMainä¸­ç»„åŒ…ï¼Ÿ

- ä¸åŒå¹³å°çš„POSTæ ¼å¼ä¸åŒ
- VxMainä¸åº”è¯¥å…³å¿ƒå¹³å°ç»†èŠ‚
- ç¬¦åˆ"å•ä¸€èŒè´£åŸåˆ™"

### 3. æŠ•æ³¨è¡¨ï¼ˆBetRecordï¼‰çš„ä½œç”¨

- è®°å½•æŠ•æ³¨å†å²
- è¿½è¸ªæŠ•æ³¨ç»“æœ
- ç»Ÿè®¡åˆ†æ
- ä¸æ˜¯ç”¨æ¥"é€ä¸ªæŠ•æ³¨"çš„

---

**ä¿®å¤å®Œæˆï¼ğŸš€ è¯·é‡æ–°ç¼–è¯‘æµ‹è¯•ï¼**

**å…³é”®æ”¹è¿›ï¼š**
- âœ… ç¬¦åˆF5BotV2çš„è®¾è®¡
- âœ… ä¸€æ¬¡æ€§POSTï¼Œé€Ÿåº¦å¿«
- âœ… é€»è¾‘æ¸…æ™°ï¼ŒèŒè´£æ˜ç¡®
- âœ… æ˜“äºç»´æŠ¤å’Œæ‰©å±•

**æ„Ÿè°¢æ‚¨çš„æŒ‡æ­£ï¼** ğŸ˜Š

