# ğŸ—ï¸ æ¶æ„è®¾è®¡ - æ¥å£åˆ†å±‚è¯´æ˜

## ğŸ“Š æ¥å£åˆ†å±‚è®¾è®¡

### å±‚æ¬¡ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IBsWebApiService (ä¸šåŠ¡æœåŠ¡å±‚)                      â”‚
â”‚  - LoginAsync(username, password)                   â”‚
â”‚  - GetBinggoDataAsync(issueId)                      â”‚
â”‚  - GetBinggoDayDataAsync(date, limit, fill)         â”‚
â”‚  â””â”€ å°è£…ä¸šåŠ¡é€»è¾‘ï¼Œè°ƒç”¨ IBsWebApiClient              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ ä¾èµ–
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IBsWebApiClient (HTTP é€šä¿¡å±‚)                      â”‚
â”‚  - GetAsync<T>(endpoint, parameters)                â”‚
â”‚  - PostAsync<T>(endpoint, data)                     â”‚
â”‚  - SetBaseUrl(baseUrl)                              â”‚
â”‚  - SetSign(sign)                                    â”‚
â”‚  â””â”€ åªè´Ÿè´£ HTTP é€šä¿¡ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ è®¾è®¡ç†å¿µ

### å•ä¸€èŒè´£åŸåˆ™ (SRP)

#### IBsWebApiClient - HTTP é€šä¿¡å±‚
**èŒè´£**ï¼š
- âœ… å‘é€ HTTP è¯·æ±‚ (GET/POST)
- âœ… å¤„ç†ç½‘ç»œå¼‚å¸¸
- âœ… åºåˆ—åŒ–/ååºåˆ—åŒ– JSON
- âœ… ç®¡ç† BaseUrl å’Œ Sign

**ä¸è´Ÿè´£**ï¼š
- âŒ ä¸šåŠ¡é€»è¾‘ï¼ˆç™»å½•ã€è·å–å¼€å¥–æ•°æ®ç­‰ï¼‰
- âŒ æ•°æ®è½¬æ¢ï¼ˆAPI å“åº”è½¬ä¸ºä¸šåŠ¡æ¨¡å‹ï¼‰
- âŒ ç¼“å­˜ç®¡ç†

#### IBsWebApiService - ä¸šåŠ¡æœåŠ¡å±‚
**èŒè´£**ï¼š
- âœ… å°è£…ä¸šåŠ¡é€»è¾‘ï¼ˆç™»å½•ã€è·å–å¼€å¥–æ•°æ®ï¼‰
- âœ… è°ƒç”¨ `IBsWebApiClient` å‘é€è¯·æ±‚
- âœ… æ•°æ®è½¬æ¢ï¼ˆAPI å“åº” â†’ ä¸šåŠ¡æ¨¡å‹ï¼‰
- âœ… ç®¡ç†è®¤è¯çŠ¶æ€ï¼ˆä¿å­˜ Signï¼‰

**ä¸è´Ÿè´£**ï¼š
- âŒ åº•å±‚ HTTP é€šä¿¡ç»†èŠ‚

---

## ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

### 1. çµæ´»æ€§
```csharp
// å¦‚æœéœ€è¦åˆ‡æ¢ HTTP åº“ï¼ˆä¾‹å¦‚ä» HttpClient æ¢æˆ RestSharpï¼‰
// åªéœ€è¦ä¿®æ”¹ BsWebApiClient çš„å®ç°ï¼Œä¸å½±å“ä¸šåŠ¡å±‚
```

### 2. å¯æµ‹è¯•æ€§
```csharp
// æµ‹è¯•ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œå¯ä»¥ Mock IBsWebApiClient
var mockClient = new Mock<IBsWebApiClient>();
mockClient.Setup(x => x.GetAsync<T>(...)).ReturnsAsync(...);

var service = new BsWebApiService(mockClient.Object);
// æµ‹è¯•ä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¾èµ–çœŸå®ç½‘ç»œ
```

### 3. å¯ç»´æŠ¤æ€§
```csharp
// HTTP å±‚å’Œä¸šåŠ¡å±‚åˆ†ç¦»ï¼ŒèŒè´£æ¸…æ™°
// ä¿®æ”¹ä¸€å±‚ä¸ä¼šå½±å“å¦ä¸€å±‚
```

### 4. å¯æ‰©å±•æ€§
```csharp
// å¦‚æœä»¥åéœ€è¦æ”¯æŒå…¶ä»– APIï¼ˆä¾‹å¦‚æ”¯ä»˜ã€çŸ­ä¿¡ï¼‰
// å¯ä»¥å¤ç”¨ IBsWebApiClientï¼Œåªéœ€åˆ›å»ºæ–°çš„ä¸šåŠ¡æœåŠ¡
public interface IPaymentService
{
    // å¤ç”¨ IBsWebApiClient
}
```

---

## ğŸ”§ å®é™…ä½¿ç”¨ç¤ºä¾‹

### IBsWebApiClient - HTTP å±‚

```csharp
public class BsWebApiClient : IBsWebApiClient
{
    private readonly HttpClient _httpClient;
    
    public async Task<BsApiResponse<T>> GetAsync<T>(
        string endpoint, 
        Dictionary<string, string>? parameters = null)
    {
        // åªè´Ÿè´£æ„å»º URLã€å‘é€è¯·æ±‚ã€è§£æå“åº”
        var url = BuildUrl(endpoint, parameters);
        var response = await _httpClient.GetAsync(url);
        var json = await response.Content.ReadAsStringAsync();
        return JsonConvert.DeserializeObject<BsApiResponse<T>>(json);
    }
}
```

### IBsWebApiService - ä¸šåŠ¡å±‚

```csharp
public class BsWebApiService : IBsWebApiService
{
    private readonly IBsWebApiClient _client;
    
    public async Task<BsApiResponse<BsApiUser>> LoginAsync(
        string username, 
        string password)
    {
        // å°è£…ä¸šåŠ¡é€»è¾‘
        var parameters = new Dictionary<string, string>
        {
            { "user", username },
            { "pwd", password }
        };
        
        // è°ƒç”¨ HTTP å±‚
        var response = await _client.GetAsync<BoterLoginResponse>("login", parameters);
        
        // å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ˆä¿å­˜ Signï¼‰
        if (response.Code == 0 && response.Data != null)
        {
            _client.SetSign(response.Data.CSign);
        }
        
        return new BsApiResponse<BsApiUser> { ... };
    }
}
```

---

## ğŸ¨ ä¾èµ–æ³¨å…¥é…ç½®

```csharp
// Program.cs
services.AddHttpClient<IBsWebApiClient, BsWebApiClient>(); // HTTP å±‚
services.AddSingleton<IBsWebApiService, BsWebApiService>(); // ä¸šåŠ¡å±‚
```

---

## ğŸ“ å¯¹æ¯”å…¶ä»–è®¾è®¡

### âŒ ä¸æ¨èï¼šæ‰€æœ‰æ–¹æ³•éƒ½åœ¨ Client å±‚

```csharp
public interface IBsWebApiClient
{
    Task<BsApiResponse<BsApiUser>> LoginAsync(string username, string password);
    Task<BsApiResponse<BinggoLotteryData>> GetBinggoDataAsync(int issueId);
    Task<BsApiResponse<List<BinggoLotteryData>>> GetBinggoDayDataAsync(...);
    // ... 100+ ä¸ªä¸šåŠ¡æ–¹æ³•
}
```

**é—®é¢˜**ï¼š
- âŒ HTTP å±‚æ‰¿æ‹…äº†å¤ªå¤šä¸šåŠ¡èŒè´£
- âŒ æ¥å£è¿‡äºåºå¤§ï¼Œéš¾ä»¥ç»´æŠ¤
- âŒ æµ‹è¯•å›°éš¾
- âŒ æ— æ³•å¤ç”¨ HTTP é€šä¿¡èƒ½åŠ›

### âœ… æ¨èï¼šåˆ†å±‚è®¾è®¡

```csharp
// HTTP å±‚ - ç®€å•ã€é€šç”¨
public interface IBsWebApiClient
{
    Task<BsApiResponse<T>> GetAsync<T>(...);
    Task<BsApiResponse<T>> PostAsync<T>(...);
}

// ä¸šåŠ¡å±‚ - å°è£…ä¸šåŠ¡é€»è¾‘
public interface IBsWebApiService
{
    Task<BsApiResponse<BsApiUser>> LoginAsync(...);
    Task<BsApiResponse<BinggoLotteryData>> GetBinggoDataAsync(...);
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… èŒè´£æ¸…æ™°
- âœ… æ˜“äºæµ‹è¯•
- âœ… æ˜“äºç»´æŠ¤
- âœ… æ˜“äºæ‰©å±•

---

## ğŸ† æ€»ç»“

### æ ¸å¿ƒåŸåˆ™

1. **å•ä¸€èŒè´£**
   - `IBsWebApiClient`: åªè´Ÿè´£ HTTP é€šä¿¡
   - `IBsWebApiService`: è´Ÿè´£ä¸šåŠ¡é€»è¾‘

2. **ä¾èµ–å€’ç½®**
   - `IBsWebApiService` ä¾èµ– `IBsWebApiClient` (æŠ½è±¡)
   - ä¸ä¾èµ–å…·ä½“å®ç°

3. **å¼€é—­åŸåˆ™**
   - å¯¹æ‰©å±•å¼€æ”¾ï¼šå¯ä»¥æ·»åŠ æ–°çš„ä¸šåŠ¡æœåŠ¡
   - å¯¹ä¿®æ”¹å…³é—­ï¼šHTTP å±‚ç¨³å®šï¼Œä¸éœ€è¦é¢‘ç¹ä¿®æ”¹

### ç±»æ¯”ç†è§£

```
IBsWebApiClient = å¿«é€’å‘˜ï¼ˆåªè´Ÿè´£é€è´§ï¼‰
IBsWebApiService = å•†å®¶ï¼ˆè´Ÿè´£æ‰“åŒ…ã€å‘è´§ã€å”®åï¼‰

å¿«é€’å‘˜ä¸éœ€è¦çŸ¥é“åŒ…è£¹é‡Œæ˜¯ä»€ä¹ˆ
å•†å®¶ä¸éœ€è¦çŸ¥é“å¿«é€’å‘˜æ€ä¹ˆé€è´§
```

---

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„æ¥å£è®¾è®¡æˆä¸¤å±‚ï¼** ğŸ‰

**ç°ä»£åŒ–ã€ç®€æ´ã€æ˜“ç»´æŠ¤ï¼** ğŸš€

