# 消息模拟器快速测试脚本

## 🎯 目标

快速验证消息模拟器是否能正常接收所有系统消息。

---

## 📝 测试前准备

### 1. 启用开发模式
```
设置 → 勾选 "开发模式" ✅
```

### 2. 打开消息模拟器
```
选择任意会员 → 右键 → 开发选项 → 发送消息
```

### 3. 打开日志窗口（可选）
```
主界面 → 日志 → 查看实时日志
```

---

## ✅ 测试清单

### 测试 1：倒计时提醒（30秒/15秒）

**等待时机**：距离封盘时间 < 30 秒

**预期结果**：
```
[HH:mm:ss] 系统消息
  123 还剩30秒
  ((消息类型: 封盘提醒))

[HH:mm:ss] 系统消息
  123 还剩15秒
  ((消息类型: 封盘提醒))
```

**日志验证**：
```
⏰ 30秒提醒: 期号 20251209123
🔧 开发模式：已通知消息模拟器显示封盘提醒 - 123 还剩30秒
⏰ 15秒提醒: 期号 20251209123
🔧 开发模式：已通知消息模拟器显示封盘提醒 - 123 还剩15秒
```

**测试状态**：☐ 通过 / ☐ 失败

---

### 测试 2：封盘消息

**等待时机**：封盘时间到达（倒计时 = 0）

**预期结果**：
```
[HH:mm:ss] 系统消息
  123 时间到! 停止进仓! 以此为准!
  张三[10]:大小|计:10
  李四[20]:单双|计:20
  ------线下无效------
  ((消息类型: 封盘))
```

**日志验证**：
```
📢 发送封盘消息: 期号 20251209123
🔧 开发模式：已通知消息模拟器显示封盘消息
```

**测试状态**：☐ 通过 / ☐ 失败

---

### 测试 3：开盘消息

**等待时机**：状态变为"开盘中"（上一期开奖后）

**预期结果**：
```
[HH:mm:ss] 系统消息
  第124队
  ---------线下开始---------
  ((消息类型: 开盘))

[HH:mm:ss] 系统消息
  [图片缩略图]
  ((消息类型: 图片, 描述: 历史记录图片: img_20251209124.jpg, 文件名: img_20251209124.jpg))
```

**日志验证**：
```
📢 开盘处理: 期号 20251209124
🔧 开发模式：已通知消息模拟器显示开盘消息 - 第124队...
📊 开始生成历史记录图片: 期号 20251209124
✅ 图片生成成功: C:\images\img_20251209124.jpg
🖼️ 调用 ShowSystemImage: C:\images\img_20251209124.jpg
```

**⚠️ 注意**：
- 如果是首次启动，可能需要等待一期完整开奖后才能看到开盘消息
- 如果日志中有 `⚠️ 上一期 xxx 尚未结算完成`，这是正常的，开发模式下仍会显示

**测试状态**：☐ 通过 / ☐ 失败

---

### 测试 4：结算消息（中~名单 + 留~名单）

**等待时机**：开奖数据到达

**预期结果 - 中~名单**：
```
[HH:mm:ss] 系统消息
  第123队
  12,34,56,78,90 | 270 大双龙
  ----中~名单----
  张三[110] 90
  李四[130] 100
  ((消息类型: 结算))
```

**预期结果 - 留~名单**：
```
[HH:mm:ss] 系统消息
  第123队
  12,34,56,78,90 | 270 大双龙
  ----留~名单----
  张三 110
  李四 130
  王五 50
  ((消息类型: 结算))
```

**日志验证**：
```
📤 发送中奖名单到群: wxid_xxx
🔧 开发模式：已通知消息模拟器显示中奖名单
📤 发送留分名单到群: wxid_xxx
🔧 开发模式：已通知消息模拟器显示留分名单
✅ 期号 20251209123 结算完成，已发送中~名单和留~名单
```

**测试状态**：☐ 通过 / ☐ 失败

---

## 🐛 常见问题排查

### 问题 1：所有消息都收不到

**原因**：开发模式未启用

**解决**：
```
设置 → 勾选 "开发模式" ✅ → 重启软件
```

**验证**：
日志中应该有：
```
🔧 开发模式：已通知消息模拟器...
```

---

### 问题 2：只有部分消息能收到

**可能原因**：

| 收到的消息 | 收不到的消息 | 原因 |
|-----------|------------|------|
| ✅ 倒计时、封盘 | ❌ 开盘 | 上一期未结算（正常，等一期） |
| ✅ 倒计时、封盘、开盘 | ❌ 结算 | 没有开奖数据 |
| ✅ 倒计时、封盘、开盘、结算 | ❌ 图片 | C:\images\ 目录无权限 |

**解决**：
- 等待一期完整的开奖流程
- 以管理员身份运行软件

---

### 问题 3：消息模拟器窗口关闭后，历史消息丢失

**原因**：
- 这是**设计行为**，不是 BUG
- 消息模拟器不会保存历史消息

**解决**：
- 保持消息模拟器窗口打开
- 或者在日志中查看历史消息

---

### 问题 4：消息显示格式错乱

**检查**：
- 消息内容是否包含 `\r` 换行符？
- 消息模拟器会自动将 `\r` 转换为 `\n` 显示

**示例**：
```
原始消息：第123队\r---------线下开始---------
显示效果：
第123队
---------线下开始---------
```

---

## 📊 完整测试报告模板

```
测试日期：2025-12-09
测试环境：Windows 10, BaiShengVx3Plus v3.2
开发模式：✅ 已启用

测试结果：
1. 倒计时提醒（30秒/15秒）：☐ 通过 / ☐ 失败
2. 封盘消息：☐ 通过 / ☐ 失败
3. 开盘消息：☐ 通过 / ☐ 失败
4. 结算消息（中~名单）：☐ 通过 / ☐ 失败
5. 结算消息（留~名单）：☐ 通过 / ☐ 失败
6. 历史记录图片：☐ 通过 / ☐ 失败

总体评价：☐ 全部通过 / ☐ 部分通过 / ☐ 全部失败

备注：
（记录测试中遇到的问题、日志片段等）
```

---

## 🎓 高级测试

### 测试场景 1：无网络连接

**操作**：
1. 断开网络连接
2. 打开消息模拟器
3. 等待系统消息

**预期**：
- ✅ 倒计时、封盘消息仍然显示（本地计算）
- ❌ 开奖、结算消息不显示（需要 API 数据）

---

### 测试场景 2：未绑定群组

**操作**：
1. 解绑群组
2. 打开消息模拟器
3. 等待系统消息

**预期**：
- ✅ 所有系统消息仍然显示（开发模式不受影响）
- ❌ 微信群不会收到消息

---

### 测试场景 3：微信未登录

**操作**：
1. 微信退出登录
2. 打开消息模拟器
3. 等待系统消息

**预期**：
- ✅ 所有系统消息仍然显示（开发模式不受影响）
- ❌ 微信群不会收到消息

---

**最后更新**：2025-12-09  
**文档版本**：v1.0

