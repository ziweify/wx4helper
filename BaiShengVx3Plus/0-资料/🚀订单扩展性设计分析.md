# ğŸš€ è®¢å•æ‰©å±•æ€§è®¾è®¡åˆ†æ

## ğŸ¯ ä½ æå‡ºçš„æ‰©å±•åœºæ™¯

**ä¸šåŠ¡éœ€æ±‚ï¼š**
> è“ä¼šä¼šå‘˜é‡‘é¢ > 500 æ—¶ï¼ŒæŠŠè®¢å•å¤šæ‰“ä¸€ä»½åˆ°é…ç½®B

### åˆ†æè¿™ä¸ªéœ€æ±‚éœ€è¦ä»€ä¹ˆä¿¡æ¯

**éœ€è¦çŸ¥é“ï¼š**
1. âœ… è¿™ä¸ªè®¢å•çš„ä¼šå‘˜æ˜¯ä»€ä¹ˆç­‰çº§ï¼Ÿï¼ˆè“ä¼šã€æ™®ä¼šã€é»„ä¼š...ï¼‰
2. âœ… è®¢å•é‡‘é¢æ˜¯å¤šå°‘ï¼Ÿ
3. âœ… è¿™æ˜¯ä¸æ˜¯æ‰˜å•ï¼Ÿï¼ˆæ‰˜å•å¯èƒ½ä¸éœ€è¦å¤šæ‰“ï¼‰

**å½“å‰è®¾è®¡èƒ½æ»¡è¶³å—ï¼Ÿ**

### æ–¹æ¡ˆ1ï¼šå½“å‰è®¾è®¡ï¼ˆä¸¤ç»´åº¦ï¼‰

```csharp
public class V2MemberOrder
{
    public OrderStatus OrderStatus { get; set; }
    public OrderType OrderType { get; set; }  // ç›˜å†…/ç›˜å¤–/æ‰˜
}
```

**é—®é¢˜ï¼š**
âŒ æ— æ³•åŒºåˆ†"è“ä¼š"å’Œ"æ™®ä¼š"
âŒ `OrderType` åªæœ‰ï¼šç›˜å†…/ç›˜å¤–/æ‰˜ï¼Œæ²¡æœ‰ä¼šå‘˜ç­‰çº§ä¿¡æ¯

**æŸ¥è¯¢é€»è¾‘ï¼š**
```csharp
// âŒ æ— æ³•å®ç°
var blueMemberOrders = orders.Where(o => 
    o.??? == "è“ä¼š" &&  // æ²¡æœ‰è¿™ä¸ªå­—æ®µï¼
    o.AmountTotal > 500);
```

### æ–¹æ¡ˆ2ï¼šæ·»åŠ  MemberState å­—æ®µï¼ˆä¸‰ç»´åº¦ï¼‰

```csharp
public class V2MemberOrder
{
    public OrderStatus OrderStatus { get; set; }
    public OrderType OrderType { get; set; }      // ç›˜å†…/ç›˜å¤–/æ‰˜
    public MemberState MemberState { get; set; }  // â­ ä¼šå‘˜ç­‰çº§å¿«ç…§
}
```

**æŸ¥è¯¢é€»è¾‘ï¼š**
```csharp
// âœ… å¯ä»¥å®ç°ï¼
var blueMemberOrders = orders.Where(o => 
    o.MemberState == MemberState.è“ä¼š &&  // âœ… æœ‰è¿™ä¸ªå­—æ®µ
    o.AmountTotal > 500);

// å¤šæ‰“ä¸€ä»½åˆ°é…ç½®B
foreach (var order in blueMemberOrders)
{
    await DuplicateOrderToConfigB(order);
}
```

---

## ğŸ’¡ æ‰©å±•æ€§å¯¹æ¯”åˆ†æ

### åœºæ™¯1ï¼šæŒ‰ä¼šå‘˜ç­‰çº§å¤šæ‰“è®¢å•

| æ–¹æ¡ˆ | èƒ½å¦å®ç° | ä»£ç  |
|-----|---------|-----|
| **ä¸¤ç»´åº¦** | âŒ ä¸èƒ½ | æ— æ³•è·å–ä¼šå‘˜ç­‰çº§ |
| **ä¸‰ç»´åº¦** | âœ… å¯ä»¥ | `o.MemberState == è“ä¼š` |

### åœºæ™¯2ï¼šæŒ‰ä¼šå‘˜ç­‰çº§è®¾ç½®ä¸åŒèµ”ç‡

```csharp
// è“ä¼šï¼š1.97  æ™®ä¼šï¼š1.95  é»„ä¼šï¼š2.00
var odds = order.MemberState switch
{
    MemberState.è“ä¼š => 1.97m,
    MemberState.æ™®ä¼š => 1.95m,
    MemberState.é»„ä¼š => 2.00m,
    _ => 1.95m
};
```

| æ–¹æ¡ˆ | èƒ½å¦å®ç° |
|-----|---------|
| **ä¸¤ç»´åº¦** | âŒ ä¸èƒ½ |
| **ä¸‰ç»´åº¦** | âœ… å¯ä»¥ |

### åœºæ™¯3ï¼šç»Ÿè®¡ä¸åŒç­‰çº§ä¼šå‘˜çš„æŠ•æ³¨é¢

```csharp
// ç»Ÿè®¡å„ç­‰çº§ä¼šå‘˜çš„æŠ•æ³¨
var stats = orders.GroupBy(o => o.MemberState)
    .Select(g => new {
        MemberLevel = g.Key,
        TotalBet = g.Sum(o => o.AmountTotal),
        Count = g.Count()
    });
```

| æ–¹æ¡ˆ | èƒ½å¦å®ç° |
|-----|---------|
| **ä¸¤ç»´åº¦** | âŒ ä¸èƒ½ |
| **ä¸‰ç»´åº¦** | âœ… å¯ä»¥ |

### åœºæ™¯4ï¼šVIPä¼šå‘˜è®¢å•ç‰¹æ®Šå¤„ç†

```csharp
// é»„ä¼šæ˜¯VIPï¼Œé‡‘é¢>1000è‡ªåŠ¨å‡çº§èµ”ç‡
if (order.MemberState == MemberState.é»„ä¼š && order.AmountTotal > 1000)
{
    order.Odds = 2.05m;  // VIPèµ”ç‡
}
```

| æ–¹æ¡ˆ | èƒ½å¦å®ç° |
|-----|---------|
| **ä¸¤ç»´åº¦** | âŒ ä¸èƒ½ |
| **ä¸‰ç»´åº¦** | âœ… å¯ä»¥ |

---

## ğŸ¤” ä½†æ˜¯ï¼Œä¼šä¸ä¼šå’Œ OrderType å†²çªï¼Ÿ

### å…³é”®é—®é¢˜ï¼šæ‰˜å•æ€ä¹ˆåŠï¼Ÿ

**æƒ…å†µ1ï¼šæ‰˜å•çš„è“ä¼šä¼šå‘˜**
```csharp
order.MemberState = MemberState.è“ä¼š;  // ä¼šå‘˜ç­‰çº§æ˜¯è“ä¼š
order.OrderType = OrderType.æ‰˜;        // ä½†æ˜¯æ˜¯æ‰˜å•
```

**æ˜¯å¦å¤šæ‰“ï¼Ÿ**
```csharp
// éœ€æ±‚ï¼šè“ä¼š ä¸” é‡‘é¢>500
if (order.MemberState == MemberState.è“ä¼š && order.AmountTotal > 500)
{
    // ä½†æ˜¯è¿™æ˜¯æ‰˜å•ï¼Œè¦å¤šæ‰“å—ï¼Ÿ
    if (order.OrderType != OrderType.æ‰˜)  // â­ å¯ä»¥æ’é™¤æ‰˜å•
    {
        await DuplicateOrder(order);
    }
}
```

**ç»“è®ºï¼š** âœ… ä¸¤ä¸ªå­—æ®µé…åˆä½¿ç”¨ï¼Œæ›´çµæ´»ï¼

---

## ğŸ’¡ æœ€ç»ˆæ¨èæ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šå®Œæ•´ä¸‰ç»´åº¦ï¼ˆæ¨èï¼‰â­

```csharp
/// <summary>
/// è®¢å•çŠ¶æ€ï¼ˆå¤„ç†æµç¨‹ï¼‰
/// </summary>
public enum OrderStatus
{
    æœªçŸ¥ = -1,
    å¾…å¤„ç† = 0,
    å¾…ç»“ç®— = 1,
    å·²å®Œæˆ = 2,
    å·²å–æ¶ˆ = 3
}

/// <summary>
/// è®¢å•ç±»å‹ï¼ˆæŠ•æ³¨å’Œç»“ç®—æ–¹å¼ï¼‰
/// </summary>
public enum OrderType
{
    å¾…å®š = 0,
    ç›˜å†… = 1,       // æŠ•æ³¨æˆåŠŸï¼Œè¿›ç›˜
    ç›˜å¤– = 2,       // æŠ•æ³¨å¤±è´¥ï¼Œæ²¡è¿›ç›˜
    æ‰˜ = 3          // æ‰˜å•ï¼šä¸æŠ•æ³¨
}

/// <summary>
/// ä¼šå‘˜çŠ¶æ€ï¼ˆåœ¨ Enums.cs ä¸­å·²å­˜åœ¨ï¼‰
/// </summary>
public enum MemberState
{
    å·²åˆ é™¤ = -1,
    éä¼šå‘˜ = 0,
    ä¼šå‘˜ = 1,
    æ‰˜ = 2,
    ç®¡ç† = 3,
    å·²é€€ç¾¤ = 4,
    æ™®ä¼š = 5,
    è“ä¼š = 6,
    ç´«ä¼š = 7,
    é»„ä¼š = 8
}

public class V2MemberOrder
{
    // ç»´åº¦1ï¼šè®¢å•å¤„ç†çŠ¶æ€
    public OrderStatus OrderStatus { get; set; }
    
    // ç»´åº¦2ï¼šæŠ•æ³¨ç»“æœ/å¤„ç†æ–¹å¼
    public OrderType OrderType { get; set; }
    
    // ç»´åº¦3ï¼šä¼šå‘˜ç­‰çº§å¿«ç…§ï¼ˆâ­ å…³é”®æ‰©å±•ç‚¹ï¼‰
    public MemberState MemberState { get; set; }
}
```

### ä¸ºä»€ä¹ˆéœ€è¦ä¸‰ç»´åº¦ï¼Ÿ

**1. OrderStatus - æµç¨‹çŠ¶æ€**
- å›ç­”ï¼šè®¢å•å¤„ç†åˆ°å“ªä¸€æ­¥äº†ï¼Ÿ
- ç”¨é€”ï¼šæŸ¥è¯¢å¾…å¤„ç†ã€å¾…ç»“ç®—ã€å·²å®Œæˆ

**2. OrderType - å¤„ç†æ–¹å¼**
- å›ç­”ï¼šè¿™ä¸ªè®¢å•è¦æ€ä¹ˆå¤„ç†ï¼Ÿ
- ç”¨é€”ï¼šåˆ¤æ–­æ˜¯å¦æŠ•æ³¨ã€æ˜¯å¦è®¡å…¥ç»Ÿè®¡ã€æ˜¯å¦æ‰£ä½™é¢

**3. MemberState - ä¼šå‘˜ç­‰çº§ï¼ˆâ­ æ‰©å±•å…³é”®ï¼‰**
- å›ç­”ï¼šè¿™ä¸ªè®¢å•æ¥è‡ªä»€ä¹ˆç­‰çº§çš„ä¼šå‘˜ï¼Ÿ
- ç”¨é€”ï¼šæŒ‰ç­‰çº§ç‰¹æ®Šå¤„ç†ã€å¤šæ‰“è®¢å•ã€å·®å¼‚åŒ–èµ”ç‡

### ä¸‰è€…å…³ç³»

```
è®¢å•åˆ›å»ºæ—¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼šå‘˜ï¼šè“ä¼š (MemberState.è“ä¼š)    â”‚
â”‚ çŠ¶æ€ï¼šæ‰˜ (Member.State = æ‰˜)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ åˆ›å»ºè®¢å•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OrderStatus = å¾…å¤„ç†              â”‚
â”‚ OrderType = æ‰˜                    â”‚ â† æ ¹æ®ä¼šå‘˜å½“å‰çŠ¶æ€
â”‚ MemberState = è“ä¼š                â”‚ â† è®°å½•ä¼šå‘˜ç­‰çº§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‚¹ï¼š**
- `OrderType` å¯èƒ½æ˜¯"æ‰˜"ï¼ˆä» `Member.State = æ‰˜` æ¨å¯¼ï¼‰
- `MemberState` å¯èƒ½æ˜¯"è“ä¼š"ï¼ˆä»ä¼šå‘˜ç­‰çº§æ¨å¯¼ï¼‰
- ä¸¤ä¸ªä¿¡æ¯ç‹¬ç«‹ä¸”éƒ½æœ‰ç”¨ï¼

---

## ğŸ“Š å®Œæ•´çš„ä¸šåŠ¡è§„åˆ™çŸ©é˜µ

| MemberState | OrderType | æ˜¯å¦æŠ•æ³¨ | æ˜¯å¦ç»Ÿè®¡ | æ˜¯å¦æ‰£ä½™é¢ | ç‰¹æ®Šè§„åˆ™ |
|-------------|-----------|---------|---------|-----------|---------|
| æ™®ä¼š | ç›˜å†… | âœ… | âœ… | âœ… | - |
| æ™®ä¼š | æ‰˜ | âŒ | âŒ | âŒ | - |
| **è“ä¼š** | ç›˜å†… | âœ… | âœ… | âœ… | **é‡‘é¢>500å¤šæ‰“** |
| **è“ä¼š** | æ‰˜ | âŒ | âŒ | âŒ | ä¸å¤šæ‰“ |
| é»„ä¼š | ç›˜å†… | âœ… | âœ… | âœ… | VIPèµ”ç‡ |
| é»„ä¼š | æ‰˜ | âŒ | âŒ | âŒ | - |

---

## ğŸ’» ä»£ç å®ç°ç¤ºä¾‹

### åˆ›å»ºè®¢å•

```csharp
public V2MemberOrder CreateOrder(V2Member member, string betContent, decimal amount)
{
    var order = new V2MemberOrder
    {
        OrderStatus = OrderStatus.å¾…å¤„ç†,
        MemberState = member.State,  // â­ è®°å½•ä¼šå‘˜ç­‰çº§å¿«ç…§
        
        // æ ¹æ®ä¼šå‘˜å½“å‰çŠ¶æ€è®¾ç½®è®¢å•ç±»å‹
        OrderType = member.State == MemberState.æ‰˜ 
            ? OrderType.æ‰˜ 
            : OrderType.å¾…å®š
    };
    
    return order;
}
```

### æ‰©å±•ä¸šåŠ¡è§„åˆ™

```csharp
// å°ç›˜æ—¶å¤„ç†è®¢å•
public async Task ProcessOrdersOnSealing(int issueId)
{
    var orders = GetPendingOrders(issueId);
    
    foreach (var order in orders)
    {
        // 1. åŸºæœ¬æŠ•æ³¨é€»è¾‘
        if (order.OrderType == OrderType.æ‰˜)
        {
            order.OrderStatus = OrderStatus.å¾…ç»“ç®—;
            continue;  // æ‰˜å•ä¸æŠ•æ³¨
        }
        
        // 2. æ‰©å±•ï¼šè“ä¼šä¼šå‘˜å¤§é¢è®¢å•å¤šæ‰“
        if (order.MemberState == MemberState.è“ä¼š && 
            order.AmountTotal > 500 &&
            order.OrderType != OrderType.æ‰˜)  // æ’é™¤æ‰˜å•
        {
            await DuplicateOrderToConfigB(order);
            Log.Info($"è“ä¼šå¤§é¢è®¢å•å¤šæ‰“åˆ°é…ç½®B: {order.Id}");
        }
        
        // 3. æ‰©å±•ï¼šé»„ä¼šVIPèµ”ç‡
        if (order.MemberState == MemberState.é»„ä¼š && 
            order.AmountTotal > 1000)
        {
            order.Odds = 2.05m;  // VIPèµ”ç‡
            Log.Info($"é»„ä¼šVIPè®¢å•ä½¿ç”¨ç‰¹æ®Šèµ”ç‡: {order.Id}");
        }
        
        // 4. æ­£å¸¸æŠ•æ³¨
        var betResult = await BetAsync(order);
        order.OrderStatus = OrderStatus.å¾…ç»“ç®—;
        order.OrderType = betResult.Success ? OrderType.ç›˜å†… : OrderType.ç›˜å¤–;
    }
}
```

### ç»Ÿè®¡æŸ¥è¯¢

```csharp
// æŒ‰ä¼šå‘˜ç­‰çº§ç»Ÿè®¡
public Dictionary<MemberState, OrderStatistics> GetStatisticsByMemberLevel()
{
    return orders
        .Where(o => o.OrderType != OrderType.æ‰˜)  // æ’é™¤æ‰˜å•
        .GroupBy(o => o.MemberState)
        .ToDictionary(
            g => g.Key,
            g => new OrderStatistics
            {
                TotalOrders = g.Count(),
                TotalAmount = g.Sum(o => o.AmountTotal),
                TotalProfit = g.Sum(o => o.NetProfit)
            }
        );
}

// æŸ¥è¯¢éœ€è¦å¤šæ‰“çš„è®¢å•
public List<V2MemberOrder> GetOrdersForDuplication()
{
    return orders.Where(o =>
        o.MemberState == MemberState.è“ä¼š &&    // è“ä¼š
        o.AmountTotal > 500 &&                   // å¤§é¢
        o.OrderType != OrderType.æ‰˜ &&          // éæ‰˜å•
        o.OrderStatus == OrderStatus.å¾…å¤„ç†      // å¾…å¤„ç†
    ).ToList();
}
```

---

## ğŸ¯ ç»“è®º

### ä½ çš„æ‹…å¿§å®Œå…¨æ­£ç¡®ï¼

**ä¸¤ç»´åº¦è®¾è®¡çš„å±€é™ï¼š**
- âŒ æ— æ³•æŒ‰ä¼šå‘˜ç­‰çº§åšå·®å¼‚åŒ–å¤„ç†
- âŒ æ— æ³•å®ç°"è“ä¼šå¤§é¢å¤šæ‰“"è¿™æ ·çš„æ‰©å±•éœ€æ±‚
- âŒ æ— æ³•ç»Ÿè®¡ä¸åŒç­‰çº§ä¼šå‘˜çš„æ•°æ®

**ä¸‰ç»´åº¦è®¾è®¡çš„ä¼˜åŠ¿ï¼š**
- âœ… å¯ä»¥æŒ‰ä¼šå‘˜ç­‰çº§ç‰¹æ®Šå¤„ç†
- âœ… å¯ä»¥å®ç°å„ç§å¤æ‚çš„æ‰©å±•è§„åˆ™
- âœ… å¯ä»¥åšè¯¦ç»†çš„åˆ†çº§ç»Ÿè®¡
- âœ… æ¯ä¸ªç»´åº¦èŒè´£æ¸…æ™°ï¼Œäº’ä¸å¹²æ‰°

### æœ€ç»ˆæ¨èï¼šä¸‰ç»´åº¦è®¾è®¡

```csharp
public class V2MemberOrder
{
    public OrderStatus OrderStatus { get; set; }    // æµç¨‹çŠ¶æ€
    public OrderType OrderType { get; set; }        // å¤„ç†æ–¹å¼
    public MemberState MemberState { get; set; }    // ä¼šå‘˜ç­‰çº§ â­
}
```

### ä¸‰ä¸ªç»´åº¦çš„ä»·å€¼

1. **OrderStatus** - å¿…éœ€ï¼ˆæµç¨‹æ§åˆ¶ï¼‰
2. **OrderType** - å¿…éœ€ï¼ˆä¸šåŠ¡è§„åˆ™ï¼šæ‰˜/ç›˜å†…/ç›˜å¤–ï¼‰
3. **MemberState** - **æ‰©å±•å…³é”®**ï¼ˆå·®å¼‚åŒ–å¤„ç†ï¼‰

---

**ç°åœ¨è¦å®æ–½ä¸‰ç»´åº¦è®¾è®¡å—ï¼Ÿ** ğŸš€

**æ”¹åŠ¨ç‚¹ï¼š**
1. åœ¨ `V2MemberOrder` ä¸­æ·»åŠ  `MemberState` å­—æ®µ
2. åˆ›å»ºè®¢å•æ—¶è®°å½• `member.State` åˆ° `order.MemberState`
3. æ•°æ®åº“ä¼šè‡ªåŠ¨æ·»åŠ è¿™ä¸ªåˆ—ï¼ˆSQLite-netè‡ªåŠ¨å¤„ç†ï¼‰
4. ç¼–è¯‘é€šè¿‡åï¼Œå°±å¯ä»¥å®ç°ä½ çš„æ‰©å±•éœ€æ±‚äº†ï¼

**æˆ‘å¯ä»¥ç«‹å³å¸®ä½ å®æ–½ï¼** ğŸ˜Š

