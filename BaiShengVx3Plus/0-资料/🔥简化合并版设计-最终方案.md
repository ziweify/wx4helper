# ğŸ”¥ ç®€åŒ–åˆå¹¶ç‰ˆè®¾è®¡ - æœ€ç»ˆæ–¹æ¡ˆ

## ğŸ’¡ æ‚¨çš„ç–‘é—®

### é—®é¢˜1: ä¸ºä»€ä¹ˆåˆ†ä¸¤å±‚ï¼Ÿ
**æ‚¨è¯´å¾—å¯¹ï¼BetConfigManager å’Œ AutoBetService å¯ä»¥åˆå¹¶ï¼**

#### åˆ†ä¸¤å±‚çš„é—®é¢˜ï¼š
- âŒ å¢åŠ å¤æ‚åº¦
- âŒ èŒè´£ä¸æ¸…æ™°
- âŒ é…ç½®å’ŒæœåŠ¡æ··æ·†
- âŒ ç»´æŠ¤æˆæœ¬é«˜

#### åˆå¹¶åçš„ä¼˜åŠ¿ï¼š
- âœ… ç®€å•ç›´æ¥
- âœ… èŒè´£æ˜ç¡®
- âœ… ä»£ç æ›´å°‘
- âœ… æ˜“äºç†è§£å’Œç»´æŠ¤

---

## ğŸ¯ å‚è€ƒ F5BotV2 çš„è®¾è®¡

### F5BotV2 çš„æ ¸å¿ƒè®¾è®¡

```
BoterServices (å•ä¸€æœåŠ¡ç±»)
    â”‚
    â”œâ”€â–º BetSiteFactory.Create(BetSiteType, IBrowser)
    â”‚      â”‚
    â”‚      â”œâ”€ å…ƒå®‡å®™2 â†’ YYZ2Member
    â”‚      â”œâ”€ æµ·å³¡ â†’ HX666
    â”‚      â”œâ”€ QT â†’ QtBet
    â”‚      â”œâ”€ èŒ…å° â†’ Mt168Member
    â”‚      â””â”€ ... â†’ æ›´å¤šå¹³å°
    â”‚
    â””â”€â–º IBetApi (ç»Ÿä¸€æ¥å£)
           â”œâ”€ LoginAsync()
           â”œâ”€ Bet()
           â”œâ”€ GetUserInfo()
           â””â”€ GetOdds()
```

### å…³é”®è®¾è®¡åŸåˆ™

1. **å·¥å‚æ¨¡å¼**: `BetSiteFactory` æ ¹æ®ç±»å‹åˆ›å»ºä¸åŒå¹³å°å®ä¾‹
2. **ç»Ÿä¸€æ¥å£**: æ‰€æœ‰å¹³å°å®ç° `IBetApi` æ¥å£
3. **ä¾èµ–æµè§ˆå™¨**: æ¯ä¸ªå¹³å°å®ä¾‹æŒæœ‰ä¸€ä¸ªæµè§ˆå™¨å®ä¾‹
4. **é…ç½®é©±åŠ¨**: æ ¹æ®é…ç½®å‚æ•°åˆ›å»ºå’Œåˆ‡æ¢å¹³å°

---

## âœ… æœ€ç»ˆç®€åŒ–æ–¹æ¡ˆ

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              VxMain (ä¸»çª—å£)                     â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AutoBetManager (å”¯ä¸€æ ¸å¿ƒç±»)              â”‚ â”‚
â”‚  â”‚                                            â”‚ â”‚
â”‚  â”‚  â€¢ Dictionary<int, BrowserContext>        â”‚ â”‚
â”‚  â”‚    é…ç½®ID â†’ æµè§ˆå™¨ä¸Šä¸‹æ–‡                  â”‚ â”‚
â”‚  â”‚                                            â”‚ â”‚
â”‚  â”‚  â€¢ LoadConfigs()                          â”‚ â”‚
â”‚  â”‚  â€¢ SaveConfig()                           â”‚ â”‚
â”‚  â”‚  â€¢ StartBrowser(configId)                 â”‚ â”‚
â”‚  â”‚  â€¢ PlaceBet(configId, order)              â”‚ â”‚
â”‚  â”‚  â€¢ GetBalance(configId)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                              â”‚
â”‚                  â”‚ åˆ›å»º/ç®¡ç†                    â”‚
â”‚                  â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  BrowserContext (æµè§ˆå™¨ä¸Šä¸‹æ–‡)            â”‚ â”‚
â”‚  â”‚                                            â”‚ â”‚
â”‚  â”‚  â€¢ Config: BetConfig                      â”‚ â”‚
â”‚  â”‚  â€¢ Browser: ChromiumWebBrowser            â”‚ â”‚
â”‚  â”‚  â€¢ Platform: IPlatformScript              â”‚ â”‚
â”‚  â”‚  â€¢ Status: è¿è¡ŒçŠ¶æ€                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                              â”‚
â”‚                  â”‚ å·¥å‚åˆ›å»º                     â”‚
â”‚                  â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PlatformScriptFactory                    â”‚ â”‚
â”‚  â”‚                                            â”‚ â”‚
â”‚  â”‚  Create(platform) â†’ IPlatformScript       â”‚ â”‚
â”‚  â”‚    â”œâ”€ YunDing28 â†’ YunDing28Script         â”‚ â”‚
â”‚  â”‚    â”œâ”€ BingGo28  â†’ BingGo28Script          â”‚ â”‚
â”‚  â”‚    â””â”€ KuaiLe8   â†’ KuaiLe8Script           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒç±»è®¾è®¡

### 1ï¸âƒ£ AutoBetManagerï¼ˆå”¯ä¸€æ ¸å¿ƒç±»ï¼‰

```csharp
namespace BaiShengVx3Plus.Services.AutoBet
{
    /// <summary>
    /// è‡ªåŠ¨æŠ•æ³¨ç®¡ç†å™¨ - ç»Ÿä¸€ç®¡ç†é…ç½®ã€æµè§ˆå™¨ã€å¹³å°
    /// </summary>
    public class AutoBetManager : IDisposable
    {
        private readonly SQLiteConnection _db;
        private readonly ILogService _logService;
        
        // ğŸ”¥ æ ¸å¿ƒï¼šé…ç½®ID â†’ æµè§ˆå™¨ä¸Šä¸‹æ–‡
        private readonly Dictionary<int, BrowserContext> _contexts;
        
        // ğŸ”¥ é…ç½®ç¼“å­˜ï¼ˆé¿å…é¢‘ç¹è¯»æ•°æ®åº“ï¼‰
        private readonly Dictionary<int, BetConfig> _configsCache;
        
        public AutoBetManager(SQLiteConnection db, ILogService logService)
        {
            _db = db;
            _logService = logService;
            _contexts = new Dictionary<int, BrowserContext>();
            _configsCache = new Dictionary<int, BetConfig>();
            
            // åˆ›å»ºè¡¨
            _db.CreateTable<BetConfig>();
            _db.CreateTable<BetOrderRecord>();
            
            // ç¡®ä¿é»˜è®¤é…ç½®å­˜åœ¨
            EnsureDefaultConfig();
        }
        
        #region é…ç½®ç®¡ç†
        
        /// <summary>
        /// è·å–æ‰€æœ‰é…ç½®
        /// </summary>
        public List<BetConfig> GetConfigs()
        {
            var configs = _db.Table<BetConfig>()
                .OrderBy(c => c.IsDefault ? 0 : 1)
                .ThenBy(c => c.Id)
                .ToList();
            
            // æ›´æ–°ç¼“å­˜
            _configsCache.Clear();
            foreach (var config in configs)
            {
                _configsCache[config.Id] = config;
            }
            
            return configs;
        }
        
        /// <summary>
        /// è·å–é…ç½®
        /// </summary>
        public BetConfig? GetConfig(int configId)
        {
            // å…ˆæŸ¥ç¼“å­˜
            if (_configsCache.TryGetValue(configId, out var config))
                return config;
            
            // æŸ¥æ•°æ®åº“
            config = _db.Find<BetConfig>(configId);
            if (config != null)
            {
                _configsCache[configId] = config;
            }
            return config;
        }
        
        /// <summary>
        /// ä¿å­˜é…ç½®
        /// </summary>
        public void SaveConfig(BetConfig config)
        {
            config.LastUpdateTime = DateTime.Now;
            
            if (config.Id > 0)
            {
                _db.Update(config);
            }
            else
            {
                _db.Insert(config);
                config.Id = (int)_db.ExecuteScalar<long>("SELECT last_insert_rowid()");
            }
            
            // æ›´æ–°ç¼“å­˜
            _configsCache[config.Id] = config;
            
            // ğŸ”¥ å¦‚æœæµè§ˆå™¨å·²å¯åŠ¨ï¼Œé‡æ–°åº”ç”¨é…ç½®
            if (_contexts.TryGetValue(config.Id, out var context))
            {
                context.ApplyConfig(config);
            }
        }
        
        /// <summary>
        /// åˆ é™¤é…ç½®
        /// </summary>
        public bool DeleteConfig(int configId)
        {
            var config = GetConfig(configId);
            if (config == null || config.IsDefault)
                return false;
            
            // å…ˆåœæ­¢æµè§ˆå™¨
            StopBrowser(configId);
            
            // åˆ é™¤é…ç½®
            _db.Delete<BetConfig>(configId);
            _configsCache.Remove(configId);
            
            _logService.Info("AutoBetManager", $"å·²åˆ é™¤é…ç½®: {config.ConfigName}");
            return true;
        }
        
        #endregion
        
        #region æµè§ˆå™¨æ§åˆ¶
        
        /// <summary>
        /// ğŸ”¥ å¯åŠ¨æµè§ˆå™¨ï¼ˆæ ¹æ®é…ç½®ï¼‰
        /// </summary>
        public async Task<bool> StartBrowserAsync(int configId)
        {
            try
            {
                var config = GetConfig(configId);
                if (config == null)
                {
                    _logService.Error("AutoBetManager", $"é…ç½®ä¸å­˜åœ¨: {configId}");
                    return false;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²å¯åŠ¨
                if (_contexts.ContainsKey(configId))
                {
                    _logService.Warning("AutoBetManager", $"æµè§ˆå™¨å·²å¯åŠ¨: {config.ConfigName}");
                    return true;
                }
                
                _logService.Info("AutoBetManager", 
                    $"ğŸš€ å¯åŠ¨æµè§ˆå™¨: [{config.ConfigName}] - {config.Platform}");
                
                // ğŸ”¥ åˆ›å»ºæµè§ˆå™¨ä¸Šä¸‹æ–‡
                var context = new BrowserContext(config, _logService);
                await context.InitializeAsync();
                
                // ä¿å­˜ä¸Šä¸‹æ–‡
                _contexts[configId] = context;
                
                // æ›´æ–°çŠ¶æ€
                config.Status = "å·²å¯åŠ¨";
                SaveConfig(config);
                
                // è‡ªåŠ¨ç™»å½•
                if (config.AutoLogin && !string.IsNullOrEmpty(config.Username))
                {
                    await LoginAsync(configId, config.Username, config.Password);
                }
                
                _logService.Info("AutoBetManager", $"âœ… æµè§ˆå™¨å¯åŠ¨æˆåŠŸ: {config.ConfigName}");
                return true;
            }
            catch (Exception ex)
            {
                _logService.Error("AutoBetManager", $"å¯åŠ¨æµè§ˆå™¨å¤±è´¥: {configId}", ex);
                return false;
            }
        }
        
        /// <summary>
        /// åœæ­¢æµè§ˆå™¨
        /// </summary>
        public void StopBrowser(int configId)
        {
            if (_contexts.TryGetValue(configId, out var context))
            {
                context.Dispose();
                _contexts.Remove(configId);
                
                var config = GetConfig(configId);
                if (config != null)
                {
                    config.Status = "å·²åœæ­¢";
                    SaveConfig(config);
                }
                
                _logService.Info("AutoBetManager", $"â¹ï¸ æµè§ˆå™¨å·²åœæ­¢: {config?.ConfigName}");
            }
        }
        
        /// <summary>
        /// ğŸ”¥ é…ç½®å˜æ›´æ—¶é‡æ–°åˆå§‹åŒ–
        /// </summary>
        public async Task<bool> ReinitializeBrowserAsync(int configId)
        {
            _logService.Info("AutoBetManager", $"ğŸ”„ é‡æ–°åˆå§‹åŒ–æµè§ˆå™¨: {configId}");
            
            // å…ˆåœæ­¢
            StopBrowser(configId);
            
            // ç­‰å¾…é‡Šæ”¾
            await Task.Delay(500);
            
            // é‡æ–°å¯åŠ¨
            return await StartBrowserAsync(configId);
        }
        
        #endregion
        
        #region å¹³å°æ“ä½œ
        
        /// <summary>
        /// ç™»å½•
        /// </summary>
        public async Task<bool> LoginAsync(int configId, string username, string password)
        {
            if (!_contexts.TryGetValue(configId, out var context))
            {
                _logService.Warning("AutoBetManager", "æµè§ˆå™¨æœªå¯åŠ¨");
                return false;
            }
            
            var success = await context.LoginAsync(username, password);
            
            var config = GetConfig(configId);
            if (config != null)
            {
                config.Status = success ? "å·²ç™»å½•" : "ç™»å½•å¤±è´¥";
                
                if (success)
                {
                    // è·å–ä½™é¢
                    var balance = await context.GetBalanceAsync();
                    config.CurrentBalance = balance;
                }
                
                SaveConfig(config);
            }
            
            return success;
        }
        
        /// <summary>
        /// è·å–ä½™é¢
        /// </summary>
        public async Task<decimal> GetBalanceAsync(int configId)
        {
            if (!_contexts.TryGetValue(configId, out var context))
                return 0;
            
            var balance = await context.GetBalanceAsync();
            
            var config = GetConfig(configId);
            if (config != null)
            {
                config.CurrentBalance = balance;
                SaveConfig(config);
            }
            
            return balance;
        }
        
        /// <summary>
        /// ğŸ”¥ æŠ•æ³¨ï¼ˆå¸¦é…ç½®IDï¼‰
        /// </summary>
        public async Task<BetResult> PlaceBetAsync(int configId, BetOrder order)
        {
            if (!_contexts.TryGetValue(configId, out var context))
            {
                return new BetResult 
                { 
                    Success = false, 
                    ErrorMessage = "æµè§ˆå™¨æœªå¯åŠ¨" 
                };
            }
            
            var config = GetConfig(configId);
            if (config == null)
            {
                return new BetResult 
                { 
                    Success = false, 
                    ErrorMessage = "é…ç½®ä¸å­˜åœ¨" 
                };
            }
            
            _logService.Info("AutoBetManager", 
                $"ğŸ“¤ [{config.ConfigName}] æŠ•æ³¨: {order.PlayType} {order.BetContent} {order.Amount}");
            
            // æ‰§è¡ŒæŠ•æ³¨
            var result = await context.PlaceBetAsync(order);
            
            // ğŸ”¥ ä¿å­˜è®¢å•è®°å½•
            var record = new BetOrderRecord
            {
                ConfigId = configId,
                ConfigName = config.ConfigName,
                Platform = config.Platform,
                IssueId = order.IssueId ?? "",
                PlayType = order.PlayType,
                BetContent = order.BetContent,
                Amount = order.Amount,
                PlatformOrderId = result.OrderId,
                Status = result.Success ? "æˆåŠŸ" : "å¤±è´¥",
                ErrorMessage = result.ErrorMessage,
                CreateTime = DateTime.Now
            };
            
            _db.Insert(record);
            
            // æ›´æ–°ä½™é¢
            if (result.Success)
            {
                var balance = await context.GetBalanceAsync();
                config.CurrentBalance = balance;
                SaveConfig(config);
            }
            
            _logService.Info("AutoBetManager", 
                $"ğŸ“¥ [{config.ConfigName}] æŠ•æ³¨ç»“æœ: {(result.Success ? "âœ… æˆåŠŸ" : "âŒ å¤±è´¥")}");
            
            return result;
        }
        
        #endregion
        
        #region è¾…åŠ©æ–¹æ³•
        
        /// <summary>
        /// ç¡®ä¿é»˜è®¤é…ç½®å­˜åœ¨
        /// </summary>
        private void EnsureDefaultConfig()
        {
            var defaultConfig = _db.Table<BetConfig>()
                .Where(c => c.IsDefault)
                .FirstOrDefault();
            
            if (defaultConfig == null)
            {
                defaultConfig = new BetConfig
                {
                    ConfigName = "é»˜è®¤é…ç½®",
                    Platform = "YunDing28",
                    PlatformUrl = "https://www.yunding28.com",
                    IsDefault = true,
                    IsEnabled = true,
                    ShowBrowserWindow = false,
                    MinBetAmount = 1,
                    MaxBetAmount = 10000,
                    Status = "æœªå¯åŠ¨"
                };
                
                _db.Insert(defaultConfig);
                _logService.Info("AutoBetManager", "âœ… å·²åˆ›å»ºé»˜è®¤é…ç½®");
            }
        }
        
        /// <summary>
        /// è·å–è¿è¡Œä¸­çš„æµè§ˆå™¨
        /// </summary>
        public List<BrowserInfo> GetRunningBrowsers()
        {
            return _contexts.Select(kvp =>
            {
                var config = GetConfig(kvp.Key);
                return new BrowserInfo
                {
                    ConfigId = kvp.Key,
                    ConfigName = config?.ConfigName ?? "",
                    Platform = config?.Platform ?? "",
                    Status = kvp.Value.Status
                };
            }).ToList();
        }
        
        public void Dispose()
        {
            foreach (var context in _contexts.Values)
            {
                context.Dispose();
            }
            _contexts.Clear();
        }
        
        #endregion
    }
}
```

---

### 2ï¸âƒ£ BrowserContextï¼ˆæµè§ˆå™¨ä¸Šä¸‹æ–‡ï¼‰

```csharp
namespace BaiShengVx3Plus.Services.AutoBet
{
    /// <summary>
    /// æµè§ˆå™¨ä¸Šä¸‹æ–‡ - å°è£…æµè§ˆå™¨ã€é…ç½®ã€å¹³å°è„šæœ¬
    /// </summary>
    public class BrowserContext : IDisposable
    {
        private BetConfig _config;
        private ChromiumWebBrowser? _browser;
        private IPlatformScript? _platformScript;
        private Form? _browserForm;
        private readonly ILogService _logService;
        
        public string Status { get; private set; } = "åˆå§‹åŒ–ä¸­";
        
        public BrowserContext(BetConfig config, ILogService logService)
        {
            _config = config;
            _logService = logService;
        }
        
        /// <summary>
        /// åˆå§‹åŒ–æµè§ˆå™¨
        /// </summary>
        public async Task InitializeAsync()
        {
            // 1. åˆå§‹åŒ– CEFï¼ˆå¦‚æœæœªåˆå§‹åŒ–ï¼‰
            if (!Cef.IsInitialized)
            {
                var settings = new CefSettings
                {
                    CachePath = Path.Combine(
                        Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData),
                        "BaiShengVx3Plus", "BrowserCache", $"Config_{_config.Id}"),
                    LogSeverity = LogSeverity.Warning
                };
                Cef.Initialize(settings);
            }
            
            // ğŸ”¥ 2. é€šè¿‡å·¥å‚åˆ›å»ºå¹³å°è„šæœ¬
            _platformScript = PlatformScriptFactory.Create(_config.Platform);
            
            // 3. åˆ›å»ºæµè§ˆå™¨
            _browser = new ChromiumWebBrowser(_platformScript.PlatformUrl)
            {
                Dock = DockStyle.Fill
            };
            
            // 4. åˆ›å»ºæ‰¿è½½çª—ä½“ï¼ˆå¦‚æœéœ€è¦æ˜¾ç¤ºï¼‰
            if (_config.ShowBrowserWindow)
            {
                _browserForm = new Form
                {
                    Text = $"è‡ªåŠ¨æŠ•æ³¨ - {_config.ConfigName}",
                    Width = 1280,
                    Height = 800,
                    StartPosition = FormStartPosition.CenterScreen
                };
                _browserForm.Controls.Add(_browser);
                _browserForm.Show();
            }
            
            // 5. ç­‰å¾…é¡µé¢åŠ è½½
            await WaitForPageLoadAsync();
            
            // 6. æ³¨å…¥è„šæœ¬
            await InjectScriptsAsync();
            
            Status = "å°±ç»ª";
            _logService.Info("BrowserContext", $"æµè§ˆå™¨åˆå§‹åŒ–å®Œæˆ: {_config.ConfigName}");
        }
        
        /// <summary>
        /// ğŸ”¥ åº”ç”¨æ–°é…ç½®ï¼ˆé…ç½®å˜æ›´æ—¶è°ƒç”¨ï¼‰
        /// </summary>
        public void ApplyConfig(BetConfig newConfig)
        {
            _config = newConfig;
            
            // æ›´æ–°çª—å£æ ‡é¢˜
            if (_browserForm != null)
            {
                _browserForm.Text = $"è‡ªåŠ¨æŠ•æ³¨ - {_config.ConfigName}";
            }
            
            // æ˜¾ç¤º/éšè—çª—å£
            SetVisible(_config.ShowBrowserWindow);
            
            _logService.Info("BrowserContext", $"é…ç½®å·²æ›´æ–°: {_config.ConfigName}");
        }
        
        /// <summary>
        /// æ˜¾ç¤º/éšè—æµè§ˆå™¨
        /// </summary>
        public void SetVisible(bool visible)
        {
            if (_browserForm != null)
            {
                if (visible)
                    _browserForm.Show();
                else
                    _browserForm.Hide();
            }
        }
        
        /// <summary>
        /// ç™»å½•
        /// </summary>
        public async Task<bool> LoginAsync(string username, string password)
        {
            if (_browser == null || _platformScript == null)
                return false;
            
            try
            {
                var script = _platformScript.GetLoginScript(username, password);
                await ExecuteScriptAsync(script);
                
                // ç­‰å¾…ç™»å½•å®Œæˆ
                await Task.Delay(2000);
                
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                var checkScript = _platformScript.GetLoginCheckScript();
                var result = await ExecuteScriptAsync(checkScript);
                
                var success = (bool)(result.Result ?? false);
                Status = success ? "å·²ç™»å½•" : "ç™»å½•å¤±è´¥";
                
                return success;
            }
            catch (Exception ex)
            {
                _logService.Error("BrowserContext", "ç™»å½•å¤±è´¥", ex);
                Status = "ç™»å½•å¤±è´¥";
                return false;
            }
        }
        
        /// <summary>
        /// è·å–ä½™é¢
        /// </summary>
        public async Task<decimal> GetBalanceAsync()
        {
            if (_browser == null || _platformScript == null)
                return 0;
            
            try
            {
                var script = _platformScript.GetBalanceScript();
                var result = await ExecuteScriptAsync(script);
                
                if (result.Success && result.Result != null)
                {
                    return Convert.ToDecimal(result.Result);
                }
                
                return 0;
            }
            catch (Exception ex)
            {
                _logService.Error("BrowserContext", "è·å–ä½™é¢å¤±è´¥", ex);
                return 0;
            }
        }
        
        /// <summary>
        /// æŠ•æ³¨
        /// </summary>
        public async Task<BetResult> PlaceBetAsync(BetOrder order)
        {
            if (_browser == null || _platformScript == null)
            {
                return new BetResult { Success = false, ErrorMessage = "æµè§ˆå™¨æœªåˆå§‹åŒ–" };
            }
            
            try
            {
                var script = _platformScript.GetPlaceBetScript(order);
                await ExecuteScriptAsync(script);
                
                // ç­‰å¾…æŠ•æ³¨å®Œæˆ
                await Task.Delay(1000);
                
                // è·å–æŠ•æ³¨ç»“æœ
                var checkScript = _platformScript.GetBetResultScript();
                var result = await ExecuteScriptAsync(checkScript);
                
                if (result.Success && result.Result != null)
                {
                    dynamic data = result.Result;
                    return new BetResult
                    {
                        Success = data.success,
                        OrderId = data.orderId?.ToString()
                    };
                }
                
                return new BetResult { Success = false, ErrorMessage = "æœªçŸ¥é”™è¯¯" };
            }
            catch (Exception ex)
            {
                _logService.Error("BrowserContext", "æŠ•æ³¨å¤±è´¥", ex);
                return new BetResult { Success = false, ErrorMessage = ex.Message };
            }
        }
        
        private async Task WaitForPageLoadAsync()
        {
            // å®ç°ç­‰å¾…é€»è¾‘
            await Task.Delay(500);
        }
        
        private async Task InjectScriptsAsync()
        {
            if (_platformScript != null)
            {
                var initScript = _platformScript.GetInitScript();
                await ExecuteScriptAsync(initScript);
            }
        }
        
        private async Task<JavascriptResponse> ExecuteScriptAsync(string script)
        {
            if (_browser == null)
                return new JavascriptResponse { Success = false };
            
            return await _browser.EvaluateScriptAsync(script);
        }
        
        public void Dispose()
        {
            _browser?.Dispose();
            _browserForm?.Close();
            _browserForm?.Dispose();
        }
    }
}
```

---

### 3ï¸âƒ£ PlatformScriptFactoryï¼ˆå·¥å‚æ¨¡å¼ï¼‰

```csharp
namespace BaiShengVx3Plus.Services.AutoBet
{
    /// <summary>
    /// å¹³å°è„šæœ¬å·¥å‚ - æ ¹æ®å¹³å°ç±»å‹åˆ›å»ºè„šæœ¬å®ä¾‹
    /// </summary>
    public static class PlatformScriptFactory
    {
        /// <summary>
        /// ğŸ”¥ åˆ›å»ºå¹³å°è„šæœ¬ï¼ˆå‚è€ƒ F5BotV2 çš„ BetSiteFactoryï¼‰
        /// </summary>
        public static IPlatformScript Create(string platformType)
        {
            return platformType switch
            {
                "YunDing28" => new YunDing28Script(),
                "BingGo28" => new BingGo28Script(),
                "KuaiLe8" => new KuaiLe8Script(),
                _ => new NonePlatformScript()  // é»˜è®¤ï¼ˆä¸ä½¿ç”¨å¹³å°ï¼‰
            };
        }
    }
}
```

---

## ğŸ”„ é…ç½®å˜æ›´å¤„ç†

### åœºæ™¯1: ç”¨æˆ·ä¿®æ”¹é…ç½®ä½†æœªå¯åŠ¨æµè§ˆå™¨

```csharp
// ç›´æ¥ä¿å­˜é…ç½®å³å¯
var config = _autoBetManager.GetConfig(configId);
config.Username = "new_username";
config.Password = "new_password";
_autoBetManager.SaveConfig(config);

// âœ… ä¸‹æ¬¡å¯åŠ¨æ—¶ä¼šä½¿ç”¨æ–°é…ç½®
```

### åœºæ™¯2: æµè§ˆå™¨å·²å¯åŠ¨ï¼Œç”¨æˆ·ä¿®æ”¹äº†éå…³é”®é…ç½®ï¼ˆå¦‚å¤‡æ³¨ï¼‰

```csharp
// ä¿å­˜é…ç½®
_autoBetManager.SaveConfig(config);

// âœ… BrowserContext ä¼šè‡ªåŠ¨åº”ç”¨æ–°é…ç½®ï¼ˆé€šè¿‡ ApplyConfigï¼‰
// ä¸éœ€è¦é‡å¯æµè§ˆå™¨
```

### åœºæ™¯3: æµè§ˆå™¨å·²å¯åŠ¨ï¼Œç”¨æˆ·ä¿®æ”¹äº†å…³é”®é…ç½®ï¼ˆå¦‚å¹³å°ã€è´¦å·ï¼‰

```csharp
// ä¿å­˜é…ç½®
_autoBetManager.SaveConfig(config);

// ğŸ”¥ éœ€è¦é‡æ–°åˆå§‹åŒ–æµè§ˆå™¨
await _autoBetManager.ReinitializeBrowserAsync(configId);

// âœ… ä¼šè‡ªåŠ¨åœæ­¢ â†’ é‡æ–°åˆ›å»º â†’ ä½¿ç”¨æ–°é…ç½®
```

### é…ç½®å˜æ›´æµç¨‹

```
ç”¨æˆ·ä¿®æ”¹é…ç½®
    â†“
SaveConfig(config)
    â†“
æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜
    â†“
åˆ¤æ–­æ˜¯å¦éœ€è¦é‡å¯æµè§ˆå™¨
    â”œâ”€ éå…³é”®é…ç½®ï¼ˆå¤‡æ³¨ã€æ˜¾ç¤ºçª—å£ç­‰ï¼‰
    â”‚     â†“
    â”‚  BrowserContext.ApplyConfig(config)
    â”‚     â†“
    â”‚  åº”ç”¨æ–°é…ç½®ï¼ˆä¸é‡å¯ï¼‰
    â”‚
    â””â”€ å…³é”®é…ç½®ï¼ˆå¹³å°ã€è´¦å·ã€URLç­‰ï¼‰
          â†“
       ReinitializeBrowserAsync(configId)
          â†“
       StopBrowser â†’ ç­‰å¾… â†’ StartBrowser
          â†“
       ä½¿ç”¨æ–°é…ç½®é‡æ–°åˆå§‹åŒ–
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´æµç¨‹

```csharp
// 1ï¸âƒ£ åˆ›å»ºç®¡ç†å™¨ï¼ˆå•ä¾‹ï¼‰
var manager = new AutoBetManager(_db, _logService);

// 2ï¸âƒ£ è·å–æ‰€æœ‰é…ç½®
var configs = manager.GetConfigs();

// 3ï¸âƒ£ ä¿®æ”¹é…ç½®
var config = manager.GetConfig(1);
config.Username = "test001";
config.Password = "aaa111";
manager.SaveConfig(config);

// 4ï¸âƒ£ å¯åŠ¨æµè§ˆå™¨ï¼ˆè‡ªåŠ¨æ ¹æ®é…ç½®åˆ›å»ºæ­£ç¡®çš„å¹³å°å®ä¾‹ï¼‰
await manager.StartBrowserAsync(config.Id);

// 5ï¸âƒ£ æŠ•æ³¨ï¼ˆè‡ªåŠ¨è·¯ç”±åˆ°æ­£ç¡®çš„æµè§ˆå™¨ï¼‰
var order = new BetOrder 
{ 
    PlayType = "å¤§å°", 
    BetContent = "å¤§", 
    Amount = 100 
};
var result = await manager.PlaceBetAsync(config.Id, order);

// 6ï¸âƒ£ é…ç½®å˜æ›´åé‡æ–°åˆå§‹åŒ–
config.Platform = "BingGo28";  // æ¢å¹³å°
manager.SaveConfig(config);
await manager.ReinitializeBrowserAsync(config.Id);

// 7ï¸âƒ£ åœæ­¢æµè§ˆå™¨
manager.StopBrowser(config.Id);
```

---

## âœ… ä¼˜åŠ¿æ€»ç»“

### å¯¹æ¯”ä¹‹å‰çš„ä¸¤å±‚è®¾è®¡

| é¡¹ç›® | ä¸¤å±‚è®¾è®¡ | **åˆå¹¶è®¾è®¡** âœ… |
|------|---------|----------------|
| ç±»æ•°é‡ | 2 ä¸ªæ ¸å¿ƒç±» | **1 ä¸ªæ ¸å¿ƒç±»** |
| ä»£ç è¡Œæ•° | ~800 è¡Œ | **~600 è¡Œ** |
| èŒè´£ | æ··æ·†ï¼ˆé…ç½®/æœåŠ¡ï¼‰ | **æ¸…æ™°ï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰** |
| é…ç½®å˜æ›´ | å¤æ‚ï¼ˆéœ€è¦åŒæ­¥ï¼‰ | **ç®€å•ï¼ˆç›´æ¥å¤„ç†ï¼‰** |
| å¹³å°åˆ‡æ¢ | æ‰‹åŠ¨ç®¡ç† | **å·¥å‚è‡ªåŠ¨åˆ›å»º** |
| ç»´æŠ¤æ€§ | ä¸­ | **é«˜** |
| å­¦ä¹ æˆæœ¬ | é«˜ | **ä½** |

### æ ¸å¿ƒä¼˜åŠ¿

1. âœ… **å•ä¸€èŒè´£**: AutoBetManager ç»Ÿä¸€ç®¡ç†ä¸€åˆ‡
2. âœ… **å·¥å‚æ¨¡å¼**: å‚è€ƒ F5BotV2ï¼Œè‡ªåŠ¨åˆ›å»ºå¹³å°å®ä¾‹
3. âœ… **é…ç½®é©±åŠ¨**: é…ç½® ID æ˜¯å”¯ä¸€æ ‡è¯†
4. âœ… **æ™ºèƒ½é‡è½½**: è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦é‡å¯æµè§ˆå™¨
5. âœ… **ç®€å•ç›´æ¥**: ä»£ç é‡å°‘ï¼Œæ˜“äºç†è§£
6. âœ… **æ˜“äºæ‰©å±•**: æ–°å¢å¹³å°åªéœ€å®ç°æ¥å£

---

## ğŸš€ å®æ–½å»ºè®®

### ä¼˜å…ˆçº§

1. **Phase 1**: å®ç° AutoBetManager æ ¸å¿ƒé€»è¾‘
2. **Phase 2**: å®ç° BrowserContext å’Œ CEF é›†æˆ
3. **Phase 3**: å®ç° PlatformScriptFactory å’Œå¹³å°è„šæœ¬
4. **Phase 4**: UI é›†æˆå’Œæµ‹è¯•

### å…³é”®ç‚¹

- âœ… å‚è€ƒ F5BotV2 çš„å·¥å‚æ¨¡å¼
- âœ… é…ç½® ID ä½œä¸ºå”¯ä¸€æ ‡è¯†
- âœ… æ™ºèƒ½å¤„ç†é…ç½®å˜æ›´
- âœ… ç®€åŒ–ç±»ç»“æ„ï¼Œå‡å°‘å¤æ‚åº¦

---

## ğŸ‰ æ€»ç»“

**ä¸ºä»€ä¹ˆåˆå¹¶æ›´å¥½ï¼Ÿ**

1. **ç®€å•**: åªæœ‰ä¸€ä¸ªæ ¸å¿ƒç±»ï¼ŒèŒè´£æ¸…æ™°
2. **ç›´æ¥**: é…ç½®å’ŒæœåŠ¡ç»Ÿä¸€ç®¡ç†ï¼Œæ— éœ€åŒæ­¥
3. **çµæ´»**: å·¥å‚æ¨¡å¼è‡ªåŠ¨åˆ›å»ºå¹³å°å®ä¾‹
4. **æ™ºèƒ½**: è‡ªåŠ¨åˆ¤æ–­é…ç½®å˜æ›´å½±å“
5. **æ˜“ç»´æŠ¤**: ä»£ç å°‘ï¼Œé€»è¾‘æ¸…æ™°

**å‚è€ƒ F5BotV2 çš„ç²¾é«“**:
- å·¥å‚æ¨¡å¼åˆ›å»ºå¹³å°
- ç»Ÿä¸€æ¥å£å°è£…å·®å¼‚
- é…ç½®é©±åŠ¨å®ä¾‹åŒ–

**è¿™å°±æ˜¯æœ€ä½³æ–¹æ¡ˆï¼** ğŸš€

