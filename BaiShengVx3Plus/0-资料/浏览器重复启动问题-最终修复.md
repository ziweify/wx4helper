# æµè§ˆå™¨é‡å¤å¯åŠ¨é—®é¢˜ - æœ€ç»ˆä¿®å¤æ–¹æ¡ˆ

## é—®é¢˜ç°è±¡

**ç”¨æˆ·åé¦ˆ**ï¼š
> å…³é—­ä¸»ç¨‹åºåï¼Œå†æ¬¡å¼€å¯ä¸»ç¨‹åºï¼Œè¿˜æ˜¯åˆæ‰“å¼€äº†æ–°çš„æµè§ˆå™¨çª—å£ã€‚  
> å¿…é¡»æ‰‹åŠ¨æŠŠé£å•å¼€å…³å…³é—­ï¼Œç„¶åä¹‹å‰æ‰“å¼€çš„æµè§ˆå™¨å°±èƒ½æ¡æ‰‹æˆåŠŸäº†ã€‚

## é—®é¢˜æ ¹æº

### æ—¶åºé—®é¢˜åˆ†æ

```
ä¸»ç¨‹åºå¯åŠ¨æµç¨‹ï¼š
1. AutoBetService æ„é€  
   â†’ Socket æœåŠ¡å™¨å¯åŠ¨ï¼ˆç«¯å£ 19527ï¼‰
   â†’ _browsers = {}

2. LoadAutoBetSettings() è¢«è°ƒç”¨
   â†’ ä»é…ç½®æ–‡ä»¶è¯»å–é£å•å¼€å…³çŠ¶æ€
   â†’ è®¾ç½® swiAutoOrdersBet.Active = true
   â†’ âš ï¸ è§¦å‘ ValueChanged äº‹ä»¶
   â†’ ç«‹å³è°ƒç”¨ StartBrowser()
   
3. LoadAppConfiguration() è¢«è°ƒç”¨
   â†’ é€šè¿‡æ•°æ®ç»‘å®šè®¾ç½® _configViewModel.IsAutoBetEnabled = true
   â†’ âš ï¸ ä¹Ÿä¼šè§¦å‘ ValueChanged äº‹ä»¶
   
4. StartBrowser() ç­‰å¾…æµè§ˆå™¨é‡è¿
   â†’ æ­¤æ—¶æ—§æµè§ˆå™¨å¯èƒ½è¿˜æ²¡æ¥å¾—åŠé‡è¿
   â†’ ç­‰å¾…è¶…æ—¶ â†’ å¯åŠ¨æ–°çš„æµè§ˆå™¨è¿›ç¨‹ âŒ
```

### ä¸ºä»€ä¹ˆå…³é—­é£å•å¼€å…³åå°±èƒ½è¿æ¥ï¼Ÿ

```
ç”¨æˆ·æ‰‹åŠ¨å…³é—­é£å•å¼€å…³ï¼š
1. ä¸»ç¨‹åºå¯åŠ¨
   â†’ Socket æœåŠ¡å™¨å¯åŠ¨
   â†’ LoadAutoBetSettings() / LoadAppConfiguration()
   â†’ é£å•å¼€å…³å…³é—­ï¼Œä¸è°ƒç”¨ StartBrowser() âœ…
   
2. æ—§æµè§ˆå™¨é‡è¿
   â†’ æ¡æ‰‹æˆåŠŸ âœ…
   â†’ OnBrowserConnected è‡ªåŠ¨åˆ›å»º BrowserClient
   â†’ _browsers[1] = browserClient
   
3. ç”¨æˆ·æ‰‹åŠ¨å¼€å¯é£å•
   â†’ è°ƒç”¨ StartBrowser()
   â†’ å‘ç° _browsers[1] å·²å­˜åœ¨
   â†’ ç›´æ¥è¿”å›ï¼Œä¸å¯åŠ¨æ–°è¿›ç¨‹ âœ…
```

---

## è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒç­–ç•¥

1. **åŠ è½½é…ç½®æ—¶è§£ç»‘äº‹ä»¶**ï¼šé¿å…é…ç½®åŠ è½½æ—¶è§¦å‘è‡ªåŠ¨å¯åŠ¨
2. **å»¶è¿Ÿå¯åŠ¨**ï¼šé…ç½®åŠ è½½å®Œæˆåï¼Œå»¶è¿Ÿ 2 ç§’å†å¯åŠ¨ï¼ˆç»™æµè§ˆå™¨é‡è¿çš„æ—¶é—´ï¼‰
3. **åˆ†æ®µç­‰å¾…**ï¼š`StartBrowser()` åˆ†æ®µç­‰å¾… 5 ç§’ï¼Œæ¯ç§’æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦é‡è¿

### ä¿®æ”¹å†…å®¹

#### 1. LoadAutoBetSettings() - è§£ç»‘äº‹ä»¶

**æ–‡ä»¶**ï¼š`BaiShengVx3Plus/Views/VxMain.cs`

```csharp
private void LoadAutoBetSettings()
{
    try
    {
        // ğŸ”¥ åŠ è½½è®¾ç½®æ—¶ï¼Œä¸´æ—¶è§£ç»‘äº‹ä»¶ï¼Œé¿å…è§¦å‘è‡ªåŠ¨å¯åŠ¨
        _logService.Info("VxMain", "ğŸ“‹ åŠ è½½è‡ªåŠ¨æŠ•æ³¨è®¾ç½®ï¼ˆä¸´æ—¶è§£ç»‘äº‹ä»¶ï¼‰...");
        swiAutoOrdersBet.ValueChanged -= swiAutoOrdersBet_ValueChanged;
        
        var defaultConfig = _autoBetService.GetConfigs().FirstOrDefault(c => c.IsDefault);
        if (defaultConfig != null)
        {
            // åŠ è½½é…ç½®...
        }
        
        _logService.Info("VxMain", "âœ… è‡ªåŠ¨æŠ•æ³¨è®¾ç½®åŠ è½½å®Œæˆ");
    }
    finally
    {
        // ğŸ”¥ é‡æ–°ç»‘å®šäº‹ä»¶
        swiAutoOrdersBet.ValueChanged += swiAutoOrdersBet_ValueChanged;
        _logService.Info("VxMain", "âœ… è‡ªåŠ¨æŠ•æ³¨å¼€å…³äº‹ä»¶å·²é‡æ–°ç»‘å®š");
    }
}
```

#### 2. LoadAppConfiguration() - è§£ç»‘äº‹ä»¶ + å»¶è¿Ÿå¯åŠ¨

**æ–‡ä»¶**ï¼š`BaiShengVx3Plus/Views/VxMain.cs`

```csharp
private void LoadAppConfiguration()
{
    try
    {
        _logService.Info("VxMain", "ğŸ“– å¼€å§‹åŠ è½½åº”ç”¨é…ç½®ï¼ˆä¸´æ—¶è§£ç»‘äº‹ä»¶ï¼‰...");
        
        // ğŸ”¥ ä¸´æ—¶è§£ç»‘äº‹ä»¶ï¼Œé¿å…åŠ è½½æ—¶è§¦å‘è‡ªåŠ¨å¯åŠ¨
        swiAutoOrdersBet.ValueChanged -= swiAutoOrdersBet_ValueChanged;
        swi_OrdersTasking.ValueChanged -= swi_OrdersTasking_ValueChanged;
        
        // åŠ è½½é…ç½®...
        var isAutoBetEnabled = _configService.GetIsAutoBetEnabled();
        _configViewModel.IsAutoBetEnabled = isAutoBetEnabled;
        
        // ğŸ”¥ é‡æ–°ç»‘å®šäº‹ä»¶
        swiAutoOrdersBet.ValueChanged += swiAutoOrdersBet_ValueChanged;
        swi_OrdersTasking.ValueChanged += swi_OrdersTasking_ValueChanged;
        
        // ğŸ”¥ å¦‚æœé£å•å¼€å…³å¼€å¯ï¼Œå»¶è¿Ÿ 2 ç§’åæ‰‹åŠ¨è§¦å‘å¯åŠ¨
        if (isAutoBetEnabled)
        {
            _ = Task.Run(async () =>
            {
                // é¢å¤–ç­‰å¾… 2 ç§’ï¼Œç¡®ä¿ Socket æœåŠ¡å™¨å®Œå…¨å°±ç»ªï¼Œæµè§ˆå™¨æœ‰æ—¶é—´é‡è¿
                await Task.Delay(2000);
                _logService.Info("VxMain", "â³ å·²ç­‰å¾… 2 ç§’ï¼Œå¼€å§‹å¯åŠ¨è‡ªåŠ¨æŠ•æ³¨");
                
                // æ¨¡æ‹Ÿå¼€å…³äº‹ä»¶è§¦å‘
                await this.InvokeAsync(() => swiAutoOrdersBet_ValueChanged(null, true));
            });
        }
    }
    catch (Exception ex)
    {
        _logService.Error("VxMain", "åŠ è½½åº”ç”¨é…ç½®å¤±è´¥", ex);
    }
}
```

#### 3. StartBrowser() - åˆ†æ®µç­‰å¾…æ£€æŸ¥

**æ–‡ä»¶**ï¼š`BaiShengVx3Plus/Services/AutoBet/AutoBetService.cs`

```csharp
public async Task<bool> StartBrowser(int configId)
{
    // ...
    
    // ğŸ”¥ å¦‚æœ _browsers å­—å…¸ä¸ºç©ºï¼Œåˆ†æ®µç­‰å¾…æµè§ˆå™¨é‡è¿
    if (!_browsers.ContainsKey(configId))
    {
        _log.Info("AutoBet", "â³ ç­‰å¾… 3-5 ç§’ï¼Œç»™å·²è¿è¡Œçš„æµè§ˆå™¨é‡è¿çš„æœºä¼š...");
        
        // åˆ†æ®µç­‰å¾…ï¼Œæ¯ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œæœ€å¤šç­‰å¾… 5 ç§’
        for (int i = 1; i <= 5; i++)
        {
            await Task.Delay(1000);
            _log.Info("AutoBet", $"   â³ å·²ç­‰å¾… {i} ç§’... _browsers å­—å…¸: [{...}]");
            
            if (_browsers.ContainsKey(configId))
            {
                _log.Info("AutoBet", $"âœ… æµè§ˆå™¨å·²è‡ªåŠ¨é‡è¿ï¼ï¼ˆç­‰å¾…äº† {i} ç§’ï¼‰");
                return true;
            }
        }
        
        _log.Warning("AutoBet", "âš ï¸ ç­‰å¾… 5 ç§’åä»æœªæ£€æµ‹åˆ°æµè§ˆå™¨é‡è¿");
    }
    
    // å¯åŠ¨æ–°æµè§ˆå™¨è¿›ç¨‹...
}
```

#### 4. æµè§ˆå™¨é‡è¿é—´éš”ä¼˜åŒ–

**æ–‡ä»¶**ï¼š`BsBrowserClient/Services/SocketServer.cs`

```csharp
// ğŸ”¥ é‡è¿é—´éš”ä» 5 ç§’æ”¹ä¸º 1 ç§’
_onLog("â³ 1ç§’åé‡è¯•è¿æ¥...");
await Task.Delay(1000, cancellationToken);
```

---

## å®Œæ•´æ—¶é—´çº¿

### åœºæ™¯ï¼šä¸»ç¨‹åºé‡å¯ï¼Œæµè§ˆå™¨è¿˜åœ¨è¿è¡Œ

```
T = 0 ç§’
  â†’ ä¸»ç¨‹åºå¯åŠ¨
  â†’ AutoBetService æ„é€ 
  â†’ Socket æœåŠ¡å™¨å¯åŠ¨ï¼ˆç«¯å£ 19527ï¼‰
  â†’ _browsers = {}

T = 0-1 ç§’
  â†’ æ—§æµè§ˆå™¨æ£€æµ‹åˆ°è¿æ¥æ–­å¼€
  â†’ ç­‰å¾… 1 ç§’åé‡è¿

T = 1 ç§’
  â†’ æµè§ˆå™¨é‡è¿åˆ° Socket æœåŠ¡å™¨
  â†’ å‘é€æ¡æ‰‹æ¶ˆæ¯ï¼ˆconfigId, configNameï¼‰
  â†’ OnBrowserConnected è‡ªåŠ¨åˆ›å»º BrowserClient
  â†’ _browsers[1] = browserClient âœ…

T = 1-2 ç§’
  â†’ LoadAutoBetSettings() æ‰§è¡Œï¼ˆè§£ç»‘äº‹ä»¶ï¼Œä¸è§¦å‘å¯åŠ¨ï¼‰
  â†’ LoadAppConfiguration() æ‰§è¡Œï¼ˆè§£ç»‘äº‹ä»¶ï¼Œä¸è§¦å‘å¯åŠ¨ï¼‰
  â†’ æ£€æµ‹åˆ°é£å•å¼€å…³å¼€å¯
  â†’ å¯åŠ¨å»¶è¿Ÿä»»åŠ¡ï¼ˆç­‰å¾… 2 ç§’åè§¦å‘ï¼‰

T = 2 ç§’
  â†’ å»¶è¿Ÿä»»åŠ¡è§¦å‘
  â†’ è°ƒç”¨ swiAutoOrdersBet_ValueChanged(null, true)
  â†’ è°ƒç”¨ StartBrowser(configId=1)

T = 2-3 ç§’
  â†’ StartBrowser() æ£€æŸ¥ _browsers[1]
  â†’ å‘ç°å·²å­˜åœ¨ âœ…
  â†’ ç›´æ¥è¿”å› true
  â†’ ä¸å¯åŠ¨æ–°è¿›ç¨‹ âœ…
```

### åœºæ™¯ï¼šé¦–æ¬¡å¯åŠ¨ï¼Œæµè§ˆå™¨æœªè¿è¡Œ

```
T = 0 ç§’
  â†’ ä¸»ç¨‹åºå¯åŠ¨
  â†’ Socket æœåŠ¡å™¨å¯åŠ¨
  â†’ _browsers = {}

T = 1-2 ç§’
  â†’ LoadAppConfiguration() æ‰§è¡Œ
  â†’ æ£€æµ‹åˆ°é£å•å¼€å…³å¼€å¯
  â†’ å¯åŠ¨å»¶è¿Ÿä»»åŠ¡ï¼ˆç­‰å¾… 2 ç§’ï¼‰

T = 2 ç§’
  â†’ å»¶è¿Ÿä»»åŠ¡è§¦å‘
  â†’ è°ƒç”¨ StartBrowser(configId=1)

T = 2-7 ç§’
  â†’ StartBrowser() ç­‰å¾… 5 ç§’ï¼Œæ¯ç§’æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦é‡è¿
  â†’ ç­‰å¾…è¶…æ—¶ï¼ˆæ²¡æœ‰æ—§æµè§ˆå™¨ï¼‰
  â†’ å¯åŠ¨æ–°æµè§ˆå™¨è¿›ç¨‹ âœ…

T = 7-8 ç§’
  â†’ æ–°æµè§ˆå™¨å¯åŠ¨
  â†’ è¿æ¥åˆ° Socket æœåŠ¡å™¨
  â†’ OnBrowserConnected åˆ›å»º BrowserClient
  â†’ _browsers[1] = browserClient âœ…
```

---

## å…³é”®æ—¥å¿—

### å¯åŠ¨æ—¶çš„æ—¥å¿—è¾“å‡º

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ AutoBetService æ„é€ å‡½æ•°æ‰§è¡Œ
âœ… Socket æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç«¯å£: 19527
âœ… AutoBetService åˆå§‹åŒ–å®Œæˆ
   Socket æœåŠ¡å™¨çŠ¶æ€: è¿è¡Œä¸­
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ åŠ è½½è‡ªåŠ¨æŠ•æ³¨è®¾ç½®ï¼ˆä¸´æ—¶è§£ç»‘äº‹ä»¶ï¼‰...
âœ… è‡ªåŠ¨æŠ•æ³¨è®¾ç½®åŠ è½½å®Œæˆ
âœ… è‡ªåŠ¨æŠ•æ³¨å¼€å…³äº‹ä»¶å·²é‡æ–°ç»‘å®š

ğŸ“– å¼€å§‹åŠ è½½åº”ç”¨é…ç½®ï¼ˆä¸´æ—¶è§£ç»‘äº‹ä»¶ï¼‰...
ğŸ“– ä»é…ç½®æ–‡ä»¶è¯»å–: é£å•=True, æ”¶å•=True
âœ… åº”ç”¨é…ç½®å·²åŠ è½½: é£å•=True, æ”¶å•=True
âœ… UI å¼€å…³äº‹ä»¶å·²é‡æ–°ç»‘å®š
ğŸš€ æ£€æµ‹åˆ°é£å•å¼€å…³å¼€å¯ï¼Œå‡†å¤‡å¯åŠ¨è‡ªåŠ¨æŠ•æ³¨...

[2 ç§’å]
â³ å·²ç­‰å¾… 2 ç§’ï¼Œå¼€å§‹å¯åŠ¨è‡ªåŠ¨æŠ•æ³¨
ğŸšï¸ é£å•å¼€å…³è§¦å‘: True
ğŸš€ å¯åŠ¨è‡ªåŠ¨æŠ•æ³¨ï¼Œé…ç½®ID: 1

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” å¯åŠ¨æµè§ˆå™¨è¯Šæ–­: ConfigId=1
   å½“å‰ _browsers å­—å…¸: [1]  â† å·²ç»é‡è¿äº†ï¼
âœ… é…ç½®ä¿¡æ¯: é…ç½®1 (YunDing28)
ğŸ“Œ åœ¨ _browsers å­—å…¸ä¸­æ‰¾åˆ°ç°æœ‰å®ä¾‹
âœ… æµè§ˆå™¨å·²è¿è¡Œï¼Œæ˜¾ç¤ºçª—å£
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### å¦‚æœæµè§ˆå™¨æœªåŠæ—¶é‡è¿

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” å¯åŠ¨æµè§ˆå™¨è¯Šæ–­: ConfigId=1
   å½“å‰ _browsers å­—å…¸: []
ğŸ“Œ _browsers å­—å…¸ä¸­æ— æ­¤ configIdï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºä¸»ç¨‹åºé‡å¯åœºæ™¯
â³ ç­‰å¾… 3-5 ç§’ï¼Œç»™å·²è¿è¡Œçš„æµè§ˆå™¨é‡è¿çš„æœºä¼š...
   â³ å·²ç­‰å¾… 1 ç§’... _browsers å­—å…¸: []
   â³ å·²ç­‰å¾… 2 ç§’... _browsers å­—å…¸: [1]  â† é‡è¿äº†ï¼
âœ… æµè§ˆå™¨å·²è‡ªåŠ¨é‡è¿ï¼ï¼ˆç­‰å¾…äº† 2 ç§’ï¼‰
   æ›´æ–°å _browsers å­—å…¸: [1]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## æµ‹è¯•æ­¥éª¤

### 1. ä¸»ç¨‹åºé‡å¯æµ‹è¯•ï¼ˆå…³é”®æµ‹è¯•ï¼‰

1. **å¯åŠ¨ä¸»ç¨‹åºå’Œæµè§ˆå™¨**ï¼Œé£å•å¼€å…³å¼€å¯
2. **å…³é—­ä¸»ç¨‹åº**ï¼ˆä¸å…³æµè§ˆå™¨ï¼‰
3. **é‡æ–°å¯åŠ¨ä¸»ç¨‹åº**
4. **é¢„æœŸç»“æœ**ï¼š
   - æ—¥å¿—æ˜¾ç¤º"ç­‰å¾… 2 ç§’ï¼Œå¼€å§‹å¯åŠ¨è‡ªåŠ¨æŠ•æ³¨"
   - æ—¥å¿—æ˜¾ç¤º"æµè§ˆå™¨å·²è‡ªåŠ¨é‡è¿"æˆ–"åœ¨ _browsers å­—å…¸ä¸­æ‰¾åˆ°ç°æœ‰å®ä¾‹"
   - **ä¸ä¼šå¯åŠ¨æ–°çš„æµè§ˆå™¨çª—å£** âœ…
   - åªæœ‰ä¸€ä¸ªæµè§ˆå™¨çª—å£åœ¨è¿è¡Œ
   - çª—å£æ ‡é¢˜æ˜¾ç¤º `BsBrowser-é…ç½®1`

### 2. é¦–æ¬¡å¯åŠ¨æµ‹è¯•

1. **å…³é—­æ‰€æœ‰æµè§ˆå™¨è¿›ç¨‹**
2. **å¯åŠ¨ä¸»ç¨‹åº**ï¼Œé£å•å¼€å…³å¼€å¯
3. **é¢„æœŸç»“æœ**ï¼š
   - æ—¥å¿—æ˜¾ç¤º"ç­‰å¾… 5 ç§’åä»æœªæ£€æµ‹åˆ°æµè§ˆå™¨é‡è¿"
   - æ—¥å¿—æ˜¾ç¤º"å¯åŠ¨æ–°æµè§ˆå™¨è¿›ç¨‹"
   - å¯åŠ¨æ–°çš„æµè§ˆå™¨çª—å£ âœ…

### 3. æŠ•æ³¨åŠŸèƒ½æµ‹è¯•

1. å®Œæˆä¸»ç¨‹åºé‡å¯æµ‹è¯•å
2. å¾®ä¿¡å‘é€ `123å¤§10`
3. ç­‰å¾…å°ç›˜
4. **é¢„æœŸç»“æœ**ï¼š
   - æ—¥å¿—æ˜¾ç¤º"æ‰¾åˆ°æµè§ˆå™¨å®¢æˆ·ç«¯: configId=1"
   - æŠ•æ³¨æˆåŠŸ âœ…

---

## ç›¸å…³æ–‡ä»¶

- `BaiShengVx3Plus/Views/VxMain.cs` - ä¸»çª—å£ï¼ˆåŠ è½½é…ç½®ã€å»¶è¿Ÿå¯åŠ¨ï¼‰
- `BaiShengVx3Plus/Services/AutoBet/AutoBetService.cs` - è‡ªåŠ¨æŠ•æ³¨æœåŠ¡ï¼ˆåˆ†æ®µç­‰å¾…ï¼‰
- `BsBrowserClient/Services/SocketServer.cs` - æµè§ˆå™¨ç«¯ Socket å®¢æˆ·ç«¯ï¼ˆå¿«é€Ÿé‡è¿ï¼‰

---

## ä¿®å¤æ—¥æœŸ

2025-11-14

