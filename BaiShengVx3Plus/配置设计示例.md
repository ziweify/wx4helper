# é…ç½®è®¾è®¡å®Œæ•´ç¤ºä¾‹ ğŸ¯

## 1. åº”ç”¨çº§é…ç½®ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰

```csharp
// Models/AppConfiguration.cs
public class AppConfiguration : INotifyPropertyChanged
{
    // åº”ç”¨çº§è®¾ç½®
    public string WeChatExePath { get; set; } = @"C:\Program Files\WeChat\WeChat.exe";
    public string LoaderDllPath { get; set; } = @"libs\Loader.dll";
    public string DatabasePath { get; set; } = @"data\app.db";
    public int SocketPort { get; set; } = 19099;
    public LogLevel LogLevel { get; set; } = LogLevel.Info;
    
    // è‡ªåŠ¨ä¿å­˜é…ç½®
    public event PropertyChangedEventHandler? PropertyChanged;
}

// Services/ConfigurationManager.cs ï¼ˆä½ å·²æœ‰çš„ï¼‰
public class ConfigurationManager
{
    public static ConfigurationManager Instance { get; }
    public AppConfiguration Configuration { get; }
    
    // é…ç½®å˜åŒ–è‡ªåŠ¨ä¿å­˜åˆ° appsettings.json
}
```

**åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼š**

```csharp
// åœ¨çª—ä½“ä¸­
public class VxMain : Form
{
    private void LoadWeChat()
    {
        var config = ConfigurationManager.Instance.Configuration;
        Process.Start(config.WeChatExePath);
    }
}

// åœ¨æœåŠ¡ä¸­
public class WeChatLoaderService
{
    public void Launch()
    {
        var config = ConfigurationManager.Instance.Configuration;
        var process = Process.Start(config.WeChatExePath);
    }
}

// åœ¨å¸®åŠ©ç±»ä¸­
public static class BinggoHelper
{
    public static void Log(string msg)
    {
        var logLevel = ConfigurationManager.Instance.Configuration.LogLevel;
        if (logLevel >= LogLevel.Debug)
        {
            Console.WriteLine(msg);
        }
    }
}
```

---

## 2. ä¸šåŠ¡é…ç½®ï¼ˆä¾èµ–æ³¨å…¥ï¼‰

```csharp
// Models/Games/Binggo/BinggoGameSettings.cs ï¼ˆä½ å·²æœ‰çš„ï¼‰
public class BinggoGameSettings
{
    // æ¸¸æˆè§„åˆ™é…ç½®
    public decimal DefaultOdds { get; set; } = 1.97m;
    public decimal MinBetAmount { get; set; } = 1m;
    public decimal MaxBetAmount { get; set; } = 10000m;
    public int MaxBetItemsPerOrder { get; set; } = 10;
    
    // ç»“ç®—è§„åˆ™
    public bool AutoSettle { get; set; } = true;
    public int SettleDelaySeconds { get; set; } = 5;
}

// Program.cs æ³¨å†Œ
services.AddSingleton(new BinggoGameSettings());
```

**é€šè¿‡ä¾èµ–æ³¨å…¥ä½¿ç”¨ï¼š**

```csharp
// æœåŠ¡ä¸­ä½¿ç”¨
public class BinggoOrderService
{
    private readonly BinggoGameSettings _settings;
    private readonly ILogService _log;
    
    public BinggoOrderService(
        BinggoGameSettings settings,  // é…ç½®æ³¨å…¥
        ILogService log)
    {
        _settings = settings;
        _log = log;
    }
    
    public bool ValidateOrder(MemberOrder order)
    {
        if (order.AmountTotal < _settings.MinBetAmount)
        {
            _log.Warn("Order", $"æŠ•æ³¨é‡‘é¢å¤ªå°: {order.AmountTotal}");
            return false;
        }
        
        if (order.AmountTotal > _settings.MaxBetAmount)
        {
            _log.Error("Order", $"æŠ•æ³¨é‡‘é¢è¶…é™: {order.AmountTotal}");
            return false;
        }
        
        return true;
    }
    
    public decimal CalculateProfit(MemberOrder order, bool isWin)
    {
        if (isWin)
        {
            return order.AmountTotal * _settings.DefaultOdds;
        }
        return -order.AmountTotal;
    }
}
```

---

## 3. æ··åˆä½¿ç”¨ç¤ºä¾‹

```csharp
public class BinggoLotteryService
{
    // ä¾èµ–æ³¨å…¥çš„é…ç½®ï¼ˆä¸šåŠ¡ï¼‰
    private readonly BinggoGameSettings _gameSettings;
    private readonly ILogService _log;
    
    public BinggoLotteryService(
        BinggoGameSettings gameSettings,
        ILogService log)
    {
        _gameSettings = gameSettings;
        _log = log;
    }
    
    public async Task ProcessLotteryAsync(LotteryData lottery)
    {
        // ä½¿ç”¨åº”ç”¨çº§é…ç½®ï¼ˆå•ä¾‹ï¼‰
        var appConfig = ConfigurationManager.Instance.Configuration;
        _log.Info("Lottery", $"å¤„ç†å¼€å¥–: {lottery.IssueId}");
        
        // ä½¿ç”¨ä¸šåŠ¡é…ç½®ï¼ˆæ³¨å…¥ï¼‰
        if (_gameSettings.AutoSettle)
        {
            await Task.Delay(_gameSettings.SettleDelaySeconds * 1000);
            await SettleOrdersAsync(lottery);
        }
    }
}
```

---

## 4. ä½•æ—¶ä½¿ç”¨å“ªç§æ–¹å¼ï¼Ÿ

### å•ä¾‹ ConfigurationManager.Instance âœ…

**é€‚ç”¨åœºæ™¯ï¼š**
- âœ… åº”ç”¨å¯åŠ¨å‚æ•°ï¼ˆè·¯å¾„ã€ç«¯å£ï¼‰
- âœ… ç³»ç»Ÿçº§è®¾ç½®ï¼ˆæ—¥å¿—çº§åˆ«ã€è¯­è¨€ï¼‰
- âœ… éœ€è¦åœ¨é™æ€æ–¹æ³•/å¸®åŠ©ç±»ä¸­è®¿é—®
- âœ… é…ç½®å¾ˆå°‘å˜åŒ–

**ä½¿ç”¨ä½ç½®ï¼š**
```csharp
// ä»»ä½•åœ°æ–¹éƒ½èƒ½ç”¨
ConfigurationManager.Instance.Configuration.XXX

// çª—ä½“ä¸­
public class VxMain : Form { }

// æœåŠ¡ä¸­
public class WeChatService { }

// é™æ€å¸®åŠ©ç±»ä¸­
public static class BinggoHelper { }

// ViewModelä¸­
public class VxMainViewModel { }
```

---

### ä¾èµ–æ³¨å…¥é…ç½® âœ…

**é€‚ç”¨åœºæ™¯ï¼š**
- âœ… ä¸šåŠ¡è§„åˆ™é…ç½®ï¼ˆèµ”ç‡ã€é™é¢ï¼‰
- âœ… éœ€è¦å•å…ƒæµ‹è¯•
- âœ… å¯èƒ½æœ‰å¤šå¥—é…ç½®ï¼ˆå¼€å‘/ç”Ÿäº§ï¼‰
- âœ… é…ç½®ä¾èµ–å…¶ä»–æœåŠ¡

**ä½¿ç”¨ä½ç½®ï¼š**
```csharp
// åªèƒ½åœ¨æ³¨å†Œäº†ä¾èµ–æ³¨å…¥çš„ç±»ä¸­ä½¿ç”¨

// âœ… æœåŠ¡ä¸­ï¼ˆæ¨èï¼‰
public class BinggoOrderService
{
    private readonly BinggoGameSettings _settings;
    public BinggoOrderService(BinggoGameSettings settings) { }
}

// âœ… ViewModelä¸­
public class VxMainViewModel
{
    private readonly BinggoGameSettings _settings;
    public VxMainViewModel(BinggoGameSettings settings) { }
}

// âŒ é™æ€ç±»ä¸­ä¸èƒ½ç”¨
public static class BinggoHelper
{
    // æ— æ³•æ³¨å…¥ï¼Œç”¨å•ä¾‹å§
}
```

---

## 5. ä½ çš„é¡¹ç›®å½“å‰ç»“æ„

```
é…ç½®å±‚æ¬¡ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨çº§é…ç½® (å…¨å±€å•ä¾‹)                        â”‚
â”‚  ConfigurationManager.Instance.Configuration â”‚
â”‚  - WeChatExePath                             â”‚
â”‚  - DatabasePath                              â”‚
â”‚  - LogLevel                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ è¢«æ‰€æœ‰å±‚è®¿é—®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡é…ç½® (DIæ³¨å…¥)                            â”‚
â”‚  - BinggoGameSettings                        â”‚
â”‚  - AutoBetSettings                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ æ³¨å…¥åˆ°æœåŠ¡å±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœåŠ¡å±‚                                       â”‚
â”‚  - BinggoOrderService                        â”‚
â”‚  - BinggoLotteryService                      â”‚
â”‚  - AutoBetService                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. å®æˆ˜ç¤ºä¾‹ï¼šæ·»åŠ æ–°é…ç½®

### åœºæ™¯ï¼šæ·»åŠ "è‡ªåŠ¨æŠ•æ³¨é…ç½®"

```csharp
// Step 1: åˆ›å»ºé…ç½®ç±»
public class AutoBetSettings
{
    public bool EnableAutoBet { get; set; } = false;
    public int MaxConcurrentBets { get; set; } = 5;
    public decimal DailyBetLimit { get; set; } = 10000m;
    public TimeSpan BetWindowClose { get; set; } = TimeSpan.FromSeconds(30);
}

// Step 2: æ³¨å†Œåˆ° Program.cs
services.AddSingleton(new AutoBetSettings());

// Step 3: åœ¨æœåŠ¡ä¸­ä½¿ç”¨
public class AutoBetService
{
    private readonly AutoBetSettings _settings;
    private readonly ILogService _log;
    
    public AutoBetService(AutoBetSettings settings, ILogService log)
    {
        _settings = settings;
        _log = log;
    }
    
    public bool CanPlaceBet(decimal amount)
    {
        if (!_settings.EnableAutoBet)
        {
            _log.Warn("AutoBet", "è‡ªåŠ¨æŠ•æ³¨å·²ç¦ç”¨");
            return false;
        }
        
        if (amount > _settings.DailyBetLimit)
        {
            _log.Error("AutoBet", $"è¶…è¿‡æ¯æ—¥é™é¢: {amount}");
            return false;
        }
        
        return true;
    }
}
```

---

## 7. å¸¸è§é—®é¢˜ FAQ

### Q1: ä¸ºä»€ä¹ˆæœ‰äº›é…ç½®ç”¨å•ä¾‹ï¼Œæœ‰äº›ç”¨DIï¼Ÿ

**A:** 
- **å•ä¾‹** = å…¨å±€å”¯ä¸€ + ä»»ä½•åœ°æ–¹éƒ½èƒ½è®¿é—®
- **DI** = èŒè´£æ¸…æ™° + ä¾¿äºæµ‹è¯• + ä¾èµ–æ˜ç¡®

### Q2: æˆ‘èƒ½åœ¨é™æ€æ–¹æ³•ä¸­è®¿é—®DIé…ç½®å—ï¼Ÿ

**A:** ä¸èƒ½ï¼é™æ€æ–¹æ³•æ— æ³•æ³¨å…¥ä¾èµ–ã€‚
- âœ… ç”¨å•ä¾‹ï¼š`ConfigurationManager.Instance`
- âŒ ä¸èƒ½ç”¨DIæ³¨å…¥

### Q3: é…ç½®æ”¹å˜åæ€ä¹ˆç”Ÿæ•ˆï¼Ÿ

**å•ä¾‹é…ç½®ï¼š**
```csharp
// è‡ªåŠ¨ä¿å­˜ï¼ˆPropertyChangedäº‹ä»¶ï¼‰
ConfigurationManager.Instance.Configuration.LogLevel = LogLevel.Debug;
// å·²è‡ªåŠ¨ä¿å­˜åˆ° appsettings.json
```

**DIé…ç½®ï¼š**
```csharp
// éœ€è¦æ‰‹åŠ¨æ›´æ–°
var settings = ServiceProvider.GetService<BinggoGameSettings>();
settings.DefaultOdds = 2.0m;
// è¿è¡Œæ—¶ç”Ÿæ•ˆï¼Œä½†ä¸ä¼šæŒä¹…åŒ–
```

### Q4: æˆ‘è¯¥åœ¨å“ªé‡Œä¿®æ”¹é…ç½®ï¼Ÿ

```csharp
// æ–¹å¼1ï¼šUIè®¾ç½®çª—å£
public class SettingsForm : Form
{
    private void btnSave_Click(object sender, EventArgs e)
    {
        var config = ConfigurationManager.Instance.Configuration;
        config.LogLevel = (LogLevel)cmbLogLevel.SelectedValue;
        // è‡ªåŠ¨ä¿å­˜
    }
}

// æ–¹å¼2ï¼šç›´æ¥ä¿®æ”¹ appsettings.json æ–‡ä»¶
{
  "WeChatExePath": "C:\\Program Files\\WeChat\\WeChat.exe",
  "LogLevel": "Debug"
}
```

---

## 8. æœ€ä½³å®è·µæ€»ç»“

| åŸåˆ™ | è¯´æ˜ |
|-----|------|
| **å•ä¸€èŒè´£** | åº”ç”¨é…ç½®å½’ConfigurationManagerï¼Œä¸šåŠ¡é…ç½®å„è‡ªç‹¬ç«‹ |
| **æœ€å°ä¾èµ–** | é…ç½®ç±»ä¸ä¾èµ–å…¶ä»–æœåŠ¡ |
| **ç±»å‹å®‰å…¨** | ç”¨å¼ºç±»å‹é…ç½®ç±»ï¼Œä¸è¦ç”¨å­—å…¸ |
| **é»˜è®¤å€¼** | æ‰€æœ‰é…ç½®éƒ½æœ‰åˆç†çš„é»˜è®¤å€¼ |
| **éªŒè¯** | åŠ è½½é…ç½®æ—¶éªŒè¯æœ‰æ•ˆæ€§ |
| **æ³¨é‡Š** | æ¯ä¸ªé…ç½®é¡¹éƒ½æœ‰æ¸…æ™°çš„æ³¨é‡Š |

---

## 9. æ£€æŸ¥æ¸…å• âœ…

æ·»åŠ æ–°é…ç½®å‰ï¼Œé—®è‡ªå·±ï¼š

- [ ] è¿™æ˜¯åº”ç”¨çº§é…ç½®è¿˜æ˜¯ä¸šåŠ¡é…ç½®ï¼Ÿ
- [ ] éœ€è¦åœ¨é™æ€ç±»/å¸®åŠ©ç±»ä¸­ä½¿ç”¨å—ï¼Ÿâ†’ å•ä¾‹
- [ ] éœ€è¦å•å…ƒæµ‹è¯•å—ï¼Ÿâ†’ DI
- [ ] ä¼šé¢‘ç¹å˜åŒ–å—ï¼Ÿâ†’ DI
- [ ] éœ€è¦æŒä¹…åŒ–å—ï¼Ÿâ†’ è€ƒè™‘ä¿å­˜åˆ°æ–‡ä»¶/æ•°æ®åº“
- [ ] æœ‰é»˜è®¤å€¼å—ï¼Ÿ
- [ ] æœ‰éªŒè¯é€»è¾‘å—ï¼Ÿ

---

**è®°ä½ï¼šé…ç½®ä¸æ˜¯æœåŠ¡ï¼Œä½†å¯ä»¥æ³¨å…¥åˆ°æœåŠ¡ä¸­ï¼** ğŸš€

