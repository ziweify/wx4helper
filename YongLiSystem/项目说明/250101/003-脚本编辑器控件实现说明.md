# è„šæœ¬ç¼–è¾‘å™¨æ§ä»¶å®ç°è¯´æ˜

**ğŸ“… åˆ›å»ºæ—¥æœŸ**: 2025-01-01  
**ğŸ¯ çŠ¶æ€**: ä»£ç å·²å®ç°ï¼Œç­‰å¾…ç¼–è¯‘éªŒè¯

---

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. è„šæœ¬å¼•æ“å±‚
- âœ… `IScriptEngine` æ¥å£ï¼ˆ`æ°¸åˆ©ç³»ç»Ÿ/Services/Scripting/IScriptEngine.cs`ï¼‰
- âœ… `MoonSharpScriptEngine` å®ç°ï¼ˆ`æ°¸åˆ©ç³»ç»Ÿ/Services/Scripting/MoonSharpScriptEngine.cs`ï¼‰
- âœ… `ScriptFunctionRegistry` åŠŸèƒ½æ³¨å†Œè¡¨ï¼ˆ`æ°¸åˆ©ç³»ç»Ÿ/Services/Scripting/ScriptFunctionRegistry.cs`ï¼‰

### 2. è„šæœ¬ç¼–è¾‘å™¨æ§ä»¶
- âœ… `ScriptEditorControl` æ§ä»¶ï¼ˆ`æ°¸åˆ©ç³»ç»Ÿ/Views/Shared/Controls/ScriptEditorControl.cs`ï¼‰
- âœ… è®¾è®¡å™¨æ–‡ä»¶ï¼ˆ`æ°¸åˆ©ç³»ç»Ÿ/Views/Shared/Controls/ScriptEditorControl.Designer.cs`ï¼‰

### 3. NuGet åŒ…
- âœ… MoonSharp 2.0.0
- âœ… ScintillaNET 5.3.0

---

## ğŸ“¦ å·²åˆ›å»ºçš„æ–‡ä»¶

### è„šæœ¬å¼•æ“ç›¸å…³
1. `æ°¸åˆ©ç³»ç»Ÿ/Services/Scripting/IScriptEngine.cs` - è„šæœ¬å¼•æ“æ¥å£å’Œç»“æœç±»
2. `æ°¸åˆ©ç³»ç»Ÿ/Services/Scripting/MoonSharpScriptEngine.cs` - MoonSharp Luaå¼•æ“å®ç°
3. `æ°¸åˆ©ç³»ç»Ÿ/Services/Scripting/ScriptFunctionRegistry.cs` - åŠŸèƒ½æ³¨å†Œè¡¨

### ç¼–è¾‘å™¨æ§ä»¶
4. `æ°¸åˆ©ç³»ç»Ÿ/Views/Shared/Controls/ScriptEditorControl.cs` - è„šæœ¬ç¼–è¾‘å™¨æ§ä»¶ä¸»ç±»
5. `æ°¸åˆ©ç³»ç»Ÿ/Views/Shared/Controls/ScriptEditorControl.Designer.cs` - è®¾è®¡å™¨æ–‡ä»¶

---

## ğŸ”§ ç¼–è¯‘æ­¥éª¤

### æ–¹æ³•1ï¼šä½¿ç”¨ Visual Studio
1. æ‰“å¼€ Visual Studio
2. æ‰“å¼€è§£å†³æ–¹æ¡ˆ `Vx3Plus.sln` æˆ–ç›´æ¥æ‰“å¼€ `æ°¸åˆ©ç³»ç»Ÿ/æ°¸åˆ©ç³»ç»Ÿ.csproj`
3. å³é”®é¡¹ç›® â†’ è¿˜åŸ NuGet åŒ…
4. ç”Ÿæˆ â†’ ç”Ÿæˆè§£å†³æ–¹æ¡ˆï¼ˆæˆ–æŒ‰ Ctrl+Shift+Bï¼‰

### æ–¹æ³•2ï¼šä½¿ç”¨å‘½ä»¤è¡Œ
ç”±äºè·¯å¾„åŒ…å«ä¸­æ–‡ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š

**PowerShell è„šæœ¬**ï¼ˆæ¨èï¼‰ï¼š
```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd æ°¸åˆ©ç³»ç»Ÿ
dotnet restore
dotnet build
```

**æˆ–è€…ä½¿ç”¨æä¾›çš„ç¼–è¯‘è„šæœ¬**ï¼š
```powershell
# åœ¨ æ°¸åˆ©ç³»ç»Ÿ ç›®å½•ä¸‹æ‰§è¡Œ
.\ç¼–è¯‘è„šæœ¬.ps1
```

---

## âš ï¸ å¯èƒ½éœ€è¦çš„è°ƒæ•´

### 1. ScintillaNET Lua è¯­æ³•é«˜äº®
å½“å‰å®ç°ä½¿ç”¨äº† `Lexer.Container`ï¼Œå› ä¸º ScintillaNET å¯èƒ½æ²¡æœ‰å†…ç½® Lua Lexerã€‚

**å¦‚æœéœ€è¦å®Œæ•´çš„ Lua è¯­æ³•é«˜äº®ï¼Œå¯ä»¥ï¼š**
- ä½¿ç”¨è‡ªå®šä¹‰è¯­æ³•é«˜äº®è§„åˆ™
- æˆ–è€…ä½¿ç”¨æ”¯æŒ Lua çš„å…¶ä»–ç¼–è¾‘å™¨æ§ä»¶ï¼ˆå¦‚ Actipro SyntaxEditorï¼‰

### 2. MoonSharp API éªŒè¯
å¦‚æœç¼–è¯‘æ—¶å‡ºç° MoonSharp API é”™è¯¯ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ï¼š
- `DynValue.FromObject()` çš„å‚æ•°
- `Script.Globals` çš„èµ‹å€¼æ–¹å¼

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```csharp
// åˆ›å»ºæ§ä»¶
var editor = new ScriptEditorControl();
editor.Dock = DockStyle.Fill;
this.Controls.Add(editor);

// è®¾ç½®è„šæœ¬
editor.ScriptText = @"
function test()
    return 'Hello World'
end
";

// æ‰§è¡Œè„šæœ¬
var result = editor.ExecuteScript();
```

### ç»‘å®šåŠŸèƒ½
```csharp
// ç»‘å®šè‡ªå®šä¹‰å‡½æ•°
editor.BindFunction("log", new Action<string>(msg => 
{
    MessageBox.Show(msg);
}));
```

---

## ğŸ” ç¼–è¯‘æ£€æŸ¥æ¸…å•

- [x] NuGet åŒ…å·²æ·»åŠ åˆ°é¡¹ç›®æ–‡ä»¶
- [x] è„šæœ¬å¼•æ“æ¥å£å·²åˆ›å»º
- [x] MoonSharp å¼•æ“å®ç°å·²åˆ›å»º
- [x] åŠŸèƒ½æ³¨å†Œè¡¨å·²åˆ›å»º
- [x] è„šæœ¬ç¼–è¾‘å™¨æ§ä»¶å·²åˆ›å»º
- [x] è®¾è®¡å™¨æ–‡ä»¶å·²åˆ›å»º
- [ ] **ç¼–è¯‘éªŒè¯**ï¼ˆéœ€è¦æ‰‹åŠ¨æ‰§è¡Œï¼‰

---

## ğŸ› å¦‚æœç¼–è¯‘å¤±è´¥

### å¸¸è§é—®é¢˜

1. **MoonSharp API é”™è¯¯**
   - æ£€æŸ¥ `DynValue.FromObject()` çš„ä½¿ç”¨
   - å¯èƒ½éœ€è¦ä½¿ç”¨ `UserData.Create()` æˆ–å…¶ä»–API

2. **ScintillaNET å¼•ç”¨é”™è¯¯**
   - ç¡®ä¿ NuGet åŒ…å·²æ­£ç¡®å®‰è£…
   - æ£€æŸ¥å‘½åç©ºé—´æ˜¯å¦æ­£ç¡®

3. **è®¾è®¡å™¨æ— æ³•æ‰“å¼€**
   - ç¡®ä¿ ScintillaNET æ§ä»¶å·²æ­£ç¡®åˆå§‹åŒ–
   - æ£€æŸ¥ Designer.cs æ–‡ä»¶æ˜¯å¦æ­£ç¡®

---

**è¯·æ‰§è¡Œç¼–è¯‘éªŒè¯ï¼Œå¦‚æœ‰é”™è¯¯è¯·å‘ŠçŸ¥ï¼Œæˆ‘ä¼šç«‹å³ä¿®å¤** âœ…
