# ç›‘æ§ABCæµè§ˆå™¨é›†æˆå®ŒæˆæŠ¥å‘Š

## ğŸ“… æ—¥æœŸ
2025-12-30

## ğŸ¯ ä»»åŠ¡ç›®æ ‡

å°† `Unit.Browser` æµè§ˆå™¨çª—å£é›†æˆåˆ°ç›‘æ§ABCä¸­ï¼Œå®ç°é…ç½®ã€è¿æ¥å’Œæµ‹è¯•åŠŸèƒ½ã€‚

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. åˆ›å»ºç›‘æ§æ§ä»¶åŸºç±»

**MonitorControlBase.cs** - æ‰€æœ‰ç›‘æ§æ§ä»¶çš„åŸºç±»ï¼Œæä¾›ç»Ÿä¸€çš„åŠŸèƒ½ï¼š

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… **åˆå§‹åŒ–æµè§ˆå™¨**: æ ¹æ®é…ç½®åˆ›å»ºç‹¬ç«‹çš„æµè§ˆå™¨çª—å£
- âœ… **å¯åŠ¨/åœæ­¢ç›‘æ§**: æ§åˆ¶ç›‘æ§å¾ªç¯çš„ç”Ÿå‘½å‘¨æœŸ
- âœ… **è‡ªåŠ¨ç™»å½•**: æ”¯æŒé…ç½®è‡ªåŠ¨ç™»å½•åŠŸèƒ½
- âœ… **å‘½ä»¤æ‰§è¡Œ**: ç™»å½•ã€é‡‡é›†ã€è·å–Cookieä¸‰ä¸ªåŸºç¡€å‘½ä»¤
- âœ… **æ—¥å¿—è®°å½•**: ç»Ÿä¸€çš„æ—¥å¿—è¾“å‡ºå’Œç®¡ç†
- âœ… **çŠ¶æ€ç®¡ç†**: å®æ—¶æ›´æ–°ç›‘æ§çŠ¶æ€

#### UIæ§ä»¶
- `åˆå§‹åŒ–æµè§ˆå™¨` æŒ‰é’® - åˆ›å»ºå¹¶å¯åŠ¨æµè§ˆå™¨çª—å£
- `å¯åŠ¨ç›‘æ§` æŒ‰é’® - å¼€å§‹ç›‘æ§å¾ªç¯
- `åœæ­¢ç›‘æ§` æŒ‰é’® - åœæ­¢ç›‘æ§å¾ªç¯
- `æ˜¾ç¤ºæµè§ˆå™¨` æŒ‰é’® - æ˜¾ç¤º/å‰ç½®æµè§ˆå™¨çª—å£
- çŠ¶æ€æ ‡ç­¾ - æ˜¾ç¤ºå½“å‰ç›‘æ§çŠ¶æ€
- æ—¥å¿—åŒºåŸŸ - æ˜¾ç¤ºè¯¦ç»†çš„æ“ä½œæ—¥å¿—ï¼ˆé™åˆ¶500è¡Œï¼‰

### 2. åˆ›å»ºABCä¸‰ä¸ªç›‘æ§æ§ä»¶

åŸºäº `MonitorControlBase` åˆ›å»ºäº†ä¸‰ä¸ªå…·ä½“çš„ç›‘æ§æ§ä»¶ï¼š

#### MonitorA_Controlï¼ˆç›‘æ§A - å°æ¹¾å½©ç¥¨ï¼‰
- é»˜è®¤URL: `https://www.taiwanlottery.com.tw/lotto/BingoBingo/OEHLStatistic.htm`
- ç›‘æ§é€»è¾‘: æ¯10ç§’é‡‡é›†ä¸€æ¬¡é¡µé¢æ•°æ®
- é»˜è®¤è„šæœ¬: è·å–æœŸå·ä¿¡æ¯

#### MonitorB_Controlï¼ˆç›‘æ§Bï¼‰
- é»˜è®¤URL: `https://example.com/monitor-b`
- åŸºç¡€ç›‘æ§å¾ªç¯ï¼ˆå¯è‡ªå®šä¹‰æ‰©å±•ï¼‰

#### MonitorC_Controlï¼ˆç›‘æ§Cï¼‰
- é»˜è®¤URL: `https://example.com/monitor-c`
- åŸºç¡€ç›‘æ§å¾ªç¯ï¼ˆå¯è‡ªå®šä¹‰æ‰©å±•ï¼‰

### 3. é›†æˆé…ç½®ä¸ç›‘æ§

åœ¨ `DataCollectionPage` ä¸­å®Œæˆäº†é…ç½®ä¸ç›‘æ§çš„è¿æ¥ï¼š

#### è¿æ¥æµç¨‹
```csharp
1. InitializeMonitorConfig()      // åˆå§‹åŒ–é…ç½®å®¹å™¨
2. SetDefaultConfigs()             // è®¾ç½®é»˜è®¤é…ç½®
3. InitializeMonitorControls()     // åˆå§‹åŒ–ç›‘æ§æ§ä»¶
4. ConnectMonitorsWithConfig()     // è¿æ¥é…ç½®ä¸ç›‘æ§
```

#### é…ç½®ä¸ç›‘æ§çš„åŒå‘ç»‘å®š
- é…ç½®æ§ä»¶ â†’ ç›‘æ§æ§ä»¶: é€šè¿‡ `SetConfig()` æ–¹æ³•ä¼ é€’é…ç½®
- ç›‘æ§æ§ä»¶ â†’ é…ç½®æ§ä»¶: æ›´æ–° `LatestIssueData` æ˜¾ç¤ºæœ€æ–°æ•°æ®
- å‘½ä»¤æŒ‰é’®: é…ç½®æ§ä»¶çš„å‘½ä»¤æŒ‰é’®ç›´æ¥è§¦å‘ç›‘æ§æ§ä»¶çš„ç›¸åº”åŠŸèƒ½

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DataCollectionPage (æ•°æ®é‡‡é›†é¡µé¢)                       â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ é…ç½®æ ‡ç­¾é¡µ      â”‚          â”‚ ç›‘æ§æ ‡ç­¾é¡µ      â”‚       â”‚
â”‚  â”‚                 â”‚          â”‚                 â”‚       â”‚
â”‚  â”‚ â”Œâ”€ ç›‘æ§é…ç½® â”€â”€â”€â”â”‚          â”‚ â”Œâ”€ ç›‘æ§A â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚ â”‚[A][B][C]     â”‚â”‚          â”‚ â”‚ æµè§ˆå™¨çª—å£   â”‚â”‚       â”‚
â”‚  â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚          â”‚ â”‚ [åˆå§‹åŒ–]     â”‚â”‚       â”‚
â”‚  â”‚ â”‚â”‚é…ç½®æ§ä»¶A  â”‚ â”‚â”‚â—„â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¤ â”‚ [å¯åŠ¨ç›‘æ§]   â”‚â”‚       â”‚
â”‚  â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚     â”‚    â”‚ â”‚ [åœæ­¢ç›‘æ§]   â”‚â”‚       â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚     â”‚    â”‚ â”‚ [æ˜¾ç¤ºæµè§ˆå™¨] â”‚â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚ â”‚ æ—¥å¿—åŒºåŸŸ     â”‚â”‚       â”‚
â”‚                           â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚                           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                           â”‚                              â”‚
â”‚                           â””â”€â”€â”€â”€ åŒå‘æ•°æ®ç»‘å®š              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é…ç½®ä¸ç›‘æ§çš„äº¤äº’æµç¨‹

```
é…ç½®æ§ä»¶                    ç›‘æ§æ§ä»¶                   æµè§ˆå™¨çª—å£
   â”‚                          â”‚                          â”‚
   â”‚â”€â”€SetConfig()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                          â”‚                          â”‚
   â”‚                          â”‚â”€â”€InitializeBrowserAsync()>â”‚
   â”‚                          â”‚                          â”‚
   â”‚                          â”‚<â”€â”€â”€â”€â”€OnLogäº‹ä»¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚<â”€LatestIssueDataæ›´æ–°â”€â”€â”€â”€â”€â”‚                          â”‚
   â”‚                          â”‚                          â”‚
   â”‚â”€â”€ç™»å½•æŒ‰é’®ç‚¹å‡»â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚â”€â”€ExecuteLoginAsync()â”€â”€>â”‚
   â”‚                          â”‚                          â”‚
   â”‚â”€â”€é‡‡é›†æŒ‰é’®ç‚¹å‡»â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚â”€â”€ExecuteCollectAsync()â”€>â”‚
   â”‚                          â”‚                          â”‚
   â”‚â”€â”€è·å–Cookieç‚¹å‡»â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚â”€â”€ExecuteGetCookieAsync()>â”‚
```

## ğŸ“‹ åŠŸèƒ½æ¸…å•

### é…ç½®åŠŸèƒ½
- âœ… è®¾ç½®ç›‘æ§URL
- âœ… è®¾ç½®ç™»å½•ç”¨æˆ·åå’Œå¯†ç 
- âœ… é…ç½®æ˜¯å¦è‡ªåŠ¨ç™»å½•
- âœ… ç¼–å†™è‡ªå®šä¹‰é‡‡é›†è„šæœ¬
- âœ… æŸ¥çœ‹æœ€æ–°æœŸå·æ•°æ®
- âœ… æ‰§è¡Œç™»å½•å‘½ä»¤
- âœ… æ‰§è¡Œé‡‡é›†å‘½ä»¤
- âœ… è·å–Cookieå‘½ä»¤

### ç›‘æ§åŠŸèƒ½
- âœ… åˆå§‹åŒ–ç‹¬ç«‹æµè§ˆå™¨çª—å£
- âœ… å¯åŠ¨/åœæ­¢ç›‘æ§å¾ªç¯
- âœ… è‡ªåŠ¨ç™»å½•ï¼ˆå¯é…ç½®ï¼‰
- âœ… å®šæ—¶æ•°æ®é‡‡é›†
- âœ… å®æ—¶æ—¥å¿—æ˜¾ç¤º
- âœ… çŠ¶æ€ç›‘æ§
- âœ… æ˜¾ç¤º/éšè—æµè§ˆå™¨çª—å£

### æµè§ˆå™¨åŠŸèƒ½ï¼ˆUnit.Browserï¼‰
- âœ… ç‹¬ç«‹çº¿ç¨‹è¿è¡Œï¼Œä¸å¡ä¸»çº¿ç¨‹
- âœ… å®Œæ•´çš„UIï¼ˆåœ°å€æ ã€æ—¥å¿—ã€çŠ¶æ€æ ï¼‰
- âœ… æ”¯æŒå¯¼èˆªã€åˆ·æ–°ç­‰åŸºç¡€æ“ä½œ
- âœ… æ‰§è¡ŒJavaScriptè„šæœ¬
- âœ… è·å–Cookie
- âœ… å‘½ä»¤æ‰§è¡Œè¶…æ—¶æ§åˆ¶
- âœ… çº¿ç¨‹å®‰å…¨çš„å‘½ä»¤é€šä¿¡

## ğŸ® ä½¿ç”¨æµç¨‹

### 1. é…ç½®é˜¶æ®µ

1. åˆ‡æ¢åˆ°"é…ç½®"æ ‡ç­¾é¡µ
2. é€‰æ‹©è¦é…ç½®çš„ç›‘æ§ï¼ˆAã€Bæˆ–Cï¼‰
3. å¡«å†™é…ç½®ä¿¡æ¯ï¼š
   - ç½‘å€ï¼šç›®æ ‡ç›‘æ§ç½‘ç«™
   - ç”¨æˆ·å/å¯†ç ï¼šç™»å½•å‡­è¯ï¼ˆå¯é€‰ï¼‰
   - è‡ªåŠ¨ç™»å½•ï¼šå‹¾é€‰ååˆå§‹åŒ–æ—¶è‡ªåŠ¨ç™»å½•
   - è„šæœ¬ï¼šè‡ªå®šä¹‰æ•°æ®é‡‡é›†è„šæœ¬

### 2. åˆå§‹åŒ–é˜¶æ®µ

1. åˆ‡æ¢åˆ°å¯¹åº”çš„ç›‘æ§æ ‡ç­¾é¡µï¼ˆç›‘æ§Aã€Bæˆ–Cï¼‰
2. ç‚¹å‡»"åˆå§‹åŒ–æµè§ˆå™¨"æŒ‰é’®
3. ç³»ç»Ÿè‡ªåŠ¨ï¼š
   - åˆ›å»ºç‹¬ç«‹çš„æµè§ˆå™¨çª—å£
   - å¯¼èˆªåˆ°é…ç½®çš„URL
   - æ˜¾ç¤ºæµè§ˆå™¨çª—å£
   - å¦‚æœé…ç½®äº†è‡ªåŠ¨ç™»å½•ï¼Œæ‰§è¡Œç™»å½•æ“ä½œ

### 3. ç›‘æ§é˜¶æ®µ

1. ç‚¹å‡»"å¯åŠ¨ç›‘æ§"æŒ‰é’®
2. ç³»ç»Ÿå¼€å§‹å®šæ—¶ç›‘æ§å¾ªç¯ï¼ˆæ¯10ç§’ï¼‰
3. å®æ—¶åœ¨æ—¥å¿—åŒºåŸŸæ˜¾ç¤ºç›‘æ§ç»“æœ
4. é…ç½®ä¸­çš„"æœ€æ–°æœŸå·"å®æ—¶æ›´æ–°

### 4. æ‰‹åŠ¨æ“ä½œ

åœ¨é…ç½®æ ‡ç­¾é¡µä¸­å¯ä»¥éšæ—¶æ‰§è¡Œï¼š
- **ç™»å½•**: æ‰‹åŠ¨è§¦å‘ç™»å½•æ“ä½œ
- **é‡‡é›†**: ç«‹å³æ‰§è¡Œä¸€æ¬¡æ•°æ®é‡‡é›†
- **è·å–Cookie**: æŸ¥çœ‹å½“å‰Cookieä¿¡æ¯

## ğŸ“ ä»£ç ç¤ºä¾‹

### ä½¿ç”¨ç›‘æ§æ§ä»¶

```csharp
// åˆ›å»ºç›‘æ§æ§ä»¶
var monitorA = new MonitorA_Control();

// åˆ›å»ºé…ç½®æ§ä»¶
var config = new MonitorConfigControl();
config.Url = "https://example.com";
config.Username = "admin";
config.Password = "123456";
config.AutoLogin = true;

// è¿æ¥é…ç½®ä¸ç›‘æ§
monitorA.SetConfig(config);

// ç°åœ¨å¯ä»¥é€šè¿‡UIæˆ–ä»£ç æ“ä½œç›‘æ§
```

### è‡ªå®šä¹‰ç›‘æ§é€»è¾‘

```csharp
public class CustomMonitor : MonitorControlBase
{
    protected override string MonitorName => "è‡ªå®šä¹‰ç›‘æ§";

    protected override async Task MonitoringLoopAsync(CancellationToken cancellationToken)
    {
        while (!cancellationToken.IsCancellationRequested)
        {
            // å®ç°è‡ªå®šä¹‰ç›‘æ§é€»è¾‘
            var result = await _browserProxy!.ExecuteCommandAsync("æ‰§è¡Œè„šæœ¬", 
                "return document.querySelector('.data').innerText;");
            
            if (result.Success)
            {
                LogMessage($"é‡‡é›†æ•°æ®: {result.Data}");
            }
            
            await Task.Delay(10000, cancellationToken);
        }
    }
}
```

### è‡ªå®šä¹‰é‡‡é›†è„šæœ¬

åœ¨é…ç½®çš„"è„šæœ¬"åŒºåŸŸè¾“å…¥ï¼š

```javascript
(function() {
    try {
        // è·å–æœŸå·
        var issueEl = document.querySelector('.issue-number');
        // è·å–å¼€å¥–å·ç 
        var numbersEl = document.querySelector('.lottery-numbers');
        
        return {
            success: true,
            issue: issueEl ? issueEl.innerText : '',
            numbers: numbersEl ? numbersEl.innerText : '',
            timestamp: new Date().toLocaleString()
        };
    } catch(e) {
        return { success: false, message: e.message };
    }
})();
```

## ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹

### 1. çº¿ç¨‹éš”ç¦»
- æ¯ä¸ªæµè§ˆå™¨çª—å£è¿è¡Œåœ¨ç‹¬ç«‹çš„STAçº¿ç¨‹
- ä¸»UIçº¿ç¨‹ä¸ä¼šè¢«æµè§ˆå™¨æ“ä½œé˜»å¡
- å‘½ä»¤æ‰§è¡Œä½¿ç”¨ `BlockingCollection` + `TaskCompletionSource`

### 2. äº‹ä»¶é©±åŠ¨
- é…ç½®æ§ä»¶å‘å‡ºå‘½ä»¤äº‹ä»¶
- ç›‘æ§æ§ä»¶å“åº”å¹¶æ‰§è¡Œ
- ç»“æœé€šè¿‡æ—¥å¿—åé¦ˆ

### 3. å¯æ‰©å±•æ€§
- åŸºç±»æä¾›æ ¸å¿ƒåŠŸèƒ½
- å­ç±»é‡å†™ `MonitoringLoopAsync` å®ç°è‡ªå®šä¹‰é€»è¾‘
- é…ç½®è„šæœ¬åŠ¨æ€æ‰§è¡Œ

### 4. çŠ¶æ€ç®¡ç†
- UIæŒ‰é’®çŠ¶æ€è‡ªåŠ¨ç®¡ç†
- ç›‘æ§çŠ¶æ€å®æ—¶æ˜¾ç¤º
- æ—¥å¿—è‡ªåŠ¨é™åˆ¶è¡Œæ•°ï¼ˆ500è¡Œï¼‰

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **WebView2 è¿è¡Œæ—¶**: éœ€è¦å®‰è£… Microsoft Edge WebView2 Runtime
2. **URLéªŒè¯**: åˆå§‹åŒ–å‰ä¼šéªŒè¯URLæ˜¯å¦é…ç½®
3. **è‡ªåŠ¨ç™»å½•**: ç™»å½•è„šæœ¬éœ€è¦æ ¹æ®å®é™…ç½‘ç«™è°ƒæ•´DOMé€‰æ‹©å™¨
4. **è„šæœ¬æ ¼å¼**: é‡‡é›†è„šæœ¬éœ€è¦è¿”å›JSONæ ¼å¼çš„ç»“æœå¯¹è±¡
5. **ç›‘æ§é—´éš”**: é»˜è®¤10ç§’ï¼Œå¯ä»¥åœ¨å­ç±»ä¸­ä¿®æ”¹
6. **èµ„æºé‡Šæ”¾**: å…³é—­é¡µé¢æ—¶è‡ªåŠ¨é‡Šæ”¾æµè§ˆå™¨èµ„æº

## ğŸ“Š æ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `MonitorControlBase.cs` | ç›‘æ§æ§ä»¶åŸºç±» |
| `MonitorA_Control.cs/.Designer.cs` | ç›‘æ§Aæ§ä»¶ï¼ˆå°æ¹¾å½©ç¥¨ï¼‰ |
| `MonitorB_Control.cs/.Designer.cs` | ç›‘æ§Bæ§ä»¶ |
| `MonitorC_Control.cs/.Designer.cs` | ç›‘æ§Cæ§ä»¶ |
| `MonitorConfigControl.cs/.Designer.cs` | å•ä¸ªç›‘æ§é…ç½®æ§ä»¶ |
| `MonitorConfigContainerControl.cs/.Designer.cs` | ABCé…ç½®å®¹å™¨ |
| `DataCollectionPage.cs` | æ•°æ®é‡‡é›†é¡µé¢ï¼ˆå·²æ›´æ–°ï¼‰ |

## ğŸ‰ æ€»ç»“

âœ… å·²æˆåŠŸå°† `Unit.Browser` æµè§ˆå™¨é›†æˆåˆ°ç›‘æ§ABCä¸­
âœ… æä¾›å®Œæ•´çš„é…ç½®ã€åˆå§‹åŒ–ã€ç›‘æ§ã€æµ‹è¯•åŠŸèƒ½
âœ… æ”¯æŒè‡ªåŠ¨ç™»å½•å’Œè‡ªå®šä¹‰è„šæœ¬
âœ… ä¸‰ä¸ªç›‘æ§å¯ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸å¹²æ‰°
âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤

ç°åœ¨å¯ä»¥ï¼š
1. åœ¨"é…ç½®"æ ‡ç­¾é¡µä¸­é…ç½®ç›‘æ§ABC
2. åœ¨"ç›‘æ§A/B/C"æ ‡ç­¾é¡µä¸­åˆå§‹åŒ–æµè§ˆå™¨
3. å¯åŠ¨ç›‘æ§å¹¶æŸ¥çœ‹å®æ—¶æ—¥å¿—
4. éšæ—¶æ‰§è¡Œç™»å½•ã€é‡‡é›†ã€è·å–Cookieç­‰å‘½ä»¤

---

**åˆ›å»ºæ—¥æœŸ**: 2025-12-30  
**ä½œè€…**: AI Assistant  
**é¡¹ç›®**: æ°¸åˆ©ç³»ç»Ÿ - ç›‘æ§ABCæµè§ˆå™¨é›†æˆ

