# è®¾è®¡å™¨å®Œå…¨æ— æ³•ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆ

**ğŸ“… æ—¥æœŸ**: 2025-12-22  
**ğŸ“Œ é—®é¢˜**: RibbonControl è®¾è®¡å™¨å®Œå…¨æ— æ³•ä½¿ç”¨ï¼Œå±æ€§çª—å£ä¹Ÿæ‰¾ä¸åˆ° Pages å±æ€§  

---

## ğŸ”´ é—®é¢˜ç¡®è®¤

1. âŒ ç‚¹å‡»æ ‡ç­¾é¡µæ— ååº”
2. âŒ ç‚¹å‡»"+"æŒ‰é’®æ— ååº”
3. âŒ å±æ€§çª—å£æ‰¾ä¸åˆ° `Pages` å±æ€§
4. âŒ è®¾è®¡å™¨æ— æ³•æ­£å¸¸ä½¿ç”¨

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šå®Œå…¨é€šè¿‡ä»£ç ç®¡ç†æ ‡ç­¾é¡µ

æ—¢ç„¶è®¾è®¡å™¨æ— æ³•ä½¿ç”¨ï¼Œæˆ‘ä»¬é‡‡ç”¨**å®Œå…¨ä»£ç æ–¹å¼**ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª**è¾…åŠ©æ–¹æ³•**æ¥ç®€åŒ–æ·»åŠ è¿‡ç¨‹ã€‚

### æ–¹æ¡ˆï¼šåˆ›å»ºæ ‡ç­¾é¡µç®¡ç†ç±»

åˆ›å»ºä¸€ä¸ª `RibbonPageManager` ç±»æ¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ ‡ç­¾é¡µçš„æ·»åŠ ï¼Œè¿™æ ·ï¼š
- âœ… ä»£ç æ¸…æ™°æ˜“ç»´æŠ¤
- âœ… æ·»åŠ æ–°æ ‡ç­¾é¡µåªéœ€è°ƒç”¨ä¸€ä¸ªæ–¹æ³•
- âœ… ä¸ä¾èµ–è®¾è®¡å™¨
- âœ… ä¾¿äºç‰ˆæœ¬æ§åˆ¶

---

## ğŸ“ å®æ–½æ­¥éª¤

### æ­¥éª¤1ï¼šåˆ›å»º RibbonPageManager è¾…åŠ©ç±»

åˆ›å»ºæ–‡ä»¶ï¼š`æ°¸åˆ©ç³»ç»Ÿ/Helpers/RibbonPageManager.cs`

```csharp
using DevExpress.XtraBars;
using DevExpress.XtraBars.Ribbon;

namespace æ°¸åˆ©ç³»ç»Ÿ.Helpers
{
    /// <summary>
    /// Ribbon æ ‡ç­¾é¡µç®¡ç†è¾…åŠ©ç±»
    /// ç”¨äºç®€åŒ–é€šè¿‡ä»£ç æ·»åŠ å’Œç®¡ç† Ribbon æ ‡ç­¾é¡µ
    /// </summary>
    public static class RibbonPageManager
    {
        /// <summary>
        /// åˆ›å»ºå¹¶æ·»åŠ ä¸€ä¸ªæ–°çš„ Ribbon æ ‡ç­¾é¡µ
        /// </summary>
        /// <param name="ribbonControl">RibbonControl å®ä¾‹</param>
        /// <param name="pageName">æ ‡ç­¾é¡µåç§°ï¼ˆç”¨äº Name å±æ€§ï¼‰</param>
        /// <param name="pageText">æ ‡ç­¾é¡µæ˜¾ç¤ºæ–‡æœ¬ï¼ˆç”¨äº Text å±æ€§ï¼‰</param>
        /// <param name="groups">æ ‡ç­¾é¡µåŒ…å«çš„ç»„åˆ—è¡¨</param>
        /// <returns>åˆ›å»ºçš„ RibbonPage</returns>
        public static RibbonPage AddPage(
            RibbonControl ribbonControl,
            string pageName,
            string pageText,
            params RibbonPageGroup[] groups)
        {
            var page = new RibbonPage
            {
                Name = pageName,
                Text = pageText
            };

            if (groups != null && groups.Length > 0)
            {
                page.Groups.AddRange(groups);
            }

            ribbonControl.Pages.Add(page);
            return page;
        }

        /// <summary>
        /// åˆ›å»ºå¹¶æ·»åŠ ä¸€ä¸ªæ–°çš„ Ribbon ç»„
        /// </summary>
        public static RibbonPageGroup AddGroup(
            string groupName,
            string groupText,
            params BarItem[] items)
        {
            var group = new RibbonPageGroup
            {
                Name = groupName,
                Text = groupText
            };

            if (items != null && items.Length > 0)
            {
                foreach (var item in items)
                {
                    group.ItemLinks.Add(item);
                }
            }

            return group;
        }

        /// <summary>
        /// åˆ›å»ºå¹¶æ·»åŠ ä¸€ä¸ªæ–°çš„æŒ‰é’®
        /// </summary>
        public static BarButtonItem AddButton(
            BarManager barManager,
            string buttonName,
            string buttonText,
            int buttonId,
            ItemClickEventHandler? clickHandler = null)
        {
            var button = new BarButtonItem(barManager, buttonId)
            {
                Name = buttonName,
                Caption = buttonText,
                RibbonStyle = RibbonItemStyles.Large
            };

            if (clickHandler != null)
            {
                button.ItemClick += clickHandler;
            }

            return button;
        }
    }
}
```

### æ­¥éª¤2ï¼šåœ¨ Main.cs ä¸­ä½¿ç”¨

```csharp
// åœ¨ Main.cs çš„æ„é€ å‡½æ•°ä¸­
private void InitializeRibbonPages()
{
    // ä½¿ç”¨è¾…åŠ©ç±»æ·»åŠ "å¼€å¥–ç®¡ç†"æ ‡ç­¾é¡µ
    var lotteryGroup = RibbonPageManager.AddGroup(
        "ribbonPageGroupLotteryActions",
        "å¼€å¥–æ“ä½œ",
        barButtonItemLotteryStart,
        barButtonItemLotteryStop
    );

    var lotteryPage = RibbonPageManager.AddPage(
        ribbonControl1,
        "ribbonPageLottery",
        "å¼€å¥–ç®¡ç†",
        lotteryGroup
    );
}
```

---

## ğŸ¯ æ›´ç®€å•çš„æ–¹æ¡ˆï¼šç›´æ¥åœ¨ Main.cs ä¸­æ·»åŠ æ–¹æ³•

å¦‚æœä¸æƒ³åˆ›å»ºæ–°ç±»ï¼Œå¯ä»¥ç›´æ¥åœ¨ `Main.cs` ä¸­æ·»åŠ ä¸€ä¸ªè¾…åŠ©æ–¹æ³•ï¼š

```csharp
// åœ¨ Main.cs ä¸­æ·»åŠ 
private RibbonPage AddRibbonPage(string pageName, string pageText, params RibbonPageGroup[] groups)
{
    var page = new RibbonPage
    {
        Name = pageName,
        Text = pageText
    };

    if (groups != null && groups.Length > 0)
    {
        page.Groups.AddRange(groups);
    }

    ribbonControl1.Pages.Add(page);
    return page;
}

private RibbonPageGroup AddRibbonGroup(string groupName, string groupText, params BarItem[] items)
{
    var group = new RibbonPageGroup
    {
        Name = groupName,
        Text = groupText
    };

    if (items != null && items.Length > 0)
    {
        foreach (var item in items)
        {
            group.ItemLinks.Add(item);
        }
    }

    return group;
}
```

---

## ğŸ“‹ å®Œæ•´ç¤ºä¾‹ï¼šæ·»åŠ "å¼€å¥–ç®¡ç†"æ ‡ç­¾é¡µ

### 1. åœ¨ Main.Designer.cs ä¸­æ·»åŠ å­—æ®µå£°æ˜

```csharp
// åœ¨å­—æ®µå£°æ˜éƒ¨åˆ†æ·»åŠ 
private RibbonPage ribbonPageLottery;
private RibbonPageGroup ribbonPageGroupLotteryActions;
private BarButtonItem barButtonItemLotteryStart;
private BarButtonItem barButtonItemLotteryStop;
```

### 2. åœ¨ Main.cs çš„æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–

```csharp
private void InitializeRibbonPages()
{
    // åˆ›å»ºæŒ‰é’®
    barButtonItemLotteryStart = new BarButtonItem(ribbonControl1.Manager, GetNextItemId())
    {
        Name = "barButtonItemLotteryStart",
        Caption = "å¼€å§‹å¼€å¥–",
        RibbonStyle = RibbonItemStyles.Large
    };
    barButtonItemLotteryStart.ItemClick += BarButtonItemLotteryStart_ItemClick;

    barButtonItemLotteryStop = new BarButtonItem(ribbonControl1.Manager, GetNextItemId())
    {
        Name = "barButtonItemLotteryStop",
        Caption = "åœæ­¢å¼€å¥–",
        RibbonStyle = RibbonItemStyles.Large
    };
    barButtonItemLotteryStop.ItemClick += BarButtonItemLotteryStop_ItemClick;

    // æ·»åŠ åˆ° RibbonControl
    ribbonControl1.Items.Add(barButtonItemLotteryStart);
    ribbonControl1.Items.Add(barButtonItemLotteryStop);

    // åˆ›å»ºç»„
    ribbonPageGroupLotteryActions = new RibbonPageGroup
    {
        Name = "ribbonPageGroupLotteryActions",
        Text = "å¼€å¥–æ“ä½œ"
    };
    ribbonPageGroupLotteryActions.ItemLinks.Add(barButtonItemLotteryStart);
    ribbonPageGroupLotteryActions.ItemLinks.Add(barButtonItemLotteryStop);

    // åˆ›å»ºæ ‡ç­¾é¡µ
    ribbonPageLottery = new RibbonPage
    {
        Name = "ribbonPageLottery",
        Text = "å¼€å¥–ç®¡ç†"
    };
    ribbonPageLottery.Groups.Add(ribbonPageGroupLotteryActions);

    // æ·»åŠ åˆ° RibbonControl
    ribbonControl1.Pages.Add(ribbonPageLottery);
}

private int GetNextItemId()
{
    return ribbonControl1.MaxItemId + 1;
}

private void BarButtonItemLotteryStart_ItemClick(object sender, ItemClickEventArgs e)
{
    _loggingService.Info("å¼€å¥–ç®¡ç†", "å¼€å§‹å¼€å¥–...");
    // TODO: å®ç°å¼€å¥–é€»è¾‘
}

private void BarButtonItemLotteryStop_ItemClick(object sender, ItemClickEventArgs e)
{
    _loggingService.Info("å¼€å¥–ç®¡ç†", "åœæ­¢å¼€å¥–...");
    // TODO: å®ç°åœæ­¢é€»è¾‘
}
```

---

## âœ… ä¼˜åŠ¿

1. **ä¸ä¾èµ–è®¾è®¡å™¨**ï¼šå®Œå…¨é€šè¿‡ä»£ç ï¼Œä¸å—è®¾è®¡å™¨é™åˆ¶
2. **æ˜“äºç»´æŠ¤**ï¼šä»£ç æ¸…æ™°ï¼Œä¾¿äºç†è§£å’Œä¿®æ”¹
3. **ç‰ˆæœ¬æ§åˆ¶å‹å¥½**ï¼šæ‰€æœ‰æ›´æ”¹éƒ½åœ¨ä»£ç ä¸­ï¼Œä¾¿äº Git ç®¡ç†
4. **çµæ´»æ€§å¼º**ï¼šå¯ä»¥åŠ¨æ€æ·»åŠ ã€åˆ é™¤æ ‡ç­¾é¡µ

---

## ğŸš€ å¿«é€Ÿæ·»åŠ æ–°æ ‡ç­¾é¡µæ¨¡æ¿

ä»¥åæ·»åŠ æ–°æ ‡ç­¾é¡µï¼Œåªéœ€è¦ï¼š

1. åœ¨ `Main.Designer.cs` ä¸­æ·»åŠ å­—æ®µå£°æ˜
2. åœ¨ `Main.cs` ä¸­è°ƒç”¨ `InitializeRibbonPages()` ç±»ä¼¼çš„æ–¹æ³•
3. æ·»åŠ äº‹ä»¶å¤„ç†æ–¹æ³•

**æˆ‘å¯ä»¥ä¸ºä½ ç”Ÿæˆå®Œæ•´çš„ä»£ç ï¼** åªéœ€è¦å‘Šè¯‰æˆ‘ï¼š
- æ ‡ç­¾é¡µåç§°ï¼ˆå¦‚"å¼€å¥–ç®¡ç†"ï¼‰
- éœ€è¦çš„æŒ‰é’®ï¼ˆå¦‚"å¼€å§‹"ã€"åœæ­¢"ã€"é…ç½®"ï¼‰

