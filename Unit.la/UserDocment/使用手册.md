# Unit.la åº“ - å®Œæ•´ä½¿ç”¨æ‰‹å†Œ

> **ç‰ˆæœ¬**: 1.0.0  
> **æ›´æ–°æ—¥æœŸ**: 2026-01-22  
> **é€‚ç”¨äº**: YongLiSystem åŠå…¶ä»–åŸºäº .NET çš„é¡¹ç›®

---

## ğŸ“š ç›®å½•

- [1. åº“æ¦‚è¿°](#1-åº“æ¦‚è¿°)
- [2. å¿«é€Ÿå¼€å§‹](#2-å¿«é€Ÿå¼€å§‹)
- [3. æµè§ˆå™¨ä»»åŠ¡æ§ä»¶](#3-æµè§ˆå™¨ä»»åŠ¡æ§ä»¶)
- [4. Lua è„šæœ¬ç³»ç»Ÿ](#4-lua-è„šæœ¬ç³»ç»Ÿ)
- [5. Web åº“ API](#5-web-åº“-api)
- [6. ç³»ç»Ÿå‡½æ•°åº“](#6-ç³»ç»Ÿå‡½æ•°åº“)
- [7. è„šæœ¬ç¼–è¾‘å™¨](#7-è„šæœ¬ç¼–è¾‘å™¨)
- [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
- [9. å¸¸è§é—®é¢˜](#9-å¸¸è§é—®é¢˜)
- [10. æ›´æ–°æ—¥å¿—](#10-æ›´æ–°æ—¥å¿—)

---

## 1. åº“æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯ Unit.la

`Unit.la` æ˜¯ä¸€ä¸ªå¯é‡ç”¨çš„ .NET ç»„ä»¶åº“ï¼Œä¸“ä¸ºæµè§ˆå™¨è‡ªåŠ¨åŒ–å’Œè„šæœ¬ä»»åŠ¡è®¾è®¡ã€‚å®ƒæä¾›ï¼š

- ğŸŒ **é›†æˆæµè§ˆå™¨æ§ä»¶** - åŸºäº WebView2 çš„å®Œæ•´æµè§ˆå™¨çª—å£
- ğŸ“ **è„šæœ¬ç¼–è¾‘å™¨** - æ”¯æŒ Lua è¯­æ³•é«˜äº®ã€æ–­ç‚¹ã€é”™è¯¯æ£€æµ‹
- ğŸ”§ **è„šæœ¬å¼•æ“** - MoonSharp Lua å¼•æ“ï¼Œæ”¯æŒå‡½æ•°ç»‘å®š
- ğŸ“Š **ä»»åŠ¡å¡ç‰‡** - å¸¦å®æ—¶ç¼©ç•¥å›¾çš„ä»»åŠ¡ç®¡ç†ç•Œé¢
- ğŸ”Œ **å¼€ç®±å³ç”¨** - å®Œæ•´å°è£…ï¼Œåªéœ€é…ç½®å³å¯ä½¿ç”¨

### 1.2 ä¸»è¦ç»„ä»¶

| ç»„ä»¶ | å‘½åç©ºé—´ | è¯´æ˜ |
|------|---------|------|
| `BrowserTaskControl` | `Unit.La.Controls` | é›†æˆæµè§ˆå™¨ä»»åŠ¡çª—å£ |
| `BrowserTaskCardControl` | `Unit.La.Controls` | ä»»åŠ¡å¡ç‰‡æ§ä»¶ï¼ˆå¸¦ç¼©ç•¥å›¾ï¼‰ |
| `ScriptEditorControl` | `Unit.La.Controls` | Lua è„šæœ¬ç¼–è¾‘å™¨ |
| `WebBridge` | `Unit.La.Scripting` | Web åº“ï¼ˆLua è°ƒç”¨ WebView2ï¼‰ |
| `ScriptFunctionRegistry` | `Unit.La.Scripting` | è„šæœ¬å‡½æ•°æ³¨å†Œè¡¨ |
| `MoonSharpScriptEngine` | `Unit.La.Scripting` | Lua è„šæœ¬å¼•æ“ |

### 1.3 ç³»ç»Ÿè¦æ±‚

- **.NET 8.0** æˆ–æ›´é«˜ç‰ˆæœ¬
- **Windows 10/11**
- **WebView2 Runtime**
- **DevExpress 23.2** (å¯é€‰ï¼Œç”¨äº UI ç»„ä»¶)

---

## 2. å¿«é€Ÿå¼€å§‹

### 2.1 å®‰è£…

#### æ–¹æ³•1ï¼šé¡¹ç›®å¼•ç”¨
```xml
<ItemGroup>
  <ProjectReference Include="..\Unit.la\Unit.la.csproj" />
</ItemGroup>
```

#### æ–¹æ³•2ï¼šNuGet åŒ…ï¼ˆæœªæ¥æ”¯æŒï¼‰
```bash
dotnet add package Unit.la
```

### 2.2 ç¬¬ä¸€ä¸ªæµè§ˆå™¨ä»»åŠ¡

```csharp
using Unit.La.Controls;
using Unit.La.Models;

// 1. åˆ›å»ºé…ç½®
var config = new BrowserTaskConfig
{
    Name = "æˆ‘çš„ç¬¬ä¸€ä¸ªä»»åŠ¡",
    Url = "https://www.baidu.com",
    ScriptDirectory = @"C:\Scripts\MyTask"
};

// 2. åˆ›å»ºæµè§ˆå™¨ä»»åŠ¡çª—å£
var taskWindow = new BrowserTaskControl(config);

// 3. æ˜¾ç¤ºçª—å£
taskWindow.Show();
```

### 2.3 ç¬¬ä¸€ä¸ª Lua è„šæœ¬

åœ¨è„šæœ¬ç›®å½•åˆ›å»º `main.lua`ï¼š

```lua
-- ç¬¬ä¸€ä¸ª Lua è„šæœ¬
log('ğŸš€ è„šæœ¬å¼€å§‹æ‰§è¡Œ')

-- å¯¼èˆªåˆ°ç™¾åº¦
web.Navigate("https://www.baidu.com")
web.WaitForLoad()

-- è·å–é¡µé¢æ ‡é¢˜
local title = web.GetTitle()
log('é¡µé¢æ ‡é¢˜: ' .. title)

-- è¾“å…¥æœç´¢å…³é”®è¯
if web.Exists("#kw") then
    web.Input("#kw", "Lua ç¼–ç¨‹")
    web.Click("#su")
    web.Wait(2000)
    log('âœ… æœç´¢å®Œæˆ')
end

log('âœ… è„šæœ¬æ‰§è¡Œå®Œæˆ')
```

---

## 3. æµè§ˆå™¨ä»»åŠ¡æ§ä»¶

### 3.1 BrowserTaskControl

#### æ„é€ å‡½æ•°
```csharp
public BrowserTaskControl(BrowserTaskConfig config)
```

#### é…ç½®å¯¹è±¡
```csharp
public class BrowserTaskConfig
{
    // åŸºæœ¬é…ç½®
    public string Name { get; set; }              // ä»»åŠ¡åç§°
    public string Url { get; set; }               // èµ·å§‹URL
    public string? Username { get; set; }         // ç”¨æˆ·åï¼ˆå¯é€‰ï¼‰
    public string? Password { get; set; }         // å¯†ç ï¼ˆå¯é€‰ï¼‰
    
    // è„šæœ¬é…ç½®
    public string? ScriptDirectory { get; set; }  // è„šæœ¬ç›®å½•
    public List<ScriptInfo> Scripts { get; set; } // è„šæœ¬åˆ—è¡¨ï¼ˆå†…å­˜æ¨¡å¼ï¼‰
    public string? MainScriptId { get; set; }     // ä¸»è„šæœ¬ID
    
    // æµè§ˆå™¨é…ç½®
    public int Width { get; set; } = 1440;        // çª—å£å®½åº¦
    public int Height { get; set; } = 980;        // çª—å£é«˜åº¦
    public bool ShowToolbar { get; set; } = true; // æ˜¾ç¤ºå·¥å…·æ 
}
```

#### å¸¸ç”¨æ–¹æ³•
```csharp
// æ˜¾ç¤ºçª—å£
taskWindow.Show();

// éšè—çª—å£
taskWindow.Hide();

// æ‰§è¡Œè„šæœ¬
await taskWindow.ExecuteScriptAsync("main.lua");

// åœæ­¢è„šæœ¬
taskWindow.StopScript();

// æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°
taskWindow.RegisterScriptFunction("myFunc", new Action(() => {
    // è‡ªå®šä¹‰é€»è¾‘
}));

// è·å–é…ç½®
var config = taskWindow.Config;
```

#### äº‹ä»¶
```csharp
// çª—å£å…³é—­äº‹ä»¶ï¼ˆå®é™…æ˜¯éšè—ï¼‰
taskWindow.FormClosing += (s, e) => {
    // çª—å£è¢«å…³é—­ï¼ˆéšè—ï¼‰
};
```

### 3.2 BrowserTaskCardControl

ä»»åŠ¡å¡ç‰‡æ§ä»¶ï¼Œæ˜¾ç¤ºä»»åŠ¡æ‘˜è¦å’Œå®æ—¶ç¼©ç•¥å›¾ã€‚

#### ä½¿ç”¨ç¤ºä¾‹
```csharp
using Unit.La.Controls;
using Unit.La.Models;

// 1. åˆ›å»ºä»»åŠ¡ä¿¡æ¯
var taskInfo = new BrowserTaskInfo
{
    Id = "task-001",
    Name = "æ•°æ®é‡‡é›†ä»»åŠ¡",
    Url = "https://example.com",
    Status = "è¿è¡Œä¸­",
    Description = "å®šæ—¶é‡‡é›†æ•°æ®"
};

// 2. åˆ›å»ºå¡ç‰‡
var card = new BrowserTaskCardControl(taskInfo);

// 3. è®¢é˜…äº‹ä»¶
card.StartRequested += (s, e) => {
    // å¯åŠ¨ä»»åŠ¡
};

card.StopRequested += (s, e) => {
    // åœæ­¢ä»»åŠ¡
};

card.ThumbnailClicked += (s, e) => {
    // æ˜¾ç¤º/éšè—çª—å£
};

// 4. æ·»åŠ åˆ°å®¹å™¨
flowLayoutPanel.Controls.Add(card);

// 5. æ›´æ–°ç¼©ç•¥å›¾
card.UpdateThumbnail(thumbnailImage);

// 6. æ›´æ–°çŠ¶æ€
card.UpdateStatus("è¿è¡Œä¸­");
```

---

## 4. Lua è„šæœ¬ç³»ç»Ÿ

### 4.1 è„šæœ¬ç±»å‹

| ç±»å‹ | æ–‡ä»¶å | ç”¨é€” |
|------|--------|------|
| Main | `main.lua` | ä¸»è„šæœ¬ï¼Œæ§åˆ¶æµç¨‹ |
| Functions | `functions.lua` | åŠŸèƒ½åº“ï¼Œå°è£…å‡½æ•° |
| Test | `test.lua` | æµ‹è¯•è„šæœ¬ |
| Custom | `*.lua` | è‡ªå®šä¹‰è„šæœ¬ |

### 4.2 è„šæœ¬ç›®å½•ç»“æ„

```
Scripts/
â””â”€â”€ ä»»åŠ¡åç§°/
    â”œâ”€â”€ main.lua           â† ä¸»è„šæœ¬
    â”œâ”€â”€ functions.lua      â† åŠŸèƒ½åº“
    â”œâ”€â”€ test.lua           â† æµ‹è¯•è„šæœ¬
    â”œâ”€â”€ config.lua         â† é…ç½®ï¼ˆå¯é€‰ï¼‰
    â””â”€â”€ utils.lua          â† å·¥å…·å‡½æ•°ï¼ˆå¯é€‰ï¼‰
```

### 4.3 è„šæœ¬æ¨¡æ¿

#### main.lua æ¨¡æ¿
```lua
-- ====================================
-- ä¸»è„šæœ¬
-- ====================================

log('ğŸš€ ä¸»è„šæœ¬å¼€å§‹æ‰§è¡Œ')

function main()
    -- 1. å¯¼èˆª
    web.Navigate(config.url or 'https://example.com')
    web.WaitForLoad(10000)
    
    -- 2. ç™»å½•
    if web.Exists('#username') then
        web.Input('#username', config.username or 'admin')
        web.Input('#password', config.password or 'password')
        web.Click('#loginBtn')
        web.Wait(2000)
    end
    
    -- 3. ä¸šåŠ¡é€»è¾‘
    -- è°ƒç”¨ functions.lua ä¸­çš„å‡½æ•°
    
    -- 4. è·å–ç»“æœ
    local title = web.GetTitle()
    log('é¡µé¢æ ‡é¢˜: ' .. title)
    
    return true
end

-- æ‰§è¡Œ
local success = main()
if success then
    log('âœ… æ‰§è¡ŒæˆåŠŸ')
else
    log('âŒ æ‰§è¡Œå¤±è´¥')
end
```

#### functions.lua æ¨¡æ¿
```lua
-- ====================================
-- åŠŸèƒ½åº“
-- ====================================

log('ğŸ“š åŠŸèƒ½åº“åŠ è½½ä¸­...')

-- ç™»å½•åŠŸèƒ½
function login(username, password)
    web.Navigate(config.url)
    web.WaitForLoad()
    web.Input('#username', username)
    web.Input('#password', password)
    web.Click('#loginBtn')
    return web.Exists('.user-info')
end

-- è·å–æ•°æ®
function getData()
    if not web.WaitFor('.data-table', 5000) then
        return nil
    end
    return web.GetAllText('.data-row .title')
end

log('âœ… åŠŸèƒ½åº“åŠ è½½å®Œæˆ')
```

---

## 5. Web åº“ API

### 5.1 å¯¼èˆªæ§åˆ¶

#### web.Navigate(url)
å¯¼èˆªåˆ°æŒ‡å®š URLã€‚

```lua
web.Navigate("https://example.com")
```

#### web.GoBack()
åé€€åˆ°ä¸Šä¸€é¡µã€‚

```lua
web.GoBack()
```

#### web.GoForward()
å‰è¿›åˆ°ä¸‹ä¸€é¡µã€‚

```lua
web.GoForward()
```

#### web.Reload()
åˆ·æ–°å½“å‰é¡µé¢ã€‚

```lua
web.Reload()
```

#### web.Stop()
åœæ­¢é¡µé¢åŠ è½½ã€‚

```lua
web.Stop()
```

### 5.2 JavaScript æ‰§è¡Œ

#### web.Execute(script)
æ‰§è¡Œ JavaScript è„šæœ¬å¹¶è¿”å›ç»“æœã€‚

```lua
local title = web.Execute("document.title")
log("æ ‡é¢˜: " .. title)
```

#### web.ExecuteJson(script)
æ‰§è¡Œè„šæœ¬å¹¶è§£æ JSON ç»“æœã€‚

```lua
local data = web.ExecuteJson("JSON.stringify({name: 'test', age: 30})")
log("å§“å: " .. data.name)
```

### 5.3 é¡µé¢ä¿¡æ¯

#### web.GetUrl()
è·å–å½“å‰ URLã€‚

```lua
local url = web.GetUrl()
log("å½“å‰URL: " .. url)
```

#### web.GetTitle()
è·å–é¡µé¢æ ‡é¢˜ã€‚

```lua
local title = web.GetTitle()
```

#### web.GetHtml()
è·å–é¡µé¢å®Œæ•´ HTMLã€‚

```lua
local html = web.GetHtml()
```

#### web.GetText()
è·å–é¡µé¢çº¯æ–‡æœ¬å†…å®¹ã€‚

```lua
local text = web.GetText()
```

### 5.4 DOM å…ƒç´ æ“ä½œ

#### web.Click(selector)
ç‚¹å‡»å…ƒç´ ã€‚

```lua
web.Click("#loginBtn")
web.Click(".submit-button")
```

#### web.Input(selector, text)
è¾“å…¥æ–‡æœ¬åˆ°å…ƒç´ ã€‚

```lua
web.Input("#username", "admin")
web.Input("#email", "test@example.com")
```

#### web.GetElementText(selector)
è·å–å…ƒç´ æ–‡æœ¬å†…å®¹ã€‚

```lua
local text = web.GetElementText("#title")
local name = web.GetElementText(".user-name")
```

#### web.GetAttr(selector, attribute)
è·å–å…ƒç´ å±æ€§å€¼ã€‚

```lua
local href = web.GetAttr("#link", "href")
local src = web.GetAttr("img", "src")
```

#### web.SetAttr(selector, attribute, value)
è®¾ç½®å…ƒç´ å±æ€§ã€‚

```lua
web.SetAttr("#input", "placeholder", "è¯·è¾“å…¥...")
web.SetAttr("img", "src", "new-image.png")
```

#### web.Exists(selector)
æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚

```lua
if web.Exists("#loginBtn") then
    log("ç™»å½•æŒ‰é’®å­˜åœ¨")
end
```

#### web.IsVisible(selector)
æ£€æŸ¥å…ƒç´ æ˜¯å¦å¯è§ã€‚

```lua
if web.IsVisible("#dialog") then
    log("å¯¹è¯æ¡†å·²æ˜¾ç¤º")
end
```

#### web.Count(selector)
è·å–åŒ¹é…å…ƒç´ çš„æ•°é‡ã€‚

```lua
local count = web.Count(".item")
log("æ‰¾åˆ° " .. count .. " ä¸ªå…ƒç´ ")
```

### 5.5 ç­‰å¾…æ“ä½œ

#### web.Wait(milliseconds)
ç­‰å¾…æŒ‡å®šæ¯«ç§’æ•°ã€‚

```lua
web.Wait(1000)  -- ç­‰å¾…1ç§’
web.Wait(500)   -- ç­‰å¾…0.5ç§’
```

#### web.WaitFor(selector, timeoutMs)
ç­‰å¾…å…ƒç´ å‡ºç°ï¼ˆé»˜è®¤è¶…æ—¶10ç§’ï¼‰ã€‚

```lua
-- ç­‰å¾…å…ƒç´ å‡ºç°ï¼ˆæœ€å¤šç­‰å¾…5ç§’ï¼‰
if web.WaitFor("#loginBtn", 5000) then
    log("ç™»å½•æŒ‰é’®å·²å‡ºç°")
    web.Click("#loginBtn")
else
    log("ç™»å½•æŒ‰é’®æœªæ‰¾åˆ°")
end
```

#### web.WaitForHidden(selector, timeoutMs)
ç­‰å¾…å…ƒç´ æ¶ˆå¤±æˆ–éšè—ã€‚

```lua
-- ç­‰å¾…åŠ è½½åŠ¨ç”»æ¶ˆå¤±
if web.WaitForHidden("#loading", 5000) then
    log("åŠ è½½å®Œæˆ")
end
```

#### web.WaitForLoad(timeoutMs)
ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆï¼ˆé»˜è®¤è¶…æ—¶30ç§’ï¼‰ã€‚

```lua
web.Navigate("https://example.com")
web.WaitForLoad(10000)  -- æœ€å¤šç­‰å¾…10ç§’
```

### 5.6 æ»šåŠ¨æ“ä½œ

#### web.ScrollToTop()
æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨ã€‚

```lua
web.ScrollToTop()
```

#### web.ScrollToBottom()
æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨ã€‚

```lua
web.ScrollToBottom()
```

#### web.ScrollTo(selector)
æ»šåŠ¨åˆ°æŒ‡å®šå…ƒç´ ã€‚

```lua
web.ScrollTo("#section2")
```

#### web.ScrollBy(x, y)
æ»šåŠ¨æŒ‡å®šè·ç¦»ã€‚

```lua
web.ScrollBy(0, 500)   -- å‘ä¸‹æ»šåŠ¨500px
web.ScrollBy(100, 0)   -- å‘å³æ»šåŠ¨100px
```

### 5.7 Cookie æ“ä½œ

#### web.GetCookies()
è·å–æ‰€æœ‰ Cookiesï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰ã€‚

```lua
local cookies = web.GetCookies()
log("Cookies: " .. cookies)
```

#### web.SetCookie(name, value, days)
è®¾ç½® Cookieï¼ˆé»˜è®¤7å¤©æœ‰æ•ˆï¼‰ã€‚

```lua
web.SetCookie("token", "abc123", 7)
web.SetCookie("userId", "12345", 30)
```

#### web.DeleteCookie(name)
åˆ é™¤æŒ‡å®š Cookieã€‚

```lua
web.DeleteCookie("token")
```

#### web.ClearCookies()
æ¸…é™¤æ‰€æœ‰ Cookiesã€‚

```lua
web.ClearCookies()
```

### 5.8 è¡¨å•æ“ä½œ

#### web.Select(selector, value)
é€‰æ‹©ä¸‹æ‹‰æ¡†é€‰é¡¹ï¼ˆæŒ‰å€¼ï¼‰ã€‚

```lua
web.Select("#country", "CN")
web.Select("#language", "zh-CN")
```

#### web.SelectIndex(selector, index)
é€‰æ‹©ä¸‹æ‹‰æ¡†é€‰é¡¹ï¼ˆæŒ‰ç´¢å¼•ï¼‰ã€‚

```lua
web.SelectIndex("#country", 0)  -- é€‰æ‹©ç¬¬ä¸€é¡¹
```

#### web.Check(selector, checked)
å‹¾é€‰/å–æ¶ˆå¤é€‰æ¡†ã€‚

```lua
web.Check("#agree", true)   -- å‹¾é€‰
web.Check("#agree", false)  -- å–æ¶ˆ
```

#### web.Submit(selector)
æäº¤è¡¨å•ã€‚

```lua
web.Submit("#loginForm")
```

### 5.9 é«˜çº§æ“ä½œ

#### web.InjectCss(css)
æ³¨å…¥ CSS æ ·å¼ã€‚

```lua
web.InjectCss("body { background: red; }")
web.InjectCss(".ad { display: none; }")
```

#### web.InjectJs(url)
æ³¨å…¥ JavaScript åº“ã€‚

```lua
web.InjectJs("https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js")
```

#### web.OpenDevTools()
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ã€‚

```lua
web.OpenDevTools()
```

#### web.Screenshot(filePath)
æˆªå›¾å¹¶ä¿å­˜åˆ°æ–‡ä»¶ã€‚

```lua
web.Screenshot("screenshot.png")
web.Screenshot("C:/Images/page.png")
```

### 5.10 æ‰¹é‡æ“ä½œ

#### web.GetAllText(selector)
è·å–æ‰€æœ‰åŒ¹é…å…ƒç´ çš„æ–‡æœ¬ï¼ˆè¿”å›æ•°ç»„ï¼‰ã€‚

```lua
local titles = web.GetAllText(".item .title")
for i, title in ipairs(titles) do
    log("æ ‡é¢˜" .. i .. ": " .. title)
end
```

#### web.GetAllAttr(selector, attribute)
è·å–æ‰€æœ‰åŒ¹é…å…ƒç´ çš„å±æ€§å€¼ï¼ˆè¿”å›æ•°ç»„ï¼‰ã€‚

```lua
local hrefs = web.GetAllAttr("a", "href")
for i, href in ipairs(hrefs) do
    log("é“¾æ¥" .. i .. ": " .. href)
end
```

---

## 6. ç³»ç»Ÿå‡½æ•°åº“

é™¤äº† `web` åº“ï¼Œç³»ç»Ÿè¿˜æä¾›ä»¥ä¸‹å†…ç½®å‡½æ•°ï¼š

### 6.1 æ—¥å¿—å‡½æ•°

```lua
log("æ™®é€šæ—¥å¿—")
log_info("ä¿¡æ¯æ—¥å¿—")
log_warn("è­¦å‘Šæ—¥å¿—")
log_error("é”™è¯¯æ—¥å¿—")
```

### 6.2 å»¶è¿Ÿå‡½æ•°

```lua
sleep(1000)  -- å»¶è¿Ÿ1ç§’
wait(500)    -- ç­‰å¾…0.5ç§’ï¼ˆsleepçš„åˆ«åï¼‰
```

### 6.3 HTTP å‡½æ•°

```lua
-- GET è¯·æ±‚
local response = http_get("https://api.example.com/data")

-- POST è¯·æ±‚
local response = http_post("https://api.example.com/submit", '{"key":"value"}')
```

### 6.4 æ—¶é—´å‡½æ•°

```lua
-- è·å–æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
local ts = get_timestamp()

-- è·å–æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²
local dt = get_datetime()

-- æ ¼å¼åŒ–æ—¶é—´
local time = format_time("yyyy-MM-dd HH:mm:ss")
```

### 6.5 éšæœºæ•°å‡½æ•°

```lua
-- ç”Ÿæˆéšæœºæ•´æ•°
local n = random_number(1, 100)

-- ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
local s = random_string(10)
```

### 6.6 JSON å‡½æ•°

```lua
-- è§£æ JSON
local obj = parse_json('{"name":"test","age":30}')
log("å§“å: " .. obj.name)

-- å¯¹è±¡è½¬ JSON
local json = to_json({name = "test", age = 30})
```

### 6.7 å­—ç¬¦ä¸²å‡½æ•°

```lua
-- åˆ¤æ–­åŒ…å«
local b = string_contains("hello world", "world")

-- æ›¿æ¢
local s = string_replace("hello", "l", "L")

-- åˆ†å‰²
local arr = string_split("a,b,c", ",")
```

---

## 7. è„šæœ¬ç¼–è¾‘å™¨

### 7.1 ScriptEditorControl

åŠŸèƒ½ä¸°å¯Œçš„ Lua è„šæœ¬ç¼–è¾‘å™¨ã€‚

#### ç‰¹æ€§
- âœ… Lua è¯­æ³•é«˜äº®
- âœ… è¡Œå·æ˜¾ç¤º
- âœ… ä»£ç æŠ˜å 
- âœ… è‡ªåŠ¨å®Œæˆ
- âœ… æ–­ç‚¹æ”¯æŒ
- âœ… é”™è¯¯æ ‡è®°
- âœ… æŸ¥æ‰¾/æ›¿æ¢
- âœ… Ctrl+S ä¿å­˜

#### ä½¿ç”¨ç¤ºä¾‹
```csharp
var editor = new ScriptEditorControl();
editor.Dock = DockStyle.Fill;

// è®¾ç½®è„šæœ¬å†…å®¹
editor.ScriptText = "log('Hello World')";

// è·å–è„šæœ¬å†…å®¹
string script = editor.ScriptText;

// è®¢é˜…æ–‡æœ¬å˜åŒ–äº‹ä»¶
editor.ScriptTextChanged += (s, e) => {
    // è„šæœ¬å·²ä¿®æ”¹
};
```

---

## 8. æœ€ä½³å®è·µ

### 8.1 é”™è¯¯å¤„ç†

```lua
-- ä½¿ç”¨ pcall æ•è·é”™è¯¯
local success, result = pcall(function()
    web.Navigate("https://example.com")
    web.WaitForLoad()
    return web.GetTitle()
end)

if success then
    log('âœ… æˆåŠŸ: ' .. result)
else
    log_error('âŒ å¤±è´¥: ' .. result)
end
```

### 8.2 å‡½æ•°å°è£…

```lua
-- åœ¨ functions.lua ä¸­å°è£…å¯é‡ç”¨å‡½æ•°
function safeClick(selector, timeout)
    if web.WaitFor(selector, timeout or 5000) then
        web.Click(selector)
        return true
    else
        log_warn('å…ƒç´ æœªæ‰¾åˆ°: ' .. selector)
        return false
    end
end

-- åœ¨ main.lua ä¸­ä½¿ç”¨
if safeClick('#loginBtn') then
    log('âœ… ç™»å½•æŒ‰é’®å·²ç‚¹å‡»')
end
```

### 8.3 é…ç½®ç®¡ç†

```lua
-- åœ¨è„šæœ¬ä¸­è®¿é—®é…ç½®
local url = config.url or 'https://default.com'
local username = config.username or 'admin'
local password = config.password or 'password'
```

### 8.4 æ‰¹é‡æ•°æ®å¤„ç†

```lua
-- é‡‡é›†æ‰€æœ‰æ•°æ®
local titles = web.GetAllText('.item .title')
local links = web.GetAllAttr('.item a', 'href')

-- å¤„ç†æ•°æ®
for i = 1, #titles do
    log('æ•°æ® ' .. i .. ':')
    log('  æ ‡é¢˜: ' .. titles[i])
    log('  é“¾æ¥: ' .. (links[i] or 'æ— '))
end
```

---

## 9. å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è°ƒè¯•è„šæœ¬ï¼Ÿ
**A**: ä½¿ç”¨ `log()` å‡½æ•°è¾“å‡ºè°ƒè¯•ä¿¡æ¯ï¼Œæˆ–ä½¿ç”¨ `web.OpenDevTools()` æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ã€‚

### Q2: å…ƒç´ æ‰¾ä¸åˆ°æ€ä¹ˆåŠï¼Ÿ
**A**: 
1. ä½¿ç”¨ `web.WaitFor()` ç­‰å¾…å…ƒç´ åŠ è½½
2. æ£€æŸ¥ CSS é€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®
3. ä½¿ç”¨ `web.Exists()` ç¡®è®¤å…ƒç´ å­˜åœ¨
4. æŸ¥çœ‹é¡µé¢ HTML ç»“æ„

### Q3: è„šæœ¬æ‰§è¡Œå¤±è´¥å¦‚ä½•å¤„ç†ï¼Ÿ
**A**: 
1. æŸ¥çœ‹æ—¥å¿—è¾“å‡º
2. ä½¿ç”¨ `pcall` æ•è·é”™è¯¯
3. æ·»åŠ  `web.Wait()` å»¶è¿Ÿ
4. æ£€æŸ¥é¡µé¢æ˜¯å¦åŠ è½½å®Œæˆ

### Q4: å¦‚ä½•æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°ï¼Ÿ
**A**: 
```csharp
taskWindow.RegisterScriptFunction("myFunc", new Action<string>(msg => {
    MessageBox.Show(msg);
}));
```

ç„¶ååœ¨ Lua ä¸­è°ƒç”¨ï¼š
```lua
myFunc("Hello from Lua!")
```

### Q5: å¦‚ä½•ä¿å­˜å’ŒåŠ è½½è„šæœ¬ï¼Ÿ
**A**: è„šæœ¬è‡ªåŠ¨ä» `ScriptDirectory` åŠ è½½ï¼Œä¿®æ”¹åæŒ‰ **Ctrl+S** ä¿å­˜ã€‚

---

## 10. æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-22)

#### æ–°å¢åŠŸèƒ½
- âœ… `BrowserTaskControl` - é›†æˆæµè§ˆå™¨ä»»åŠ¡çª—å£
- âœ… `BrowserTaskCardControl` - ä»»åŠ¡å¡ç‰‡æ§ä»¶
- âœ… `ScriptEditorControl` - Lua è„šæœ¬ç¼–è¾‘å™¨
- âœ… `WebBridge` - Web åº“ï¼ˆ43ä¸ªæ–¹æ³•ï¼‰
- âœ… `ScriptFunctionRegistry` - è„šæœ¬å‡½æ•°æ³¨å†Œç³»ç»Ÿ
- âœ… è‡ªåŠ¨åˆ›å»ºè„šæœ¬æ¨¡æ¿
- âœ… å®æ—¶ç¼©ç•¥å›¾æ›´æ–°
- âœ… Chrome F12 é£æ ¼å¸ƒå±€
- âœ… å®Œæ•´çš„æµè§ˆå™¨å¯¼èˆªåŠŸèƒ½
- âœ… Ctrl+S ä¿å­˜å¿«æ·é”®

#### Web åº“ API (43ä¸ªæ–¹æ³•)
- å¯¼èˆªæ§åˆ¶ï¼šNavigate, GoBack, GoForward, Reload, Stop
- JavaScriptæ‰§è¡Œï¼šExecute, ExecuteJson
- é¡µé¢ä¿¡æ¯ï¼šGetUrl, GetTitle, GetHtml, GetText
- DOMæ“ä½œï¼šClick, Input, GetElementText, GetAttr, SetAttr, Exists, IsVisible, Count
- ç­‰å¾…æ“ä½œï¼šWait, WaitFor, WaitForHidden, WaitForLoad
- æ»šåŠ¨æ“ä½œï¼šScrollToTop, ScrollToBottom, ScrollTo, ScrollBy
- Cookieç®¡ç†ï¼šGetCookies, SetCookie, DeleteCookie, ClearCookies
- è¡¨å•æ“ä½œï¼šSelect, SelectIndex, Check, Submit
- é«˜çº§åŠŸèƒ½ï¼šInjectCss, InjectJs, OpenDevTools, Screenshot
- æ‰¹é‡æ“ä½œï¼šGetAllText, GetAllAttr

#### ç³»ç»Ÿå‡½æ•°åº“
- æ—¥å¿—ï¼šlog, log_info, log_warn, log_error
- å»¶è¿Ÿï¼šsleep, wait
- HTTPï¼šhttp_get, http_post
- æ—¶é—´ï¼šget_timestamp, get_datetime, format_time
- éšæœºï¼šrandom_number, random_string
- JSONï¼šparse_json, to_json
- å­—ç¬¦ä¸²ï¼šstring_contains, string_replace, string_split

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [Webåº“å®Œæ•´å®ç°-å®ŒæˆæŠ¥å‘Š.md](./Webåº“å®Œæ•´å®ç°-å®ŒæˆæŠ¥å‘Š.md) - Webåº“è¯¦ç»†æ–‡æ¡£
- [Webåº“-å¿«é€Ÿå‚è€ƒ.md](./Webåº“-å¿«é€Ÿå‚è€ƒ.md) - Webåº“å¿«é€Ÿå‚è€ƒ
- [è„šæœ¬ç®¡ç†ç³»ç»Ÿ-å®ŒæˆæŠ¥å‘Š.md](./è„šæœ¬ç®¡ç†ç³»ç»Ÿ-å®ŒæˆæŠ¥å‘Š.md) - è„šæœ¬ç³»ç»Ÿæ–‡æ¡£
- [README_BrowserTask.md](./README_BrowserTask.md) - æµè§ˆå™¨ä»»åŠ¡æ§ä»¶æ–‡æ¡£
- [README_ScriptManager.md](./README_ScriptManager.md) - è„šæœ¬ç®¡ç†å™¨æ–‡æ¡£

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æŸ¥çœ‹ç›¸å…³æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

**Â© 2026 Unit.la Library. All rights reserved.**
