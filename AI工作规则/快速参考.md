# AI终端命令执行 - 快速参考卡

## 🚦 快速判断

```
命令/路径包含中文？
  ├─ 是 → ❌ 不使用 run_terminal_cmd
  │       ✅ 创建脚本文件
  │       ✅ 让用户在终端执行
  │
  └─ 否 → ✅ 可以使用 run_terminal_cmd
```

## ❌ 禁止操作

```javascript
// ❌ 错误：使用 run_terminal_cmd 处理中文路径
run_terminal_cmd({
  command: 'cd "E:\\项目\\中文目录"'
})

// ❌ 错误：尝试注入 chcp 65001（已测试，无效！）
run_terminal_cmd({
  command: 'chcp 65001; cd 中文路径'
  // 虽然 chcp 执行成功，但路径已是乱码
})

// ❌ 错误：尝试设置编码（已测试，无效！）
run_terminal_cmd({
  command: '[Console]::OutputEncoding = [System.Text.Encoding]::UTF8; cd 中文路径'
  // 只影响输出，不影响脚本文件编码
})

// ❌ 错误：使用 -LiteralPath 参数
run_terminal_cmd({
  command: 'Rename-Item -LiteralPath "E:\\中文\\路径\\file.txt"'
  // 参数本身的中文已损坏
})

// ❌ 错误：使用绝对路径规避
run_terminal_cmd({
  command: 'cd "E:\\完整\\的\\中文\\路径"'
  // 绝对路径也包含中文，问题相同
})
```

**重要**：所有"运行时编码设置"方案都已验证无效！
原因：中文字符在写入临时脚本文件时就已损坏。

## ✅ 正确操作

```javascript
// ✅ 正确：使用write工具创建脚本（已验证有效！）
write({
  file_path: '项目/重命名文件.ps1',
  contents: `# PowerShell脚本 - UTF-8编码
$targetDir = Join-Path $baseDir "项目说明"  # ✅ 中文正常
$renameMap = @{
    "old.md" = "new-中文.md"  # ✅ 中文正常
}
# ... 脚本内容
`
})

// ✅ 正确：创建批处理脚本
write({
  file_path: '项目/rename.bat',
  contents: `@echo off
chcp 65001 >nul
cd /d "E:\\项目\\中文目录"
ren "old.md" "new.md"
pause`
})

// 然后告知用户
// "请在Cursor终端中执行：
//  cd "E:\\项目\\中文目录"
//  .\\重命名文件.ps1"
// 或
//  .\\rename.bat"
```

**关键**：`write`工具创建的脚本文件编码正确，中文完全正常！✅

**⚠️ 重要补充**：PowerShell脚本中的中文字符串字面量可能导致解析错误！

```powershell
# ❌ 错误：直接使用中文字符串
$title = "本地DLL引用"  # 可能导致"意外的标记"错误

# ✅ 正确：使用Base64编码
function Decode-UTF8Base64 {
    param([string]$base64)
    $bytes = [System.Convert]::FromBase64String($base64)
    return [System.Text.Encoding]::UTF8.GetString($bytes)
}
$title = Decode-UTF8Base64 "6Y+I7oSA5rm0RExM5a+u5pug5pWk"  # "本地DLL引用"
```

## 📝 标准回复

```
由于操作涉及中文路径，请您在Cursor终端中执行：

cd "【路径】"
【命令】

或双击运行：【脚本文件路径】
```

## 🔗 详细文档

`AI工作规则/终端命令执行规则.md`

---

## 💻 代码实现原则 - 快速参考

### 🚦 快速判断

```
需要实现功能？
  ├─ 查找现有实现（框架/库/项目内）
  │
  ├─ 有且适用 → ✅ 使用现成实现
  │
  ├─ 有但过于复杂 → ⚠️ 评估后决定
  │
  └─ 无或不适用 → ❌ 手动实现
```

### ❌ 禁止操作

```csharp
// ❌ 错误：自己实现框架已提供的功能
public class CustomViewModelBase { ... }  // DevExpress.Mvvm 已提供

// ❌ 错误：重复实现项目中已有的功能
public class CustomLogger { ... }  // 项目已有 LoggingService

// ❌ 错误：没有查找就手动实现
public class DataValidator { ... }  // 框架可能已提供验证功能
```

### ✅ 正确操作

```csharp
// ✅ 正确：使用框架提供的功能
public class MainViewModel : DevExpress.Mvvm.ViewModelBase { ... }

// ✅ 正确：使用项目已有的服务
var logger = LoggingService.Instance;
logger.Info("模块", "消息");

// ✅ 正确：需求简单时手动实现
private void NavigateToPage(string pageKey) { ... }  // 简单导航，不需要复杂框架
```

### 📋 评估清单

在决定是否手动实现前，检查：

- [ ] 是否已查找现有实现？
- [ ] 现有实现是否满足需求？
- [ ] 现有实现是否适合项目？
- [ ] 手动实现的必要性？

### 🔗 详细文档

`AI工作规则/代码实现原则.md`

---

## 📚 库功能文档维护 - 快速参考

### 🚦 核心原则

```
代码变更 → 必须同步更新文档 → 一起提交
```

### ❌ 禁止操作

```javascript
// ❌ 错误：只修改代码，不更新文档
- 新增方法 web.NewMethod()
- 没有更新 Unit.la/使用手册.md

// ❌ 错误：文档与代码不一致
- 代码: web.Click(selector, waitMs = 1000)
- 文档: web.Click(selector)  // 缺少新参数说明

// ❌ 错误：示例代码无法运行
- 文档中的示例使用了错误的API
- 没有经过测试验证
```

### ✅ 正确操作

```javascript
// ✅ 正确：新增功能同步更新文档
1. 添加代码: web.NewMethod()
2. 更新 Unit.la/使用手册.md
   - 添加API文档
   - 提供使用示例
   - 更新更新日志
3. 创建功能完成报告（可选）

// ✅ 正确：修改功能标注变更
1. 修改代码签名
2. 更新文档中所有相关部分
3. 在"更新日志"中说明变更
4. 如不兼容，提供迁移指南

// ✅ 正确：删除功能标记废弃
1. 标记代码为 [Obsolete]
2. 在文档中标记"已废弃"
3. 提供替代方案
4. 更新日志记录删除原因
```

### 📋 文档更新检查清单

#### 新增功能
- [ ] 更新"库概述"章节
- [ ] 添加详细API文档
- [ ] 提供至少2个示例
- [ ] 更新"更新日志"
- [ ] 更新目录
- [ ] 创建功能完成报告

#### 修改功能
- [ ] 更新API文档
- [ ] 更新示例代码
- [ ] 更新"更新日志"
- [ ] 标注不兼容变更

#### 删除功能
- [ ] 标记"已废弃"
- [ ] 提供替代方案
- [ ] 更新"更新日志"

### 📖 主要文档位置

```
Unit.la/
  ├── 使用手册.md                    ← 主文档（必须维护）
  ├── [功能名称]-完成报告.md          ← 功能文档（推荐）
  └── [功能名称]-快速参考.md          ← 快速参考（可选）
```

### 🔗 详细文档

`AI工作规则/库功能文档维护规则.md`

---

**记住**：
- 用户环境正常 ✅
- 工具有限制 ⚠️
- 创建脚本 👍
- 让用户执行 👍
- 脚本中文字符串用Base64编码 🔐
- **优先使用现成实现** 🎯
- **不要重复造轮子** ⚙️
- **代码与文档必须同步** 📚
- **每次库变更必须更新文档** 📝

